function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function PromiseCapability(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i}),this.resolve=_aFunction(t),this.reject=_aFunction(r)}function isNonNullObject(e){return!!e&&"object"==typeof e}function isSpecial(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||isReactElement(e)}function isReactElement(e){return e.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(e){return Array.isArray(e)?[]:{}}function cloneUnlessOtherwiseSpecified(e,t){return!1!==t.clone&&t.isMergeableObject(e)?deepmerge(emptyTarget(e),e,t):e}function defaultArrayMerge(e,t,r){return e.concat(t).map(function(e){return cloneUnlessOtherwiseSpecified(e,r)})}function mergeObject(e,t,r){var i={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(t){i[t]=cloneUnlessOtherwiseSpecified(e[t],r)}),Object.keys(t).forEach(function(n){r.isMergeableObject(t[n])&&e[n]?i[n]=deepmerge(e[n],t[n],r):i[n]=cloneUnlessOtherwiseSpecified(t[n],r)}),i}function deepmerge(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||defaultArrayMerge,r.isMergeableObject=r.isMergeableObject||isMergeableObject;var i=Array.isArray(t);return i===Array.isArray(e)?i?r.arrayMerge(e,t,r):mergeObject(e,t,r):cloneUnlessOtherwiseSpecified(t,r)}import Player from"xgplayer";var _global=createCommonjsModule(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),_aFunction=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},_ctx=function(e,t,r){if(_aFunction(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},toString={}.toString,_cof=function(e){return toString.call(e).slice(8,-1)},_core=createCommonjsModule(function(e){var t=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=t)}),_core_1=_core.version,_shared=createCommonjsModule(function(e){var t=_global["__core-js_shared__"]||(_global["__core-js_shared__"]={});(e.exports=function(e,r){return t[e]||(t[e]=void 0!==r?r:{})})("versions",[]).push({version:_core.version,mode:"global",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),id=0,px=Math.random(),_uid=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++id+px).toString(36))},_wks=createCommonjsModule(function(e){var t=_shared("wks"),r=_global.Symbol,i="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=i&&r[e]||(i?r:_uid)("Symbol."+e))}).store=t}),TAG=_wks("toStringTag"),ARG="Arguments"==_cof(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}},_classof=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet(t=Object(e),TAG))?r:ARG?_cof(t):"Object"==(i=_cof(t))&&"function"==typeof t.callee?"Arguments":i},_isObject=function(e){return"object"==typeof e?null!==e:"function"==typeof e},_anObject=function(e){if(!_isObject(e))throw TypeError(e+" is not an object!");return e},_fails=function(e){try{return!!e()}catch(e){return!0}},_descriptors=!_fails(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),document$1=_global.document,is=_isObject(document$1)&&_isObject(document$1.createElement),_domCreate=function(e){return is?document$1.createElement(e):{}},_ie8DomDefine=!_descriptors&&!_fails(function(){return 7!=Object.defineProperty(_domCreate("div"),"a",{get:function(){return 7}}).a}),_toPrimitive=function(e,t){if(!_isObject(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!_isObject(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!_isObject(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!_isObject(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},dP=Object.defineProperty,f=_descriptors?Object.defineProperty:function(e,t,r){if(_anObject(e),t=_toPrimitive(t,!0),_anObject(r),_ie8DomDefine)try{return dP(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e},_objectDp={f:f},_propertyDesc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},_hide=_descriptors?function(e,t,r){return _objectDp.f(e,t,_propertyDesc(1,r))}:function(e,t,r){return e[t]=r,e},hasOwnProperty={}.hasOwnProperty,_has=function(e,t){return hasOwnProperty.call(e,t)},_redefine=createCommonjsModule(function(e){var t=_uid("src"),r=Function.toString,i=(""+r).split("toString");_core.inspectSource=function(e){return r.call(e)},(e.exports=function(e,r,n,a){var o="function"==typeof n;o&&(_has(n,"name")||_hide(n,"name",r)),e[r]!==n&&(o&&(_has(n,t)||_hide(n,t,e[r]?""+e[r]:i.join(String(r)))),e===_global?e[r]=n:a?e[r]?e[r]=n:_hide(e,r,n):(delete e[r],_hide(e,r,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||r.call(this)})}),PROTOTYPE="prototype",$export=function(e,t,r){var i,n,a,o,s=e&$export.F,u=e&$export.G,f=e&$export.S,c=e&$export.P,d=e&$export.B,l=u?_global:f?_global[t]||(_global[t]={}):(_global[t]||{})[PROTOTYPE],h=u?_core:_core[t]||(_core[t]={}),m=h[PROTOTYPE]||(h[PROTOTYPE]={});u&&(r=t);for(i in r)a=((n=!s&&l&&void 0!==l[i])?l:r)[i],o=d&&n?_ctx(a,_global):c&&"function"==typeof a?_ctx(Function.call,a):a,l&&_redefine(l,i,a,e&$export.U),h[i]!=a&&_hide(h,i,o),c&&m[i]!=a&&(m[i]=a)};_global.core=_core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var _export=$export,_anInstance=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e},_iterCall=function(e,t,r,i){try{return i?t(_anObject(r)[0],r[1]):t(r)}catch(t){var n=e.return;throw void 0!==n&&_anObject(n.call(e)),t}},_iterators={},ITERATOR=_wks("iterator"),ArrayProto=Array.prototype,_isArrayIter=function(e){return void 0!==e&&(_iterators.Array===e||ArrayProto[ITERATOR]===e)},ceil=Math.ceil,floor=Math.floor,_toInteger=function(e){return isNaN(e=+e)?0:(e>0?floor:ceil)(e)},min=Math.min,_toLength=function(e){return e>0?min(_toInteger(e),9007199254740991):0},ITERATOR$1=_wks("iterator"),core_getIteratorMethod=_core.getIteratorMethod=function(e){if(void 0!=e)return e[ITERATOR$1]||e["@@iterator"]||_iterators[_classof(e)]},_forOf=createCommonjsModule(function(e){var t={},r={},i=e.exports=function(e,i,n,a,o){var s,u,f,c,d=o?function(){return e}:core_getIteratorMethod(e),l=_ctx(n,a,i?2:1),h=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(_isArrayIter(d)){for(s=_toLength(e.length);s>h;h++)if((c=i?l(_anObject(u=e[h])[0],u[1]):l(e[h]))===t||c===r)return c}else for(f=d.call(e);!(u=f.next()).done;)if((c=_iterCall(f,l,u.value,i))===t||c===r)return c};i.BREAK=t,i.RETURN=r}),SPECIES=_wks("species"),_speciesConstructor=function(e,t){var r,i=_anObject(e).constructor;return void 0===i||void 0==(r=_anObject(i)[SPECIES])?t:_aFunction(r)},_invoke=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},document$2=_global.document,_html=document$2&&document$2.documentElement,process=_global.process,setTask=_global.setImmediate,clearTask=_global.clearImmediate,MessageChannel=_global.MessageChannel,Dispatch=_global.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port,run=function(){var e=+this;if(queue.hasOwnProperty(e)){var t=queue[e];delete queue[e],t()}},listener=function(e){run.call(e.data)};setTask&&clearTask||(setTask=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return queue[++counter]=function(){_invoke("function"==typeof e?e:Function(e),t)},defer(counter),counter},clearTask=function(e){delete queue[e]},"process"==_cof(process)?defer=function(e){process.nextTick(_ctx(run,e,1))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(_ctx(run,e,1))}:MessageChannel?(port=(channel=new MessageChannel).port2,channel.port1.onmessage=listener,defer=_ctx(port.postMessage,port,1)):_global.addEventListener&&"function"==typeof postMessage&&!_global.importScripts?(defer=function(e){_global.postMessage(e+"","*")},_global.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in _domCreate("script")?function(e){_html.appendChild(_domCreate("script"))[ONREADYSTATECHANGE]=function(){_html.removeChild(this),run.call(e)}}:function(e){setTimeout(_ctx(run,e,1),0)});var _task={set:setTask,clear:clearTask},macrotask=_task.set,Observer=_global.MutationObserver||_global.WebKitMutationObserver,process$1=_global.process,Promise$1=_global.Promise,isNode="process"==_cof(process$1),_microtask=function(){var e,t,r,i=function(){var i,n;for(isNode&&(i=process$1.domain)&&i.exit();e;){n=e.fn,e=e.next;try{n()}catch(i){throw e?r():t=void 0,i}}t=void 0,i&&i.index()};if(isNode)r=function(){process$1.nextTick(i)};else if(!Observer||_global.navigator&&_global.navigator.standalone)if(Promise$1&&Promise$1.resolve){var n=Promise$1.resolve(void 0);r=function(){n.then(i)}}else r=function(){macrotask.call(_global,i)};else{var a=!0,o=document.createTextNode("");new Observer(i).observe(o,{characterData:!0}),r=function(){o.data=a=!a}}return function(i){var n={fn:i,next:void 0};t&&(t.next=n),e||(e=n,r()),t=n}},f$1=function(e){return new PromiseCapability(e)},_newPromiseCapability={f:f$1},_perform=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},navigator=_global.navigator,_userAgent=navigator&&navigator.userAgent||"",_promiseResolve=function(e,t){if(_anObject(e),_isObject(t)&&t.constructor===e)return t;var r=_newPromiseCapability.f(e);return(0,r.resolve)(t),r.promise},_redefineAll=function(e,t,r){for(var i in t)_redefine(e,i,t[i],r);return e},def=_objectDp.f,TAG$1=_wks("toStringTag"),_setToStringTag=function(e,t,r){e&&!_has(e=r?e:e.prototype,TAG$1)&&def(e,TAG$1,{configurable:!0,value:t})},SPECIES$1=_wks("species"),_setSpecies=function(e){var t=_global[e];_descriptors&&t&&!t[SPECIES$1]&&_objectDp.f(t,SPECIES$1,{configurable:!0,get:function(){return this}})},ITERATOR$2=_wks("iterator"),SAFE_CLOSING=!1;try{var riter=[7][ITERATOR$2]();riter.return=function(){SAFE_CLOSING=!0},Array.from(riter,function(){throw 2})}catch(e){}var _iterDetect=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var r=!1;try{var i=[7],n=i[ITERATOR$2]();n.next=function(){return{done:r=!0}},i[ITERATOR$2]=function(){return n},e(i)}catch(e){}return r},task=_task.set,microtask=_microtask(),PROMISE="Promise",TypeError$1=_global.TypeError,process$2=_global.process,versions=process$2&&process$2.versions,v8=versions&&versions.v8||"",$Promise=_global[PROMISE],isNode$1="process"==_classof(process$2),empty=function(){},Internal,newGenericPromiseCapability,OwnPromiseCapability,Wrapper,newPromiseCapability=newGenericPromiseCapability=_newPromiseCapability.f,USE_NATIVE=!!function(){try{var e=$Promise.resolve(1),t=(e.constructor={})[_wks("species")]=function(e){e(empty,empty)};return(isNode$1||"function"==typeof PromiseRejectionEvent)&&e.then(empty)instanceof t&&0!==v8.indexOf("6.6")&&-1===_userAgent.indexOf("Chrome/66")}catch(e){}}(),isThenable=function(e){var t;return!(!_isObject(e)||"function"!=typeof(t=e.then))&&t},notify=function(e, t){if(!e._n){e._n=!0;var r=e._c;microtask(function(){for(var i=e._v,n=1==e._s,a=0; r.length>a;)!function(t){var r,a,o,s=n?t.ok:t.fail,u=t.resolve,f=t.reject,c=t.domain;try{s?(n||(2==e._h&&onHandleUnhandled(e),e._h=1),!0===s?r=i:(c&&c.index(),r=s(i),c&&(c.exit(),o=!0)),r===t.promise?f(TypeError$1("Promise-chain cycle")):(a=isThenable(r))?a.call(r,u,f):u(r)):f(i)}catch(e){c&&!o&&c.exit(),f(e)}}(r[a++]);e._c=[],e._n=!1,t&&!e._h&&onUnhandled(e)})}},onUnhandled=function(e){task.call(_global,function(){var t,r,i,n=e._v,a=isUnhandled(e);if(a&&(t=_perform(function(){isNode$1?process$2.emit("unhandledRejection",n,e):(r=_global.onunhandledrejection)?r({promise:e,reason:n}):(i=_global.console)&&i.error&&i.error("Unhandled promise rejection",n)}),e._h=isNode$1||isUnhandled(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},isUnhandled=function(e){return 1!==e._h&&0===(e._a||e._c).length},onHandleUnhandled=function(e){task.call(_global,function(){var t;isNode$1?process$2.emit("rejectionHandled",e):(t=_global.onrejectionhandled)&&t({promise:e,reason:e._v})})},$reject=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),notify(t,!0))},$resolve=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw TypeError$1("Promise can't be resolved itself");(t=isThenable(e))?microtask(function(){var i={_w:r,_d:!1};try{t.call(e,_ctx($resolve,i,1),_ctx($reject,i,1))}catch(e){$reject.call(i,e)}}):(r._v=e,r._s=1,notify(r,!1))}catch(e){$reject.call({_w:r,_d:!1},e)}}};USE_NATIVE||($Promise=function(e){_anInstance(this,$Promise,PROMISE,"_h"),_aFunction(e),Internal.call(this);try{e(_ctx($resolve,this,1),_ctx($reject,this,1))}catch(e){$reject.call(this,e)}},(Internal=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=_redefineAll($Promise.prototype,{then:function(e,t){var r=newPromiseCapability(_speciesConstructor(this,$Promise));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=isNode$1?process$2.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&notify(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),OwnPromiseCapability=function(){var e=new Internal;this.promise=e,this.resolve=_ctx($resolve,e,1),this.reject=_ctx($reject,e,1)},_newPromiseCapability.f=newPromiseCapability=function(e){return e===$Promise||e===Wrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)}),_export(_export.G+_export.W+_export.F*!USE_NATIVE,{Promise:$Promise}),_setToStringTag($Promise,PROMISE),_setSpecies(PROMISE),Wrapper=_core[PROMISE],_export(_export.S+_export.F*!USE_NATIVE,PROMISE,{reject:function(e){var t=newPromiseCapability(this);return(0,t.reject)(e),t.promise}}),_export(_export.S+_export.F*!USE_NATIVE,PROMISE,{resolve:function(e){return _promiseResolve(this,e)}}),_export(_export.S+_export.F*!(USE_NATIVE&&_iterDetect(function(e){$Promise.all(e).catch(empty)})),PROMISE,{all:function(e){var t=this,r=newPromiseCapability(t),i=r.resolve,n=r.reject,a=_perform(function(){var r=[],a=0,o=1;_forOf(e,!1,function(e){var s=a++,u=!1;r.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,r[s]=e,--o||i(r))},n)}),--o||i(r)});return a.e&&n(a.v),r.promise},race:function(e){var t=this,r=newPromiseCapability(t),i=r.reject,n=_perform(function(){_forOf(e,!1,function(e){t.resolve(e).then(r.resolve,i)})});return n.e&&i(n.v),r.promise}});var _defined=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},_stringRepeat=function(e){var t=String(_defined(this)),r="",i=_toInteger(e);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r},_stringPad=function(e,t,r,i){var n=String(_defined(e)),a=n.length,o=void 0===r?" ":String(r),s=_toLength(t);if(s<=a||""==o)return n;var u=s-a,f=_stringRepeat.call(o,Math.ceil(u/o.length));return f.length>u&&(f=f.slice(0,u)),i?f+n:n+f};_export(_export.P+_export.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(_userAgent),"String",{padStart:function(e){return _stringPad(this,e,arguments.length>1?arguments[1]:void 0,!0)}});var isImplemented=function(){var e,t=Object.assign;return"function"==typeof t&&(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},isImplemented$1=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}},noop=function(){},_undefined=noop(),isValue=function(e){return e!==_undefined&&null!==e},keys=Object.keys,shim=function(e){return keys(isValue(e)?Object(e):e)},keys$1=isImplemented$1()?Object.keys:shim,validValue=function(e){if(!isValue(e))throw new TypeError("Cannot use null or undefined");return e},max=Math.max,shim$1=function(e,t){var r,i,n,a=max(arguments.length,2);for(e=Object(validValue(e)),n=function(i){try{e[i]=t[i]}catch(e){r||(r=e)}},i=1;i<a;++i)t=arguments[i],keys$1(t).forEach(n);if(void 0!==r)throw r;return e},assign=isImplemented()?Object.assign:shim$1,forEach=Array.prototype.forEach,create=Object.create,process$3=function(e,t){var r;for(r in e)t[r]=e[r]},normalizeOptions=function(e){var t=create(null);return forEach.call(arguments,function(e){isValue(e)&&process$3(Object(e),t)}),t},isCallable=function(e){return"function"==typeof e},str="razdwatrzy",isImplemented$2=function(){return"function"==typeof str.contains&&(!0===str.contains("dwa")&&!1===str.contains("foo"))},indexOf=String.prototype.indexOf,shim$2=function(e){return indexOf.call(this,e,arguments[1])>-1},contains=isImplemented$2()?String.prototype.contains:shim$2,d_1=createCommonjsModule(function(e){(e.exports=function(e,t){var r,i,n,a,o;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],null==e?(r=n=!0,i=!1):(r=contains.call(e,"c"),i=contains.call(e,"e"),n=contains.call(e,"w")),o={value:t,configurable:r,enumerable:i,writable:n},a?assign(normalizeOptions(a),o):o}).gs=function(e,t,r){var i,n,a,o;return"string"!=typeof e?(a=r,r=t,t=e,e=null):a=arguments[3],null==t?t=void 0:isCallable(t)?null==r?r=void 0:isCallable(r)||(a=r,r=void 0):(a=t,t=r=void 0),null==e?(i=!0,n=!1):(i=contains.call(e,"c"),n=contains.call(e,"e")),o={get:t,set:r,configurable:i,enumerable:n},a?assign(normalizeOptions(a),o):o}}),validCallable=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},eventEmitter=createCommonjsModule(function(e,t){var r,i,n,a,o,s,u,f=Function.prototype.apply,c=Function.prototype.call,d=Object.create,l=Object.defineProperty,h=Object.defineProperties,m=Object.prototype.hasOwnProperty,p={configurable:!0,enumerable:!1,writable:!0};o={on:r=function(e,t){var r;return validCallable(t),m.call(this,"__ee__")?r=this.__ee__:(r=p.value=d(null),l(this,"__ee__",p),p.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i=function(e,t){var i,a;return validCallable(t),a=this,r.call(this,e,i=function(){n.call(a,e,i),f.call(t,this,arguments)}),i.__eeOnceListener__=t,this},off:n=function(e,t){var r,i,n,a;if(validCallable(t),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==typeof(i=r[e]))for(a=0;n=i[a];++a)n!==t&&n.__eeOnceListener__!==t||(2===i.length?r[e]=i[a?0:1]:i.splice(a,1));else i!==t&&i.__eeOnceListener__!==t||delete r[e];return this},emit:a=function(e){var t,r,i,n,a;if(m.call(this,"__ee__")&&(n=this.__ee__[e]))if("object"==typeof n){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(n=n.slice(),t=0;i=n[t];++t)f.call(i,this,a)}else switch(arguments.length){case 1:c.call(n,this);break;case 2:c.call(n,this,arguments[1]);break;case 3:c.call(n,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];f.call(n,this,a)}}},s={on:d_1(r),once:d_1(i),off:d_1(n),emit:d_1(a)},u=h({},s),e.exports=t=function(e){return null==e?d(u):h(Object(e),s)},t.methods=o}),eventEmitter_1=eventEmitter.methods,isMergeableObject=function(e){return isNonNullObject(e)&&!isSpecial(e)},canUseSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;deepmerge.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,r){return deepmerge(e,r,t)},{})};var deepmerge_1=deepmerge,version="1.1.8",_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_Errors=function(e){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";classCallCheck(this,t),i.version=version;var a=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));return a.url=n,a}return inherits(t,e),t}(Player.Errors),Stream=function(){function e(t){if(classCallCheck(this,e),!(t instanceof ArrayBuffer))throw new _Errors("parse","",{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return createClass(e,[{key:"skip",value:function(t){for(var r=Math.floor(t/4),i=t%4,n=0;n<r;n++)e.readByte(this.dataview,4);i>0&&e.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,r){var i=void 0;switch(t){case 1:i=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw"not supported for readByte 3";i=e.getUint8(e.position)<<16,i|=e.getUint8(e.position+1)<<8,i|=e.getUint8(e.position+2);break;case 4:i=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new _Errors("parse","",{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});i=e.getUint32(e.position)<<32,i|=e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}]),e}(),Box=function(){function e(){classCallCheck(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return createClass(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new _Errors("parse","",{line:19,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],r=0;r<16;r++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var r=this.size-t.position+this.start,i=this.type;this.data=t.buffer.slice(t.position,t.position+r),t.position+=this.data.byteLength;var n=void 0;(n=e.containerBox.find(function(e){return e===i})?e.containerParser:e[i])&&n instanceof Function&&n.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new Stream(this.data),r=t.buffer.byteLength,i=this;t.position<r;){var n=new e;n.readHeader(t),i.subBox.push(n),n.readBody(t)}delete i.data,t=null}}]),e}();Box.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra"],Box.avc1=function(){var e=new Stream(this.data),t=this;e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var r=0;r<31;r++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var i=new Box;i.readHeader(e),t.subBox.push(i),i.readBody(e)}delete this.data,e=null},Box.avcC=function(){var e=new Stream(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var r=[],i=0;i<t;i++)r.push(Number(e.readUint8()).toString(16));this.ppsCount=e.readUint8();var n=e.readUint16();this.ppsLength=n;for(var a=[],o=0;o<n;o++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sequence=r;for(var s=[],u=e.dataview.byteLength;e.position<u;)s.push(e.readUint8());this.last=s,delete this.subBox,delete this.data,e=null},Box.btrt=function(){var e=new Stream(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null},Box.co64=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,i=this.count;r<i;r++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null},Box.ctts=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var r=0,i=this.entryCount;r<i;r++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null},Box.dref=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var r=this,i=0;i<t;i++){var n=new Box;r.subBox.push(n),n.read(e)}delete this.data,e=null},Box.elst=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=[],r=e.readUint32();this.entries=t;for(var i=0;i<r;i++){var n={};t.push(n),1===this.version?(n.segment_duration=e.readUint64(),n.media_time=e.readUint64()):(n.segment_duration=e.readUint32(),n.media_time=e.readInt32()),n.media_rate_integer=e.readInt16(),n.media_rate_fraction=e.readInt16()}delete this.subBox,delete this.data,e=null},Box.esds=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=Box.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null},Box.ftyp=function(){var e=new Stream(this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],r=0,i=Math.floor((e.buffer.byteLength-8)/4);r<i;r++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data},Box.hdlr=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null},Box.iods=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null},Box.mdat=function(){delete this.subBox};var UTC=function(){function e(){classCallCheck(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return createClass(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();Box.mdhd=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null},Box.mp4a=function(){var e=new Stream(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null},Box.MP4DecConfigDescrTag=function(e){var t=new Box,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=Stream.readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(Box.MP4DecSpecificDescrTag(e)),t},Box.MP4DecSpecificDescrTag=function(e){var t=new Box,r=void 0,i=void 0;t.type=e.readUint8(),128===(r=e.readUint8())?(t.extend=!0,e.skip(2),i=(r=e.readUint8()+5)-5):(i=r,r+=2),t.size=r;for(var n=[],a=0;a<i;a++)n.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=n,delete t.subBox,t},Box.MP4ESDescrTag=function(e){var t=new Box,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(Box.MP4DecConfigDescrTag(e)),t.subBox.push(Box.SLConfigDescriptor(e)),t},Box.mvhd=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),Stream.readByte(e.dataview,8),Stream.readByte(e.dataview,2);for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,Stream.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data},Box.pasp=function(){var e=new Stream(this.data);this.content=e.buffer.slice(0,this.size-8),delete this.subBox,delete this.data,e=null},Box.SLConfigDescriptor=function(e){var t=new Box,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.SL=e.readUint8(),delete t.subBox,t},Box.smhd=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null},Box.stco=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,i=this.count;r<i;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Box.stsc=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,i=this.count;r<i;r++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var n,a,o=0,s=this.count;o<s-1;o++)n=t[o],a=t[o-1],n.chunk_count=t[o+1].first_chunk-n.first_chunk,n.first_sample=0===o?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var u=t[0];u.first_sample=1,u.chunk_count=0}else if(this.count>1){var f=t[this.count-1],c=t[this.count-2];f.first_sample=c.first_sample+c.chunk_count*c.samples_per_chunk,f.chunk_count=0}delete this.subBox,delete this.data,e=null},Box.stsd=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null},Box.stss=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,i=this.count;r<i;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Box.stsz=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,i=this.count;r<i;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Box.stts=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],r=0,i=this.count;r<i;r++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null},Box.tkhd=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null},Box.udta=function(){delete this.subBox},Box["url "]=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null},Box.vmhd=function(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null};var concat=createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var a=!0,o=!1,s=void 0;try{for(var u,f=i[Symbol.iterator]();!(a=(u=f.next()).done);a=!0)t+=u.value.length}catch(e){o=!0,s=e}finally{try{!a&&f.return&&f.return()}finally{if(o)throw s}}var c=new e(t),d=0,l=!0,h=!1,m=void 0;try{for(var p,v=i[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var y=p.value;c.set(y,d),d+=y.length}}catch(e){h=!0,m=e}finally{try{!l&&v.return&&v.return()}finally{if(h)throw m}}return c}});unwrapExports(concat);var lib=createCommonjsModule(function(e){var t=function(e){return e&&e.__esModule?e:{default:e}}(concat);e.exports=t.default}),Concat=unwrapExports(lib),Parse=function e(t){classCallCheck(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;var r=this;r.buffer?Concat(Uint8Array,r.buffer,t):r.buffer=t;var i=t.byteLength;t.position=0;for(var n=new Stream(t);i-n.position>=8;){var a=new Box;if(a.readHeader(n),a.size-8<=i-n.position)a.readBody(n),r.boxes.push(a);else{if("mdat"!==a.type){r.nextBox=a,n.position-=8;break}a.readBody(n),r.boxes.push(a)}}r.buffer=new Uint8Array(r.buffer.slice(n.position))},Buffer=function(){function e(){classCallCheck(this,e),this.buffer=new Uint8Array(0)}return createClass(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];r.forEach(function(t){t?e.buffer=Concat(Uint8Array,e.buffer,t):window.console.error(t)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),UINT32_MAX=Math.pow(2,32)-1,FMP4=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return Buffer.writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new Buffer;return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])),t.buffer}},{key:"moov",value:function(t){var r=new Buffer,i=8,n=e.mvhd(t.duration,t.timeScale),a=e.videoTrak(t),o=e.audioTrak(t),s=e.mvex(t.duration,t.timeScale);return[n,a,o,s].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("moov"),n,a,o,s),r.buffer}},{key:"mvhd",value:function(t,r){var i=new Buffer;t*=r;var n=Math.floor(t/(UINT32_MAX+1)),a=Math.floor(t%(UINT32_MAX+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i.write(e.size(8+o.length),e.type("mvhd"),new Uint8Array(o)),i.buffer}},{key:"videoTrak",value:function(t){var r=new Buffer,i=8,n=e.tkhd({id:1,duration:t.videoDuration,timescale:t.videoTimeScale,width:t.width,height:t.height,type:"video"}),a=e.mdia({type:"video",timescale:t.videoTimeScale,duration:t.videoDuration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[n,a].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("trak"),n,a),r.buffer}},{key:"audioTrak",value:function(t){var r=new Buffer,i=8,n=e.tkhd({id:2,duration:t.audioDuration,timescale:t.audioTimeScale,width:0,height:0,type:"audio"}),a=e.mdia({type:"audio",timescale:t.audioTimeScale,duration:t.audioDuration,channelCount:t.channelCount,samplerate:t.sampleRate,audioConfig:t.audioConfig});return[n,a].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("trak"),n,a),r.buffer}},{key:"tkhd",value:function(t){var r=new Buffer,i=t.id,n=t.duration*t.timeScale,a=t.width,o=t.height,s=t.type,u=Math.floor(n/(UINT32_MAX+1)),f=Math.floor(n%(UINT32_MAX+1)),c=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,u>>24,u>>16&255,u>>8&255,255&u,f>>24,f>>16&255,f>>8&255,255&f,0,0,0,0,0,0,0,0,0,0,0,"video"===s?1:0,"audio"===s?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]);return r.write(e.size(8+c.byteLength),e.type("tkhd"),c),r.buffer}},{key:"edts",value:function(t){var r=new Buffer,i=t.duration,n=t.mediaTime;return r.write(e.size(36),e.type("edts")),r.write(e.size(28),e.type("elst")),r.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,1])),r.buffer}},{key:"mdia",value:function(t){var r=new Buffer,i=8,n=e.mdhd(t.timescale),a=e.hdlr(t.type),o=e.minf(t);return[n,a,o].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("mdia"),n,a,o),r.buffer}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new Buffer;r*=t;var n=Math.floor(r/(UINT32_MAX+1)),a=Math.floor(r%(UINT32_MAX+1)),o=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]);return i.write(e.size(12+o.byteLength),e.type("mdhd"),e.extension(1,0),o),i.buffer}},{key:"hdlr",value:function(t){var r=new Buffer,i=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(i.splice.apply(i,[8,4].concat([115,111,117,110])),i.splice.apply(i,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),r.write(e.size(8+i.length),e.type("hdlr"),new Uint8Array(i)),r.buffer}},{key:"minf",value:function(t){var r=new Buffer,i=8,n="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),o=e.stbl(t);return[n,a,o].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("minf"),n,a,o),r.buffer}},{key:"vmhd",value:function(){var t=new Buffer;return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new Buffer;return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new Buffer,r=[0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1];return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array(r)),t.buffer}},{key:"stbl",value:function(t){var r=new Buffer,i=8,n=e.stsd(t),a=e.stts(),o=e.stsc(),s=e.stsz(),u=e.stco();return[n,a,o,s,u].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("stbl"),n,a,o,s,u),r.buffer}},{key:"stsd",value:function(t){var r=new Buffer,i=void 0;return i="audio"===t.type?e.mp4a(t):e.avc1(t),r.write(e.size(16+i.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),i),r.buffer}},{key:"mp4a",value:function(t){var r=new Buffer,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),n=e.esds(t.audioConfig);return r.write(e.size(8+i.byteLength+n.byteLength),e.type("mp4a"),i,n),r.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],r=t.length,i=new Buffer,n=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2]));return i.write(e.size(8+n.byteLength),e.type("esds"),n),i.buffer}},{key:"avc1",value:function(t){var r=new Buffer,i=t.sps,n=t.pps,a=t.width,o=t.height,s=t.pixelRatio[0],u=t.pixelRatio[1],f=new Uint8Array([1,i[1],i[2],i[3],255,225].concat([i.length>>>8&255,255&i.length]).concat(i).concat(1).concat([n.length>>>8&255,255&n.length]).concat(n)),c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,o>>8&255,255&o,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),l=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u]);return r.write(e.size(40+c.byteLength+f.byteLength+d.byteLength),e.type("avc1"),c,e.size(8+f.byteLength),e.type("avcC"),f,e.size(20),e.type("btrt"),d,e.size(16),e.type("pasp"),l),r.buffer}},{key:"stts",value:function(){var t=new Buffer,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),r),t.buffer}},{key:"stsc",value:function(){var t=new Buffer,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),r),t.buffer}},{key:"stco",value:function(){var t=new Buffer,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),r),t.buffer}},{key:"stsz",value:function(){var t=new Buffer,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),r),t.buffer}},{key:"mvex",value:function(t,r){var i=new Buffer,n=Buffer.writeUint32(t*r);return i.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),n,e.trex(1),e.trex(2)),i.buffer}},{key:"trex",value:function(t){var r=new Buffer,i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return r.write(e.size(8+i.byteLength),e.type("trex"),i),r.buffer}},{key:"moof",value:function(t){var r=new Buffer,i=8,n=e.mfhd(),a=e.traf(t);return[n,a].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("moof"),n,a),r.buffer}},{key:"mfhd",value:function(){var t=new Buffer,r=Buffer.writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),r),t.buffer}},{key:"traf",value:function(t){var r=new Buffer,i=8,n=e.tfhd(t.id),a=e.tfdt(t.time),o=e.sdtp(t),s=e.trun(t,o.byteLength);return[n,a,o,s].forEach(function(e){i+=e.byteLength}),r.write(e.size(i),e.type("traf"),n,a,o,s),r.buffer}},{key:"tfhd",value:function(t){var r=new Buffer,i=Buffer.writeUint32(t);return r.write(e.size(16),e.type("tfhd"),e.extension(0,0),i),r.buffer}},{key:"tfdt",value:function(t){var r=new Buffer,i=Math.floor(t/(UINT32_MAX+1)),n=Math.floor(t%(UINT32_MAX+1));return r.write(e.size(20),e.type("tfdt"),e.extension(1,0),Buffer.writeUint32(i),Buffer.writeUint32(n)),r.buffer}},{key:"trun",value:function(t,r){var i=t.id,n=1===i?16:12,a=new Buffer,o=Buffer.writeUint32(t.samples.length),s=Buffer.writeUint32(96+n*t.samples.length+r);return a.write(e.size(20+n*t.samples.length),e.type("trun"),e.extension(0,t.flags),o,s),t.samples.forEach(function(e,t){a.write(Buffer.writeUint32(e.duration)),a.write(Buffer.writeUint32(e.size)),1===i?(a.write(Buffer.writeUint32(e.key?33554432:16842752)),a.write(Buffer.writeUint32(e.offset))):a.write(Buffer.writeUint32(16777216))}),a.buffer}},{key:"sdtp",value:function(t){var r=new Buffer;return r.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(function(e){r.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))}),r.buffer}},{key:"mdat",value:function(t){var r=new Buffer,i=8;return t.samples.forEach(function(e){i+=e.size}),r.write(e.size(i),e.type("mdat")),t.samples.forEach(function(e){r.write(e.buffer)}),r.buffer}}]),e}();FMP4.sequence=1;var Task=function(){function e(t,r,i,n){classCallCheck(this,e),eventEmitter(this),this.url=t,this.range=r,this.withCredentials=i,this.id=r.join("-"),this.on=!1;var a=new window.XMLHttpRequest;a.target=this,a.responseType="arraybuffer",a.withCredentials=this.withCredentials||!1,a.open("get",t),a.setRequestHeader("Range","bytes="+r[0]+"-"+r[1]),a.onload=function(){200!==a.status&&206!==a.status||n&&n instanceof Function&&n(a.response),a.target.remove()},a.onerror=function(e){a.target.emit("error",new _Errors("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),a.target.remove()},a.onabort=function(){a.target.remove()},this.xhr=a,e.queue.push(this),this.update()}return createClass(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter(function(r,i){return r.url===t.url&&r.id===t.id&&(e.queue.splice(i,1),!0)}),this.update()}},{key:"update",value:function(){var t=e.queue,r=t.filter(function(e){return e.on}),i=t.filter(function(e){return!e.on}),n=e.limit-r.length;i.forEach(function(e,t){t<n&&e.run()})}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach(function(e){e.on&&e.cancel()}),e.queue.length=0}}]),e}();Task.queue=[],Task.limit=2,window.Task=Task;var util={};util.findBox=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var i=e.subBox.filter(function(e){return e.type===t});i.length?i.forEach(function(e){return r.push(e)}):e.subBox.forEach(function(e){return util.findBox(e,t,r)})}}else r.push(e);return r=[].concat(r),r.length>1?r:r[0]},util.padStart=function(e,t,r){for(var i=String(r),n=t>>0,a=Math.ceil(n/i.length),o=[],s=String(e);a--;)o.push(i);return o.join("").substring(0,n-s.length)+s},util.toHex=function(){for(var e=[],t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.forEach(function(t){e.push(util.padStart(Number(t).toString(16),2,0))}),e},util.sum=function(){for(var e=0,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.forEach(function(t){e+=t}),e},util.stscOffset=function(e,t){var r=void 0,i="",n=e.entries.filter(function(e){return e.first_sample<=t&&t<e.first_sample+e.chunk_count*e.samples_per_chunk})[0];if(n){var a=Math.floor((t-n.first_sample)/n.samples_per_chunk),o=n.first_sample+a*n.samples_per_chunk;return r=n.first_chunk+a,i=[o,t],{chunk_index:r,samples_offset:i}}var s=e.entries.pop();e.entries.push(s);var u=Math.floor((t-s.first_sample)/s.samples_per_chunk);return{chunk_index:s.first_chunk+u,samples_offset:[s.first_sample+s.samples_per_chunk*u,t]}},util.seekSampleOffset=function(e,t,r,i,n){var a=util.stscOffset(e,i+1),o=t.entries[a.chunk_index-1]+util.sum.apply(null,r.entries.slice(a.samples_offset[0]-1,a.samples_offset[1]-1))-n;if(void 0===o)throw"result="+o+",stco.length="+t.entries.length+",sum="+util.sum.apply(null,r.entries.slice(0,i));if(o<0)throw"result="+o+",stco.length="+t.entries.length+",sum="+util.sum.apply(null,r.entries.slice(0,i));return o},util.seekSampleTime=function(e,t,r){var i=void 0,n=void 0,a=0,o=0,s=0;if(e.entry.every(function(e){return n=e.sampleDuration,r<a+e.sampleCount?(i=o+(r-a)*e.sampleDuration,!1):(a+=e.sampleCount,o+=e.sampleCount*n,!0)}),t){var u=0;t.entry.every(function(e){return u+=e.count,!(r<u)||(s=e.offset,!1)})}return i||(i=o+(r-a)*n),{time:i,duration:n,offset:s}},util.seekOrderSampleByTime=function(e,t,r){var i=0,n=0,a=0,o=void 0;return e.every(function(e,s){return o=e.sampleCount*e.sampleDuration/t,r<=i+o?(n=a+Math.ceil((r-i)*t/e.sampleDuration),i+=Math.ceil((r-i)*t/e.sampleDuration)*e.sampleDuration/t,!1):(i+=o,a+=e.sampleCount,!0)}),{order:n,startTime:i}},util.seekTrakDuration=function(e,t){var r=0;return util.findBox(e,"stts").entry.forEach(function(e){r+=e.sampleCount*e.sampleDuration}),Number(r/t).toFixed(4)};var MP4=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(25,4);classCallCheck(this,e),eventEmitter(this),this.url=t,this.withCredentials=r,this.CHUNK_SIZE=i,this.init(t),this.once("moovReady",this.moovParse.bind(this)),this.cache=new Buffer,this.bufferCache=new Set,this.timeRage=[],this.canDownload=!0}return createClass(e,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE,i=this;return new Promise(function(n,a){new Task(e.url,[t,r],e.withCredentials,n).once("error",function(e){i.emit("error",e)})})}},{key:"moovParse",value:function(){var e=this,t=this,r=this.moovBox,i=util.findBox(r,"mvhd"),n=void 0,a=void 0,o=void 0,s=void 0,u=void 0,f=void 0,c=void 0,d=void 0,l=void 0,h=void 0,m=void 0,p=void 0,v=void 0,y=void 0;util.findBox(r,"trak").forEach(function(e){var r=util.findBox(e,"hdlr"),i=util.findBox(e,"mdhd");if(!r||!i)return void t.emit("error",new _Errors("parse","",{line:72,handle:"[MP4] moovParse",url:t.url}));var _=util.findBox(e,"stsd").subBox[0];if("vide"===r.handleType){var g=util.findBox(e,"avcC"),b=util.findBox(e,"tkhd");n=e,u=i.timescale,g?(o=_.type+"."+util.toHex(g.profile,g.profileCompatibility,g.AVCLevelIndication).join(""),c=g.sequence&&g.sequence.map(function(e){return Number("0x"+e)}),d=g.pps&&g.pps.map(function(e){return Number("0x"+e)}),l=g.profile):o=""+_.type,b&&(h=b.width,m=b.height)}if("soun"===r.handleType){a=e;var w=util.findBox(e,"esds"),x=util.findBox(e,"mp4a"),U=util.findBox(e,5);f=i.timescale,s=w?_.type+"."+util.toHex(w.subBox[0].subBox[0].typeID)+"."+w.subBox[0].subBox[0].subBox[0].type:""+_.type,U&&U.EScode&&(y=U.EScode.map(function(e){return Number("0x"+e)})),x&&(p=x.channelCount,v=x.sampleRate)}}),this.videoTrak=deepmerge_1({},n),this.audioTrak=deepmerge_1({},a);var _=this._boxes.find(function(e){return"mdat"===e.type}),g=util.seekTrakDuration(n,u),b=util.seekTrakDuration(a,f);this.mdatStart=_.start;var w=this.videoKeyFrames,x=w.length-1;w.forEach(function(t,r){r<x?e.timeRage.push([t.time.time/u,w[r+1].time.time/u]):e.timeRage.push([t.time.time/u,-1])}),this.meta={videoCodec:o,audioCodec:s,createTime:i.createTime,modifyTime:i.modifyTime,duration:i.duration/i.timeScale,timeScale:i.timeScale,videoDuration:g,videoTimeScale:u,audioDuration:b,audioTimeScale:f,endTime:Math.min(g,b),sps:c,pps:d,width:h,height:m,profile:l,pixelRatio:[1,1],channelCount:p,sampleRate:v,audioConfig:y}}},{key:"init",value:function(){var e=this;e.getData().then(function(t){var r=void 0,i=0,n=void 0,a=void 0;try{r=new Parse(t)}catch(t){return e.emit("error",t.type?t:new _Errors("parse","",{line:176,handle:"[MP4] init",msg:t.message})),!1}if(e._boxes=a=r.boxes,a.every(function(t){return i+=t.size,"moov"!==t.type||(n=t,e.moovBox=n,e.emit("moovReady",n),!1)}),!n){var o=r.nextBox;o?"moov"===o.type?e.getData(i,i+o.size+28).then(function(t){var r=new Parse(t);e._boxes=e._boxes.concat(r.boxes),(n=r.boxes.filter(function(e){return"moov"===e.type})).length?(e.moovBox=n[0],e.emit("moovReady",n)):e.emit("error",new _Errors("parse","",{line:203,handle:"[MP4] init",msg:"not find moov box"}))}):e.emit("error",new _Errors("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"})):e.getData(i,"").then(function(t){var r=new Parse(t);r?(e._boxes=e._boxes.concat(r.boxes),r.boxes.every(function(t){return"moov"!==t.type||(n=t,e.moovBox=n,e.emit("moovReady",n),!1)})):e.emit("error",new _Errors("parse","",{line:225,handle:"[MP4] init",msg:"not find moov box"}))})}}).catch(function(){e.emit("error",new _Errors("network","",{line:231,handle:"[MP4] getData",msg:"getData failed"}))})}},{key:"getSamplesByOrders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments[1],r=arguments[2],i="video"===e?this.videoTrak:this.audioTrak,n=util.findBox(i,"stsc"),a=util.findBox(i,"stsz"),o=util.findBox(i,"stts"),s=util.findBox(i,"stco"),u=util.findBox(i,"ctts"),f=this.mdatStart,c=[];if(r=void 0!==r?r:a.entries.length,t instanceof Array)t.forEach(function(e,t){c.push({idx:e,size:a.entries[e],time:util.seekSampleTime(o,u,e),offset:util.seekSampleOffset(n,s,a,e,f)})});else if(0!==r)for(var d=t;d<r;d++)c.push({idx:d,size:a.entries[d],time:util.seekSampleTime(o,u,d),offset:util.seekSampleOffset(n,s,a,d,f)});else c={idx:t,size:a.entries[t],time:util.seekSampleTime(o,u,t),offset:util.seekSampleOffset(n,s,a,t,f)};return c}},{key:"packMeta",value:function(){if(this.meta){var e=new Buffer;return e.write(FMP4.ftyp()),e.write(FMP4.moov(this.meta)),this.cache.write(e.buffer),e.buffer}}},{key:"seek",value:function(e){var t=e*this.meta.videoTimeScale,r=void 0,i=this.videoKeyFrames,n=this.audioKeyFrames;return i.every(function(e,n){var a=e.time.time,o=i[n+1]?i[n+1].time.time:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(r=n,!1)}),n.every(function(e,i){var a=e.startTime,o=n[i+1]?n[i+1].startTime:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(r=Math.min(i,r),!1)}),this.bufferCache.has(r)?Promise.resolve(null):this.loadFragment(r)}},{key:"loadFragment",value:function(e){var t=void 0,r=void 0,i=this.videoKeyFrames[e],n=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);if(t=Math.min(i.offset,n.offset),e<this.videoKeyFrames.length-1){var a=this.videoKeyFrames[e+1],o=this.getSamplesByOrders("audio",this.audioKeyFrames[e+1].order,0);r=Math.max(a.offset,o.offset)}var s=this;return window.isNaN(t)||void 0!==r&&window.isNaN(r)?(s.emit("error",new _Errors("parse","",{line:366,handle:"[MP4] loadFragment",url:s.url})),!1):this.bufferCache.has(e)?Promise.resolve(null):this.getData(t+s.mdatStart,r?s.mdatStart+r:"").then(function(r){return s.createFragment(new Uint8Array(r),t,e)})}},{key:"addFragment",value:function(e){var t=new Buffer;return t.write(FMP4.moof(e)),t.write(FMP4.mdat(e)),this.cache.write(t.buffer),t.buffer}},{key:"createFragment",value:function(e,t,r){var i=this,n=[];this.bufferCache.add(r);var a=i.videoKeyFrames.map(function(e){return e.idx}),o=i.getSamplesByOrders("video",a[r],a[r+1]),s=o.map(function(r,i){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===i}});n.push(this.addFragment({id:1,time:o[0].time.time,firstFlags:33554432,flags:3841,samples:s}));var u=this.getSamplesByOrders("audio",this.audioKeyFrames[r].order,this.audioKeyFrames[r+1]?this.audioKeyFrames[r+1].order:void 0),f=u.map(function(r,i){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===i}});n.push(this.addFragment({id:2,time:u[0].time.time,firstFlags:0,flags:1793,samples:f}));var c=0;n.every(function(e){return c+=e.byteLength,!0});var d=new Uint8Array(c),l=0;return n.every(function(e){return d.set(e,l),l+=e.byteLength,!0}),Promise.resolve(d)}},{key:"download",value:function(){}},{key:"cut",value:function(e,t){var r=this;this.bufferCache.clear();var i=e*this.meta.videoTimeScale,n=t*this.meta.videoTimeScale,a=void 0,o=void 0,s=this.videoKeyFrames,u=this.audioKeyFrames;return s.every(function(e,t){var r=e.time.time,u=s[t+1]?s[t+1].time.time:Number.MAX_SAFE_INTEGER;return r<=i&&i<u?(a=t,!0):!(r<=n&&n<u)||(o=t,!1)}),u.every(function(e,t){var r=e.startTime,s=u[t+1]?u[t+1].startTime:Number.MAX_SAFE_INTEGER;return r<=i&&i<s?(a=Math.min(t,a),!0):!(r<=n&&n<s)||(o=Math.min(t,o),!1)}),o||(o=s.length),r.loadFragmentForCut(a,o)}},{key:"loadFragmentForCut",value:function(e,t){var r=void 0,i=void 0,n=this.videoKeyFrames[e],a=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);r=Math.min(n.offset,a.offset);var o=this.videoKeyFrames[t],s=this.getSamplesByOrders("audio",this.audioKeyFrames[t].order,0);i=Math.max(o.offset,s.offset);var u=this;return window.isNaN(r)||void 0!==i&&window.isNaN(i)?(u.emit("error",new _Errors("parse","",{line:366,handle:"[MP4] loadFragment",url:u.url})),!1):this.getData(r+u.mdatStart,i?u.mdatStart+i:"").then(function(n){return u.createFragmentForCut(new Uint8Array(n),r,e,i,t)})}},{key:"createFragmentForCut",value:function(e,t,r,i,n){var a=this,o=[],s=a.videoKeyFrames.map(function(e){return e.idx}),u=a.getSamplesByOrders("video",s[r],s[n]).map(function(r,i){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===i}});o.push(this.addFragment({id:1,time:0,firstFlags:33554432,flags:3841,samples:u}));var f=this.getSamplesByOrders("audio",this.audioKeyFrames[r].order,this.audioKeyFrames[n]?this.audioKeyFrames[n].order:void 0).map(function(r,i){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===i}});o.push(this.addFragment({id:2,time:0,firstFlags:0,flags:1793,samples:f}));var c=0;o.every(function(e){return c+=e.byteLength,!0});var d=new Uint8Array(c),l=0;return o.every(function(e){return d.set(e,l),l+=e.byteLength,!0}),Promise.resolve(d)}},{key:"videoKeyFrames",get:function(){if(this._videoFrames)return this._videoFrames;var e=this.videoTrak,t=util.findBox(e,"stss"),r=this.getSamplesByOrders("video",t.entries.map(function(e){return e-1}));return this._videoFrames=r,r}},{key:"audioKeyFrames",get:function(){if(this._audioFrames)return this._audioFrames;var e=util.findBox(this.videoTrak,"mdhd").timescale,t=util.findBox(this.audioTrak,"mdhd").timescale,r=util.findBox(this.audioTrak,"stts").entry,i=[];return i=this.videoKeyFrames.map(function(i){return util.seekOrderSampleByTime(r,t,i.time.time/e)}),this._audioFrames=i,this._audioFrames}}]),e}(),MSE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.64001E, mp4a.40.5"';classCallCheck(this,e);var r=this;eventEmitter(this),this.codecs=t,this.mediaSource=new window.MediaSource,this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this.updating=!1,this.mediaSource.addEventListener("sourceopen",function(){r.sourceBuffer=r.mediaSource.addSourceBuffer(r.codecs),r.sourceBuffer.addEventListener("error",function(e){r.emit("error",new _Errors("mse","",{line:16,handle:"[MSE] constructor sourceopen",msg:e.message}))}),r.sourceBuffer.addEventListener("updateend",function(e){r.emit("updateend");var t=r.queue.shift();t&&r.sourceBuffer&&!r.sourceBuffer.updating&&"open"===r.state&&r.sourceBuffer.appendBuffer(t)}),r.emit("sourceopen")}),this.mediaSource.addEventListener("sourceclose",function(){r.emit("sourceclose")})}return createClass(e,[{key:"appendBuffer",value:function(e){var t=this.sourceBuffer;return t&&!t.updating&&"open"===this.state?(t.appendBuffer(e),!0):(this.queue.push(e),!1)}},{key:"removeBuffer",value:function(e,t){this.sourceBuffer.remove(e,t)}},{key:"endOfStream",value:function(){"open"===this.state&&this.mediaSource.endOfStream()}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){this.mediaSource.duration=e}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}(),isEnded=function(e,t){if(t.meta.endTime-e.currentTime<2){var r=e.getBufferedRange();e.currentTime-r[1]<.1&&e.mse.endOfStream()}},mp4player=function(){var e=this,t=Player.sniffer,r=Player.util,i=Player.Errors,n=void 0,a=void 0,o=e.config.preloadTime||15,s=void 0,u=e.config.url,f=e.config.pluginRule||function(){return!0};if(!u)return void e.emit("error",new i("other",e.config.vid));"String"===r.typeOf(u)?n=u:"Array"===r.typeOf(u)&&u.length&&(n=u[0].src,u.length>1&&(a=u[1].src)),e.config._mainURL=n,e.config._backupURL=a;var c=function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.currentTime;e.timer&&clearTimeout(e.timer),i=Math.max(i,e.currentTime),e.timer=setTimeout(function(){e.mp4.seek(i+.1*r).then(function(t){if(t){var r=e.mse;r.updating=!0,r.appendBuffer(t),r.once("updateend",function(){r.updating=!1})}},function(){r<10&&setTimeout(function(){t(r+1)},2e3)})},50)},d=function(t){var r=new MP4(t,e.config.withCredentials),i=void 0;return new Promise(function(t,n){r.once("moovReady",function(){(i=new MSE).on("sourceopen",function(){i.appendBuffer(r.packMeta()),i.once("updateend",c.bind(e))}),i.on("error",function(e){n(e)}),t([r,i])}),r.on("error",function(e){n(e)})})};if(["chrome","firfox","safari"].some(function(e){return e===t.browser})&&MSE.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')){if(e._start=e.start,!f.call(e))return!1;var l=function(e,t){t.vid=e.config.vid,t.url=e.src,t.errd&&"object"===_typeof(t.errd)&&e.mp4&&(t.errd.url=e.mp4.url,t.url=e.mp4.url,e.mp4.canDownload=!1),e.emit("DATA_REPORT",t),Task.clear(),e.mp4&&e.mp4.bufferCache&&e.mp4.bufferCache.clear(),e.currentTime&&(e._currentTime=e.currentTime),e._start&&(e.start=e._start,e._start=null),e.switchURL=null,e._replay=null,clearInterval(e.mp4ProgressTimer),e.off("seeking",m),e.off("pause",p),e.off("playing",v),e.off("waiting",y),e.off("ended",_),e.off("destroy",g),"network"===t.errt&&e.config._backupURL?e.src=e.config._backupURL:e.src=e.config._mainURL,e.once("canplay",function(){e._currentTime&&(e.currentTime=e._currentTime),e.play()})};e.start=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;d(r).then(function(t){var i=t[0],n=t[1];e._start(n.url),e.logParams.pluginSrc=r,e.mp4=i,e.mse=n,i.on("error",function(t){l(e,t)})},function(t){e._start(r),l(e,t)}),e.once("canplay",function(){if("safari"===t.browser&&e.buffered){var r=e.buffered.start(0);e.currentTime=r+.1}})},e.cut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments[1],i=new Buffer,n=new MP4(u,e.config.withCredentials);return new Promise(function(e,a){n.once("moovReady",function(){(!r||r<=t)&&(r=t+15),r>n.meta.duration&&(t=n.meta.duration-(r-t),r=n.meta.duration),n.cut(t,r).then(function(a){if(a){var o=Player.util.deepCopy({duration:r-t,audioDuration:r-t,endTime:r-t},n.meta);o.duration=r-t,o.videoDuration=r-t,o.audioDuration=r-t,o.endTime=r-t,i.write(n.packMeta(o),a),e(new Blob([i.buffer],{type:'video/mp4; codecs="avc1.64001E, mp4a.40.5"'}))}})}),n.on("error",function(e){a(e)})})},e.switchURL=function(r){var i=new MP4(r,e.config.withCredentials),n=e.mp4;i.on("moovReady",function(){var a=n.timeRage,o=e.currentTime,s=(a=n.timeRage).find(function(e){return e[0]-o>2})[0],u=e.getBufferedRange()[1];u-s>0&&"safari"!==t.browser&&e.mse.removeBuffer(s,u),Player.util.hasClass(e.root,"xgplayer-ended")||e.emit("urlchange",JSON.parse(JSON.stringify(e.logParams))),e.logParams={bc:0,bu_acu_t:0,played:[{begin:e.video.currentTime,end:-1}],pt:(new Date).getTime(),vt:(new Date).getTime(),vd:0},e.mp4=i,e.mse.appendBuffer(i.packMeta()),e.logParams.pt=(new Date).getTime(),e.logParams.vt=(new Date).getTime(),e.logParams.vd=e.video.duration,e.logParams.pluginSrc=r}),i.on("error",function(t){l(e,t)})},e.playNext=function(t){var r=new MP4(t,e.config.withCredentials),i=e.mp4;r.on("moovReady",function(){var t=[0,0],n=e.video.buffered,a=e.video.currentTime,o=0;if(n)for(var s=0,u=n.length;s<u;s++)t[0]=n.start(s),t[1]=n.end(s),t[0]<=a&&t[1]<=a&&(o=t[1]>o?t[1]:o,e.mse.removeBuffer(t[0],t[1]));e.mp4=r,e.mse.appendBuffer(r.packMeta());var f=!0;e.on("timeupdate",function(){if(f&&i.meta.endTime-e.currentTime<2){var t=e.getBufferedRange();if(e.currentTime-t[1]<.1&&(f=!1,e.currentTime=0,n=e.video.buffered))for(var r=0,a=n.length;r<a;r++)t[0]=n.start(r),t[1]=n.end(r),t[0]>=o&&e.mse.removeBuffer(t[0],t[1])}})}),r.on("error",function(t){l(e,t)})};var h=function(){var t=e.mse,r=e.mp4;if(t&&!t.updating&&r.canDownload){var i=r.timeRage,n=e.getBufferedRange(),a=e.currentTime+o;if(n[1]-a>0)return;i.every(function(e,t){var i=(e[0]+e[1])/2;return 0!==n[1]&&(!(i>n[1]&&!r.bufferCache.has(t))||void c(0,i))}),isEnded(e,r)}};e.mp4ProgressTimer=setInterval(h,e.config.mp4ProgressTimer||300);var m=function(){var t=e.buffered,r=!1,i=e.currentTime;if(Task.clear(),t.length){for(var n=0,a=t.length;n<a;n++)if(i>=t.start(n)&&i<=t.end(n)){r=!0;break}r||c(0,i)}else c(0,e.currentTime)};e.on("seeking",m);var p=function(){Task.clear()};e.on("pause",p);var v=function(){s&&clearTimeout(s)};e.on("playing",v);var y=function(){var t=e.mp4;if(t&&t.meta){var r=e.getBufferedRange(),i=t.meta.videoDuration;i-e.currentTime<.5&&i-r[1]<.5?e.mse.endOfStream():(c(0,r[1]+1),s=setTimeout(function(){for(var t=e.buffered,r=void 0,i=0,n=t.length;i<n;i++)if((r=t.start(i))>=e.currentTime){e.currentTime=r;break}},1500))}};e.on("waiting",y);var _=function(){e.off("waiting",y),clearInterval(e.mp4ProgressTimer)};e.on("ended",_);var g=function(){Task.clear(),e.timer&&clearTimeout(e.timer)};e.once("destroy",g),e._replay=function(){Task.clear(),e.mp4.bufferCache.clear(),d(e.mp4.url).then(function(t){var r=t[0],i=t[1];e._start(i.url),e.mp4=r,e.mse=i,e.currentTime=0,e.play(),e.once("canplay",function(){e.on("waiting",y),e.mp4ProgressTimer=setInterval(h,e.config.mp4ProgressTimer||300)})},function(t){l(e,t)})}}};Player.install("mp4player",mp4player);
//# sourceMappingURL=index.min.js.map
