!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],t):(e=e||self,t(e.Player))}(this,function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=l(t),this.reject=l(r)}function i(e){return!!e&&"object"==typeof e}function a(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||o(e)}function o(e){return e.$$typeof===It}function s(e){return Array.isArray(e)?[]:{}}function u(e,t){return!1!==t.clone&&t.isMergeableObject(e)?d(s(e),e,t):e}function f(e,t,r){return e.concat(t).map(function(e){return u(e,r)})}function c(e,t,r){var n={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(t){n[t]=u(e[t],r)}),Object.keys(t).forEach(function(i){r.isMergeableObject(t[i])&&e[i]?n[i]=d(e[i],t[i],r):n[i]=u(t[i],r)}),n}function d(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||f,r.isMergeableObject=r.isMergeableObject||Rt;var n=Array.isArray(t);return n===Array.isArray(e)?n?r.arrayMerge(e,t,r):c(e,t,r):u(t,r)}e=e&&e.hasOwnProperty("default")?e.default:e;var h=r(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),l=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},v=function(e,t,r){if(l(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},m={}.toString,p=function(e){return m.call(e).slice(8,-1)},y=r(function(e){var t=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=t)}),g=(y.version,r(function(e){var t=h["__core-js_shared__"]||(h["__core-js_shared__"]={});(e.exports=function(e,r){return t[e]||(t[e]=void 0!==r?r:{})})("versions",[]).push({version:y.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),w=0,b=Math.random(),U=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++w+b).toString(36))},_=r(function(e){var t=g("wks"),r=h.Symbol,n="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=n&&r[e]||(n?r:U)("Symbol."+e))}).store=t}),k=_("toStringTag"),x="Arguments"==p(function(){return arguments}()),B=function(e,t){try{return e[t]}catch(e){}},S=function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=B(t=Object(e),k))?r:x?p(t):"Object"==(n=p(t))&&"function"==typeof t.callee?"Arguments":n},T=function(e){return"object"==typeof e?null!==e:"function"==typeof e},z=function(e){if(!T(e))throw TypeError(e+" is not an object!");return e},C=function(e){try{return!!e()}catch(e){return!0}},M=!C(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),O=h.document,E=T(O)&&T(O.createElement),A=function(e){return E?O.createElement(e):{}},F=!M&&!C(function(){return 7!=Object.defineProperty(A("div"),"a",{get:function(){return 7}}).a}),P=function(e,t){if(!T(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!T(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!T(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!T(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},j=Object.defineProperty,D={f:M?Object.defineProperty:function(e,t,r){if(z(e),t=P(t,!0),z(r),F)try{return j(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},L=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},R=M?function(e,t,r){return D.f(e,t,L(1,r))}:function(e,t,r){return e[t]=r,e},I={}.hasOwnProperty,N=function(e,t){return I.call(e,t)},K=g("native-function-to-string",Function.toString),q=r(function(e){var t=U("src"),r=(""+K).split("toString");y.inspectSource=function(e){return K.call(e)},(e.exports=function(e,n,i,a){var o="function"==typeof i;o&&(N(i,"name")||R(i,"name",n)),e[n]!==i&&(o&&(N(i,t)||R(i,t,e[n]?""+e[n]:r.join(String(n)))),e===h?e[n]=i:a?e[n]?e[n]=i:R(e,n,i):(delete e[n],R(e,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||K.call(this)})}),H=function(e,t,r){var n,i,a,o,s=e&H.F,u=e&H.G,f=e&H.S,c=e&H.P,d=e&H.B,l=u?h:f?h[t]||(h[t]={}):(h[t]||{}).prototype,m=u?y:y[t]||(y[t]={}),p=m.prototype||(m.prototype={});u&&(r=t);for(n in r)a=((i=!s&&l&&void 0!==l[n])?l:r)[n],o=d&&i?v(a,h):c&&"function"==typeof a?v(Function.call,a):a,l&&q(l,n,a,e&H.U),m[n]!=a&&R(m,n,o),c&&p[n]!=a&&(p[n]=a)};h.core=y,H.F=1,H.G=2,H.S=4,H.P=8,H.B=16,H.W=32,H.U=64,H.R=128;var G,V,X,W=H,J=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e},Z=function(e,t,r,n){try{return n?t(z(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&z(i.call(e)),t}},$={},Y=_("iterator"),Q=Array.prototype,ee=function(e){return void 0!==e&&($.Array===e||Q[Y]===e)},te=Math.ceil,re=Math.floor,ne=function(e){return isNaN(e=+e)?0:(e>0?re:te)(e)},ie=Math.min,ae=function(e){return e>0?ie(ne(e),9007199254740991):0},oe=_("iterator"),se=y.getIteratorMethod=function(e){if(void 0!=e)return e[oe]||e["@@iterator"]||$[S(e)]},ue=r(function(e){var t={},r={},n=e.exports=function(e,n,i,a,o){var s,u,f,c,d=o?function(){return e}:se(e),h=v(i,a,n?2:1),l=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(ee(d)){for(s=ae(e.length);s>l;l++)if((c=n?h(z(u=e[l])[0],u[1]):h(e[l]))===t||c===r)return c}else for(f=d.call(e);!(u=f.next()).done;)if((c=Z(f,h,u.value,n))===t||c===r)return c};n.BREAK=t,n.RETURN=r}),fe=_("species"),ce=function(e,t){var r,n=z(e).constructor;return void 0===n||void 0==(r=z(n)[fe])?t:l(r)},de=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},he=h.document,le=he&&he.documentElement,ve=h.process,me=h.setImmediate,pe=h.clearImmediate,ye=h.MessageChannel,ge=h.Dispatch,we=0,be={},Ue=function(){var e=+this;if(be.hasOwnProperty(e)){var t=be[e];delete be[e],t()}},_e=function(e){Ue.call(e.data)};me&&pe||(me=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return be[++we]=function(){de("function"==typeof e?e:Function(e),t)},G(we),we},pe=function(e){delete be[e]},"process"==p(ve)?G=function(e){ve.nextTick(v(Ue,e,1))}:ge&&ge.now?G=function(e){ge.now(v(Ue,e,1))}:ye?(X=(V=new ye).port2,V.port1.onmessage=_e,G=v(X.postMessage,X,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(G=function(e){h.postMessage(e+"","*")},h.addEventListener("message",_e,!1)):G="onreadystatechange"in A("script")?function(e){le.appendChild(A("script")).onreadystatechange=function(){le.removeChild(this),Ue.call(e)}}:function(e){setTimeout(v(Ue,e,1),0)});var ke={set:me,clear:pe},xe=ke.set,Be=h.MutationObserver||h.WebKitMutationObserver,Se=h.process,Te=h.Promise,ze="process"==p(Se),Ce={f:function(e){return new n(e)}},Me=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Oe=h.navigator,Ee=Oe&&Oe.userAgent||"",Ae=function(e,t){if(z(e),T(t)&&t.constructor===e)return t;var r=Ce.f(e);return(0,r.resolve)(t),r.promise},Fe=D.f,Pe=_("toStringTag"),je=_("species"),De=_("iterator"),Le=!1;try{var Re=[7][De]();Re.return=function(){Le=!0},Array.from(Re,function(){throw 2})}catch(e){}var Ie,Ne,Ke,qe,He=ke.set,Ge=function(){var e,t,r,n=function(){var n,i;for(ze&&(n=Se.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(ze)r=function(){Se.nextTick(n)};else if(!Be||h.navigator&&h.navigator.standalone)if(Te&&Te.resolve){var i=Te.resolve(void 0);r=function(){i.then(n)}}else r=function(){xe.call(h,n)};else{var a=!0,o=document.createTextNode("");new Be(n).observe(o,{characterData:!0}),r=function(){o.data=a=!a}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}(),Ve=h.TypeError,Xe=h.process,We=Xe&&Xe.versions,Je=We&&We.v8||"",Ze=h.Promise,$e="process"==S(Xe),Ye=function(){},Qe=Ne=Ce.f,et=!!function(){try{var e=Ze.resolve(1),t=(e.constructor={})[_("species")]=function(e){e(Ye,Ye)};return($e||"function"==typeof PromiseRejectionEvent)&&e.then(Ye)instanceof t&&0!==Je.indexOf("6.6")&&-1===Ee.indexOf("Chrome/66")}catch(e){}}(),tt=function(e){var t;return!(!T(e)||"function"!=typeof(t=e.then))&&t},rt=function(e,t){if(!e._n){e._n=!0;var r=e._c;Ge(function(){for(var n=e._v,i=1==e._s,a=0;r.length>a;)!function(t){var r,a,o,s=i?t.ok:t.fail,u=t.resolve,f=t.reject,c=t.domain;try{s?(i||(2==e._h&&at(e),e._h=1),!0===s?r=n:(c&&c.enter(),r=s(n),c&&(c.exit(),o=!0)),r===t.promise?f(Ve("Promise-chain cycle")):(a=tt(r))?a.call(r,u,f):u(r)):f(n)}catch(e){c&&!o&&c.exit(),f(e)}}(r[a++]);e._c=[],e._n=!1,t&&!e._h&&nt(e)})}},nt=function(e){He.call(h,function(){var t,r,n,i=e._v,a=it(e);if(a&&(t=Me(function(){$e?Xe.emit("unhandledRejection",i,e):(r=h.onunhandledrejection)?r({promise:e,reason:i}):(n=h.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=$e||it(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},it=function(e){return 1!==e._h&&0===(e._a||e._c).length},at=function(e){He.call(h,function(){var t;$e?Xe.emit("rejectionHandled",e):(t=h.onrejectionhandled)&&t({promise:e,reason:e._v})})},ot=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),rt(t,!0))},st=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw Ve("Promise can't be resolved itself");(t=tt(e))?Ge(function(){var n={_w:r,_d:!1};try{t.call(e,v(st,n,1),v(ot,n,1))}catch(e){ot.call(n,e)}}):(r._v=e,r._s=1,rt(r,!1))}catch(e){ot.call({_w:r,_d:!1},e)}}};et||(Ze=function(e){J(this,Ze,"Promise","_h"),l(e),Ie.call(this);try{e(v(st,this,1),v(ot,this,1))}catch(e){ot.call(this,e)}},(Ie=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,r){for(var n in t)q(e,n,t[n],r);return e}(Ze.prototype,{then:function(e,t){var r=Qe(ce(this,Ze));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=$e?Xe.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&rt(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Ke=function(){var e=new Ie;this.promise=e,this.resolve=v(st,e,1),this.reject=v(ot,e,1)},Ce.f=Qe=function(e){return e===Ze||e===qe?new Ke(e):Ne(e)}),W(W.G+W.W+W.F*!et,{Promise:Ze}),function(e,t,r){e&&!N(e=r?e:e.prototype,Pe)&&Fe(e,Pe,{configurable:!0,value:t})}(Ze,"Promise"),function(e){var t=h[e];M&&t&&!t[je]&&D.f(t,je,{configurable:!0,get:function(){return this}})}("Promise"),qe=y.Promise,W(W.S+W.F*!et,"Promise",{reject:function(e){var t=Qe(this);return(0,t.reject)(e),t.promise}}),W(W.S+W.F*!et,"Promise",{resolve:function(e){return Ae(this,e)}}),W(W.S+W.F*!(et&&function(e,t){if(!t&&!Le)return!1;var r=!1;try{var n=[7],i=n[De]();i.next=function(){return{done:r=!0}},n[De]=function(){return i},e(n)}catch(e){}return r}(function(e){Ze.all(e).catch(Ye)})),"Promise",{all:function(e){var t=this,r=Qe(t),n=r.resolve,i=r.reject,a=Me(function(){var r=[],a=0,o=1;ue(e,!1,function(e){var s=a++,u=!1;r.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,r[s]=e,--o||n(r))},i)}),--o||n(r)});return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=Qe(t),n=r.reject,i=Me(function(){ue(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}});var ut=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},ft=function(e){var t=String(ut(this)),r="",n=ne(e);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},ct=function(e,t,r,n){var i=String(ut(e)),a=i.length,o=void 0===r?" ":String(r),s=ae(t);if(s<=a||""==o)return i;var u=s-a,f=ft.call(o,Math.ceil(u/o.length));return f.length>u&&(f=f.slice(0,u)),n?f+i:i+f},dt=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Ee);W(W.P+W.F*dt,"String",{padStart:function(e){return ct(this,e,arguments.length>1?arguments[1]:void 0,!0)}});var ht=function(e){return void 0!==e&&null!==e},lt={object:!0,function:!0,undefined:!0},vt=function(e){return!!ht(e)&&hasOwnProperty.call(lt,typeof e)},mt=function(e){if(!vt(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}},pt=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!mt(e)},yt=/^\s*class[\s{/}]/,gt=Function.prototype.toString,wt=function(e){return!!pt(e)&&!yt.test(gt.call(e))},bt=function(e){return void 0!==e&&null!==e},Ut=Object.keys,_t=function(e){return Ut(bt(e)?Object(e):e)},kt=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}()?Object.keys:_t,xt=function(e){if(!bt(e))throw new TypeError("Cannot use null or undefined");return e},Bt=Math.max,St=function(e,t){var r,n,i,a=Bt(arguments.length,2);for(e=Object(xt(e)),i=function(n){try{e[n]=t[n]}catch(e){r||(r=e)}},n=1;n<a;++n)t=arguments[n],kt(t).forEach(i);if(void 0!==r)throw r;return e},Tt=function(){var e,t=Object.assign;return"function"==typeof t&&(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}()?Object.assign:St,zt=Array.prototype.forEach,Ct=Object.create,Mt=function(e,t){var r;for(r in e)t[r]=e[r]},Ot=function(e){var t=Ct(null);return zt.call(arguments,function(e){bt(e)&&Mt(Object(e),t)}),t},Et="razdwatrzy",At=String.prototype.indexOf,Ft=function(e){return At.call(this,e,arguments[1])>-1},Pt=function(){return"function"==typeof Et.contains&&(!0===Et.contains("dwa")&&!1===Et.contains("foo"))}()?String.prototype.contains:Ft,jt=r(function(e){(e.exports=function(e,t){var r,n,i,a,o;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],ht(e)?(r=Pt.call(e,"c"),n=Pt.call(e,"e"),i=Pt.call(e,"w")):(r=i=!0,n=!1),o={value:t,configurable:r,enumerable:n,writable:i},a?Tt(Ot(a),o):o}).gs=function(e,t,r){var n,i,a,o;return"string"!=typeof e?(a=r,r=t,t=e,e=null):a=arguments[3],ht(t)?wt(t)?ht(r)?wt(r)||(a=r,r=void 0):r=void 0:(a=t,t=r=void 0):t=void 0,ht(e)?(n=Pt.call(e,"c"),i=Pt.call(e,"e")):(n=!0,i=!1),o={get:t,set:r,configurable:n,enumerable:i},a?Tt(Ot(a),o):o}}),Dt=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},Lt=r(function(e,t){var r,n,i,a,o,s,u,f=Function.prototype.apply,c=Function.prototype.call,d=Object.create,h=Object.defineProperty,l=Object.defineProperties,v=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};o={on:r=function(e,t){var r;return Dt(t),v.call(this,"__ee__")?r=this.__ee__:(r=m.value=d(null),h(this,"__ee__",m),m.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:n=function(e,t){var n,a;return Dt(t),a=this,r.call(this,e,n=function(){i.call(a,e,n),f.call(t,this,arguments)}),n.__eeOnceListener__=t,this},off:i=function(e,t){var r,n,i,a;if(Dt(t),!v.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==typeof(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:a=function(e){var t,r,n,i,a;if(v.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)f.call(n,this,a)}else switch(arguments.length){case 1:c.call(i,this);break;case 2:c.call(i,this,arguments[1]);break;case 3:c.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];f.call(i,this,a)}}},s={on:jt(r),once:jt(n),off:jt(i),emit:jt(a)},u=l({},s),e.exports=t=function(e){return null==e?d(u):l(Object(e),s)},t.methods=o}),Rt=(Lt.methods,function(e){return i(e)&&!a(e)}),It="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;d.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,r){return d(e,r,t)},{})};var Nt=d,Kt="1.1.8",qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Gt=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Vt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Xt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Wt=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";Ht(this,t),n.version=Kt;var a=Xt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n));return a.url=i,a}return Vt(t,e),t}(e.Errors),Jt=function(){function e(t){if(Ht(this,e),!(t instanceof ArrayBuffer))throw new Wt("parse","",{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return Gt(e,[{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,r){var n=void 0;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw"not supported for readByte 3";n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Wt("parse","",{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),Zt=function(){function e(){Ht(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return Gt(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new Wt("parse","",{line:19,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],r=0;r<16;r++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var r=this.size-t.position+this.start,n=this.type;this.data=t.buffer.slice(t.position,t.position+r),t.position+=this.data.byteLength;var i=void 0;(i=e.containerBox.find(function(e){return e===n})?e.containerParser:e[n])&&i instanceof Function&&i.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new Jt(this.data),r=t.buffer.byteLength,n=this;t.position<r;){var i=new e;i.readHeader(t),n.subBox.push(i),i.readBody(t)}delete n.data,t=null}}]),e}();Zt.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra"],Zt.avc1=function(){var e=new Jt(this.data),t=this;e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var r=0;r<31;r++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var n=new Zt;n.readHeader(e),t.subBox.push(n),n.readBody(e)}delete this.data,e=null},Zt.avcC=function(){var e=new Jt(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var r=[],n=0;n<t;n++)r.push(Number(e.readUint8()).toString(16));this.ppsCount=e.readUint8();var i=e.readUint16();this.ppsLength=i;for(var a=[],o=0;o<i;o++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sequence=r;for(var s=[],u=e.dataview.byteLength;e.position<u;)s.push(e.readUint8());this.last=s,delete this.subBox,delete this.data,e=null},Zt.btrt=function(){var e=new Jt(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null},Zt.co64=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null},Zt.ctts=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var r=0,n=this.entryCount;r<n;r++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null},Zt.dref=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var r=this,n=0;n<t;n++){var i=new Zt;r.subBox.push(i),i.read(e)}delete this.data,e=null},Zt.elst=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3);var t=[],r=e.readUint32();this.entries=t;for(var n=0;n<r;n++){var i={};t.push(i),1===this.version?(i.segment_duration=e.readUint64(),i.media_time=e.readUint64()):(i.segment_duration=e.readUint32(),i.media_time=e.readInt32()),i.media_rate_integer=e.readInt16(),i.media_rate_fraction=e.readInt16()}delete this.subBox,delete this.data,e=null},Zt.esds=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3);var t=Zt.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null},Zt.ftyp=function(){var e=new Jt(this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],r=0,n=Math.floor((e.buffer.byteLength-8)/4);r<n;r++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data},Zt.hdlr=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null},Zt.iods=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3);for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null},Zt.mdat=function(){delete this.subBox};var $t=function(){function e(){Ht(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return Gt(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();Zt.mdhd=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new $t).setTime(1e3*this.create),this.modifyTime=(new $t).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new $t).setTime(1e3*this.create),this.modifyTime=(new $t).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null},Zt.mp4a=function(){var e=new Jt(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new Zt;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null},Zt.MP4DecConfigDescrTag=function(e){var t=new Zt,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=Jt.readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(Zt.MP4DecSpecificDescrTag(e)),t},Zt.MP4DecSpecificDescrTag=function(e){var t=new Zt,r=void 0,n=void 0;t.type=e.readUint8(),128===(r=e.readUint8())?(t.extend=!0,e.skip(2),n=(r=e.readUint8()+5)-5):(n=r,r+=2),t.size=r;for(var i=[],a=0;a<n;a++)i.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=i,delete t.subBox,t},Zt.MP4ESDescrTag=function(e){var t=new Zt,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(Zt.MP4DecConfigDescrTag(e)),t.subBox.push(Zt.SLConfigDescriptor(e)),t},Zt.mvhd=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new $t).setTime(1e3*this.create),this.modifyTime=(new $t).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),Jt.readByte(e.dataview,8),Jt.readByte(e.dataview,2);for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,Jt.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data},Zt.pasp=function(){var e=new Jt(this.data);this.content=e.buffer.slice(0,this.size-8),delete this.subBox,delete this.data,e=null},Zt.SLConfigDescriptor=function(e){var t=new Zt,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.SL=e.readUint8(),delete t.subBox,t},Zt.smhd=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null},Zt.stco=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Zt.stsc=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var i,a,o=0,s=this.count;o<s-1;o++)i=t[o],a=t[o-1],i.chunk_count=t[o+1].first_chunk-i.first_chunk,i.first_sample=0===o?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var u=t[0];u.first_sample=1,u.chunk_count=0}else if(this.count>1){var f=t[this.count-1],c=t[this.count-2];f.first_sample=c.first_sample+c.chunk_count*c.samples_per_chunk,f.chunk_count=0}delete this.subBox,delete this.data,e=null},Zt.stsd=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new Zt;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null},Zt.stss=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Zt.stsz=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Zt.stts=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],r=0,n=this.count;r<n;r++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null},Zt.tkhd=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=Jt.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new $t).setTime(1e3*this.create),this.modifyTime=(new $t).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new $t).setTime(1e3*this.create),this.modifyTime=(new $t).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null},Zt.udta=function(){delete this.subBox},Zt["url "]=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null},Zt.vmhd=function(){var e=new Jt(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null};var Yt=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=!0,o=!1,s=void 0;try{for(var u,f=n[Symbol.iterator]();!(a=(u=f.next()).done);a=!0)t+=u.value.length}catch(e){o=!0,s=e}finally{try{!a&&f.return&&f.return()}finally{if(o)throw s}}var c=new e(t),d=0,h=!0,l=!1,v=void 0;try{for(var m,p=n[Symbol.iterator]();!(h=(m=p.next()).done);h=!0){var y=m.value;c.set(y,d),d+=y.length}}catch(e){l=!0,v=e}finally{try{!h&&p.return&&p.return()}finally{if(l)throw v}}return c}});t(Yt);var Qt=t(r(function(e){var t=function(e){return e&&e.__esModule?e:{default:e}}(Yt);e.exports=t.default})),er=function e(t){Ht(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;var r=this;r.buffer?Qt(Uint8Array,r.buffer,t):r.buffer=t;var n=t.byteLength;t.position=0;for(var i=new Jt(t);n-i.position>=8;){var a=new Zt;if(a.readHeader(i),a.size-8<=n-i.position)a.readBody(i),r.boxes.push(a);else{if("mdat"!==a.type){r.nextBox=a,i.position-=8;break}a.readBody(i),r.boxes.push(a)}}r.buffer=new Uint8Array(r.buffer.slice(i.position))},tr=function(){function e(){Ht(this,e),this.buffer=new Uint8Array(0)}return Gt(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach(function(t){t?e.buffer=Qt(Uint8Array,e.buffer,t):window.console.error(t)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),rr=Math.pow(2,32)-1,nr=function(){function e(){Ht(this,e)}return Gt(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return tr.writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new tr;return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])),t.buffer}},{key:"moov",value:function(t){var r=new tr,n=8,i=e.mvhd(t.duration,t.timeScale),a=e.videoTrak(t),o=e.audioTrak(t),s=e.mvex(t.duration,t.timeScale);return[i,a,o,s].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("moov"),i,a,o,s),r.buffer}},{key:"mvhd",value:function(t,r){var n=new tr;t*=r;var i=Math.floor(t/(rr+1)),a=Math.floor(t%(rr+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.write(e.size(8+o.length),e.type("mvhd"),new Uint8Array(o)),n.buffer}},{key:"videoTrak",value:function(t){var r=new tr,n=8,i=e.tkhd({id:1,duration:t.videoDuration,timescale:t.videoTimeScale,width:t.width,height:t.height,type:"video"}),a=e.mdia({type:"video",timescale:t.videoTimeScale,duration:t.videoDuration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[i,a].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("trak"),i,a),r.buffer}},{key:"audioTrak",value:function(t){var r=new tr,n=8,i=e.tkhd({id:2,duration:t.audioDuration,timescale:t.audioTimeScale,width:0,height:0,type:"audio"}),a=e.mdia({type:"audio",timescale:t.audioTimeScale,duration:t.audioDuration,channelCount:t.channelCount,samplerate:t.sampleRate,audioConfig:t.audioConfig});return[i,a].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("trak"),i,a),r.buffer}},{key:"tkhd",value:function(t){var r=new tr,n=t.id,i=t.duration*t.timeScale,a=t.width,o=t.height,s=t.type,u=Math.floor(i/(rr+1)),f=Math.floor(i%(rr+1)),c=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,u>>24,u>>16&255,u>>8&255,255&u,f>>24,f>>16&255,f>>8&255,255&f,0,0,0,0,0,0,0,0,0,0,0,"video"===s?1:0,"audio"===s?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]);return r.write(e.size(8+c.byteLength),e.type("tkhd"),c),r.buffer}},{key:"edts",value:function(t){var r=new tr,n=t.duration,i=t.mediaTime;return r.write(e.size(36),e.type("edts")),r.write(e.size(28),e.type("elst")),r.write(new Uint8Array([0,0,0,1,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,1])),r.buffer}},{key:"mdia",value:function(t){var r=new tr,n=8,i=e.mdhd(t.timescale),a=e.hdlr(t.type),o=e.minf(t);return[i,a,o].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("mdia"),i,a,o),r.buffer}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new tr;r*=t;var i=Math.floor(r/(rr+1)),a=Math.floor(r%(rr+1)),o=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]);return n.write(e.size(12+o.byteLength),e.type("mdhd"),e.extension(1,0),o),n.buffer}},{key:"hdlr",value:function(t){var r=new tr,n=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(n.splice.apply(n,[8,4].concat([115,111,117,110])),n.splice.apply(n,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),r.write(e.size(8+n.length),e.type("hdlr"),new Uint8Array(n)),r.buffer}},{key:"minf",value:function(t){var r=new tr,n=8,i="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),o=e.stbl(t);return[i,a,o].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("minf"),i,a,o),r.buffer}},{key:"vmhd",value:function(){var t=new tr;return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new tr;return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new tr,r=[0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1];return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array(r)),t.buffer}},{key:"stbl",value:function(t){var r=new tr,n=8,i=e.stsd(t),a=e.stts(),o=e.stsc(),s=e.stsz(),u=e.stco();return[i,a,o,s,u].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("stbl"),i,a,o,s,u),r.buffer}},{key:"stsd",value:function(t){var r=new tr,n=void 0;return n="audio"===t.type?e.mp4a(t):e.avc1(t),r.write(e.size(16+n.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),n),r.buffer}},{key:"mp4a",value:function(t){var r=new tr,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=e.esds(t.audioConfig);return r.write(e.size(8+n.byteLength+i.byteLength),e.type("mp4a"),n,i),r.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],r=t.length,n=new tr,i=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2]));return n.write(e.size(8+i.byteLength),e.type("esds"),i),n.buffer}},{key:"avc1",value:function(t){var r=new tr,n=t.sps,i=t.pps,a=t.width,o=t.height,s=t.pixelRatio[0],u=t.pixelRatio[1],f=new Uint8Array([1,n[1],n[2],n[3],255,225].concat([n.length>>>8&255,255&n.length]).concat(n).concat(1).concat([i.length>>>8&255,255&i.length]).concat(i)),c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,o>>8&255,255&o,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u]);return r.write(e.size(40+c.byteLength+f.byteLength+d.byteLength),e.type("avc1"),c,e.size(8+f.byteLength),e.type("avcC"),f,e.size(20),e.type("btrt"),d,e.size(16),e.type("pasp"),h),r.buffer}},{key:"stts",value:function(){var t=new tr,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),r),t.buffer}},{key:"stsc",value:function(){var t=new tr,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),r),t.buffer}},{key:"stco",value:function(){var t=new tr,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),r),t.buffer}},{key:"stsz",value:function(){var t=new tr,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),r),t.buffer}},{key:"mvex",value:function(t,r){var n=new tr,i=tr.writeUint32(t*r);return n.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),i,e.trex(1),e.trex(2)),n.buffer}},{key:"trex",value:function(t){var r=new tr,n=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return r.write(e.size(8+n.byteLength),e.type("trex"),n),r.buffer}},{key:"moof",value:function(t){var r=new tr,n=8,i=e.mfhd(),a=e.traf(t);return[i,a].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("moof"),i,a),r.buffer}},{key:"mfhd",value:function(){var t=new tr,r=tr.writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),r),t.buffer}},{key:"traf",value:function(t){var r=new tr,n=8,i=e.tfhd(t.id),a=e.tfdt(t.time),o=e.sdtp(t),s=e.trun(t,o.byteLength);return[i,a,o,s].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("traf"),i,a,o,s),r.buffer}},{key:"tfhd",value:function(t){var r=new tr,n=tr.writeUint32(t);return r.write(e.size(16),e.type("tfhd"),e.extension(0,0),n),r.buffer}},{key:"tfdt",value:function(t){var r=new tr,n=Math.floor(t/(rr+1)),i=Math.floor(t%(rr+1));return r.write(e.size(20),e.type("tfdt"),e.extension(1,0),tr.writeUint32(n),tr.writeUint32(i)),r.buffer}},{key:"trun",value:function(t,r){var n=t.id,i=1===n?16:12,a=new tr,o=tr.writeUint32(t.samples.length),s=tr.writeUint32(96+i*t.samples.length+r);return a.write(e.size(20+i*t.samples.length),e.type("trun"),e.extension(0,t.flags),o,s),t.samples.forEach(function(e,t){a.write(tr.writeUint32(e.duration)),a.write(tr.writeUint32(e.size)),1===n?(a.write(tr.writeUint32(e.key?33554432:16842752)),a.write(tr.writeUint32(e.offset))):a.write(tr.writeUint32(16777216))}),a.buffer}},{key:"sdtp",value:function(t){var r=new tr;return r.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(function(e){r.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))}),r.buffer}},{key:"mdat",value:function(t){var r=new tr,n=8;return t.samples.forEach(function(e){n+=e.size}),r.write(e.size(n),e.type("mdat")),t.samples.forEach(function(e){r.write(e.buffer)}),r.buffer}}]),e}();nr.sequence=1;var ir=function(){function e(t,r,n,i){Ht(this,e),Lt(this),this.url=t,this.range=r,this.withCredentials=n,this.id=r.join("-"),this.on=!1;var a=new window.XMLHttpRequest;a.target=this,a.responseType="arraybuffer",a.withCredentials=this.withCredentials||!1,a.open("get",t),a.setRequestHeader("Range","bytes="+r[0]+"-"+r[1]),a.onload=function(){200!==a.status&&206!==a.status||i&&i instanceof Function&&i(a.response),a.target.remove()},a.onerror=function(e){a.target.emit("error",new Wt("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),a.target.remove()},a.onabort=function(){a.target.remove()},this.xhr=a,e.queue.push(this),this.update()}return Gt(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter(function(r,n){return r.url===t.url&&r.id===t.id&&(e.queue.splice(n,1),!0)}),this.update()}},{key:"update",value:function(){var t=e.queue,r=t.filter(function(e){return e.on}),n=t.filter(function(e){return!e.on}),i=e.limit-r.length;n.forEach(function(e,t){t<i&&e.run()})}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach(function(e){e.on&&e.cancel()}),e.queue.length=0}}]),e}();ir.queue=[],ir.limit=2,window.Task=ir;var ar={};ar.findBox=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var n=e.subBox.filter(function(e){return e.type===t});n.length?n.forEach(function(e){return r.push(e)}):e.subBox.forEach(function(e){return ar.findBox(e,t,r)})}}else r.push(e);return r=[].concat(r),r.length>1?r:r[0]},ar.padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},ar.toHex=function(){for(var e=[],t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach(function(t){e.push(ar.padStart(Number(t).toString(16),2,0))}),e},ar.sum=function(){for(var e=0,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach(function(t){e+=t}),e},ar.stscOffset=function(e,t){var r=void 0,n="",i=e.entries.filter(function(e){return e.first_sample<=t&&t<e.first_sample+e.chunk_count*e.samples_per_chunk})[0];if(i){var a=Math.floor((t-i.first_sample)/i.samples_per_chunk),o=i.first_sample+a*i.samples_per_chunk;return r=i.first_chunk+a,n=[o,t],{chunk_index:r,samples_offset:n}}var s=e.entries.pop();e.entries.push(s);var u=Math.floor((t-s.first_sample)/s.samples_per_chunk);return{chunk_index:s.first_chunk+u,samples_offset:[s.first_sample+s.samples_per_chunk*u,t]}},ar.seekSampleOffset=function(e,t,r,n,i){var a=ar.stscOffset(e,n+1),o=t.entries[a.chunk_index-1]+ar.sum.apply(null,r.entries.slice(a.samples_offset[0]-1,a.samples_offset[1]-1))-i;if(void 0===o)throw"result="+o+",stco.length="+t.entries.length+",sum="+ar.sum.apply(null,r.entries.slice(0,n));if(o<0)throw"result="+o+",stco.length="+t.entries.length+",sum="+ar.sum.apply(null,r.entries.slice(0,n));return o},ar.seekSampleTime=function(e,t,r){var n=void 0,i=void 0,a=0,o=0,s=0;if(e.entry.every(function(e){return i=e.sampleDuration,r<a+e.sampleCount?(n=o+(r-a)*e.sampleDuration,!1):(a+=e.sampleCount,o+=e.sampleCount*i,!0)}),t){var u=0;t.entry.every(function(e){return u+=e.count,!(r<u)||(s=e.offset,!1)})}return n||(n=o+(r-a)*i),{time:n,duration:i,offset:s}},ar.seekOrderSampleByTime=function(e,t,r){var n=0,i=0,a=0,o=void 0;return e.every(function(e,s){return o=e.sampleCount*e.sampleDuration/t,r<=n+o?(i=a+Math.ceil((r-n)*t/e.sampleDuration),n+=Math.ceil((r-n)*t/e.sampleDuration)*e.sampleDuration/t,!1):(n+=o,a+=e.sampleCount,!0)}),{order:i,startTime:n}},ar.seekTrakDuration=function(e,t){var r=0;return ar.findBox(e,"stts").entry.forEach(function(e){r+=e.sampleCount*e.sampleDuration}),Number(r/t).toFixed(4)};var or=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(25,4);Ht(this,e),Lt(this),this.url=t,this.withCredentials=r,this.CHUNK_SIZE=n,this.init(t),this.once("moovReady",this.moovParse.bind(this)),this.cache=new tr,this.bufferCache=new Set,this.timeRage=[],this.canDownload=!0}return Gt(e,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE,n=this;return new Promise(function(i,a){new ir(e.url,[t,r],e.withCredentials,i).once("error",function(e){n.emit("error",e)})})}},{key:"moovParse",value:function(){var e=this,t=this,r=this.moovBox,n=ar.findBox(r,"mvhd"),i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,f=void 0,c=void 0,d=void 0,h=void 0,l=void 0,v=void 0,m=void 0,p=void 0,y=void 0;ar.findBox(r,"trak").forEach(function(e){var r=ar.findBox(e,"hdlr"),n=ar.findBox(e,"mdhd");if(!r||!n)return void t.emit("error",new Wt("parse","",{line:72,handle:"[MP4] moovParse",url:t.url}));var g=ar.findBox(e,"stsd").subBox[0];if("vide"===r.handleType){var w=ar.findBox(e,"avcC"),b=ar.findBox(e,"tkhd");i=e,u=n.timescale,w?(o=g.type+"."+ar.toHex(w.profile,w.profileCompatibility,w.AVCLevelIndication).join(""),c=w.sequence&&w.sequence.map(function(e){return Number("0x"+e)}),d=w.pps&&w.pps.map(function(e){return Number("0x"+e)}),h=w.profile):o=""+g.type,b&&(l=b.width,v=b.height)}if("soun"===r.handleType){a=e;var U=ar.findBox(e,"esds"),_=ar.findBox(e,"mp4a"),k=ar.findBox(e,5);f=n.timescale,s=U?g.type+"."+ar.toHex(U.subBox[0].subBox[0].typeID)+"."+U.subBox[0].subBox[0].subBox[0].type:""+g.type,k&&k.EScode&&(y=k.EScode.map(function(e){return Number("0x"+e)})),_&&(m=_.channelCount,p=_.sampleRate)}}),this.videoTrak=Nt({},i),this.audioTrak=Nt({},a);var g=this._boxes.find(function(e){return"mdat"===e.type}),w=ar.seekTrakDuration(i,u),b=ar.seekTrakDuration(a,f);this.mdatStart=g.start;var U=this.videoKeyFrames,_=U.length-1;U.forEach(function(t,r){r<_?e.timeRage.push([t.time.time/u,U[r+1].time.time/u]):e.timeRage.push([t.time.time/u,-1])}),this.meta={videoCodec:o,audioCodec:s,createTime:n.createTime,modifyTime:n.modifyTime,duration:n.duration/n.timeScale,timeScale:n.timeScale,videoDuration:w,videoTimeScale:u,audioDuration:b,audioTimeScale:f,endTime:Math.min(w,b),sps:c,pps:d,width:l,height:v,profile:h,pixelRatio:[1,1],channelCount:m,sampleRate:p,audioConfig:y}}},{key:"init",value:function(){var e=this;e.getData().then(function(t){var r=void 0,n=0,i=void 0,a=void 0;try{r=new er(t)}catch(t){return e.emit("error",t.type?t:new Wt("parse","",{line:176,handle:"[MP4] init",msg:t.message})),!1}if(e._boxes=a=r.boxes,a.every(function(t){return n+=t.size,"moov"!==t.type||(i=t,e.moovBox=i,e.emit("moovReady",i),!1)}),!i){var o=r.nextBox;o?"moov"===o.type?e.getData(n,n+o.size+28).then(function(t){var r=new er(t);e._boxes=e._boxes.concat(r.boxes),(i=r.boxes.filter(function(e){return"moov"===e.type})).length?(e.moovBox=i[0],e.emit("moovReady",i)):e.emit("error",new Wt("parse","",{line:203,handle:"[MP4] init",msg:"not find moov box"}))}):e.emit("error",new Wt("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"})):e.getData(n,"").then(function(t){var r=new er(t);r?(e._boxes=e._boxes.concat(r.boxes),r.boxes.every(function(t){return"moov"!==t.type||(i=t,e.moovBox=i,e.emit("moovReady",i),!1)})):e.emit("error",new Wt("parse","",{line:225,handle:"[MP4] init",msg:"not find moov box"}))})}}).catch(function(){e.emit("error",new Wt("network","",{line:231,handle:"[MP4] getData",msg:"getData failed"}))})}},{key:"getSamplesByOrders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments[1],r=arguments[2],n="video"===e?this.videoTrak:this.audioTrak,i=ar.findBox(n,"stsc"),a=ar.findBox(n,"stsz"),o=ar.findBox(n,"stts"),s=ar.findBox(n,"stco"),u=ar.findBox(n,"ctts"),f=this.mdatStart,c=[];if(r=void 0!==r?r:a.entries.length,t instanceof Array)t.forEach(function(e,t){c.push({idx:e,size:a.entries[e],time:ar.seekSampleTime(o,u,e),offset:ar.seekSampleOffset(i,s,a,e,f)})});else if(0!==r)for(var d=t;d<r;d++)c.push({idx:d,size:a.entries[d],time:ar.seekSampleTime(o,u,d),offset:ar.seekSampleOffset(i,s,a,d,f)});else c={idx:t,size:a.entries[t],time:ar.seekSampleTime(o,u,t),offset:ar.seekSampleOffset(i,s,a,t,f)};return c}},{key:"packMeta",value:function(){if(this.meta){var e=new tr;return e.write(nr.ftyp()),e.write(nr.moov(this.meta)),this.cache.write(e.buffer),e.buffer}}},{key:"seek",value:function(e){var t=e*this.meta.videoTimeScale,r=void 0,n=this.videoKeyFrames,i=this.audioKeyFrames;return n.every(function(e,i){var a=e.time.time,o=n[i+1]?n[i+1].time.time:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(r=i,!1)}),i.every(function(e,n){var a=e.startTime,o=i[n+1]?i[n+1].startTime:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(r=Math.min(n,r),!1)}),this.bufferCache.has(r)?Promise.resolve(null):this.loadFragment(r)}},{key:"loadFragment",value:function(e){var t=void 0,r=void 0,n=this.videoKeyFrames[e],i=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);if(t=Math.min(n.offset,i.offset),e<this.videoKeyFrames.length-1){var a=this.videoKeyFrames[e+1],o=this.getSamplesByOrders("audio",this.audioKeyFrames[e+1].order,0);r=Math.max(a.offset,o.offset)}var s=this;return window.isNaN(t)||void 0!==r&&window.isNaN(r)?(s.emit("error",new Wt("parse","",{line:366,handle:"[MP4] loadFragment",url:s.url})),!1):this.bufferCache.has(e)?Promise.resolve(null):this.getData(t+s.mdatStart,r?s.mdatStart+r:"").then(function(r){return s.createFragment(new Uint8Array(r),t,e)})}},{key:"addFragment",value:function(e){var t=new tr;return t.write(nr.moof(e)),t.write(nr.mdat(e)),this.cache.write(t.buffer),t.buffer}},{key:"createFragment",value:function(e,t,r){var n=this,i=[];this.bufferCache.add(r);var a=n.videoKeyFrames.map(function(e){return e.idx}),o=n.getSamplesByOrders("video",a[r],a[r+1]),s=o.map(function(r,n){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===n}});i.push(this.addFragment({id:1,time:o[0].time.time,firstFlags:33554432,flags:3841,samples:s}));var u=this.getSamplesByOrders("audio",this.audioKeyFrames[r].order,this.audioKeyFrames[r+1]?this.audioKeyFrames[r+1].order:void 0),f=u.map(function(r,n){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===n}});i.push(this.addFragment({id:2,time:u[0].time.time,firstFlags:0,flags:1793,samples:f}));var c=0;i.every(function(e){return c+=e.byteLength,!0});var d=new Uint8Array(c),h=0;return i.every(function(e){return d.set(e,h),h+=e.byteLength,!0}),Promise.resolve(d)}},{key:"download",value:function(){}},{key:"cut",value:function(e,t){var r=this;this.bufferCache.clear();var n=e*this.meta.videoTimeScale,i=t*this.meta.videoTimeScale,a=void 0,o=void 0,s=this.videoKeyFrames,u=this.audioKeyFrames;return s.every(function(e,t){var r=e.time.time,u=s[t+1]?s[t+1].time.time:Number.MAX_SAFE_INTEGER;return r<=n&&n<u?(a=t,!0):!(r<=i&&i<u)||(o=t,!1)}),u.every(function(e,t){var r=e.startTime,s=u[t+1]?u[t+1].startTime:Number.MAX_SAFE_INTEGER;return r<=n&&n<s?(a=Math.min(t,a),!0):!(r<=i&&i<s)||(o=Math.min(t,o),!1)}),o||(o=s.length),r.loadFragmentForCut(a,o)}},{key:"loadFragmentForCut",value:function(e,t){var r=void 0,n=void 0,i=this.videoKeyFrames[e],a=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);r=Math.min(i.offset,a.offset);var o=this.videoKeyFrames[t],s=this.getSamplesByOrders("audio",this.audioKeyFrames[t].order,0);n=Math.max(o.offset,s.offset);var u=this;return window.isNaN(r)||void 0!==n&&window.isNaN(n)?(u.emit("error",new Wt("parse","",{line:366,handle:"[MP4] loadFragment",url:u.url})),!1):this.getData(r+u.mdatStart,n?u.mdatStart+n:"").then(function(i){return u.createFragmentForCut(new Uint8Array(i),r,e,n,t)})}},{key:"createFragmentForCut",value:function(e,t,r,n,i){var a=this,o=[],s=a.videoKeyFrames.map(function(e){return e.idx}),u=a.getSamplesByOrders("video",s[r],s[i]).map(function(r,n){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===n}});o.push(this.addFragment({id:1,time:0,firstFlags:33554432,flags:3841,samples:u}));var f=this.getSamplesByOrders("audio",this.audioKeyFrames[r].order,this.audioKeyFrames[i]?this.audioKeyFrames[i].order:void 0).map(function(r,n){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===n}});o.push(this.addFragment({id:2,time:0,firstFlags:0,flags:1793,samples:f}));var c=0;o.every(function(e){return c+=e.byteLength,!0});var d=new Uint8Array(c),h=0;return o.every(function(e){return d.set(e,h),h+=e.byteLength,!0}),Promise.resolve(d)}},{key:"videoKeyFrames",get:function(){if(this._videoFrames)return this._videoFrames;var e=this.videoTrak,t=ar.findBox(e,"stss"),r=this.getSamplesByOrders("video",t.entries.map(function(e){return e-1}));return this._videoFrames=r,r}},{key:"audioKeyFrames",get:function(){if(this._audioFrames)return this._audioFrames;var e=ar.findBox(this.videoTrak,"mdhd").timescale,t=ar.findBox(this.audioTrak,"mdhd").timescale,r=ar.findBox(this.audioTrak,"stts").entry,n=[];return n=this.videoKeyFrames.map(function(n){return ar.seekOrderSampleByTime(r,t,n.time.time/e)}),this._audioFrames=n,this._audioFrames}}]),e}(),sr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.64001E, mp4a.40.5"';Ht(this,e);var r=this;Lt(this),this.codecs=t,this.mediaSource=new window.MediaSource,this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this.updating=!1,this.mediaSource.addEventListener("sourceopen",function(){r.sourceBuffer=r.mediaSource.addSourceBuffer(r.codecs),r.sourceBuffer.addEventListener("error",function(e){r.emit("error",new Wt("mse","",{line:16,handle:"[MSE] constructor sourceopen",msg:e.message}))}),r.sourceBuffer.addEventListener("updateend",function(e){r.emit("updateend");var t=r.queue.shift();t&&r.sourceBuffer&&!r.sourceBuffer.updating&&"open"===r.state&&r.sourceBuffer.appendBuffer(t)}),r.emit("sourceopen")}),this.mediaSource.addEventListener("sourceclose",function(){r.emit("sourceclose")})}return Gt(e,[{key:"appendBuffer",value:function(e){var t=this.sourceBuffer;return t&&!t.updating&&"open"===this.state?(t.appendBuffer(e),!0):(this.queue.push(e),!1)}},{key:"removeBuffer",value:function(e,t){this.sourceBuffer.remove(e,t)}},{key:"endOfStream",value:function(){"open"===this.state&&this.mediaSource.endOfStream()}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){this.mediaSource.duration=e}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}(),ur=function(e,t){if(t.meta.endTime-e.currentTime<2){var r=e.getBufferedRange();e.currentTime-r[1]<.1&&e.mse.endOfStream()}},fr=function(){var t=this,r=e.sniffer,n=e.util,i=e.Errors,a=void 0,o=void 0,s=t.config.preloadTime||15,u=void 0,f=t.config.url,c=t.config.pluginRule||function(){return!0};if(!f)return void t.emit("error",new i("other",t.config.vid));"String"===n.typeOf(f)?a=f:"Array"===n.typeOf(f)&&f.length&&(a=f[0].src,f.length>1&&(o=f[1].src)),t.config._mainURL=a,t.config._backupURL=o;var d=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.currentTime;t.timer&&clearTimeout(t.timer),n=Math.max(n,t.currentTime),t.timer=setTimeout(function(){t.mp4.seek(n+.1*r).then(function(e){if(e){var r=t.mse;r.updating=!0,r.appendBuffer(e),r.once("updateend",function(){r.updating=!1})}},function(){r<10&&setTimeout(function(){e(r+1)},2e3)})},50)},h=function(e){var r=new or(e,t.config.withCredentials),n=void 0;return new Promise(function(e,i){r.once("moovReady",function(){(n=new sr).on("sourceopen",function(){n.appendBuffer(r.packMeta()),n.once("updateend",d.bind(t))}),n.on("error",function(e){i(e)}),e([r,n])}),r.on("error",function(e){i(e)})})};if(["chrome","firfox","safari"].some(function(e){return e===r.browser})&&sr.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')){if(t._start=t.start,!c.call(t))return!1;var l=function(e,t){t.vid=e.config.vid,t.url=e.src,t.errd&&"object"===qt(t.errd)&&e.mp4&&(t.errd.url=e.mp4.url,t.url=e.mp4.url,e.mp4.canDownload=!1),e.emit("DATA_REPORT",t),ir.clear(),e.mp4&&e.mp4.bufferCache&&e.mp4.bufferCache.clear(),e.currentTime&&(e._currentTime=e.currentTime),e._start&&(e.start=e._start,e._start=null),e.switchURL=null,e._replay=null,clearInterval(e.mp4ProgressTimer),e.off("seeking",m),e.off("pause",p),e.off("playing",y),e.off("waiting",g),e.off("ended",w),e.off("destroy",b),"network"===t.errt&&e.config._backupURL?e.src=e.config._backupURL:e.src=e.config._mainURL,e.once("canplay",function(){e._currentTime&&(e.currentTime=e._currentTime),e.play()})};t.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;h(e).then(function(r){var n=r[0],i=r[1];t._start(i.url),t.logParams.pluginSrc=e,t.mp4=n,t.mse=i,n.on("error",function(e){l(t,e)})},function(r){t._start(e),l(t,r)}),t.once("canplay",function(){if("safari"===r.browser&&t.buffered){var e=t.buffered.start(0);t.currentTime=e+.1}})},t.cut=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments[1],i=new tr,a=new or(f,t.config.withCredentials);return new Promise(function(t,o){a.once("moovReady",function(){(!n||n<=r)&&(n=r+15),n>a.meta.duration&&(r=a.meta.duration-(n-r),n=a.meta.duration),a.cut(r,n).then(function(o){if(o){var s=e.util.deepCopy({duration:n-r,audioDuration:n-r,endTime:n-r},a.meta);s.duration=n-r,s.videoDuration=n-r,s.audioDuration=n-r,s.endTime=n-r,i.write(a.packMeta(s),o),t(new Blob([i.buffer],{type:'video/mp4; codecs="avc1.64001E, mp4a.40.5"'}))}})}),a.on("error",function(e){o(e)})})},t.switchURL=function(n){var i=new or(n,t.config.withCredentials),a=t.mp4;i.on("moovReady",function(){var o=a.timeRage,s=t.currentTime,u=(o=a.timeRage).find(function(e){return e[0]-s>2})[0],f=t.getBufferedRange()[1];f-u>0&&"safari"!==r.browser&&t.mse.removeBuffer(u,f),e.util.hasClass(t.root,"xgplayer-ended")||t.emit("urlchange",JSON.parse(JSON.stringify(t.logParams))),t.logParams={bc:0,bu_acu_t:0,played:[{begin:t.video.currentTime,end:-1}],pt:(new Date).getTime(),vt:(new Date).getTime(),vd:0},t.mp4=i,t.mse.appendBuffer(i.packMeta()),t.logParams.pt=(new Date).getTime(),t.logParams.vt=(new Date).getTime(),t.logParams.vd=t.video.duration,t.logParams.pluginSrc=n}),i.on("error",function(e){l(t,e)})},t.playNext=function(e){var r=new or(e,t.config.withCredentials),n=t.mp4;r.on("moovReady",function(){var e=[0,0],i=t.video.buffered,a=t.video.currentTime,o=0;if(i)for(var s=0,u=i.length;s<u;s++)e[0]=i.start(s),e[1]=i.end(s),e[0]<=a&&e[1]<=a&&(o=e[1]>o?e[1]:o,t.mse.removeBuffer(e[0],e[1]));t.mp4=r,t.mse.appendBuffer(r.packMeta());var f=!0;t.on("timeupdate",function(){if(f&&n.meta.endTime-t.currentTime<2){var e=t.getBufferedRange();if(t.currentTime-e[1]<.1&&(f=!1,t.currentTime=0,i=t.video.buffered))for(var r=0,a=i.length;r<a;r++)e[0]=i.start(r),e[1]=i.end(r),e[0]>=o&&t.mse.removeBuffer(e[0],e[1])}})}),r.on("error",function(e){l(t,e)})};var v=function(){var e=t.mse,r=t.mp4;if(e&&!e.updating&&r.canDownload){var n=r.timeRage,i=t.getBufferedRange(),a=t.currentTime+s;if(i[1]-a>0)return;n.every(function(e,t){var n=(e[0]+e[1])/2;return 0!==i[1]&&(!(n>i[1]&&!r.bufferCache.has(t))||void d(0,n))}),ur(t,r)}};t.mp4ProgressTimer=setInterval(v,t.config.mp4ProgressTimer||300);var m=function(){var e=t.buffered,r=!1,n=t.currentTime;if(ir.clear(),e.length){for(var i=0,a=e.length;i<a;i++)if(n>=e.start(i)&&n<=e.end(i)){r=!0;break}r||d(0,n)}else d(0,t.currentTime)};t.on("seeking",m);var p=function(){ir.clear()};t.on("pause",p);var y=function(){u&&clearTimeout(u)};t.on("playing",y);var g=function(){var e=t.mp4;if(e&&e.meta){var r=t.getBufferedRange(),n=e.meta.videoDuration;n-t.currentTime<.5&&n-r[1]<.5?t.mse.endOfStream():(d(0,r[1]+1),u=setTimeout(function(){for(var e=t.buffered,r=void 0,n=0,i=e.length;n<i;n++)if((r=e.start(n))>=t.currentTime){t.currentTime=r;break}},1500))}};t.on("waiting",g);var w=function(){t.off("waiting",g),clearInterval(t.mp4ProgressTimer)};t.on("ended",w);var b=function(){ir.clear(),t.timer&&clearTimeout(t.timer)};t.once("destroy",b),t._replay=function(){ir.clear(),t.mp4.bufferCache.clear(),h(t.mp4.url).then(function(e){var r=e[0],n=e[1];t._start(n.url),t.mp4=r,t.mse=n,t.currentTime=0,t.play(),t.once("canplay",function(){t.on("waiting",g),t.mp4ProgressTimer=setInterval(v,t.config.mp4ProgressTimer||300)})},function(e){l(t,e)})}}};e.install("mp4player",fr)});
//# sourceMappingURL=index.min.js.map
