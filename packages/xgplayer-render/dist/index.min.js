!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.HlsLivePlayer=t())}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var P=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),U=function(){function t(){e(this,t)}return P(t,null,[{key:"createTexture",value:function(e,t,r,i,o){var a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r instanceof Uint8Array?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,o,0,e.RGBA,e.UNSIGNED_BYTE,r):r instanceof HTMLVideoElement?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r):r instanceof HTMLImageElement?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r):r instanceof ImageData&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),a}},{key:"createBuffer",value:function(e,t){var r=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),r}},{key:"createShader",value:function(e,t,r){var i=e.createShader(t);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));return i}},{key:"createProgram",value:function(e,r,i){var o=e.createProgram(),a=t.createShader(e,e.VERTEX_SHADER,r),n=t.createShader(e,e.FRAGMENT_SHADER,i);if(e.attachShader(o,a),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o));for(var u={program:o},s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),h=0;h<s;h++){var f=e.getActiveAttrib(o,h);u[f.name]=e.getAttribLocation(o,f.name)}for(var c=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),l=0;l<c;l++){var p=e.getActiveUniform(o,l);u[p.name]=e.getUniformLocation(o,p.name)}return u}},{key:"bindAttribute",value:function(e,t,r,i){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,i,e.FLOAT,!1,0,0)}}]),t}(),S=function e(){t(this,e),this.inputTextures=[]},C=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),D=function(e){function t(e){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),o.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform highp float opacity;","uniform sampler2D sampler;","uniform highp float flipx;","uniform highp float flipy;","void main(void) {","  float cordx = textureCoord.x;","  if(flipx > 0.5) {","     cordx = 1.0 - textureCoord.x;","  }","  float cordy = 1.0 - textureCoord.y;","  if(flipy > 0.5) {","    cordy = textureCoord.y;","  }","  vec4 color = texture2D(sampler,vec2(cordx, cordy));","  gl_FragColor = vec4(color[0],color[1],color[2],opacity);","}"].join("\n"),o.opacity=void 0===e.opacity?1:e.opacity,o.flip=e.flip,o}return o(t,e),C(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2);var i=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));U.bindAttribute(t,i,this.pw.texturePos,2),U.createTexture(t,t.LINEAR),t.uniform1i(this.pw.sampler,0),t.uniform1f(this.pw.opacity,this.opacity);var o=0,a=0;"x"!==this.flip&&"xy"!==this.flip||(o=1),"y"!==this.flip&&"xy"!==this.flip||(a=1),t.uniform1f(this.pw.flipx,o),t.uniform1f(this.pw.flipy,a)}},{key:"setFlip",value:function(e){var t=0,r=0;this.flip=e,"x"!==this.flip&&"xy"!==this.flip||(t=1),"y"!==this.flip&&"xy"!==this.flip||(r=1),this.gl.uniform1f(this.pw.flipx,t),this.gl.uniform1f(this.pw.flipy,r)}},{key:"render",value:function(e,t,r){var i=this.gl,o=this.program;i.useProgram(o),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}]),t}(S),F=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),N=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 yuv2rgb;","void main(void) {","  float cx = 1.0 / outerSize.x;","  float odd = floor(mod(textureCoord.x * outerSize.x, 2.0));","  float x = textureCoord.x + 0.5 * cx - odd * cx;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  float ydata = odd < 0.5?color[0]:color[2];","  float udata = color[1];","  float vdata = color[3];","  gl_FragColor = vec4(ydata, udata, vdata, 1) * yuv2rgb;","}"].join("\n"),r}return u(t,e),F(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),U.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i);var o=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];t.uniformMatrix4fv(this.pw.yuv2rgb,!1,o)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,o=this.program,a=this.inputTextures[0];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(o),i.viewport(0,0,this.canvas.width,this.canvas.height),i.uniform2fv(this.pw.outerSize,[t,r]),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t/2,r,0,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),I=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),B=function(e){function t(e){s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","void main(void) {","  vec4 color = texture2D(sampler, textureCoord);","  gl_FragColor = vec4(color[2],color[1],color[0],color[3]);","}"].join("\n"),r}return f(t,e),I(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),U.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,o=this.program,a=this.inputTextures[0];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(o),i.viewport(0,0,this.canvas.width,this.canvas.height),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),O=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),L=function(e){function t(e){c(this,t);var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 YUV2RGB;","void main(void) {","  float my = floor(mod(textureCoord.y * outerSize.y, 4.0));","  float cy = 1.0 / outerSize.y;","  float mx = floor(mod(outerSize.x, 4.0));","  float cx = 1.0 / outerSize.x;","  float width =  outerSize.x + mx;","  float x = textureCoord.x + (mx * cx * textureCoord.y * outerSize.y);","  x = cx * mod(x * outerSize.x, width);","  float bdata, gdata, rdata;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  rdata = color[0];","  gdata = color[1];","  bdata = color[2];","  gl_FragColor = vec4(bdata, gdata, rdata, 1);","}"].join("\n"),r}return p(t,e),O(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),U.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,o=this.program,a=this.inputTextures[0];this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(o),i.viewport(0,0,this.canvas.width,this.canvas.height);var n=i.getUniformLocation(o,"outerSize");i.uniform2fv(n,[t,r]),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a);var u=t-t%4;return i.texImage2D(i.TEXTURE_2D,0,i.RGB,u,r,0,i.RGB,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),j=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),G=function(e){function t(e){v(this,t);var r=T(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 yTexturePos;","attribute vec2 uvTexturePos;","varying vec2 yTextureCoord;","varying vec2 uvTextureCoord;","void main()","{","  gl_Position = vertexPos;","  yTextureCoord = yTexturePos;","  uvTextureCoord = uvTexturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 yTextureCoord;","varying highp vec2 uvTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uvSampler;","uniform mat4 yuv2rgb;","void main(void) {","  vec4 colory = texture2D(ySampler, yTextureCoord);","  vec4 coloruv = texture2D(uvSampler, vec2(yTextureCoord.x / 2.0, yTextureCoord.y));","  gl_FragColor = vec4(colory[0], coloruv[0], coloruv[1], 1) * yuv2rgb;","}"].join("\n"),r}return x(t,e),j(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2);var i=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));U.bindAttribute(t,i,this.pw.yTexturePos,2);var o=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));U.bindAttribute(t,o,this.pw.uvTexturePos,2);var a=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.ySampler,0),this.inputTextures.push(a);var n=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.uvSampler,1),this.inputTextures.push(n);var u=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];t.uniformMatrix4fv(this.pw.yuv2rgb,!1,u)}},{key:"render",value:function(e,t,r){var i=e[0],o=e[1],a=this.gl,n=this.program,u=this.inputTextures[0],s=this.inputTextures[1];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(a,a.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(a,a.LINEAR,new Uint8Array(t*r*4),t,r)),a.bindFramebuffer(a.FRAMEBUFFER,this.rend.fb),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.outputTexuture,0),a.useProgram(n),a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,u),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,t,r,0,a.LUMINANCE,a.UNSIGNED_BYTE,i),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,s),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t/2,r/4,0,a.RGBA,a.UNSIGNED_BYTE,o),a.drawArrays(a.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),X=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),k=function(e){function t(e,r){d(this,t);var i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.vShader=["attribute vec4 vertexPos;","attribute vec2 yTexturePos;","attribute vec2 uTexturePos;","attribute vec2 vTexturePos;","varying vec2 yTextureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  yTextureCoord = yTexturePos;","  uTextureCoord = uTexturePos;","  vTextureCoord = vTexturePos;","}"].join("\n"),i.fShader=["precision highp float;","varying highp vec2 yTextureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 yuv2rgb;","void main(void) {","  highp float y = texture2D(ySampler,  yTextureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * yuv2rgb;","}"].join("\n"),i}return g(t,e),X(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2);var i=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));U.bindAttribute(t,i,this.pw.yTexturePos,2);var o=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));U.bindAttribute(t,o,this.pw.uTexturePos,2);var a=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));U.bindAttribute(t,a,this.pw.vTexturePos,2);var n=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.ySampler,0),this.inputTextures.push(n);var u=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.uSampler,1),this.inputTextures.push(u);var s=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.vSampler,2),this.inputTextures.push(s);var h=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];t.uniformMatrix4fv(this.pw.yuv2rgb,!1,h)}},{key:"render",value:function(e,t,r){var i=e[0],o=e[1],a=e[2],n=this.gl,u=this.program,s=this.inputTextures[0],h=this.inputTextures[1],f=this.inputTextures[2];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(n,n.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(n,n.LINEAR,new Uint8Array(t*r*4),t,r)),n.bindFramebuffer(n.FRAMEBUFFER,this.rend.fb),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.outputTexuture,0),n.useProgram(u),n.viewport(0,0,this.canvas.width,this.canvas.height),n.pixelStorei(n.UNPACK_ALIGNMENT,1),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t,r,0,n.LUMINANCE,n.UNSIGNED_BYTE,i),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t/2,r/2,0,n.LUMINANCE,n.UNSIGNED_BYTE,o),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,f),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t/2,r/2,0,n.LUMINANCE,n.UNSIGNED_BYTE,a),n.drawArrays(n.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),M=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),z=function(e){function t(e){m(this,t);var r=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","void main(void) {","  vec4 color = texture2D(sampler, textureCoord);","  gl_FragColor = vec4(color[0],color[1],color[2],color[3]);","}"].join("\n"),r}return E(t,e),M(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),U.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e instanceof ImageData?e.data:e[0];var i=this.gl,o=this.program,a=this.inputTextures[0];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(o),i.viewport(0,0,this.canvas.width,this.canvas.height),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),Y=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),H=function(e){function t(e){w(this,t);var r=R(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 YUV2RGB;","void main(void) {","  float my = floor(mod(textureCoord.y * outerSize.y, 4.0));","  float cy = 1.0 / outerSize.y;","  float mx = floor(mod(outerSize.x, 4.0));","  float cx = 1.0 / outerSize.x;","  float width =  outerSize.x + mx;","  float x = textureCoord.x + (mx * cx * textureCoord.y * outerSize.y);","  x = cx * mod(x * outerSize.x, width);","  float bdata, gdata, rdata;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  rdata = color[0];","  gdata = color[1];","  bdata = color[2];","  gl_FragColor = vec4(rdata, gdata, bdata, 1);","}"].join("\n"),r}return _(t,e),Y(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=U.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=U.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));U.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=U.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),U.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=U.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,o=this.program,a=this.inputTextures[0];this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=U.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(o),i.viewport(0,0,this.canvas.width,this.canvas.height);var n=i.getUniformLocation(o,"outerSize");i.uniform2fv(n,[t,r]),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a);var u=t-t%4;return i.texImage2D(i.TEXTURE_2D,0,i.RGB,u,r,0,i.RGB,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(S),V=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();return function(){function e(t){if(A(this,e),this.canvas=t.canvas,t.video?(this.video=t.video,t.flip="y"):t.image?this.image=t.image:this._initFmt(t),this.filters=[],this.basicFilter=new D({opacity:void 0!==t.opacity?t.opacity:1,flip:t.flip||void 0}),t.filters)for(var r=0;r<t.filters.length;r++)this.filters.push(t.filters[r]);this._init()}return V(e,[{key:"_initFmt",value:function(e){switch(e.format){case"YUY2":this.fmt=new N(this);break;case"RGBA":this.fmt=new z(this);break;case"RGB":this.fmt=new H(this);break;case"RGB32":this.fmt=new B(this);break;case"RGB24":this.fmt=new L(this);break;case"NV12":this.fmt=new G(this);break;case"YUV420":this.fmt=new k(this)}}},{key:"_initImage",value:function(){}},{key:"_init",value:function(){if(this._initContextGL(),!this.gl)throw new Error("fail to init gl");var e=this.gl;if(this.fb=e.createFramebuffer(),this.fmt)this.fmt.init(this);else if(this.video){var t=this.video.videoWidth,r=this.video.videoHeight,i=new Uint8Array(t*r*4);this.videoTexture=U.createTexture(e,e.LINEAR,i,t,r)}this.basicFilter.init(this);for(var o=0;o<this.filters.length;o++)this.filters[o].init(this)}},{key:"_initContextGL",value:function(){for(var e=this.canvas,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!t&&i<r.length;){var o=r[i];try{t=e.getContext(o)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++i}this.gl=t}},{key:"_drawPicture",value:function(e,t,r){var i=this.fmt.render(e,t,r),o=i.texture,a=i.width,n=i.height;this._applyFilters(o,a,n)}},{key:"_drawVideo",value:function(){var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.videoTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.video),this._applyFilters(this.videoTexture,this.video.videoWidth,this.video.videoHeight)}},{key:"_applyFilters",value:function(e,t,r){for(var i=this.gl,o=0;o<this.filters.length;o++){var a=this.filters[o].render(e,t,r);e=a.texture,t=a.width,r=a.height}i.bindFramebuffer(i.FRAMEBUFFER,null),this.width===t&&this.height===r||(this.width=this.canvas.width=t,this.height=this.canvas.height=r),this.basicFilter.render(e,t,r)}},{key:"render",value:function(e,t,r){this.fmt?(this.width===t&&this.height===r||(this.width=this.canvas.width=t,this.height=this.canvas.height=r),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this._drawPicture(e,t,r)):this.video&&(this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this._drawVideo())}}]),e}()});
//# sourceMappingURL=index.min.js.map
