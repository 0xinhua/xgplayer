!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],t):(e=e||self,t(e.Player))}(this,function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e){return!!e&&"object"==typeof e}function i(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||a(e)}function a(e){return e.$$typeof===Be}function o(e){return Array.isArray(e)?[]:{}}function s(e,t){return!1!==t.clone&&t.isMergeableObject(e)?d(o(e),e,t):e}function u(e,t,r){return e.concat(t).map(function(e){return s(e,r)})}function f(e,t,r){var n={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(t){n[t]=s(e[t],r)}),Object.keys(t).forEach(function(i){r.isMergeableObject(t[i])&&e[i]?n[i]=d(e[i],t[i],r):n[i]=s(t[i],r)}),n}function d(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||u,r.isMergeableObject=r.isMergeableObject||xe;var n=Array.isArray(t);return n===Array.isArray(e)?n?r.arrayMerge(e,t,r):f(e,t,r):s(t,r)}e=e&&e.hasOwnProperty("default")?e.default:e;var c,h,l,m,p=require("./_library"),v=require("./_global"),y=require("./_ctx"),w=require("./_classof"),g=require("./_export"),b=require("./_is-object"),U=require("./_a-function"),_=require("./_an-instance"),k=require("./_for-of"),x=require("./_species-constructor"),B=require("./_task").set,S=require("./_microtask")(),T=require("./_new-promise-capability"),z=require("./_perform"),C=require("./_user-agent"),A=require("./_promise-resolve"),O=v.TypeError,L=v.process,D=L&&L.versions,M=D&&D.v8||"",P=v.Promise,j="process"==w(L),q=function(){},E=h=T.f,R=!!function(){try{var e=P.resolve(1),t=(e.constructor={})[require("./_wks")("species")]=function(e){e(q,q)};return(j||"function"==typeof PromiseRejectionEvent)&&e.then(q)instanceof t&&0!==M.indexOf("6.6")&&-1===C.indexOf("Chrome/66")}catch(e){}}(),I=function(e){var t;return!(!b(e)||"function"!=typeof(t=e.then))&&t},F=function(e,t){if(!e._n){e._n=!0;var r=e._c;S(function(){for(var n=e._v,i=1==e._s,a=0;r.length>a;)!function(t){var r,a,o,s=i?t.ok:t.fail,u=t.resolve,f=t.reject,d=t.domain;try{s?(i||(2==e._h&&V(e),e._h=1),!0===s?r=n:(d&&d.enter(),r=s(n),d&&(d.exit(),o=!0)),r===t.promise?f(O("Promise-chain cycle")):(a=I(r))?a.call(r,u,f):u(r)):f(n)}catch(e){d&&!o&&d.exit(),f(e)}}(r[a++]);e._c=[],e._n=!1,t&&!e._h&&H(e)})}},H=function(e){B.call(v,function(){var t,r,n,i=e._v,a=N(e);if(a&&(t=z(function(){j?L.emit("unhandledRejection",i,e):(r=v.onunhandledrejection)?r({promise:e,reason:i}):(n=v.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=j||N(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},V=function(e){B.call(v,function(){var t;j?L.emit("rejectionHandled",e):(t=v.onrejectionhandled)&&t({promise:e,reason:e._v})})},K=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),F(t,!0))},Z=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw O("Promise can't be resolved itself");(t=I(e))?S(function(){var n={_w:r,_d:!1};try{t.call(e,y(Z,n,1),y(K,n,1))}catch(e){K.call(n,e)}}):(r._v=e,r._s=1,F(r,!1))}catch(e){K.call({_w:r,_d:!1},e)}}};R||(P=function(e){_(this,P,"Promise","_h"),U(e),c.call(this);try{e(y(Z,this,1),y(K,this,1))}catch(e){K.call(this,e)}},(c=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=require("./_redefine-all")(P.prototype,{then:function(e,t){var r=E(x(this,P));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=j?L.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&F(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),l=function(){var e=new c;this.promise=e,this.resolve=y(Z,e,1),this.reject=y(K,e,1)},T.f=E=function(e){return e===P||e===m?new l(e):h(e)}),g(g.G+g.W+g.F*!R,{Promise:P}),require("./_set-to-string-tag")(P,"Promise"),require("./_set-species")("Promise"),m=require("./_core").Promise,g(g.S+g.F*!R,"Promise",{reject:function(e){var t=E(this);return(0,t.reject)(e),t.promise}}),g(g.S+g.F*(p||!R),"Promise",{resolve:function(e){return A(p&&this===m?P:this,e)}}),g(g.S+g.F*!(R&&require("./_iter-detect")(function(e){P.all(e).catch(q)})),"Promise",{all:function(e){var t=this,r=E(t),n=r.resolve,i=r.reject,a=z(function(){var r=[],a=0,o=1;k(e,!1,function(e){var s=a++,u=!1;r.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,r[s]=e,--o||n(r))},i)}),--o||n(r)});return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=E(t),n=r.reject,i=z(function(){k(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}});var $=require("./_export"),G=require("./_string-pad"),W=require("./_user-agent"),X=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(W);$($.P+$.F*X,"String",{padStart:function(e){return G(this,e,arguments.length>1?arguments[1]:void 0,!0)}});var Y=function(e){return void 0!==e&&null!==e},J={object:!0,function:!0,undefined:!0},Q=function(e){return!!Y(e)&&hasOwnProperty.call(J,typeof e)},ee=function(e){if(!Q(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}},te=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!ee(e)},re=/^\s*class[\s{/}]/,ne=Function.prototype.toString,ie=function(e){return!!te(e)&&!re.test(ne.call(e))},ae=function(e){return void 0!==e&&null!==e},oe=Object.keys,se=function(e){return oe(ae(e)?Object(e):e)},ue=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}()?Object.keys:se,fe=function(e){if(!ae(e))throw new TypeError("Cannot use null or undefined");return e},de=Math.max,ce=function(e,t){var r,n,i,a=de(arguments.length,2);for(e=Object(fe(e)),i=function(n){try{e[n]=t[n]}catch(e){r||(r=e)}},n=1;n<a;++n)t=arguments[n],ue(t).forEach(i);if(void 0!==r)throw r;return e},he=function(){var e,t=Object.assign;return"function"==typeof t&&(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}()?Object.assign:ce,le=Array.prototype.forEach,me=Object.create,pe=function(e,t){var r;for(r in e)t[r]=e[r]},ve=function(e){var t=me(null);return le.call(arguments,function(e){ae(e)&&pe(Object(e),t)}),t},ye="razdwatrzy",we=String.prototype.indexOf,ge=function(e){return we.call(this,e,arguments[1])>-1},be=function(){return"function"==typeof ye.contains&&(!0===ye.contains("dwa")&&!1===ye.contains("foo"))}()?String.prototype.contains:ge,Ue=r(function(e){(e.exports=function(e,t){var r,n,i,a,o;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],Y(e)?(r=be.call(e,"c"),n=be.call(e,"e"),i=be.call(e,"w")):(r=i=!0,n=!1),o={value:t,configurable:r,enumerable:n,writable:i},a?he(ve(a),o):o}).gs=function(e,t,r){var n,i,a,o;return"string"!=typeof e?(a=r,r=t,t=e,e=null):a=arguments[3],Y(t)?ie(t)?Y(r)?ie(r)||(a=r,r=void 0):r=void 0:(a=t,t=r=void 0):t=void 0,Y(e)?(n=be.call(e,"c"),i=be.call(e,"e")):(n=!0,i=!1),o={get:t,set:r,configurable:n,enumerable:i},a?he(ve(a),o):o}}),_e=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},ke=r(function(e,t){var r,n,i,a,o,s,u,f=Function.prototype.apply,d=Function.prototype.call,c=Object.create,h=Object.defineProperty,l=Object.defineProperties,m=Object.prototype.hasOwnProperty,p={configurable:!0,enumerable:!1,writable:!0};o={on:r=function(e,t){var r;return _e(t),m.call(this,"__ee__")?r=this.__ee__:(r=p.value=c(null),h(this,"__ee__",p),p.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:n=function(e,t){var n,a;return _e(t),a=this,r.call(this,e,n=function(){i.call(a,e,n),f.call(t,this,arguments)}),n.__eeOnceListener__=t,this},off:i=function(e,t){var r,n,i,a;if(_e(t),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==typeof(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:a=function(e){var t,r,n,i,a;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)f.call(n,this,a)}else switch(arguments.length){case 1:d.call(i,this);break;case 2:d.call(i,this,arguments[1]);break;case 3:d.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];f.call(i,this,a)}}},s={on:Ue(r),once:Ue(n),off:Ue(i),emit:Ue(a)},u=l({},s),e.exports=t=function(e){return null==e?c(u):l(Object(e),s)},t.methods=o}),xe=(ke.methods,function(e){return n(e)&&!i(e)}),Be="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;d.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,r){return d(e,r,t)},{})};var Se=d,Te="1.1.5",ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ae=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Oe=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Le=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},De=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";Ce(this,t),n.version=Te;var a=Le(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n));return a.url=i,a}return Oe(t,e),t}(e.Errors),Me=function(){function e(t){if(Ce(this,e),!(t instanceof ArrayBuffer))throw new De("parse","",{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return Ae(e,[{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,r){var n=void 0;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw"not supported for readByte 3";n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new De("parse","",{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),Pe=function(){function e(){Ce(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return Ae(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new De("parse","",{line:19,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],r=0;r<16;r++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var r=this.size-t.position+this.start,n=this.type;this.data=t.buffer.slice(t.position,t.position+r),t.position+=this.data.byteLength;var i=void 0;(i=e.containerBox.find(function(e){return e===n})?e.containerParser:e[n])&&i instanceof Function&&i.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new Me(this.data),r=t.buffer.byteLength,n=this;t.position<r;){var i=new e;i.readHeader(t),n.subBox.push(i),i.readBody(t)}delete n.data,t=null}}]),e}();Pe.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra"],Pe.avc1=function(){var e=new Me(this.data),t=this;e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var r=0;r<31;r++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var n=new Pe;n.readHeader(e),t.subBox.push(n),n.readBody(e)}delete this.data,e=null},Pe.avcC=function(){var e=new Me(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var r=[],n=0;n<t;n++)r.push(Number(e.readUint8()).toString(16));this.ppsCount=e.readUint8();var i=e.readUint16();this.ppsLength=i;for(var a=[],o=0;o<i;o++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sequence=r;for(var s=[],u=e.dataview.byteLength;e.position<u;)s.push(e.readUint8());this.last=s,delete this.subBox,delete this.data,e=null},Pe.btrt=function(){var e=new Me(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null},Pe.co64=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null},Pe.ctts=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var r=0,n=this.entryCount;r<n;r++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null},Pe.dref=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var r=this,n=0;n<t;n++){var i=new Pe;r.subBox.push(i),i.read(e)}delete this.data,e=null},Pe.elst=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3);var t=[],r=e.readUint32();this.entries=t;for(var n=0;n<r;n++){var i={};t.push(i),1===this.version?(i.segment_duration=e.readUint64(),i.media_time=e.readUint64()):(i.segment_duration=e.readUint32(),i.media_time=e.readInt32()),i.media_rate_integer=e.readInt16(),i.media_rate_fraction=e.readInt16()}delete this.subBox,delete this.data,e=null},Pe.esds=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3);var t=Pe.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null},Pe.ftyp=function(){var e=new Me(this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],r=0,n=Math.floor((e.buffer.byteLength-8)/4);r<n;r++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data},Pe.hdlr=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null},Pe.iods=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3);for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null},Pe.mdat=function(){delete this.subBox};var je=function(){function e(){Ce(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return Ae(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();Pe.mdhd=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new je).setTime(1e3*this.create),this.modifyTime=(new je).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new je).setTime(1e3*this.create),this.modifyTime=(new je).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null},Pe.mp4a=function(){var e=new Me(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()/65536;var t=new Pe;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null},Pe.MP4DecConfigDescrTag=function(e){var t=new Pe,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=Me.readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(Pe.MP4DecSpecificDescrTag(e)),t},Pe.MP4DecSpecificDescrTag=function(e){var t=new Pe,r=void 0,n=void 0;t.type=e.readUint8(),128===(r=e.readUint8())?(t.extend=!0,e.skip(2),n=(r=e.readUint8()+5)-5):(n=r,r+=2),t.size=r;for(var i=[],a=0;a<n;a++)i.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=i,delete t.subBox,t},Pe.MP4ESDescrTag=function(e){var t=new Pe,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(Pe.MP4DecConfigDescrTag(e)),t.subBox.push(Pe.SLConfigDescriptor(e)),t},Pe.mvhd=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new je).setTime(1e3*this.create),this.modifyTime=(new je).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),Me.readByte(e.dataview,8),Me.readByte(e.dataview,2);for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,Me.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data},Pe.pasp=function(){var e=new Me(this.data);this.content=e.buffer.slice(0,this.size-8),delete this.subBox,delete this.data,e=null},Pe.SLConfigDescriptor=function(e){var t=new Pe,r=void 0;return t.type=e.readUint8(),r=e.readUint8(),128===r?(t.extend=!0,e.skip(2),r=e.readUint8()+5):r+=2,t.size=r,t.SL=e.readUint8(),delete t.subBox,t},Pe.smhd=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null},Pe.stco=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Pe.stsc=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var i,a,o=0,s=this.count;o<s-1;o++)i=t[o],a=t[o-1],i.chunk_count=t[o+1].first_chunk-i.first_chunk,i.first_sample=0===o?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var u=t[0];u.first_sample=1,u.chunk_count=0}else if(this.count>1){var f=t[this.count-1],d=t[this.count-2];f.first_sample=d.first_sample+d.chunk_count*d.samples_per_chunk,f.chunk_count=0}delete this.subBox,delete this.data,e=null},Pe.stsd=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new Pe;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null},Pe.stss=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Pe.stsz=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null},Pe.stts=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],r=0,n=this.count;r<n;r++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null},Pe.tkhd=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=Me.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new je).setTime(1e3*this.create),this.modifyTime=(new je).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new je).setTime(1e3*this.create),this.modifyTime=(new je).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null},Pe.udta=function(){delete this.subBox},Pe["url "]=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null},Pe.vmhd=function(){var e=new Me(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null};var qe=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=!0,o=!1,s=void 0;try{for(var u,f=n[Symbol.iterator]();!(a=(u=f.next()).done);a=!0)t+=u.value.length}catch(e){o=!0,s=e}finally{try{!a&&f.return&&f.return()}finally{if(o)throw s}}var d=new e(t),c=0,h=!0,l=!1,m=void 0;try{for(var p,v=n[Symbol.iterator]();!(h=(p=v.next()).done);h=!0){var y=p.value;d.set(y,c),c+=y.length}}catch(e){l=!0,m=e}finally{try{!h&&v.return&&v.return()}finally{if(l)throw m}}return d}});t(qe);var Ee=t(r(function(e){var t=function(e){return e&&e.__esModule?e:{default:e}}(qe);e.exports=t.default})),Re=function e(t){Ce(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;var r=this;r.buffer?Ee(Uint8Array,r.buffer,t):r.buffer=t;var n=t.byteLength;t.position=0;for(var i=new Me(t);n-i.position>=8;){var a=new Pe;if(a.readHeader(i),a.size-8<=n-i.position)a.readBody(i),r.boxes.push(a);else{if("mdat"!==a.type){r.nextBox=a,i.position-=8;break}a.readBody(i),r.boxes.push(a)}}r.buffer=new Uint8Array(r.buffer.slice(i.position))},Ie=function(){function e(){Ce(this,e),this.buffer=new Uint8Array(0)}return Ae(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach(function(t){t?e.buffer=Ee(Uint8Array,e.buffer,t):window.console.error(t)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),Fe=Math.pow(2,32)-1,He=function(){function e(){Ce(this,e)}return Ae(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return Ie.writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new Ie;return t.write(e.size(28),e.type("ftyp"),new Uint8Array([105,115,111,53,0,0,0,1,77,52,65,32,105,115,111,53,100,97,115,104])),t.buffer}},{key:"moov",value:function(t){var r=new Ie,n=8,i=e.mvhd(t.duration,t.timeScale),a=e.audioTrak(t),o=e.mvex(t.duration,t.timeScale),s=new Ie,u=new Uint8Array([0,0,0,85,117,100,116,97,0,0,0,77,109,101,116,97,0,0,0,0,0,0,0,33,104,100,108,114,0,0,0,0,0,0,0,0,109,100,105,114,97,112,112,108,0,0,0,0,0,0,0,0,0,0,0,0,32,105,108,115,116,0,0,0,12,45,45,45,45,0,0,0,0,0,0,0,12,45,45,45,45,0,0,0,0]);s.write(new Uint8Array(u));var f=s.buffer;return[i,a,o,f].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("moov"),i,o,a,f),r.buffer}},{key:"mvhd",value:function(t,r){var n=new Ie;t*=r,t=0;var i=Math.floor(t/(Fe+1)),a=Math.floor(t%(Fe+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.write(e.size(8+o.length),e.type("mvhd"),new Uint8Array(o)),n.buffer}},{key:"audioTrak",value:function(t){var r=new Ie,n=8,i=e.tkhd({id:1,duration:t.audioDuration,timeScale:t.audioTimeScale,width:0,height:0,type:"audio"}),a=e.mdia({type:"audio",timeScale:t.audioTimeScale,duration:t.audioDuration,channelCount:t.channelCount,sampleRate:t.sampleRate,audioConfig:t.audioConfig}),o=new Ie,s=new Uint8Array([0,0,0,44,108,117,100,116,0,0,0,36,116,108,111,117,1,0,0,0,1,0,0,0,72,84,132,35,5,1,114,35,3,114,19,4,125,19,5,115,19,6,4,19]);o.write(e.size(52),e.type("udta"),new Uint8Array(s));var u=o.buffer;return[i,a,u].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("trak"),i,a,u),r.buffer}},{key:"tkhd",value:function(t){var r=new Ie,n=t.id;t.duration,t.timeScale;var i=t.type,a=Math.floor(0/(Fe+1)),o=Math.floor(0%(Fe+1)),s=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,"video"===i?1:0,"audio"===i?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]);return r.write(e.size(8+s.byteLength),e.type("tkhd"),s),r.buffer}},{key:"edts",value:function(t){var r=new Ie,n=t.duration,i=t.mediaTime;return r.write(e.size(36),e.type("edts")),r.write(e.size(28),e.type("elst")),r.write(new Uint8Array([0,0,0,1,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,1])),r.buffer}},{key:"mdia",value:function(t){var r=new Ie,n=8,i=e.mdhd(t.timeScale),a=e.hdlr(t.type),o=e.minf(t);return[i,a,o].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("mdia"),i,a,o),r.buffer}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new Ie;r*=t;var i=Math.floor(r/(Fe+1)),a=Math.floor(r%(Fe+1)),o=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]);return n.write(e.size(12+o.byteLength),e.type("mdhd"),e.extension(1,0),o),n.buffer}},{key:"hdlr",value:function(t){var r=new Ie,n=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(n.splice.apply(n,[8,4].concat([115,111,117,110])),n.splice.apply(n,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),r.write(e.size(8+n.length),e.type("hdlr"),new Uint8Array(n)),r.buffer}},{key:"minf",value:function(t){var r=new Ie,n=8,i="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),o=e.stbl(t);return[i,a,o].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("minf"),i,a,o),r.buffer}},{key:"vmhd",value:function(){var t=new Ie;return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new Ie;return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new Ie,r=[0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1];return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array(r)),t.buffer}},{key:"stbl",value:function(t){var r=new Ie,n=8,i=e.stsd(t),a=e.stts(),o=e.stsc(),s=e.stsz(),u=e.stco();return[i,a,o,s,u].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("stbl"),i,a,o,s,u),r.buffer}},{key:"stsd",value:function(t){var r=new Ie,n=void 0;return n="audio"===t.type?e.mp4a(t):e.avc1(t),r.write(e.size(16+n.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),n),r.buffer}},{key:"mp4a",value:function(t){var r=new Ie,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),i=e.esds(t.audioConfig);return r.write(e.size(8+n.byteLength+i.byteLength),e.type("mp4a"),n,i),r.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],r=t.length,n=new Ie,i=new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2]));return n.write(e.size(8+i.byteLength),e.type("esds"),i),n.buffer}},{key:"avc1",value:function(t){var r=new Ie,n=t.sps,i=t.pps,a=t.width,o=t.height,s=t.pixelRatio[0],u=t.pixelRatio[1],f=new Uint8Array([1,n[1],n[2],n[3],255,225].concat([n.length>>>8&255,255&n.length]).concat(n).concat(1).concat([i.length>>>8&255,255&i.length]).concat(i)),d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,o>>8&255,255&o,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u]);return r.write(e.size(40+d.byteLength+f.byteLength+c.byteLength),e.type("avc1"),d,e.size(8+f.byteLength),e.type("avcC"),f,e.size(20),e.type("btrt"),c,e.size(16),e.type("pasp"),h),r.buffer}},{key:"stts",value:function(){var t=new Ie,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),r),t.buffer}},{key:"stsc",value:function(){var t=new Ie,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),r),t.buffer}},{key:"stco",value:function(){var t=new Ie,r=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),r),t.buffer}},{key:"stsz",value:function(){var t=new Ie,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),r),t.buffer}},{key:"mvex",value:function(t,r){var n=new Ie,i=8,a=e.mehd(t*r),o=e.trex(1),s=e.trep(1);return[a,o,s].forEach(function(e){i+=e.byteLength}),n.write(e.size(i),e.type("mvex"),a,o,s),n.buffer}},{key:"mehd",value:function(t){var r=new Ie,n=new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t]);return r.write(e.size(16),e.type("mehd"),e.extension(0,0),n),r.buffer}},{key:"trex",value:function(t){var r=new Ie,n=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,0,30,132,128]);return r.write(e.size(8+n.byteLength),e.type("trex"),n),r.buffer}},{key:"trep",value:function(t){var r=new Ie,n=new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t]);return r.write(e.size(16),e.type("trep"),e.extension(0,0),n),r.buffer}},{key:"moof",value:function(t){var r=new Ie,n=8,i=e.mfhd(),a=e.traf(t);return[i,a].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("moof"),i,a),r.buffer}},{key:"mfhd",value:function(){var t=new Ie,r=Ie.writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),r),t.buffer}},{key:"traf",value:function(t){var r=new Ie,n=8,i=e.tfhd(1),a=e.tfdt(t.time),o=e.trun(t);return[i,a,o].forEach(function(e){n+=e.byteLength}),r.write(e.size(n),e.type("traf"),i,a,o),r.buffer}},{key:"tfhd",value:function(t){var r=new Ie,n=Ie.writeUint32(t);return r.write(e.size(16),e.type("tfhd"),e.extension(0,131072),n),r.buffer}},{key:"tfdt",value:function(t){var r=new Ie,n=new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t]);return r.write(e.size(16),e.type("tfdt"),e.extension(0,0),n),r.buffer}},{key:"trun",value:function(t){var r=new Ie,n=Ie.writeUint32(t.samples.length),i=Ie.writeUint32(92+4*t.samples.length);return r.write(e.size(20+4*t.samples.length),e.type("trun"),e.extension(0,513),n,i),t.samples.forEach(function(e,t){r.write(Ie.writeUint32(e.size))}),r.buffer}},{key:"mdat",value:function(t){var r=new Ie,n=8;return t.samples.forEach(function(e){n+=e.size}),r.write(e.size(n),e.type("mdat")),t.samples.forEach(function(e){r.write(e.buffer)}),r.buffer}}]),e}();He.sequence=1;var Ne=function(){function e(t,r,n){Ce(this,e),ke(this),this.url=t,this.range=r,this.id=r.join("-"),this.on=!1;var i=new window.XMLHttpRequest;i.target=this,i.responseType="arraybuffer",i.open("get",t),i.setRequestHeader("Range","bytes="+r[0]+"-"+r[1]),i.onload=function(){200!==i.status&&206!==i.status||n&&n instanceof Function&&n(i.response),i.target.remove()},i.onerror=function(e){i.target.emit("error",new De("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),i.target.remove()},i.onabort=function(){i.target.remove()},this.xhr=i,e.queue.push(this),this.update()}return Ae(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter(function(r,n){return r.url===t.url&&r.id===t.id&&(e.queue.splice(n,1),!0)}),this.update()}},{key:"update",value:function(){var t=e.queue,r=t.filter(function(e){return e.on}),n=t.filter(function(e){return!e.on}),i=e.limit-r.length;n.forEach(function(e,t){t<i&&e.run()})}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach(function(e){e.on&&e.cancel()}),e.queue.length=0}}]),e}();Ne.queue=[],Ne.limit=2,window.Task=Ne;var Ve={};Ve.findBox=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var n=e.subBox.filter(function(e){return e.type===t});n.length?n.forEach(function(e){return r.push(e)}):e.subBox.forEach(function(e){return Ve.findBox(e,t,r)})}}else r.push(e);return r=[].concat(r),r.length>1?r:r[0]},Ve.padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},Ve.toHex=function(){for(var e=[],t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach(function(t){e.push(Ve.padStart(Number(t).toString(16),2,0))}),e},Ve.sum=function(){for(var e=0,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach(function(t){e+=t}),e},Ve.stscOffset=function(e,t){var r=void 0,n="",i=e.entries.filter(function(e){return e.first_sample<=t&&t<e.first_sample+e.chunk_count*e.samples_per_chunk})[0];if(i){var a=Math.floor((t-i.first_sample)/i.samples_per_chunk),o=i.first_sample+a*i.samples_per_chunk;return r=i.first_chunk+a,n=[o,t],{chunk_index:r,samples_offset:n}}var s=e.entries.pop();e.entries.push(s);var u=Math.floor((t-s.first_sample)/s.samples_per_chunk);return{chunk_index:s.first_chunk+u,samples_offset:[s.first_sample+s.samples_per_chunk*u,t]}},Ve.seekSampleOffset=function(e,t,r,n,i){var a=Ve.stscOffset(e,n+1),o=t.entries[a.chunk_index-1]+Ve.sum.apply(null,r.entries.slice(a.samples_offset[0]-1,a.samples_offset[1]-1))-i;if(void 0===o)throw"result="+o+",stco.length="+t.entries.length+",sum="+Ve.sum.apply(null,r.entries.slice(0,n));if(o<0)throw"result="+o+",stco.length="+t.entries.length+",sum="+Ve.sum.apply(null,r.entries.slice(0,n));return o},Ve.seekSampleTime=function(e,t,r){var n=void 0,i=void 0,a=0,o=0,s=0;if(e.entry.every(function(e){return i=e.sampleDuration,r<a+e.sampleCount?(n=o+(r-a)*e.sampleDuration,!1):(a+=e.sampleCount,o+=e.sampleCount*i,!0)}),t){var u=0;t.entry.every(function(e){return u+=e.count,!(r<u)||(s=e.offset,!1)})}return n||(n=o+(r-a)*i),{time:n,duration:i,offset:s}},Ve.seekOrderSampleByTime=function(e,t,r){var n=0,i=0,a=0,o=void 0,s=void 0;return e.every(function(e,u){return o=e.sampleCount*e.sampleDuration/t,r<=n+o?(i=a+Math.ceil((r-n)*t/e.sampleDuration),n+=Math.ceil((r-n)*t/e.sampleDuration)*e.sampleDuration/t,s=e.sampleCount,!1):(n+=o,a+=e.sampleCount,!0)}),{order:i,startTime:n,sampleDuration:s}},Ve.sampleCount=function(e){var t=0;return e.forEach(function(e,r){t+=e.sampleCount}),t},Ve.seekTrakDuration=function(e,t){var r=0;return Ve.findBox(e,"stts").entry.forEach(function(e){r+=e.sampleCount*e.sampleDuration}),Number(r/t).toFixed(4)};var Ke=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;Ce(this,t),ke(this),this.url=e,this.CHUNK_SIZE=r,this.reqTimeLength=5,this.init(e),this.once("mdatReady",this.moovParse.bind(this)),this.cache=new Ie,this.bufferCache=new Set,this.mdatCache=[],this.timeRage=[],this.canDownload=!0,this.cut=!1}return Ae(t,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE,n=this;return new Promise(function(i,a){new Ne(e.url,[t,r],i).once("error",function(e){n.emit("error",e)})})}},{key:"moovParse",value:function(){var t=this,r=this.moovBox,n=Ve.findBox(r,"mvhd"),i=Ve.findBox(r,"trak"),a=void 0,o=void 0,s=void 0,u=void 0,f=void 0,d=void 0;"Array"!==e.util.typeOf(i)&&(i=[i]),i.forEach(function(e){var r=Ve.findBox(e,"hdlr"),n=Ve.findBox(e,"mdhd");if(!r||!n)return void t.emit("error",new De("parse","",{line:72,handle:"[MP4] moovParse",url:t.url}));var i=Ve.findBox(e,"stsd").subBox[0];if("soun"===r.handleType){a=e;var c=Ve.findBox(e,"esds"),h=Ve.findBox(e,"mp4a"),l=Ve.findBox(e,5);s=n.timescale,o=c?i.type+"."+Ve.toHex(c.subBox[0].subBox[0].typeID)+"."+c.subBox[0].subBox[0].subBox[0].type:""+i.type,l&&l.EScode&&(d=l.EScode.map(function(e){return Number("0x"+e)})),h&&(u=h.channelCount,f=h.sampleRate)}}),this.audioTrak=Se({},a);var c=this._boxes.find(function(e){return"mdat"===e.type}),h=parseFloat(Ve.seekTrakDuration(a,s));this.mdatStart=c.start,this.sampleCount=Ve.sampleCount(Ve.findBox(this.audioTrak,"stts").entry);for(var l=void 0,m=void 0,p=Ve.findBox(this.audioTrak,"stts").entry,v=0;v<h;v+=this.reqTimeLength)l=Ve.seekOrderSampleByTime(p,s,v),v+this.reqTimeLength<h?(m=Ve.seekOrderSampleByTime(p,s,v+this.reqTimeLength),this.timeRage.push([{time:l.startTime,order:l.order},{time:m.startTime,order:m.order}])):this.timeRage.push([{time:l.startTime,order:l.order},{time:h,order:this.sampleCount-1}]);this.meta={audioCodec:o,createTime:n.createTime,modifyTime:n.modifyTime,duration:n.duration/n.timeScale,timeScale:n.timeScale,audioDuration:h,audioTimeScale:s,endTime:h,channelCount:u,sampleRate:f,audioConfig:d}}},{key:"init",value:function(){var e=this;e.getData().then(function(t){var r=void 0,n=0,i=void 0,a=void 0,o=void 0,s=void 0;try{r=new Re(t)}catch(t){return e.emit("error",t.type?t:new De("parse","",{line:176,handle:"[MP4] init",msg:t.message})),!1}if(e._boxes=s=r.boxes,s.every(function(r){return"ftyp"===r.type?(n+=r.size,o=r,e.ftypBox=o,e.ftypBuffer=t.slice(0,o.size)):"mdat"===r.type&&((i=r).start=n,n+=r.size,e.mdatBox=i),!0}),i)r.nextBox?e.emit("error",new De("parse","",{line:223,handle:"[MP4] init",msg:"not find moov box"})):e.getData(n,n+1024).then(function(t){var r=new Re(t);if(e._boxes=e._boxes.concat(r.boxes),r.boxes.every(function(r){return"moov"===r.type?(n+=r.size,a=r,e.moovBox=a,e.moovBuffer=t.slice(0,a.size),e.emit("mdatReady",a),!1):(n+=r.size,!0)}),!a){var i=r.nextBox;i?"moov"===i.type?e.getData(n,n+i.size-1).then(function(r){var i=new Re(r);e._boxes=e._boxes.concat(i.boxes),i.boxes.every(function(r){return"moov"===r.type?(n+=r.size,a=r,e.moovBox=a,e.moovBuffer=t.slice(0,a.size),e.emit("mdatReady",a),!1):(n+=r.size,!0)}),a||e.emit("error",new De("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"}))}).catch(function(){e.emit("error",new De("network","",{line:210,handle:"[MP4] getData",msg:"getData failed"}))}):e.emit("error",new De("parse","",{line:213,handle:"[MP4] init",msg:"not find moov box"})):e.emit("error",new De("parse","",{line:216,handle:"[MP4] init",msg:"not find moov box"}))}}).catch(function(){e.emit("error",new De("network","",{line:220,handle:"[MP4] getData",msg:"getData failed"}))});else{var u=r.nextBox;u?"moov"===u.type||"free"===u.type?e.getData(n,n+u.size+1024).then(function(t){var r=new Re(t);if(e._boxes=e._boxes.concat(r.boxes),r.boxes.every(function(r){return"moov"===r.type?(n+=r.size,a=r,e.moovBox=a,e.moovBuffer=t.slice(0,a.size),!0):"mdat"===r.type?(i=r,i.start=n,n+=r.size,e.mdatBox=i,e.emit("mdatReady",a),!1):(n+=r.size,!0)}),!i){var o=r.nextBox;o?"free"===o.type?e.getData(n,n+o.size+1024).then(function(t){var r=new Re(t);e._boxes=e._boxes.concat(r.boxes),r.boxes.every(function(r){return"mdat"===r.type?(i=r,i.start=n,e.mdatBox=i,e.emit("mdatReady",a),!1):"free"===r.type?(e.freeBuffer=t.slice(0,r.size),n+=r.size,!0):(n+=r.size,!0)}),i||e.emit("error",new De("parse","",{line:207,handle:"[MP4] init",msg:"not find mdat box"}))}).catch(function(){e.emit("error",new De("network","",{line:210,handle:"[MP4] getData",msg:"getData failed"}))}):e.emit("error",new De("parse","",{line:213,handle:"[MP4] init",msg:"not find mdat box"})):e.emit("error",new De("parse","",{line:216,handle:"[MP4] init",msg:"not find mdat box"}))}}).catch(function(){e.emit("error",new De("network","",{line:220,handle:"[MP4] getData",msg:"getData failed"}))}):e.emit("error",new De("parse","",{line:223,handle:"[MP4] init",msg:"not find mdat box"})):e.emit("error",new De("parse","",{line:226,handle:"[MP4] init",msg:"not find mdat box"}))}}).catch(function(){e.emit("error",new De("network","",{line:230,handle:"[MP4] getData",msg:"getData failed"}))})}},{key:"getSamplesByOrders",value:function(){var e=arguments[1],t=arguments[2],r=this.audioTrak,n=Ve.findBox(r,"stsc"),i=Ve.findBox(r,"stsz"),a=Ve.findBox(r,"stts"),o=Ve.findBox(r,"stco"),s=Ve.findBox(r,"ctts"),u=this.mdatStart,f=[];if(t=void 0!==t?t:i.entries.length,e instanceof Array)e.forEach(function(e,t){f.push({idx:e,size:i.entries[e],time:Ve.seekSampleTime(a,s,e),offset:Ve.seekSampleOffset(n,o,i,e,u)})});else if(0!==t)for(var d=e;d<t;d++)f.push({idx:d,size:i.entries[d],time:Ve.seekSampleTime(a,s,d),offset:Ve.seekSampleOffset(n,o,i,d,u)});else f={idx:e,size:i.entries[e],time:Ve.seekSampleTime(a,s,e),offset:Ve.seekSampleOffset(n,o,i,e,u)};return f}},{key:"packMeta",value:function(e){if(e){var t=new Ie;return t.write(He.ftyp()),t.write(He.moov(e)),this.cache.write(t.buffer),t.buffer}}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Ve.findBox(this.audioTrak,"stts").entry;return t||(t=Ve.seekOrderSampleByTime(n,this.meta.audioTimeScale,e).order),r||e+this.reqTimeLength<this.meta.audioDuration&&(r=Ve.seekOrderSampleByTime(n,this.meta.audioTimeScale,e+this.reqTimeLength).order),this.bufferCache.has(t)?Promise.resolve(null):this.loadFragment(t,r)}},{key:"loadFragment",value:function(e,t){var r=this,n=void 0,i=void 0,a=this,o=this.getSamplesByOrders("audio",e,0);n=o.offset;var s=void 0;return t?(s=this.getSamplesByOrders("audio",t,0),i=s.offset-1):(s=this.getSamplesByOrders("audio",this.sampleCount-1,0),i=s.offset+s.size-1),window.isNaN(n)||void 0!==i&&window.isNaN(i)?(a.emit("error",new De("parse","",{line:366,handle:"[MP4] loadFragment",url:a.url})),!1):this.getData(n+a.mdatStart,i?a.mdatStart+i:"").then(function(o){return i&&r.mdatCache.push({start:n+a.mdatStart,end:a.mdatStart+i,buffer:new Uint8Array(o)}),a.createFragment(new Uint8Array(o),n,e,t)})}},{key:"addFragment",value:function(e){var t=new Ie;return t.write(He.moof(e)),t.write(He.mdat(e)),this.cache.write(t.buffer),t.buffer}},{key:"createFragment",value:function(e,t,r,n){var i=[];this.bufferCache.add(r);var a=this.getSamplesByOrders("audio",r,n),o=a.map(function(r,n){return{size:r.size,duration:r.time.duration,offset:r.time.offset,buffer:new Uint8Array(e.slice(r.offset-t,r.offset-t+r.size)),key:0===n}});i.push(this.addFragment({id:2,time:this.cut?0:a[0].time.time,firstFlags:0,flags:1793,samples:o}));var s=0;i.every(function(e){return s+=e.byteLength,!0});var u=new Uint8Array(s),f=0;return i.every(function(e){return u.set(e,f),f+=e.byteLength,!0}),Promise.resolve(u)}},{key:"download",value:function(){}}]),t}(),Ze=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'audio/mp4; codecs="mp4a.40.5"';Ce(this,e);var r=this;ke(this),this.codecs=t,this.replaying=!1,this.mediaSource=new window.MediaSource,this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this.updating=!1,this.mediaSource.addEventListener("sourceopen",function(){r.sourceBuffer=r.mediaSource.addSourceBuffer(r.codecs),r.sourceBuffer.addEventListener("error",function(e){r.emit("error",new De("mse","",{line:16,handle:"[MSE] constructor sourceopen",msg:e.message}))}),r.sourceBuffer.addEventListener("updateend",function(e){r.emit("updateend");var t=r.queue.shift();t&&r.sourceBuffer.appendBuffer(t)}),r.emit("sourceopen")}),this.mediaSource.addEventListener("sourceclose",function(){r.emit("sourceclose")})}return Ae(e,[{key:"appendBuffer",value:function(e){var t=this.sourceBuffer;return!1===t.updating&&"open"===this.state?(t.appendBuffer(e),!0):(this.queue.push(e),!1)}},{key:"removeBuffer",value:function(e,t){this.sourceBuffer.remove(e,t)}},{key:"endOfStream",value:function(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}},{key:"state",get:function(){return this.replaying?"open":this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){this.mediaSource.duration=e}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}(),$e=function(e,t){if(t.meta.endTime-e.currentTime<2){var r=e.getBufferedRange();e.currentTime-r[1]<.1&&e.mse.endOfStream()}},Ge=function(e,t){t.vid=e.config.vid,t.url=e.src,t.errd&&"object"===ze(t.errd)&&e.mp4&&(t.errd.url=e.mp4.url,t.url=e.mp4.url,e.mp4.canDownload=!1),e.emit("DATA_REPORT",t),"network"===t.errt&&e.config._backupURL?e.src=e.config._backupURL:e.src=e.config._mainURL,e.switchURL=null,e._replay=null},We=function(){var t=this,r=e.sniffer,n=e.util,i=e.Errors,a=void 0,o=void 0,s=t.config.preloadTime||15;e.m4a=!0,t.hasEnded=!1;var u="Array"===n.typeOf(t.config.url)?t.config.url:[{src:t.config.url,name:t.config.name,vid:t.config.vid,poster:t.config.poster}],f=u[0].src,d=u[0].name,c=u[0].vid,h=u[0].poster,l=t.config.pluginRule||function(){return!0};if(!f)return void t.emit("error",new i("other",t.config.vid));"String"===n.typeOf(f)?a=f:"Array"===n.typeOf(f)&&f.length&&(a=f[0].src,o=f[1].src),t.config._mainURL=a,t.config._backupURL=o;var m=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.currentTime,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t.timer&&clearTimeout(t.timer),n=Math.max(n,t.currentTime),t.timer=setTimeout(function(){t.mp4.seek(n,i,a).then(function(e){if(e){var r=t.mse;r.updating=!0,r.appendBuffer(e),r.once("updateend",function(){r.updating=!1})}},function(){r<10&&setTimeout(function(){e(r+1)},2e3)})},50)},p=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Ke(e);n.reqTimeLength=t.config.reqTimeLength||5;var i=void 0;return new Promise(function(e,a){n.once("mdatReady",function(){i=new Ze,r&&(i.replaying=!0),i.on("sourceopen",function(){i.appendBuffer(n.packMeta(n.meta)),i.once("updateend",m.bind(t))}),i.on("error",function(e){a(e)}),e([n,i])}),n.on("error",function(e){a(e)})})};if(["chrome","firfox","safari"].some(function(e){return e===r.browser})&&Ze.isSupported('audio/mp4; codecs="mp4a.40.5"')){var v=t.start;if(!l.call(t))return!1;if(t.cut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments[1],n=new Ie;return new Promise(function(i,a){var o=new Ke(f);o.once("mdatReady",function(){(!r||r<=t)&&(r=t+15),r>o.meta.audioDuration&&(t=o.meta.audioDuration-(r-t),r=o.meta.audioDuration),o.reqTimeLength=r-t,o.cut=!0,o.seek(t).then(function(t){if(t){var r=e.util.deepCopy({duration:o.reqTimeLength,audioDuration:o.reqTimeLength,endTime:o.reqTimeLength},o.meta);r.duration=o.reqTimeLength,r.audioDuration=o.reqTimeLength,r.endTime=o.reqTimeLength,n.write(o.packMeta(r),t),i(new Blob([n.buffer],{type:'audio/mp4; codecs="mp4a.40.5"'}))}})}),o.on("error",function(e){a(e)})})},t.config.segPlay){var y=t.config.segPlay;return void t.cut(y.start,y.end).then(function(e){e&&(t.config.url=URL.createObjectURL(e),t.start(t.config.url))},function(){console.log("error")})}Object.defineProperty(t,"src",{get:function(){return t.currentSrc},set:function(e){t.config.url=e,t.paused?t.start(e):(t.pause(),t.once("pause",function(){t.start(e)}),t.once("canplay",function(){t.play()})),t.once("canplay",function(){t.currentTime=0})},configurable:!0}),t.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;p(e).then(function(e){var r=e[0],n=e[1];v.call(t,n.url),t.mp4=r,t.mse=n,r.on("error",function(e){Ge(t,e)})},function(r){v.call(t,e),Ge(t,r)}),t.once("canplay",function(){if("safari"===r.browser&&t.buffered){var e=t.buffered.start(0);t.currentTime=e+.1}})},t.switchURL=function(e){var n=new Ke(e),i=t.mp4;n.on("mdatReady",function(){var e=i.timeRage,a=t.currentTime,o=(e=i.timeRage).find(function(e){return e[0]-a>2})[0],s=t.getBufferedRange()[1];s-o>0&&"safari"!==r.browser&&t.mse.removeBuffer(o,s),t.mp4=n,t.mse.appendBuffer(n.packMeta(n.meta))}),n.on("error",function(e){Ge(t,e)})},t.on("timeupdate",function(){var e=t.mse,r=t.mp4;if(e&&!e.updating&&r.canDownload){var n=r.timeRage,i=t.getBufferedRange(),a=t.currentTime+s;if(i[1]-a>0)return;n.every(function(e,t){return 0===i[1]?(m(5),!1):!(e[0].time>=i[1]&&!r.bufferCache.has(t))||void m(0,e[0].time,e[0].order,e[1].order)}),$e(t,r)}}),t.on("seeking",function(){var e=t.buffered,r=!1,n=t.currentTime;Ne.clear();var i=t.mp4.timeRage;if(e.length){for(var a=0,o=e.length;a<o;a++)if(n>=e.start(a)&&n<=e.end(a)){r=!0;break}r||i.every(function(e,t){return!(e[0].time<=n&&e[1].time>n)||(m(0,e[0].time,e[0].order,e[1].order),!1)})}else i.every(function(e,t){return!(e[0].time<=n&&e[1].time>n)||(m(0,e[0].time,e[0].order,e[1].order),!1)})}),t.on("pause",function(){Ne.clear()}),t.on("playing",function(){}),t.on("waiting",function(){var e=t.buffered,r=!1,n=t.currentTime;Ne.clear();var i=t.mp4.timeRage;if(e.length){for(var a=0,o=e.length;a<o;a++)if(n>=e.start(a)&&n<=e.end(a)){r=!0;break}r||i.every(function(e,t){return!(e[0].time<=n&&e[1].time>n)||(m(0,e[0].time,e[0].order,e[1].order),!1)})}else i.every(function(e,t){return!(e[0].time<=n&&e[1].time>n)||(m(0,e[0].time,e[0].order,e[1].order),!1)})}),t.once("destroy",function(){Ne.clear(),t.timer&&clearTimeout(t.timer)}),t.on("change",function(e){t.newMusic(e.src),d=""+e.name,c=""+e.vid,h=""+e.poster}),t.newMusic=function(e){Ne.clear(),t.mp4.bufferCache.clear(),p(e,!0).then(function(e){var r=e[0],n=e[1];t.src=n.url,t.mp4=r,t.mse=n,t.mse.replaying=!0,t.currentTime=0,setTimeout(function(){t.video.play()},60)},function(e){Ge(t,e)})},t.on("ended",function(){if(t.hasEnded=!0,t.config.offline){var e=new Ie;e.write(He.size(t.mp4.mdatBox.size),He.type("mdat")),t.mp4.mdatCache.sort(function(e,t){return e.start-t.start});var r=t.mp4.mdatCache[0].start-1;if(t.mp4.mdatCache.forEach(function(t,n){t.start===r+1&&(e.write(t.buffer),r=t.end)}),r!==t.mp4.mdatCache[t.mp4.mdatCache.length-1].end)return;var n=new Ie;t.mp4.freeBuffer?n.write(new Uint8Array(t.mp4.ftypBuffer),new Uint8Array(t.mp4.moovBuffer),new Uint8Array(t.mp4.freeBuffer),e.buffer):n.write(new Uint8Array(t.mp4.ftypBuffer),new Uint8Array(t.mp4.moovBuffer),e.buffer);var i=c||d;t.database.openDB(function(){t.database.addData(t.database.myDB.ojstore.name,[{vid:i,blob:new Blob([n.buffer],{type:'audio/mp4; codecs="mp4a.40.5"'})}]),setTimeout(function(){t.database.closeDB()},5e3)})}})}};e.install("m4aplayer",We)});
//# sourceMappingURL=index.min.js.map
