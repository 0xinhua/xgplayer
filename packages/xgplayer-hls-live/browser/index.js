window.HlsLivePlayer=function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=r(4);e.default=class{constructor(t=[]){this._emitter=new i.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.allowedEvents=t}getInstance(t){if(this._instanceMap[t])return this._instanceMap[t];throw new Error(`${t}实例尚未初始化`)}initInstance(t,...e){if(this._clsMap[t]){const r=new this._clsMap[t](...e);return this._instanceMap[t]=r,r.init&&r.init(),r}throw new Error(`${t}未在context中注册`)}init(t){if(!this._inited){for(let e in this._clsMap)this._clsMap.hasOwnProperty(e)&&!this._instanceMap[e]&&this.initInstance(e,t);this._inited=!0}}registry(t,e){const r=this._emitter,i=this._isMessageNameValid.bind(this),s=this;return this._clsMap[t]=class extends e{constructor(...e){super(...e),this.listeners={},this.TAG=t,this._context=s}on(t,e){return i(t),this.listeners[t]?this.listeners[t].push(e):this.listeners[t]=[e],r.on(t,e)}once(t,e){return i(t),r.once(t,e)}emit(t,...e){return i(t),r.emit(t,...e)}off(t,e){return i(t),r.off(t,e)}removeListeners(){const t=Object.prototype.hasOwnProperty.bind(this.listeners);for(let e in this.listeners)if(t(e)){const t=this.listeners[e]||[];for(let i=0;i<t.length;i++){const s=t[i];r.off(e,s)}}}destroy(){this.removeListeners(),delete s._instanceMap[t],super.destroy()}},(...e)=>this.initInstance(t,...e)}destroyInstances(){Object.keys(this._instanceMap).forEach(t=>{this._instanceMap[t].destroy&&this._instanceMap[t].destroy()})}destroy(){this._emitter=null,this.allowedEvents=null,this._clsMap=null,this.destroyInstances()}_isMessageNameValid(t){if(!this.allowedEvents.indexOf(t)<0)throw new Error(`unregistered message name: ${t}`)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RemuxBuffer=e.VideoTrack=e.AudioTrack=e.XgBuffer=void 0;var i,s=r(5),n=(i=s)&&i.__esModule?i:{default:i};e.XgBuffer=class{constructor(t){this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}push(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}shift(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,e}let e=new Uint8Array(t),r=0;for(;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){let i=this.array[0].slice(this.offset,this.offset+t);e.set(i,r),this.offset+=t,this.length-=t,t=0;break}{let i=this.array[0].length-this.offset;e.set(this.array[0].slice(this.offset,this.array[0].length),r),this.array.shift(),this.offset=0,r+=i,this.length-=i,t-=i}}return e}clear(){this.array=[],this.length=0,this.offset=0}destroy(){this.clear(),this.historyLen=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(t,e){let r=0,i=this.offset+t;for(;i<this.offset+e+t;)i<this.array[0].length?r=256*r+this.array[0][i]:this.array[1]&&(r=256*r+this.array[1][i-this.array[0].length]),i++;return r}};e.AudioTrack=class extends n.default{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}};e.VideoTrack=class extends n.default{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}};e.RemuxBuffer=class{constructor(){this.video=[],this.audio=[]}destroy(){this.video=[],this.audio=[]}}},function(t,e,r){t.exports=r(3)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(r(0)),s=r(1),n=l(r(6)),a=l(r(7)),o=l(r(9)),d=l(r(10));function l(t){return t&&t.__esModule?t:{default:t}}window.Context=i.default,e.default=class{constructor(t){this.configs=Object.assign({},t),this.url="",this.baseurl="",this.sequence=0,this._playlist=null,this.retrytimes=this.configs.retrytimes||3}init(){this._context.registry("M3U8_BUFFER",s.XgBuffer),this._context.registry("TS_BUFFER",s.XgBuffer),this._context.registry("PLAYLIST",n.default),this._context.initInstance("M3U8_BUFFER"),this._context.initInstance("TS_BUFFER"),this._playlist=this._context.initInstance("PLAYLIST",{autoclear:!0}),this._context.registry("M3U8_LOADER",a.default),this._context.registry("TS_LOADER",a.default),this._context.initInstance("M3U8_LOADER",{buffer:"M3U8_BUFFER",readtype:1}),this._context.initInstance("TS_LOADER",{buffer:"TS_BUFFER",readtype:0}),this._context.registry("TS_DEMUXER",d.default),this._context.initInstance("TS_DEMUXER",{inputbuffer:"TS_BUFFER"}),this.initEvents()}initEvents(){this.on("LOADER_COMPLETE",t=>{let e=this._context.getInstance("TS_LOADER"),r=this._context.getInstance("M3U8_LOADER");if("M3U8_BUFFER"===t.TAG){let i=o.default.parse(t.shift(),this.baseurl);this._playlist.pushM3U8(i);let s=this._playlist.getTs();s?e.load(s.url):this.retrytimes>0&&(this.retrytimes--,r.load(this.url))}else if("TS_BUFFER"===t.TAG){this._context.getInstance("TS_DEMUXER").demux();let t=this._playlist.getTs();t?e.load(t.url):r.load(this.url)}})}load(t){this.baseurl=o.default.parseURL(t),this.url=t,this._context.getInstance("M3U8_LOADER").load(t)}}},function(t,e,r){"use strict";var i,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};i=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var d=10;function l(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function h(t,e,r,i){var s,n,a,o;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(n=t._events)?(n=t._events=Object.create(null),t._eventsCount=0):(void 0!==n.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),n=t._events),a=n[e]),void 0===a)a=n[e]=r,++t._eventsCount;else if("function"==typeof a?a=n[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(s=l(t))>0&&a.length>s&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=a.length,o=d,console&&console.warn&&console.warn(o)}return t}function u(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,n(this.listener,this.target,t))}function c(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=u.bind(i);return s.listener=r,i.wrapFn=s,s}function f(t,e,r){var i=t._events;if(void 0===i)return[];var s=i[e];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(s):_(s,s.length)}function p(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function _(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");d=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var d=s[t];if(void 0===d)return!1;if("function"==typeof d)n(d,this,e);else{var l=d.length,h=_(d,l);for(r=0;r<l;++r)n(h[r],this,e)}return!0},o.prototype.addListener=function(t,e){return h(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return h(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,c(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,c(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,i,s,n,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(i=this._events))return this;if(void 0===(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(s=-1,n=r.length-1;n>=0;n--)if(r[n]===e||r[n].listener===e){a=r[n].listener,s=n;break}if(s<0)return this;0===s?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,s),1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var s,n=Object.keys(r);for(i=0;i<n.length;++i)"removeListener"!==(s=n[i])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},o.prototype.listeners=function(t){return f(this,t,!0)},o.prototype.rawListeners=function(t){return f(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.id=-1,this.sequenceNumber=0,this.samples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}};e.Tracks=class{constructor(){this.audioTrack=null,this.videoTrack=null}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this._lastget=void 0,this._audoclear=t.autoclear||!1}get list(){return this._list}set baseURL(t){this.baseURL!==t&&(this.clear(),this._baseURL=t)}get baseURL(){return this._baseURL}push(t,e){this._ts[t]={duration:e,downloaded:!1,start:this.duration},this._list[this.duration]=t,this.duration+=e}pushM3U8(t){if(this.version=t.version,this.targetduration=t.targetduration,t.sequence>this.sequence){this.sequence=t.sequence;for(let e=0;e<t.frags.length;e++){let r=t.frags[e];this._ts[r.url]||this.push(r.url,r.duration)}}}getTs(t){let e,r=Object.keys(this._list);if(void 0===t&&(t=this._lastget?this._lastget.time+this._lastget.duration:0),!(r.length<1||t>=this.duration)){for(let i=0;i<r.length&&t>=r[i];i++){let t=this._list[r[i]];e={url:t,downloaded:this._ts[t].downloaded,time:parseInt(r[i]),duration:parseInt(this._ts[t].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=e}return e}}clear(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,s=r(0),n=(i=s)&&i.__esModule?i:{default:i},a=r(8);const o=0,d=1,l=2;window.Context=n.default,e.default=class{constructor(t){this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER"}static get type(){return"loader"}load(t,e){let r=this;this.url=t;let i=this.getParams(e);return fetch(this.url,i).then(function(t){return r.status=t.status,r.loading=!0,r._onFetchResponse(t)})}_onFetchResponse(t){let e=this,r=this._context.getInstance(this.buffer);if(!0===t.ok)switch(this.readtype){case l:t.json().then(t=>{r?(r.push(t),e.emit(a.LOADER_EVENTS.LOADER_COMPLETE,r)):e.emit(a.LOADER_EVENTS.LOADER_COMPLETE,t)});break;case d:t.text().then(t=>{r?(r.push(t),e.emit(a.LOADER_EVENTS.LOADER_COMPLETE,r)):e.emit(a.LOADER_EVENTS.LOADER_COMPLETE,t)});break;case o:default:return this._onReader(t.body.getReader())}}_onReader(t){let e=this._context.getInstance(this.buffer);if(e||this._reader.cancel(),this._reader=t,!1===this.loading)return;let r=this;this._reader&&this._reader.read().then(function(i){return i.done?(r.loading=!1,r.status=0,void r.emit(a.LOADER_EVENTS.LOADER_COMPLETE,e)):(e.push(i.value),r.emit(a.LOADER_EVENTS.LOADER_DATALOADED,e),r._onReader(t))}).catch(function(t){console.log(t)})}getParams(t){let e=Object.assign({},t),r=new Headers,i={method:"GET",headers:r,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let t=this.configs.headers;for(let e in t)t.hasOwnProperty(e)&&r.append(e,t[e])}return!1===e.cors&&(i.mode="same-origin"),e.withCredentials&&(i.credentials="include"),i}cancel(){this._reader&&(this._reader.cancel(),this._reader=null)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=e.LOADER_EVENTS={LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},s=e.DEMUX_EVENTS={DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_COMPLETE",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},n=e.REMUX_EVENTS={MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},a=Object.assign({},i,s,n),o=e.flvAllowedEvents=[];for(var d in a)a.hasOwnProperty(d)&&o.push(a[d]);e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static parse(t,e=""){let r={duration:0},i=t.split(/\r|\n/),s=i.shift();if(!s.match("#EXTM3U"))return null;for(s=i.shift();void 0!==s;){let t=s.match(/#(.*):(.*)/);if(t&&t.length>2)switch(t[1]){case"EXT-X-VERSION":r.version=parseInt(t[2]);break;case"EXT-X-MEDIA-SEQUENCE":r.sequence=parseInt(t[2]);break;case"EXT-X-TARGETDURATION":r.targetduration=parseFloat(t[2]);break;case"EXTINF":r.frags||(r.frags=[]);let s={start:r.duration,duration:1e3*parseFloat(t[2])};r.duration+=s.duration,s.url=e+i.shift(),r.frags.push(s)}s=i.shift()}return r}static parseURL(t){let e="",r=t.match(/(.*\/).*\.m3u8$/);if(r&&r.length>0)for(let t=0;t<r.length;t++)r[t].match(/.*\/$/g)&&r[t].length>e.length&&(e=r[t]);return e}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(r(11)),s=a(r(12)),n=r(1);function a(t){return t&&t.__esModule?t:{default:t}}const o={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};class d{constructor(t){this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[]}init(){this.inputbuffer=this._context.getInstance(this.configs.inputbuffer)}demux(){if(this.demuxing)return;let t=this.inputbuffer,e={pat:[],pmt:[]},r={};for(;t.length>=188;){let s=t.shift(188),n=new i.default(s.buffer),a={};d.read(n,a,e),a.pes?(r[a.header.pid]||(r[a.header.pid]=[]),r[a.header.pid].push(a.pes),a.pes.ES.buffer=[a.pes.ES.buffer]):r[a.header.pid]&&r[a.header.pid][r[a.header.pid].length-1].ES.buffer.push(a.payload.stream)}for(let t=0;t<Object.keys(r).length;t++){let e=r[Object.keys(r)[t]];for(let t=0;t<e.length;t++)e[t].ES.buffer=d.Merge(e[t].ES.buffer),"audio"===e[t].type?console.log(e[t]):"video"===e[t].type&&this.pushVideoSample(e[t]);e[0].type}}pushAudioSample(t){let e;this._context._clsMap.AUDIO_TRACK?e=this._context.getInstance("AUDIO_TRACK"):(this._context.registry("AUDIO_TRACK",n.VideoTrack),e=this._context.initInstance("AUDIO_TRACK")),e.samples.push(t)}pushVideoSample(t){let e,r=s.default.getNalunits(t.ES.buffer);this._context._clsMap.VIDEO_TRACK?e=this._context.getInstance("VIDEO_TRACK"):(this._context.registry("VIDEO_TRACK",n.VideoTrack),e=this._context.initInstance("VIDEO_TRACK"));let i=0;for(let t=0;t<r.length;t++){let s=r[t];s.sps?(e.meta=s.sps,e.sps=s.body):s.pps?e.pps=s.body:i+=4+s.body.byteLength}let a={pts:parseInt(t.pts/90),dts:parseInt(t.dts/90),data:new Uint8Array(i)},o=0;for(let t=0;t<r.length;t++){let e=r[t],i=e.body.byteLength;e.pps||e.sps||(a.data.set(new Uint8Array([i>>>24&255,i>>>16&255,i>>>8&255,255&i]),o),o+=4,a.data.set(e.body,o),o+=i)}e.samples.push(a)}static Merge(t){let e,r=0,s=0;for(let e=0;e<t.length;e++)r+=t[e].length-t[e].position;e=new Uint8Array(r);for(let r=0;r<t.length;r++){let i=t[r];e.set(new Uint8Array(i.buffer,i.position),s),s+=i.length-i.position}return new i.default(e.buffer)}static read(t,e,r){d.readHeader(t,e),d.readPayload(t,e,r),"MEDIA"===e.header.packet&&1===e.header.payload&&(e.pes=d.PES(e))}static readPayload(t,e,r){let i=e.header.pid;switch(i){case 0:d.PAT(t,e,r);break;case 1:d.CAT(t,e,r);break;case 2:d.TSDT(t,e,r);break;case 8191:break;default:if(r.pat.some(t=>t.pid===i))d.PMT(t,e,r);else{let s=r.pmt?r.pmt.filter(t=>t.pid===i):[];s.length>0&&d.Media(t,e,o[s[0].streamType][0])}}}static readHeader(t,e){let r={};r.sync=t.readUint8();let i=t.readUint16();r.error=i>>>15,r.payload=i>>>14&1,r.priority=i>>>13&1,r.pid=8191&i,i=t.readUint8(),r.scrambling=i>>6&3,r.adaptation=i>>4&3,r.continuity=15&i,r.packet=0===r.pid?"PAT":"MEDIA",e.header=r}static PAT(t,e,r){let i={},s=t.readUint8();t.skip(s),s=t.readUint8(),i.tabelID=s,s=t.readUint16(),i.error=s>>>7,i.zero=s>>>6&1,i.sectionLength=4095&s,i.streamID=t.readUint16(),i.current=1&t.readUint8(),i.sectionNumber=t.readUint8(),i.lastSectionNumber=t.readUint8();let n=(i.sectionLength-9)/4,a=[];for(let e=0;e<n;e++){let e=t.readUint16(),r=8191&t.readUint16();a.push({program:e,pid:r,type:0===e?"network":"mapPID"})}a.length>0&&(r.pat=r.pat.concat(a)),i.list=a,i.program=t.readUint16(),i.pid=8191&t.readUint16(),e.payload=i}static PMT(t,e,r){let i={};e.header.packet="PMT";let s=t.readUint8();t.skip(s),s=t.readUint8(),i.tableID=s,s=t.readUint16(),i.sectionLength=4095&s,i.program=t.readUint16(),i.current=1&t.readUint8(),i.order=t.readUint8(),i.lastOrder=t.readUint8(),i.PCR_PID=8191&t.readUint16(),i.programLength=4095&t.readUint16();let n=(i.sectionLength-13)/5,a=[];for(let e=0;e<n;e++)a.push({streamType:t.readUint8(),pid:8191&t.readUint16(),es:4095&t.readUint16()});i.list=a,this.pmt||(this.pmt=[]),r.pmt=this.pmt.concat(a.map(t=>({pid:t.pid,es:t.es,streamType:t.streamType,program:i.program}))),e.payload=i}static Media(t,e,r){let s=e.header,n={};if(s.type=r,3===s.adaptation&&(n.adaptationLength=t.readUint8(),n.adaptationLength>0)){let e=t.readUint8();n.discontinue=e>>>7,n.access=e>>>6&1,n.priority=e>>>5&1,n.PCR=e>>>4&1,n.OPCR=e>>>3&1,n.splicePoint=e>>>2&1,n.transportPrivate=e>>>1&1,n.adaptationField=1&e;let r=t.position;if(1===n.PCR&&(n.programClockBase=t.readUint32()<<1,e=t.readUint16(),n.programClockBase|=e>>>15,n.programClockExtension=511&e),1===n.OPCR&&(n.originProgramClockBase=t.readUint32()<<1,e=t.readUint16(),n.originProgramClockBase+=e>>>15,n.originProgramClockExtension=511&e),1===n.splicePoint&&(n.spliceCountdown=t.readUint8()),1===n.transportPrivate){let e=t.readUint8(),r=[];for(let i=0;i<e;i++)r.push(t.readUint8())}if(1===n.adaptationField){let e=t.readUint8(),r=t.readUint8(),i=t.position,s=r>>>6&1,a=r>>>5&1;1===r>>>7&&(r=t.readUint16(),n.ltwValid=r>>>15,n.ltwOffset=61439&r),1===s&&(r=t.readUint24(),n.piecewiseRate=4194303&r),1===a&&(r=t.readInt8(),n.spliceType=r>>>4,n.dtsNextAU1=r>>>1&7,n.marker1=1&r,r=t.readUint16(),n.dtsNextAU2=r>>>1,n.marker2=1&r,r=t.readUint16(),n.dtsNextAU3=r),t.skip(e-1-(t.position-i))}let i=n.adaptationLength-1-(t.position-r);t.skip(i)}n.stream=new i.default(t.buffer.slice(t.position)),e.payload=n}static PES(t){let e={},r=t.payload.stream;if(1!==r.readUint24())e.ES={},e.ES.buffer=r;else{let t=r.readUint8();t>=224&&t<=239&&(e.type="video"),t>=192&&t<=223&&(e.type="audio");let i=r.readUint16();if(e.packetLength=i,"video"!==e.type&&"audio"!==e.type)throw new Error("format is not supported");{let t=r.readUint8();if(2!==t>>>6)throw new Error("error when parse pes header");t=r.readUint8(),e.ptsDTSFlag=t>>>6,e.escrFlag=t>>>5&1,e.esRateFlag=t>>>4&1,e.dsmFlag=t>>>3&1,e.additionalFlag=t>>>2&1,e.crcFlag=t>>>1&1,e.extensionFlag=1&t,e.pesHeaderLength=r.readUint8();let i=e.pesHeaderLength;if(2===e.ptsDTSFlag){let s=[];t=r.readUint8(),s.push(t>>>1&7),t=r.readUint16(),s.push(t>>>1),t=r.readUint16(),s.push(t>>>1),e.pts=s[0]<<30|s[1]<<15|s[2],i-=5,"video"===e.type&&(e.dts=e.pts)}if(3===e.ptsDTSFlag){let s=[];t=r.readUint8(),s.push(t>>>1&7),t=r.readUint16(),s.push(t>>>1),t=r.readUint16(),s.push(t>>>1),e.pts=s[0]<<30|s[1]<<15|s[2];let n=[];t=r.readUint8(),n.push(t>>>1&7),t=r.readUint16(),n.push(t>>>1),t=r.readUint16(),n.push(t>>>1),e.dts=n[0]<<30|n[1]<<15|n[2],i-=10}if(1===e.escrFlag){let s=[],n=[];t=r.readUint8(),s.push(t>>>3&7),s.push(3&t),t=r.readUint16(),s.push(t>>>13),s.push(3&t),t=r.readUint16(),s.push(t>>>13),n.push(3&t),t=r.readUint8(),n.push(t>>>1),e.escr=300*(s[0]<<30|s[1]<<28|s[2]<<15|s[3]<<13|s[4])+(n[0]<<7|n[1]),i-=6}if(1===e.esRateFlag&&(t=r.readUint24(),e.esRate=t>>>1&4194303,i-=3),1===e.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===e.additionalFlag&&(t=r.readUint8(),e.additionalCopyInfo=127&t,i-=1),1===e.crcFlag&&(e.pesCRC=r.readUint16(),i-=2),1===e.extensionFlag)throw new Error("not support extension");i>0&&r.skip(i),e.ES=d.ES(r,e.type)}}return e}static ES(t,e){let r,i={};if("video"===e){if(1!==(r=t.readUint32())&&(t.back(4),1!==(r=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),i.buffer=t}else{if("audio"!==e)throw new Error(`ES ${e} is not supported`);{if((r=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i.id=0==(r>>>3&1)?"MPEG-4":"MPEG-2",i.layer=r>>>1&3,i.absent=1&r,r=t.readUint16(),i.audioObjectType=1+(r>>>14&3),i.profile=i.audioObjectType-1,i.frequencyIndex=r>>>10&15,i.frequence=e[i.frequencyIndex],i.channel=r>>>6&7,i.frameLength=(3&r)<<11|t.readUint16()>>>5,i.audioConfig=d.getAudioConfig(i.audioObjectType,i.channel,i.frequencyIndex),t.skip(1),i.buffer=t}}return i}static TSDT(t,e,r){e.payload={}}static CAT(t,e,r){let i={};i.tableID=t.readUint8();let s=t.readUint16();i.sectionIndicator=s>>>7,i.sectionLength=4095&s,t.skip(2),s=t.readUint8(),i.version=s>>>3,i.currentNextIndicator=1&s,i.sectionNumber=t.readUint8(),i.lastSectionNumber=t.readUint8();let n=(this.sectionLength-9)/4,a=[];for(let t=0;t<n;t++)a.push({});i.crc32=t.readUint32(),e.payload=i}static getAudioConfig(t,e,r){let i,s,n=navigator.userAgent.toLowerCase();return/firefox/i.test(n)?r>=6?(t=5,i=new Array(4),s=r-3):(t=2,i=new Array(2),s=r):-1!==n.indexOf("android")?(t=2,i=new Array(2),s=r):(t=5,i=new Array(4),r>=6?s=r-3:(1===e&&(t=2,i=new Array(2)),s=r)),i[0]=t<<3,i[0]|=(14&r)>>1,i[1]=(1&r)<<7,i[1]|=e<<3,5===t&&(i[1]|=(14&s)>>1,i[2]=(1&s)<<7,i[2]|=8,i[3]=0),i}}e.default=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){if(!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(t){this.dataview.position=t}get position(){return this.dataview.position}back(t){this.position-=t}skip(t){let e=Math.floor(t/4),r=t%4;for(let t=0;t<e;t++)i.readByte(this.dataview,4);r>0&&i.readByte(this.dataview,r)}static readByte(t,e,r){let i;switch(e){case 1:i=r?t.getInt8(t.position):t.getUint8(t.position);break;case 2:i=r?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(r)throw"not supported for readByte 3";i=t.getUint8(t.position)<<16,i|=t.getUint8(t.position+1)<<8,i|=t.getUint8(t.position+2);break;case 4:i=r?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(r)throw"not supported for readBody 8";i=t.getUint32(t.position)<<32,i|=t.getUint32(t.position+4);break;default:i=""}return t.position+=e,i}readUint8(){return i.readByte(this.dataview,1)}readUint16(){return i.readByte(this.dataview,2)}readUint24(){return i.readByte(this.dataview,3)}readUint32(){return i.readByte(this.dataview,4)}readUint64(){return i.readByte(this.dataview,8)}readInt8(){return i.readByte(this.dataview,1,!0)}readInt16(){return i.readByte(this.dataview,2,!0)}readInt32(){return i.readByte(this.dataview,4,!0)}writeUint32(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}}e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,s=r(13),n=(i=s)&&i.__esModule?i:{default:i};class a{static getNalunits(t){if(t.length-t.position<4)return[];let e=t.dataview,r=t.position;return 1===e.getInt32(r)||0===e.getInt16(r)&&1===e.getInt8(r+2)?a.getAnnexbNals(t):a.getAvccNals(t)}static getAnnexbNals(t){let e=[],r=a.getHeaderPositionAnnexB(t),i=r.pos,s=i;for(;i<t.length-4;){let n=t.buffer.slice(i,i+r.headerLength);r.pos===t.position&&t.skip(r.headerLength),s=(r=a.getHeaderPositionAnnexB(t)).pos;let o={header:n,body:new Uint8Array(t.buffer.slice(i+n.byteLength,s))};a.analyseNal(o),e.push(o),t.skip(s-t.position),i=s}return e}static getAvccNals(t){let e=[];for(;t.position<t.length-4;){let r=t.dataview.getInt32();if(!(t.length-t.position>=r))break;{let i=t.buffer.slice(t.position,t.position+4);t.skip(4);let s=t.buffer.slice(t.position,t.position+r);t.skip(r);let n={header:i,body:s};a.analyseNal(n),e.push(n)}}return e}static analyseNal(t){switch(31&t.body[0]){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:break;case 7:t.sps=n.default.parseSPS(t.body),console.log(t);break;case 8:t.pps=!0}}static getHeaderPositionAnnexB(t){let e=t.position,r=0;for(;3!==r&&4!==r&&e<t.length-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?r=4:1===t.dataview.getInt8(e+2)?r=3:e++:e++;return e===t.length-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(r=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?r=3:e=t.length)),{pos:e,headerLength:r}}static getAvcc(t,e){let r=new Uint8Array(t.byteLength+e.byteLength+11);r[0]=1,r[1]=t[3],r[2]=t[4],r[3]=t[5],r[4]=255,r[5]=225;let i=6;return r.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),i),i+=2,r.set(t,i),r[i+=t.byteLength]=1,i++,r.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),i),i+=2,r.set(e,i),r}}e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,s=r(14),n=(i=s)&&i.__esModule?i:{default:i};class a{static _ebsp2rbsp(t){let e=t,r=e.byteLength,i=new Uint8Array(r),s=0;for(let t=0;t<r;t++)t>=2&&3===e[t]&&0===e[t-1]&&0===e[t-2]||(i[s]=e[t],s++);return new Uint8Array(i.buffer,0,s)}static parseSPS(t){let e=a._ebsp2rbsp(t),r=new n.default(e);r.readByte();let i=r.readByte();r.readByte();let s=r.readByte();r.readUEG();let o=a.getProfileString(i),d=a.getLevelString(s),l=1,h=420,u=[0,420,422,444],c=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(3===(l=r.readUEG())&&r.readBits(1),l<=3&&(h=u[l]),c=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool())){let t=3!==l?8:12;for(let e=0;e<t;e++)r.readBool()&&(e<6?a._skipScalingList(r,16):a._skipScalingList(r,64))}r.readUEG();let f=r.readUEG();if(0===f)r.readUEG();else if(1===f){r.readBits(1),r.readSEG(),r.readSEG();let t=r.readUEG();for(let e=0;e<t;e++)r.readSEG()}r.readUEG(),r.readBits(1);let p=r.readUEG(),_=r.readUEG(),g=r.readBits(1);0===g&&r.readBits(1),r.readBits(1);let y=0,E=0,v=0,b=0;r.readBool()&&(y=r.readUEG(),E=r.readUEG(),v=r.readUEG(),b=r.readUEG());let m=1,U=1,w=0,L=!0,A=0,T=0;if(r.readBool()){if(r.readBool()){let t=r.readByte(),e=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],i=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];t>0&&t<16?(m=e[t-1],U=i[t-1]):255===t&&(m=r.readByte()<<8|r.readByte(),U=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){let t=r.readBits(32),e=r.readBits(32);L=r.readBool(),w=(A=e)/(T=2*t)}}let O=1;1===m&&1===U||(O=m/U);let M=0,R=0;if(0===l)M=1,R=2-g;else{M=3===l?1:2,R=(1===l?2:1)*(2-g)}let I=16*(p+1),D=16*(_+1)*(2-g);I-=(y+E)*M,D-=(v+b)*R;let x=Math.ceil(I*O);return r.destroy(),r=null,{profile_string:o,level_string:d,bit_depth:c,chroma_format:h,chroma_format_string:a.getChromaFormatString(h),frame_rate:{fixed:L,fps:w,fps_den:T,fps_num:A},sar_ratio:{width:m,height:U},codec_size:{width:I,height:D},present_size:{width:x,height:D}}}static _skipScalingList(t,e){let r=8,i=8,s=0;for(let n=0;n<e;n++)0!==i&&(i=(r+(s=t.readSEG())+256)%256),r=0===i?r:i}static getProfileString(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(t){return(t/10).toFixed(1)}static getChromaFormatString(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}static toVideoMeta(t){let e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.sarRatio={width:t.sar_ratio.width,height:t.sar_ratio.height},t.frame_rate.fixed&&t.frame_rate.fps_num>0&&t.frame_rate.fps_den>0&&(e.frameRate=t.frame_rate);let r=e.frameRate.fps_den,i=e.frameRate.fps_num;e.refSampleDuration=Math.floor(e.timescale*(r/i))}}e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}destroy(){this._buffer=null}_fillCurrentWord(){let t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),r=new Uint8Array(4);r.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(r.buffer).getUint32(0,!1),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}readBits(t){if(t<=this._currentWordBitsLeft){let e=this._currentWord>>>32-t;return this._currentWord<<=t,this._currentWordBitsLeft-=t,e}let e=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;let r=t-this._currentWordBitsLeft;this._fillCurrentWord();let i=Math.min(r,this._currentWordBitsLeft),s=this._currentWord>>>32-i;return this._currentWord<<=i,this._currentWordBitsLeft-=i,e=e<<i|s}readBool(){return 1===this.readBits(1)}readByte(){return this.readBits(8)}_skipLeadingZero(){let t;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}readUEG(){let t=this._skipLeadingZero();return this.readBits(t+1)-1}readSEG(){let t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}}]);