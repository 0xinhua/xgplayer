window.HlsLivePlayer=function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=i(3),s=(r=n)&&r.__esModule?r:{default:r};const a=i(4),o={flv:s.default};e.default=class{constructor(t){this._emitter=new a.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.allEvents=o[t]||[]}getInstance(t){if(this._instanceMap[t])return this._instanceMap[t];throw new Error(`${t}实例尚未初始化`)}initInstance(t,...e){if(this._clsMap[t]){const i=new this._clsMap[t](...e);return i.init&&i.init(),this._instanceMap[t]=i,i}throw new Error(`${t}未在context中注册`)}init(t){if(!this._inited)for(let e in this._clsMap)this._clsMap.hasOwnProperty(e)&&this.initInstance(e,t)}registry(t,e){const i=this._emitter,r=this._isMessageNameValid.bind(this),n=this;return this._clsMap[t]=class extends e{constructor(...e){super(...e),this.listeners={},this.tag=t,this._context=n}on(t,e){return r(t),this.listeners[t]?this.listeners[t].push(e):this.listeners[t]=[e],i.on(t,e)}once(t,e){return r(t),i.once(t,e)}emit(t,e,...n){return r(e),i.emit(e,...n)}off(t,e){return r(t),i.off(t,e)}destroy(){Object.keys(this.listeners).forEach(t=>{this.listeners[t].forEach(e=>{i.off(t,e)})}),delete n._instanceMap[t],super.destroy()}},(...e)=>this.initInstance(t,...e)}destroyInstances(){Object.keys(this._instanceMap).forEach(t=>{this._instanceMap[t].destroy&&this._instanceMap[t].destroy()})}destroy(){this._emitter=null,this.allEvents=null,this._clsMap=null,this.destroyInstances()}_isMessageNameValid(t){if(!this.allEvents[t])throw new Error(`unregistered message name: ${t}`)}}},function(t,e,i){t.exports=i(2)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=h(i(0)),n=i(5),s=h(i(7)),a=h(i(8)),o=h(i(9));function h(t){return t&&t.__esModule?t:{default:t}}window.Context=r.default,e.default=class{constructor(t){this.configs=Object.assign({},t),this.url="",this.baseurl="",this.sequence=0,this._playlist=null}init(){console.log(n.XgBuffer),this._context.registry("M3U8_BUFFER",n.XgBuffer),this._context.registry("TS_BUFFER",n.XgBuffer),this._context.initInstance("M3U8_BUFFER"),this._context.initInstance("TS_BUFFER"),this._context.registry("M3U8_LOADER",s.default),this._context.registry("TS_LOADER",s.default),this._context.initInstance("M3U8_LOADER",{buffer:"M3U8_BUFFER",readtype:1}),this._context.initInstance("TS_LOADER",{buffer:"TS_BUFFER",readtype:0}),this._context.registry("TS_DEMUXER",o.default),this._context.initInstance("TS_DEMUXER",{inputbuffer:"TS_BUFFER"}),this.initEvents()}initEvents(){this.on("LOADER_COMPLETE",t=>{let e=this._context.getInstance("TS_LOADER");if("M3U8_BUFFER"==t.tag){let i=a.default.parse(t.shift(),this.baseurl);if(this._playlist||(this._playlist=i),this._playlist.frags&&this._playlist.frags.length>0){let t=this._playlist.frags.shift();e.load(t.url)}}else if("TS_BUFFER"==t.tag){this._context.getInstance("TS_DEMUXER").demux(),this._playlist.frags&&this._playlist.frags.length}})}load(t){this.baseurl=a.default.parseURL(t),this.url=t,this._context.getInstance("M3U8_LOADER").load(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.LOADER_EVENTS={LOADER_DATALOADED:"loader_dataloaded",LOADER_COMPLETE:"loader_complete",LOADER_ERROR:"loader_error"},n=e.DEMUX_EVENTS={DEMUX_COMPLETE:"demux_complete",DEMUX_ERROR:"demux_error",METADATA_PARSED:"metadata_complete",VIDEO_METADATA_CHANGE:"video_metadata_change",AUDIO_METADATA_CHANGE:"audio_metadata_change",MEDIA_INFO:"media_info"},s=e.REMUX_EVENTS={MEDIA_SEGMENT:"media_segment",INIT_SEGMENT:"init_segment"};e.default=Object.assign({},r,n,s)},function(t,e,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var h=10;function u(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function l(t,e,i,r){var n,s,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),a=s[e]),void 0===a)a=s[e]=i,++t._eventsCount;else if("function"==typeof a?a=s[e]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(n=u(t))>0&&a.length>n&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,o=h,console&&console.warn&&console.warn(o)}return t}function d(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,t))}function f(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=d.bind(r);return n.listener=i,r.wrapFn=n,n}function c(t,e,i){var r=t._events;if(void 0===r)return[];var n=r[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):g(n,n.length)}function p(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=n[t];if(void 0===h)return!1;if("function"==typeof h)s(h,this,e);else{var u=h.length,l=g(h,u);for(i=0;i<u;++i)s(l[i],this,e)}return!0},o.prototype.addListener=function(t,e){return l(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return l(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,f(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,f(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,r,n,s,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){a=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,n),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return c(this,t,!0)},o.prototype.rawListeners=function(t){return c(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VideoTrack=e.AudioTrack=e.XgBuffer=void 0;var r,n=i(6),s=(r=n)&&r.__esModule?r:{default:r};e.XgBuffer=class{constructor(t){this.length=t||0,this.array=[],this.offset=0}push(t){this.array.push(t),this.length+=t.byteLength}shift(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,e}let e=new Uint8Array(t),i=0;for(;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){let r=this.array[0].slice(this.offset,this.offset+t);e.set(r,i),this.offset+=t,this.length-=t,t=0;break}{let r=this.array[0].length-this.offset;e.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=r,this.length-=r,t-=r}}return e}clear(){this.array=[],this.length=0,this.offset=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(t,e){let i=0,r=this.offset+t;for(;r<this.offset+e+t;)r<this.array[0].length?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++;return i}readUint8(){if(!(this.length<1))return this.array[0][this.offset]}readUint16(){}readUint24(){}readUint32(){}shiftUint8(){return this.shift(1)[0]}shiftUint16(){return 256*this.shiftUint8()+this.shiftUint8()}shiftUint24(){return 256*this.shiftUint16()+this.shiftUint8()}shiftUint32(){return 256*this.shiftUint24()+this.shiftUint8()}};e.AudioTrack=class extends s.default{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}};e.VideoTrack=class extends s.default{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.TAG="Track",this.id=-1,this.sequenceNumber=0,this.samples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=i(0),s=(r=n)&&r.__esModule?r:{default:r};const a=0,o=1,h=2;window.Context=s.default,e.default=class{constructor(t){this.configs=Object.assign({},t),this.url=null,this.status=0,this.errir=null,this.buffer=this.configs.buffer,this.readtype=this.configs.readtype||a,this._reader=null}static get type(){return"loader"}load(t,e){let i=this;this.url=t;let r=this.getParams(e);self.fetch(this.url,r).then(t=>(i.status=t.status,i.loading=!0,i._onFetchResponse.call(i,t)))}_onFetchResponse(t){let e=this,i=this._context.getInstance(this.buffer);if(!0===t.ok)switch(this.readtype){case h:t.json().then(t=>{i?(i.push(t),e.emit(e.tag,"LOADER_COMPLETE",i)):e.emit(e.tag,"LOADER_COMPLETE",t)});break;case o:t.text().then(t=>{i?(i.push(t),e.emit(e.tag,"LOADER_COMPLETE",i)):e.emit(e.tag,"LOADER_COMPLETE",t)});break;case a:default:return this._onReader.call(this,t.body.getReader())}}_onReader(t){let e=this._context.getInstance(this.buffer);if(e||this._reader.cancel(),this._reader=t,!1===this.loading)return;let i=this;this._reader&&this._reader.read().then(function(r){return r.done?(i.loading=!1,i.status=0,void i.emit(i.tag,"LOADER_COMPLETE",e)):(e.push(r.value),i.emit(i.tag,"LOADER_DATALOADED",e),i._onReader(t))}).catch(function(t){console.log(t)})}getParams(t){let e=Object.assign({},t),i=new self.Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let t=this.configs.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}return!1===e.cors&&(r.mode="same-origin"),e.withCredentials&&(r.credentials="include"),r}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static parse(t,e=""){let i={duration:0},r=t.split(/\r|\n/),n=r.shift();if(!n.match("#EXTM3U"))return null;for(;n=r.shift();){let t=n.match(/#(.*):(.*)/);if(t&&!(t.length<3))switch(t[1]){case"EXT-X-VERSION":i.version=parseInt(t[2]);break;case"EXT-X-MEDIA-SEQUENCE":i.sequence=parseInt(t[2]);break;case"EXT-X-TARGETDURATION":i.targetduration=parseFloat(t[2]);break;case"EXTINF":i.frags||(i.frags=[]);let n={start:i.duration,duration:1e3*parseFloat(t[2])};i.duration+=n.duration,n.url=e+r.shift(),i.frags.push(n)}}return i}static parseURL(t){let e="",i=t.match(/(.*\/).*\.m3u8$/);if(i&&i.length>0)for(let t=0;t<i.length;t++)i[t].match(/.*\/$/g)&&i[t].length>e.length&&(e=i[t]);return e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=i(10),s=(r=n)&&r.__esModule?r:{default:r};const a={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};class o{constructor(t){this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[]}init(){this.inputbuffer=this._context.getInstance(this.configs.inputbuffer)}demux(){if(this.demuxing)return;let t=this.inputbuffer,e={pat:[],pmt:[]};for(;t.length>=188;){let i=t.shift(188),r=new s.default(i.buffer),n={};o.read(r,n,e)}}static read(t,e,i){if(o.readHeader(t,e),o.readPayload(t,e,i),"MEDIA"===e.header.packet&&1===e.header.payload){let t=o.PES(e);console.log(t)}else"MEDIA"===e.header.packet&&console.log(e)}static readPayload(t,e,i){let r=e.header.pid;switch(r){case 0:o.PAT(t,e,i);break;case 8191:break;default:if(i.pat.some(t=>t.pid===r))o.PMT(t,e,i);else{let n=i.pmt?i.pmt.filter(t=>t.pid===r):[];n.length>0&&o.Media(t,e,a[n[0].streamType][0])}}}static readHeader(t,e){let i={};i.sync=t.readUint8();let r=t.readUint16();i.error=r>>>15,i.payload=r>>>14&1,i.priority=r>>>13&1,i.pid=8191&r,r=t.readUint8(),i.scrambling=r>>6&3,i.adaptation=r>>4&3,i.continuity=15&r,i.packet=0===i.pid?"PAT":"MEDIA",e.header=i}static PAT(t,e,i){let r={},n=t.readUint8();t.skip(n),n=t.readUint8(),r.tabelID=n,n=t.readUint16(),r.error=n>>>7,r.zero=n>>>6&1,r.sectionLength=4095&n,r.streamID=t.readUint16(),r.current=1&t.readUint8(),r.sectionNumber=t.readUint8(),r.lastSectionNumber=t.readUint8();let s=(r.sectionLength-9)/4,a=[];for(let e=0;e<s;e++){let e=t.readUint16(),i=8191&t.readUint16();a.push({program:e,pid:i,type:0===e?"network":"mapPID"})}a.length>0&&(i.pat=i.pat.concat(a)),r.list=a,r.program=t.readUint16(),r.pid=8191&t.readUint16(),e.payload=r}static PMT(t,e,i){let r={};e.header.packet="PMT";let n=t.readUint8();t.skip(n),n=t.readUint8(),r.tableID=n,n=t.readUint16(),r.sectionLength=4095&n,r.program=t.readUint16(),r.current=1&t.readUint8(),r.order=t.readUint8(),r.lastOrder=t.readUint8(),r.PCR_PID=8191&t.readUint16(),r.programLength=4095&t.readUint16();let s=(r.sectionLength-13)/5,a=[];for(let e=0;e<s;e++)a.push({streamType:t.readUint8(),pid:8191&t.readUint16(),es:4095&t.readUint16()});r.list=a,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(a.map(t=>({pid:t.pid,es:t.es,streamType:t.streamType,program:r.program}))),e.payload=r}static Media(t,e,i){let r=e.header,n={};if(r.type=i,3===r.adaptation&&(n.adaptationLength=t.readUint8(),n.adaptationLength>0)){let e=t.readUint8();n.discontinue=e>>>7,n.access=e>>>6&1,n.priority=e>>>5&1,n.PCR=e>>>4&1,n.OPCR=e>>>3&1,n.splicePoint=e>>>2&1,n.transportPrivate=e>>>1&1,n.adaptationField=1&e;let i=t.position;if(1===n.PCR&&(n.programClockBase=t.readUint32()<<1,e=t.readUint16(),n.programClockBase|=e>>>15,n.programClockExtension=511&e),1===n.OPCR&&(n.originProgramClockBase=t.readUint32()<<1,e=t.readUint16(),n.originProgramClockBase+=e>>>15,n.originProgramClockExtension=511&e),1===n.splicePoint&&(n.spliceCountdown=t.readUint8()),1===n.transportPrivate){let e=t.readUint8(),i=[];for(let r=0;r<e;r++)i.push(t.readUint8())}if(1===n.adaptationField){let e=t.readUint8(),i=t.readUint8(),r=t.position,s=i>>>6&1,a=i>>>5&1;1===i>>>7&&(i=t.readUint16(),n.ltwValid=i>>>15,n.ltwOffset=61439&i),1===s&&(i=t.readUint24(),n.piecewiseRate=4194303&i),1===a&&(i=t.readInt8(),n.spliceType=i>>>4,n.dtsNextAU1=i>>>1&7,n.marker1=1&i,i=t.readUint16(),n.dtsNextAU2=i>>>1,n.marker2=1&i,i=t.readUint16(),n.dtsNextAU3=i),t.skip(e-1-(t.position-r))}let r=n.adaptationLength-1-(t.position-i);t.skip(r)}n.stream=new s.default(t.buffer.slice(t.position)),e.payload=n}static PES(t){let e={},i=t.payload.stream;if(1!==i.readUint24())e.ES={},e.ES.buffer=i;else{let t=i.readUint8();t>=224&&t<=239&&(e.type="video"),t>=192&&t<=223&&(e.type="audio");let r=i.readUint16();if(e.packetLength=r,"video"!==e.type&&"audio"!==e.type)throw new Error("format is not supported");{let t=i.readUint8();if(2!==t>>>6)throw new Error("error when parse pes header");t=i.readUint8(),e.ptsDTSFlag=t>>>6,e.escrFlag=t>>>5&1,e.esRateFlag=t>>>4&1,e.dsmFlag=t>>>3&1,e.additionalFlag=t>>>2&1,e.crcFlag=t>>>1&1,e.extensionFlag=1&t,e.pesHeaderLength=i.readUint8();let r=e.pesHeaderLength;if(2===e.ptsDTSFlag){let n=[];t=i.readUint8(),n.push(t>>>1&7),t=i.readUint16(),n.push(t>>>1),t=i.readUint16(),n.push(t>>>1),e.pts=n[0]<<30|n[1]<<15|n[2],r-=5,"video"===e.type&&(e.dts=this.pts)}if(3===e.ptsDTSFlag){let n=[];t=i.readUint8(),n.push(t>>>1&7),t=i.readUint16(),n.push(t>>>1),t=i.readUint16(),n.push(t>>>1),e.pts=n[0]<<30|n[1]<<15|n[2];let s=[];t=i.readUint8(),s.push(t>>>1&7),t=i.readUint16(),s.push(t>>>1),t=i.readUint16(),s.push(t>>>1),e.dts=s[0]<<30|s[1]<<15|s[2],r-=10}if(1===e.escrFlag){let n=[],s=[];t=i.readUint8(),n.push(t>>>3&7),n.push(3&t),t=i.readUint16(),n.push(t>>>13),n.push(3&t),t=i.readUint16(),n.push(t>>>13),s.push(3&t),t=i.readUint8(),s.push(t>>>1),e.escr=300*(n[0]<<30|n[1]<<28|n[2]<<15|n[3]<<13|n[4])+(s[0]<<7|s[1]),r-=6}if(1===e.esRateFlag&&(t=i.readUint24(),e.esRate=t>>>1&4194303,r-=3),1===e.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===e.additionalFlag&&(t=i.readUint8(),e.additionalCopyInfo=127&t,r-=1),1===e.crcFlag&&(e.pesCRC=i.readUint16(),r-=2),1===e.extensionFlag)throw new Error("not support extension");r>0&&i.skip(r),e.ES=o.ES(i,e.type)}}return e}static ES(t,e){let i,r={};if("video"===e){if(1!==(i=t.readUint32())&&(t.back(4),1!==(i=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),r.buffer=t}else{if("audio"!==e)throw`ES ${e} is not supported`;{if((i=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",r.layer=i>>>1&3,r.absent=1&i,i=t.readUint16(),r.audioObjectType=1+(i>>>14&3),r.profile=r.audioObjectType-1,r.frequencyIndex=i>>>10&15,r.frequence=e[r.frequencyIndex],r.channel=i>>>6&7,r.frameLength=(3&i)<<11|t.readUint16()>>>5,r.audioConfig=o.getAudioConfig(r.audioObjectType,r.channel,r.frequencyIndex),t.skip(1),r.buffer=t}}return r}static getAudioConfig(t,e,i){let r,n,s=navigator.userAgent.toLowerCase();return/firefox/i.test(s)?i>=6?(t=5,r=new Array(4),n=i-3):(t=2,r=new Array(2),n=i):-1!==s.indexOf("android")?(t=2,r=new Array(2),n=i):(t=5,r=new Array(4),i>=6?n=i-3:(1===e&&(t=2,r=new Array(2)),n=i)),r[0]=t<<3,r[0]|=(14&i)>>1,r[1]=(1&i)<<7,r[1]|=e<<3,5===t&&(r[1]|=(14&n)>>1,r[2]=(1&n)<<7,r[2]|=8,r[3]=0),r}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){if(!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(t){this.dataview.position=t}get position(){return this.dataview.position}back(t){this.position-=t}skip(t){let e=Math.floor(t/4),i=t%4;for(let t=0;t<e;t++)r.readByte(this.dataview,4);i>0&&r.readByte(this.dataview,i)}static readByte(t,e,i){let r;switch(e){case 1:r=i?t.getInt8(t.position):t.getUint8(t.position);break;case 2:r=i?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(i)throw"not supported for readByte 3";r=t.getUint8(t.position)<<16,r|=t.getUint8(t.position+1)<<8,r|=t.getUint8(t.position+2);break;case 4:r=i?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(i)throw"not supported for readBody 8";r=t.getUint32(t.position)<<32,r|=t.getUint32(t.position+4);break;default:r=""}return t.position+=e,r}readUint8(){return r.readByte(this.dataview,1)}readUint16(){return r.readByte(this.dataview,2)}readUint24(){return r.readByte(this.dataview,3)}readUint32(){return r.readByte(this.dataview,4)}readUint64(){return r.readByte(this.dataview,8)}readInt8(){return r.readByte(this.dataview,1,!0)}readInt16(){return r.readByte(this.dataview,2,!0)}readInt32(){return r.readByte(this.dataview,4,!0)}writeUint32(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}}e.default=r}]);