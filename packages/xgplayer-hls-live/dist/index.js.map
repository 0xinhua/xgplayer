{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import Player from 'xgplayer'\nimport { Context, EVENTS } from 'xgplayer-utils';\nimport HlsLiveController from './hls-live';\nconst HlsAllowedEvents = EVENTS.HlsAllowedEvents;\nconst REMUX_EVENTS = EVENTS.REMUX_EVENTS;\n\nexport class HlsLivePlayer extends Player {\n  constructor (options) {\n    super(options)\n    this.hlsOps = {};\n    this.util = Player.util;\n    this.util.deepCopy(this.hlsOps, options);\n    this._context = new Context(HlsAllowedEvents);\n    this._hasStarted = false;\n  }\n\n  _initEvents () {\n    this.__core__.once(REMUX_EVENTS.INIT_SEGMENT, () => {\n      const mse = this._context.getInstance('MSE');\n      if (!this._hasStarted) {\n        const live = this.util.createDom('xg-live', '正在直播', {}, 'xgplayer-live');\n        this.util.addClass(this.root, 'xgplayer-is-live');\n        this.controls.appendChild(live);\n      }\n      this._hasStarted = true;\n      super.start(mse.url);\n    });\n\n    this.once('canplay', () => {\n      this.video.play()\n    });\n  }\n\n  _initSrcChangeHandler () {\n    let _this = this;\n    Object.defineProperty(this, 'src', {\n      get () {\n        return _this.currentSrc\n      },\n      set (url) {\n        _this.config.url = url\n        if (!_this.paused) {\n          _this.pause()\n          _this.once('pause', () => {\n            _this.start(url)\n          })\n          _this.once('canplay', () => {\n            _this.play()\n          })\n        } else {\n          _this.start(url)\n        }\n        _this.once('canplay', () => {\n          _this.currentTime = 0\n        })\n      },\n      configurable: true\n    })\n  }\n\n  start (url = this.config.url) {\n    if (!url) {\n      return;\n    }\n    this.__core__ = this._context.registry('HLS_LIVE_CONTROLLER', HlsLiveController)({player:this, container: this.video});\n    this._context.init();\n    this.url = url;\n    this.__core__.load(url);\n    this._initEvents();\n    this._initSrcChangeHandler();\n  }\n\n  play () {\n    if (this._hasStarted) {\n      this._context.destroy();\n      this._context = new Context(HlsAllowedEvents);\n      this.__core__ = this._context.registry('HLS_LIVE_CONTROLLER', HlsLiveController)({container: this.video});\n      this._context.init();\n      this._initEvents();\n      this.__core__.load(this.url);\n    }\n    super.play();\n  }\n\n  destroy () {\n    this._context.destroy();\n    super.destroy();\n  }\n}\nmodule.exports = HlsLivePlayer;\n"],"names":["HlsAllowedEvents","EVENTS","REMUX_EVENTS","HlsLivePlayer","Player","constructor","options","hlsOps","util","deepCopy","_context","Context","_hasStarted","_initEvents","__core__","once","INIT_SEGMENT","mse","getInstance","live","createDom","addClass","root","controls","appendChild","start","url","video","play","_initSrcChangeHandler","_this","Object","defineProperty","get","currentSrc","set","config","paused","pause","currentTime","configurable","registry","HlsLiveController","player","container","init","load","destroy","module","exports"],"mappings":"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"}