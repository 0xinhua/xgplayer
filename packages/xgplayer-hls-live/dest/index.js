!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],e):"object"==typeof exports?exports["xgplayer-hls-live"]=e(require("xgplayer")):t["xgplayer-hls-live"]=e(t.xgplayer)}(window,function(t){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e,i){"use strict";t.exports={Context:i(12).default,EVENTS:i(14).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,MediaInfo:i(2).default,MediaSample:i(19).default,MediaSegment:i(20).default,MediaSegmentList:i(21).default,AudioTrackMeta:i(3).AudioTrackMeta,VideoTrackMeta:i(3).VideoTrackMeta,AudioTrackSample:i(4).AudioTrackSample,VideoTrackSample:i(4).VideoTrackSample,Mse:i(22).default,Stream:i(23).default,Buffer:i(24).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}}e.default=r;e.AudioTrack=class extends r{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}};e.VideoTrack=class extends r{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}};e.Tracks=class{constructor(){this.audioTrack=null,this.videoTrack=null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=t=>{for(let e in t)if(t.hasOwnProperty(e)&&null===t[e])return!1;return!0};class s{constructor(){this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}isComplete(){return s.isBaseInfoReady(this)&&s.isVideoReady(this)&&s.isAudioReady(this)}static isBaseInfoReady(t){return r(t)}static isVideoReady(t){return!t.hasVideo||r(t.video)}static isAudioReady(t){return!t.hasAudio||r(t.video)}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.AudioTrackMeta=class{constructor(t){const e={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},e,t):e}};e.VideoTrackMeta=class{constructor(t){const e={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},e,t):e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){let e=r.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,data:new Uint8Array}}}e.AudioTrackSample=r;class s{constructor(t){let e=s.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}e.VideoTrackSample=s},function(t,e,i){"use strict";t.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(6).XgBuffer,RemuxBuffer:i(6).RemuxBuffer,PreSource:i(28).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.XgBuffer=class{constructor(t){this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}push(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}shift(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,e}let e=new Uint8Array(t),i=0;for(;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){let r=this.array[0].slice(this.offset,this.offset+t);e.set(r,i),this.offset+=t,this.length-=t,t=0;break}{let r=this.array[0].length-this.offset;e.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=r,this.length-=r,t-=r}}return e}clear(){this.array=[],this.length=0,this.offset=0}destroy(){this.clear(),this.historyLen=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(t,e){let i=0,r=this.offset+t;for(;r<this.offset+e+t;)r<this.array[0].length?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++;return i}};e.RemuxBuffer=class{constructor(){this.video=[],this.audio=[]}destroy(){this.video=[],this.audio=[]}}},function(t,e,i){"use strict";t.exports={Nalunit:i(31).default,SpsParser:i(8).default,Compatibility:i(33).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(32),n=(r=s)&&r.__esModule?r:{default:r};class a{static _ebsp2rbsp(t){let e=t,i=e.byteLength,r=new Uint8Array(i),s=0;for(let t=0;t<i;t++)t>=2&&3===e[t]&&0===e[t-1]&&0===e[t-2]||(r[s]=e[t],s++);return new Uint8Array(r.buffer,0,s)}static parseSPS(t){let e=a._ebsp2rbsp(t),i=new n.default(e);i.readByte();let r=i.readByte();i.readByte();let s=i.readByte();i.readUEG();let o=a.getProfileString(r),d=a.getLevelString(s),l=1,u=420,h=[0,420,422,444],c=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(l=i.readUEG())&&i.readBits(1),l<=3&&(u=h[l]),c=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool())){let t=3!==l?8:12;for(let e=0;e<t;e++)i.readBool()&&(e<6?a._skipScalingList(i,16):a._skipScalingList(i,64))}i.readUEG();let f=i.readUEG();if(0===f)i.readUEG();else if(1===f){i.readBits(1),i.readSEG(),i.readSEG();let t=i.readUEG();for(let e=0;e<t;e++)i.readSEG()}i.readUEG(),i.readBits(1);let p=i.readUEG(),g=i.readUEG(),_=i.readBits(1);0===_&&i.readBits(1),i.readBits(1);let m=0,y=0,E=0,v=0;i.readBool()&&(m=i.readUEG(),y=i.readUEG(),E=i.readUEG(),v=i.readUEG());let b=1,A=1,S=0,w=!0,U=0,T=0;if(i.readBool()){if(i.readBool()){let t=i.readByte(),e=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],r=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];t>0&&t<16?(b=e[t-1],A=r[t-1]):255===t&&(b=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){let t=i.readBits(32),e=i.readBits(32);w=i.readBool(),S=(U=e)/(T=2*t)}}let M=1;1===b&&1===A||(M=b/A);let L=0,D=0;if(0===l)L=1,D=2-_;else{L=3===l?1:2,D=(1===l?2:1)*(2-_)}let R=16*(p+1),x=16*(g+1)*(2-_);R-=(m+y)*L,x-=(E+v)*D;let O=Math.ceil(R*M);return i.destroy(),i=null,{profile_string:o,level_string:d,bit_depth:c,chroma_format:u,chroma_format_string:a.getChromaFormatString(u),frame_rate:{fixed:w,fps:S,fps_den:T,fps_num:U},par_ratio:{width:b,height:A},codec_size:{width:R,height:x},present_size:{width:O,height:x}}}static _skipScalingList(t,e){let i=8,r=8,s=0;for(let n=0;n<e;n++)0!==r&&(r=(i+(s=t.readSEG())+256)%256),i=0===r?i:r}static getProfileString(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(t){return(t/10).toFixed(1)}static getChromaFormatString(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}static toVideoMeta(t){let e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},t.frame_rate.fixed&&t.frame_rate.fps_num>0&&t.frame_rate.fps_den>0&&(e.frameRate=t.frame_rate);let i=e.frameRate.fps_den,r=e.frameRate.fps_num;e.refSampleDuration=Math.floor(e.timescale*(i/r))}}e.default=a},function(t,e,i){t.exports=i(10)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HlsLivePlayer=void 0;var r=a(i(11)),s=i(0),n=a(i(27));function a(t){return t&&t.__esModule?t:{default:t}}const o=s.EVENTS.HlsAllowedEvents,d=s.EVENTS.REMUX_EVENTS;class l extends r.default{constructor(t){super(t),this.hlsOps={},this.util=r.default.util,this.util.deepCopy(this.hlsOps,t),this._context=new s.Context(o)}_initEvents(){this.__core__.once(d.INIT_SEGMENT,()=>{const t=this.util.createDom("xg-live","正在直播",{},"xgplayer-live"),e=this._context.getInstance("MSE");this.util.addClass(this.root,"xgplayer-is-live"),this.controls.appendChild(t),super.start(e.url)}),this.once("canplay",()=>{this.play()})}_initSrcChangeHandler(){let t=this;Object.defineProperty(this,"src",{get:()=>t.currentSrc,set(e){t.config.url=e,t.paused?t.start(e):(t.pause(),t.once("pause",()=>{t.start(e)}),t.once("canplay",()=>{t.play()})),t.once("canplay",()=>{t.currentTime=0})},configurable:!0})}start(t=this.config.url){t&&(this.__core__=this._context.registry("HLS_LIVE_CONTROLLER",n.default)({container:this.video}),this._context.init(),this.__core__.load(t),this._initEvents(),this._initSrcChangeHandler())}}e.HlsLivePlayer=l,t.exports=l},function(e,i){e.exports=t},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(2),n=(r=s)&&r.__esModule?r:{default:r},a=i(13);const o="__TO__";e.default=class{constructor(t=[]){this._emitter=new a.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new n.default,this.allowedEvents=t,this._hooks={}}getInstance(t){if(this._instanceMap[t])return this._instanceMap[t];throw new Error(`${t}实例尚未初始化`)}initInstance(t,...e){if(this._clsMap[t]){const i=new this._clsMap[t](...e);return this._instanceMap[t]=i,i.init&&i.init(),i}throw new Error(`${t}未在context中注册`)}init(t){if(!this._inited){for(let e in this._clsMap)this._clsMap.hasOwnProperty(e)&&!this._instanceMap[e]&&this.initInstance(e,t);this._inited=!0}}registry(t,e){const i=this._emitter,r=this._isMessageNameValid.bind(this),s=this;return this._clsMap[t]=class extends e{constructor(...e){super(...e),this.listeners={},this.TAG=t,this._context=s}on(e,s){return r(e),this.listeners[e]?this.listeners[e].push(s):this.listeners[e]=[s],i.on(`${e}${o}${t}`,s),i.on(e,s)}before(t,e){r(t),s._hooks[t]?s._hooks[t].push(e):s._hooks[t]=[e]}once(e,s){return r(e),i.on(`${e}${o}${t}`,s),i.once(e,s)}emit(t,...e){r(t);const n=s._hooks[t];if(n)for(let t=0,e=n.length;t<e;t++){(0,n[t])()}return i.emit(t,...e)}emitTo(t,e,...s){return r(e),i.emit(`${e}${o}${t}`,...s)}off(t,e){return r(t),i.off(t,e)}removeListeners(){const t=Object.prototype.hasOwnProperty.bind(this.listeners);for(let e in this.listeners)if(t(e)){const t=this.listeners[e]||[];for(let r=0;r<t.length;r++){const s=t[r];i.off(e,s)}}}destroy(){this.removeListeners(),delete s._instanceMap[t],super.destroy()}},(...e)=>this.initInstance(t,...e)}destroyInstances(){Object.keys(this._instanceMap).forEach(t=>{this._instanceMap[t].destroy&&this._instanceMap[t].destroy()})}destroy(){this._emitter=null,this.allowedEvents=null,this._clsMap=null,this.destroyInstances()}_isMessageNameValid(t){if(!this.allowedEvents.indexOf(t)<0)throw new Error(`unregistered message name: ${t}`)}}},function(t,e,i){"use strict";var r,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};r=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var d=10;function l(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,i,r){var s,n,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(n=t._events)?(n=t._events=Object.create(null),t._eventsCount=0):(void 0!==n.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),n=t._events),a=n[e]),void 0===a)a=n[e]=i,++t._eventsCount;else if("function"==typeof a?a=n[e]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(s=l(t))>0&&a.length>s&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=a.length,o=d,console&&console.warn&&console.warn(o)}return t}function h(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,n(this.listener,this.target,t))}function c(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=h.bind(r);return s.listener=i,r.wrapFn=s,s}function f(t,e,i){var r=t._events;if(void 0===r)return[];var s=r[e];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(s):g(s,s.length)}function p(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");d=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var d=s[t];if(void 0===d)return!1;if("function"==typeof d)n(d,this,e);else{var l=d.length,u=g(d,l);for(i=0;i<l;++i)n(u[i],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,c(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,c(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,r,s,n,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,n=i.length-1;n>=0;n--)if(i[n]===e||i[n].listener===e){a=i[n].listener,s=n;break}if(s<0)return this;0===s?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,s),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var s,n=Object.keys(i);for(r=0;r<n.length;++r)"removeListener"!==(s=n[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return f(this,t,!0)},o.prototype.rawListeners=function(t){return f(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},s={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},n={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},a=Object.assign({},r,s,n),o=[],d=[];for(let t in a)a.hasOwnProperty(t)&&o.push(a[t]);for(let t in a)a.hasOwnProperty(t)&&d.push(a[t]);e.default={ALLEVENTS:a,REMUX_EVENTS:n,DEMUX_EVENTS:s,LOADER_EVENTS:r,FlvAllowedEvents:o,HlsAllowedEvents:d}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}(),s={get device(){let t=s.os;return t.isPc?"pc":t.isTablet?"tablet":"mobile"},get browser(){let t=navigator.userAgent.toLowerCase(),e={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(e).filter(i=>e[i].test(t)))[0]},get os(){let t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),i=/(?:SymbianOS)/.test(t)||e,r=/(?:Android)/.test(t),s=/(?:Firefox)/.test(t),n=/(?:iPad|PlayBook)/.test(t)||r&&!/(?:Mobile)/.test(t)||s&&/(?:Tablet)/.test(t),a=/(?:iPhone)/.test(t)&&!n;return{isTablet:n,isPhone:a,isAndroid:r,isPc:!a&&!r&&!i,isSymbian:i,isWindowsPhone:e,isFireFox:s}},get isLe(){return r}};e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static decode(t){const e=[],i=t;let s=0;const n=t.length;for(;s<n;)if(i[s]<128)e.push(String.fromCharCode(i[s])),++s;else{if(i[s]<192);else if(i[s]<224){if(r._checkContinuation(i,s,1)){const t=(31&i[s])<<6|63&i[s+1];if(t>=128){e.push(String.fromCharCode(65535&t)),s+=2;continue}}}else if(i[s]<240){if(r._checkContinuation(i,s,2)){const t=(15&i[s])<<12|(63&i[s+1])<<6|63&i[s+2];if(t>=2048&&55296!=(63488&t)){e.push(String.fromCharCode(65535&t)),s+=3;continue}}}else if(i[s]<248&&r._checkContinuation(i,s,3)){let t=(7&i[s])<<18|(63&i[s+1])<<12|(63&i[s+2])<<6|63&i[s+3];if(t>65536&&t<1114112){t-=65536,e.push(String.fromCharCode(t>>>10|55296)),e.push(String.fromCharCode(1023&t|56320)),s+=4;continue}}e.push(String.fromCharCode(65533)),++s}return e.join("")}static _checkContinuation(t,e,i){let r=t;if(e+i<r.length){for(;i--;)if(128!=(192&r[++e]))return!1;return!0}return!1}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){let e=r.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;let i=Object.assign({},e,t);Object.entries(i).forEach(([t,e])=>{this[t]=e})}static getDefaultInf(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}addRAP(t){t.isRAP=!0,this.randomAccessPoints.push(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this._type=t,this._list=[],this._lastAppendLocation=-1}get type(){return this._type}get length(){return this._list.length}isEmpty(){return 0===this._list.length}clear(){this._list=[],this._lastAppendLocation=-1}_searchNearestSegmentBefore(t){let e=this._list;if(0===e.length)return-2;let i=e.length-1,r=0,s=0,n=i,a=0;if(t<e[0].originDts)return a=-1;for(;s<=n;){if((r=s+Math.floor((n-s)/2))===i||t>e[r].lastSample.originDts&&t<e[r+1].originDts){a=r;break}e[r].originDts<t?s=r+1:n=r-1}return a}_searchNearestSegmentAfter(t){return this._searchNearestSegmentBefore(t)+1}append(t){let e=this._list,i=this._lastAppendLocation,r=0;-1!==i&&i<e.length&&t.originStartDts>=e[i].lastSample.originDts&&(i===e.length-1||i<e.length-1&&t.originStartDts<e[i+1].originStartDts)?r=i+1:e.length>0&&(r=this._searchNearestSegmentBefore(t.originStartDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,t)}getLastSegmentBefore(t){let e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null}getLastSampleBefore(t){let e=this.getLastSegmentBefore(t);return null!==e?e.lastSample:null}getLastRAPBefore(t){let e=this._searchNearestSegmentBefore(t),i=this._list[e].randomAccessPoints;for(;0===i.length&&e>0;)e--,i=this._list[e].randomAccessPoints;return i.length>0?i[i.length-1]:null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={}}init(){let t=this;this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",e=>{t.addSourceBuffers()}),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",()=>{this.emit("TIME_UPDATE",this.container)})}addSourceBuffers(){if("open"!==this.mediaSource.readyState)return;let t=this._context.getInstance("PRE_SOURCE_BUFFER");if(t.sources.audio&&t.sources.video){if(Object.keys(this.sourceBuffers).length>=2)return;for(let e=0,i=Object.keys(t.sources).length;e<i;e++){let i=t.sources[Object.keys(t.sources)[e]],r="video"===Object.keys(t.sources)[e]?"video/mp4;codecs="+i.mimetype:"audio/mp4;codecs="+i.mimetype,s=this.mediaSource.addSourceBuffer(r);this.sourceBuffers[Object.keys(t.sources)[e]]=s,s.addEventListener("updateend",()=>{this.doAppend()}),this.doAppend()}}}doAppend(){let t=this._context.getInstance("PRE_SOURCE_BUFFER");if(t)for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i=Object.keys(this.sourceBuffers)[e],r=this.sourceBuffers[i];if(!r.updating){let e=t.sources[i];if(e&&!e.inited)r.appendBuffer(e.init.buffer.buffer),e.inited=!0;else if(e){let t=e.data.shift();t&&r.appendBuffer(t.buffer.buffer)}}}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){if(!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(t){this.dataview.position=t}get position(){return this.dataview.position}back(t){this.position-=t}skip(t){let e=Math.floor(t/4),i=t%4;for(let t=0;t<e;t++)r.readByte(this.dataview,4);i>0&&r.readByte(this.dataview,i)}static readByte(t,e,i){let r;switch(e){case 1:r=i?t.getInt8(t.position):t.getUint8(t.position);break;case 2:r=i?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(i)throw new Error("not supported for readByte 3");r=t.getUint8(t.position)<<16,r|=t.getUint8(t.position+1)<<8,r|=t.getUint8(t.position+2);break;case 4:r=i?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(i)throw new Error("not supported for readBody 8");r=t.getUint32(t.position)<<32,r|=t.getUint32(t.position+4);break;default:r=""}return t.position+=e,r}readUint8(){return r.readByte(this.dataview,1)}readUint16(){return r.readByte(this.dataview,2)}readUint24(){return r.readByte(this.dataview,3)}readUint32(){return r.readByte(this.dataview,4)}readUint64(){return r.readByte(this.dataview,8)}readInt8(){return r.readByte(this.dataview,1,!0)}readInt16(){return r.readByte(this.dataview,2,!0)}readInt32(){return r.readByte(this.dataview,4,!0)}writeUint32(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(25),n=(r=s)&&r.__esModule?r:{default:r};e.default=class{constructor(t){this.buffer=t||new Uint8Array(0)}write(...t){t.forEach(t=>{this.buffer=(0,n.default)(Uint8Array,this.buffer,t)})}static writeUint32(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t])}static readAsInt(t){let e="";return t.forEach(t=>{e+=function(t){return t.toString(16).padStart(2,"0")}(t)}),parseInt(e,16)}}},function(t,e,i){"use strict";var r,s=i(26),n=(r=s)&&r.__esModule?r:{default:r};t.exports=n.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=0,i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var n=!0,a=!1,o=void 0;try{for(var d,l=r[Symbol.iterator]();!(n=(d=l.next()).done);n=!0){var u=d.value;e+=u.length}}catch(t){a=!0,o=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}var h=new t(e),c=0,f=!0,p=!1,g=void 0;try{for(var _,m=r[Symbol.iterator]();!(f=(_=m.next()).done);f=!0){var y=_.value;h.set(y,c),c+=y.length}}catch(t){p=!0,g=t}finally{try{!f&&m.return&&m.return()}finally{if(p)throw g}}return h}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(0),n=i(5),a=i(29),o=i(7),d=i(35),l=(r=d)&&r.__esModule?r:{default:r},u=i(37);const h=s.EVENTS.LOADER_EVENTS,c=s.EVENTS.REMUX_EVENTS,f=s.EVENTS.DEMUX_EVENTS;e.default=class{constructor(t){this.configs=Object.assign({},t),this.url="",this.baseurl="",this.sequence=0,this._playlist=null,this.retrytimes=this.configs.retrytimes||3,this.container=this.configs.container}init(){this._context.registry("M3U8_BUFFER",n.XgBuffer),this._context.registry("TS_BUFFER",n.XgBuffer),this._context.registry("TRACKS",n.Tracks),this._playlist=this._context.registry("PLAYLIST",u.Playlist)({autoclear:!0}),this._context.registry("PRE_SOURCE_BUFFER",n.PreSource),this._context.registry("COMPATIBILITY",o.Compatibility),this._context.registry("M3U8_LOADER",a.FetchLoader)({buffer:"M3U8_BUFFER",readtype:1}),this._context.registry("TS_LOADER",a.FetchLoader)({buffer:"TS_BUFFER",readtype:0}),this._context.registry("TS_DEMUXER",u.TsDemuxer)({inputbuffer:"TS_BUFFER"}),this._context.registry("MP4_REMUXER",l.default),this.mse=this._context.registry("MSE",s.Mse)({container:this.container}),this.initEvents()}initEvents(){this.on(h.LOADER_COMPLETE,t=>{if("M3U8_BUFFER"===t.TAG){let e=u.M3U8Parser.parse(t.shift(),this.baseurl);this._playlist.pushM3U8(e);let i=this._playlist.getTs();i?this.emitTo("TS_LOADER",h.LADER_START,i.url):this.retrytimes>0&&(this.retrytimes--,this.emitTo("M3U8_LOADER",h.LADER_START,this.url))}else if("TS_BUFFER"===t.TAG){this.emit(f.DEMUX_START);let t=this._playlist.getTs();t?this.emitTo("TS_LOADER",h.LADER_START,t.url):this.emitTo("M3U8_LOADER",h.LADER_START,this.url)}}),this.on(c.INIT_SEGMENT,t=>{this.mse.addSourceBuffers()}),this.on(c.MEDIA_SEGMENT,t=>{this.mse.doAppend()}),this.on(c.REMUX_ERROR,t=>{console.log(t)}),this.on(f.METADATA_PARSED,t=>{this.emit(c.REMUX_METADATA,t)}),this.on(f.DEMUX_COMPLETE,()=>{this.emit(c.REMUX_MEDIA)}),this.on("TIME_UPDATE",t=>{t.currentTime>this._playlist.duration/1e3-5&&this.load(this.url)})}load(t){this.baseurl=u.M3U8Parser.parseURL(t),this.url=t,this.emitTo("M3U8_LOADER",h.LADER_START,t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.mimetype="",this.init=null,this.data=[]}}e.default=class{constructor(){this.sources={}}getSource(t){return this.sources[t]}createSource(t){return this.sources[t]=new r,this.sources[t]}clear(){this.sources={}}}},function(t,e,i){"use strict";t.exports={FetchLoader:i(30).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0).EVENTS.LOADER_EVENTS,s=0,n=1,a=2;e.default=class{constructor(t){this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER"}init(){this.on(r.LADER_START,this.load.bind(this))}static get type(){return"loader"}load(t,e){let i=this;this.url=t;let r=this.getParams(e);return fetch(this.url,r).then(function(t){return i.status=t.status,i.loading=!0,i._onFetchResponse(t)})}_onFetchResponse(t){let e=this,i=this._context.getInstance(this.buffer);if(!0===t.ok)switch(this.readtype){case a:t.json().then(t=>{i?(i.push(t),e.emit(r.LOADER_COMPLETE,i)):e.emit(r.LOADER_COMPLETE,t)});break;case n:t.text().then(t=>{i?(i.push(t),e.emit(r.LOADER_COMPLETE,i)):e.emit(r.LOADER_COMPLETE,t)});break;case s:default:return this._onReader(t.body.getReader())}}_onReader(t){let e=this._context.getInstance(this.buffer);if(e||this._reader.cancel(),this._reader=t,!1===this.loading)return;let i=this;this._reader&&this._reader.read().then(function(s){return s.done?(i.loading=!1,i.status=0,void i.emit(r.LOADER_COMPLETE,e)):(e.push(s.value),i.emit(r.LOADER_DATALOADED,e),i._onReader(t))}).catch(function(t){console.log(t)})}getParams(t){let e=Object.assign({},t),i=new Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let t=this.configs.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}return!1===e.cors&&(r.mode="same-origin"),e.withCredentials&&(r.credentials="include"),r}cancel(){this._reader&&(this._reader.cancel(),this._reader=null)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(8),n=(r=s)&&r.__esModule?r:{default:r};class a{static getNalunits(t){if(t.length-t.position<4)return[];let e=t.dataview,i=t.position;return 1===e.getInt32(i)||0===e.getInt16(i)&&1===e.getInt8(i+2)?a.getAnnexbNals(t):a.getAvccNals(t)}static getAnnexbNals(t){let e=[],i=a.getHeaderPositionAnnexB(t),r=i.pos,s=r;for(;r<t.length-4;){let n=t.buffer.slice(r,r+i.headerLength);i.pos===t.position&&t.skip(i.headerLength),s=(i=a.getHeaderPositionAnnexB(t)).pos;let o={header:n,body:new Uint8Array(t.buffer.slice(r+n.byteLength,s))};a.analyseNal(o),e.push(o),t.skip(s-t.position),r=s}return e}static getAvccNals(t){let e=[];for(;t.position<t.length-4;){let i=t.dataview.getInt32();if(!(t.length-t.position>=i))break;{let r=t.buffer.slice(t.position,t.position+4);t.skip(4);let s=t.buffer.slice(t.position,t.position+i);t.skip(i);let n={header:r,body:s};a.analyseNal(n),e.push(n)}}return e}static analyseNal(t){switch(31&t.body[0]){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:break;case 7:t.sps=n.default.parseSPS(t.body);break;case 8:t.pps=!0}}static getHeaderPositionAnnexB(t){let e=t.position,i=0;for(;3!==i&&4!==i&&e<t.length-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?i=4:1===t.dataview.getInt8(e+2)?i=3:e++:e++;return e===t.length-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(i=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?i=3:e=t.length)),{pos:e,headerLength:i}}static getAvcc(t,e){let i=new Uint8Array(t.byteLength+e.byteLength+11);i[0]=1,i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=255,i[5]=225;let r=6;return i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),r),r+=2,i.set(t,r),i[r+=t.byteLength]=1,r++,i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),r),r+=2,i.set(e,r),i}}e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}destroy(){this._buffer=null}_fillCurrentWord(){let t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(i.buffer).getUint32(0,!1),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}readBits(t){if(t<=this._currentWordBitsLeft){let e=this._currentWord>>>32-t;return this._currentWord<<=t,this._currentWordBitsLeft-=t,e}let e=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;let i=t-this._currentWordBitsLeft;this._fillCurrentWord();let r=Math.min(i,this._currentWordBitsLeft),s=this._currentWord>>>32-r;return this._currentWord<<=r,this._currentWordBitsLeft-=r,e=e<<r|s}readBool(){return 1===this.readBits(1)}readByte(){return this.readBits(8)}_skipLeadingZero(){let t;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}readUEG(){let t=this._skipLeadingZero();return this.readBits(t+1)-1}readSEG(){let t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(0),n=i(34),a=(r=n)&&r.__esModule?r:{default:r};const{REMUX_EVENTS:o}=s.EVENTS;class d{constructor(){this.nextDts=0,this._firstAudioSample=null,this._firstVideoSample=null}init(){this.before(o.REMUX_MEDIA,this.doFix.bind(this))}doFix(){this.doFixAudio()}doFixVideo(){let{samples:t,meta:e}=this.videoTrack,{samples:i}=this.audioTrack;t&&t.length&&(this._firstVideoSample||(this._firstVideoSample=t[0]))}doFixAudio(){let{samples:t,meta:e}=this.audioTrack;if(!t||!t.length)return;if(0===(t=t.filter(t=>t.dts>=0)).length)return;const i=a.default.getSilentFrame(e.codec,e.channelCount);if(!this._firstAudioSample){const r=d.findFirstAudioSample(t),s=t.indexOf(r);if(t.splice(0,s),this._firstAudioSample=r,this._firstVideoSample){const s=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(r.dts-s>2*e.refSampleDuration){const n=(r.dts-s)/e.refSampleDuration-1;for(let r=0;r<n;r++){const n={data:i,datasize:i.byteLength,dts:s+r*e.refSampleDuration,filtered:0};t.unshift(n)}}}else if(r.dts>2*e.refSampleDuration){let s=Math.floor(r.dts/e.refSampleDuration-1);for(let r=0;r<s;r++){const s={data:i,datasize:i.byteLength,dts:r*e.refSampleDuration,filtered:0};t.unshift(s)}}}let r;const s=t[0].dts;if(this.nextDts?r=s-this.nextDts:this.nextDts=t[t.length-1].dts+e.refSampleDuration,r>2*e.refSampleDuration){const t=Math.floor(r/e.refSampleDuration-1);for(let r=0;r<t;r++){const t={data:i,datasize:i.byteLength,dts:this.nextDts+r*e.refSampleDuration,filtered:0};this.audioTrack.samples.unshift(t)}}else r>-1*e.refSampleDuration?t[0].dts=this.nextDts:t.shift();const n=[];let o=null;for(let r=0,s=t.length;r<s;r++){n.indexOf(r)<0&&!o&&(o=t[r]);const s=t[r+1];if(!s)break;const a=s.dts-o.dts;if(a>2*e.refSampleDuration){let s=Math.floor(a/e.refSampleDuration-1);for(;s>0;){s--;const n={data:i,datasize:i.byteLength,dts:o.dts+e.refSampleDuration,filtered:0};t.splice(r,0,n)}}else a<0?(this.audioTrack.droppedSamples.push({dts:s.dts,datasize:s.datasize}),n.push(r+1)):o=null}this.audioTrack.samples=t}static findFirstAudioSample(t){return t.length?t.sort((t,e)=>t.dts-e.dts)[0]:null}get tracks(){return this._context.getInstance("TRACKS")}get audioTrack(){return this.tracks?this.tracks.audioTrack:null}get videoTrack(){return this.tracks?this.tracks.videoTrack:null}}e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,s=i(0),n=i(36),a=(r=n)&&r.__esModule?r:{default:r};const o=s.EVENTS.REMUX_EVENTS;class d{constructor(){this._dtsBase=0,this._isDtsBaseInited=!1,this._audioNextDts=null,this._videoNextDts=null,this._videoSegmentList=new s.MediaSegmentList("video"),this._audioSegmentList=new s.MediaSegmentList("audio");const{browser:t}=s.sniffer;this._fillSilenceFrame="ie"===t}init(){this.on(o.REMUX_MEDIA,this.remux.bind(this)),this.on(o.REMUX_METADATA,this.onMetaDataReady.bind(this))}destroy(){this._dtsBase=-1,this._dtsBaseInited=!1,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null}remux(){const{audioTrack:t,videoTrack:e}=this._context.getInstance("TRACKS");!this._isDtsBaseInited&&this.calcDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)}seek(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()}onMetaDataReady(t){let e,i,r=new s.Buffer,n=a.default.ftyp();if("audio"===t){const{audioTrack:t}=this._context.getInstance("TRACKS");i=t}else{const{videoTrack:t}=this._context.getInstance("TRACKS");i=t}e=a.default.moov({type:t,meta:i.meta}),r.write(n,e);let d=this._context.getInstance("PRE_SOURCE_BUFFER"),l=d.getSource(t);l||(l=d.createSource(t)),l.mimetype=i.meta.codec,l.init=r,this.emit(o.INIT_SEGMENT,t)}calcDtsBase(t,e){let i=1/0,r=1/0;t.samples&&t.samples.length&&(i=t.samples[0].dts),e.samples&&e.samples.length&&(r=e.samples[0].dts),this._dtsBase=Math.min(i,r),this._isDtsBaseInited=!0}_remuxVideo(t){const e=t;if(!t.samples||!t.samples.length)return;let i,{samples:r}=e,n=-1,d=-1,l=-1,u=-1;const h=[],c={samples:[]},f=new s.MediaSegment;for(;r.length;){const t=r.shift(),{isKeyframe:e}=t;let a=t.dts-this._dtsBase;const o=t.cts;if(void 0===i)if(this._videoNextDts)i=a-this._videoNextDts>=1e3?0:a-this._videoNextDts;else if(this._videoSegmentList.isEmpty())i=0;else{const t=this._videoSegmentList.getLastSegmentBefore(a);if(t){let e;const{lastDts:r,gap:s}=t;i=a-(r+(e=a-(r+s)>3?a-(r+s):0))}else i=0}const d=a,u=(a-=i)+o;-1===n&&(n=a,l=u);let p={buffer:[],size:0};c.samples.push(p),p.buffer.push(t.data),p.size+=t.data.byteLength;let g=0;if(r.length>=1){g=r[0].dts-this._dtsBase-i-a}else g=h.length>=1?h[h.length-1].duration:this.videoMeta.refSampleDuration;if(e){const e=new s.MediaSample({dts:a,pts:u,duration:g,originDts:t.dts,isRAP:!0});f.addRAP(e)}h.push({dts:a,cts:o,pts:u,data:t.data,size:t.data.byteLength,isKeyframe:e,duration:g,flags:{isLeading:0,dependsOn:e?2:1,isDependedOn:e?1:0,hasRedundancy:0,isNonSync:e?0:1},originDts:d})}const p=h[0],g=h[h.length-1];d=g.dts+g.duration,u=g.pts+g.duration,this._videoNextDts=d,f.startDts=n,f.endDts=d,f.startPts=l,f.endPts=u,f.originStartDts=p.originDts,f.originEndDts=g.originDts+g.duration,f.gap=i;const _=new s.MediaSample({dts:p.dts,pts:p.pts,duration:p.duration,isKeyframe:p.isKeyframe,originDts:p.originDts}),m=new s.MediaSample({dts:g.dts,pts:g.pts,duration:g.duration,isKeyframe:g.isKeyframe,originDts:g.originDts});f.firstSample=_,f.lastSample=m;let y=new s.Buffer;const E=a.default.moof({id:e.meta.id,time:n,samples:h}),v=a.default.mdat(c);y.write(E,v),e.samples=[],e.length=0;let b=this._context.getInstance("PRE_SOURCE_BUFFER"),A=b.getSource("video");A||(A=b.createSource("video")),A.data.push(y),this.emit(o.MEDIA_SEGMENT,"video")}_remuxAudio(t){const{samples:e}=t;let i=-1,r=-1,n=[];const d={samples:[]};if(!e||!e.length)return;let l=!1;for(;e.length;){let t=e.shift();const{data:r}=t;let s=t.dts-this._dtsBase;const a=s;l||(i=s,l=!0);let o=0;if(e.length>=1){o=e[0].dts-this._dtsBase-s}else o=n.length>=1?n[n.length-1].duration:this.audioMeta.refSampleDuration;const u={dts:s,pts:s,cts:0,size:r.byteLength,duration:o,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:a};let h={buffer:[],size:0};h.buffer.push(r),h.size+=r.byteLength,d.samples.push(h),n.push(u)}const u=n[n.length-1];r=u.dts+u.duration,this._audioNextDts=r;const h=new s.MediaSegment;h.startDts=i,h.endDts=r,h.startPts=i,h.endPts=r,h.originStartDts=n[0].originDts,h.originEndDts=u.originDts+u.duration,h.gap=0,h.firstSample=new s.MediaSample({dts:n[0].dts,pts:n[0].pts,duration:n[0].duration,originDts:n[0].originDts}),h.lastSample=new s.MediaSample({dts:u.dts,pts:u.pts,duration:u.duration,originDts:u.originDts}),t.samples=n;const c=new s.Buffer,f=a.default.moof({id:t.meta.id,time:i,samples:n}),p=a.default.mdat(d);c.write(f,p),t.samples=[],t.length=0;let g=this._context.getInstance("PRE_SOURCE_BUFFER"),_=g.getSource("audio");_||(_=g.createSource("audio")),_.data.push(c),this.emit(o.MEDIA_SEGMENT,"audio",c)}initSilentAudio(t,e){const i=d.getSilentFrame(this._audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:e,unit:i,size:i.byteLength,originDts:t}}get videoMeta(){return this._context.getInstance("TRACKS").videoTrack.meta}get audioMeta(){return this._context.getInstance("TRACKS").audioTrack.meta}static getSilentFrame(t){return 1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(0);class s{static size(t){return r.Buffer.writeUint32(t)}static initBox(t,e,...i){const n=new r.Buffer;return n.write(s.size(t),s.type(e),...i),n.buffer}static extension(t,e){return new Uint8Array([t,e>>16&255,e>>8&255,255&e])}static ftyp(){return s.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}static moov({type:t,meta:e}){let i,r=8,n=s.mvhd(e.duration,e.timescale);i="video"===t?s.videoTrak(e):s.audioTrak(e);let a=s.mvex(e.duration,e.timescale||1e3,e.id);return[n,i,a].forEach(t=>{r+=t.byteLength}),s.initBox(r,"moov",n,i,a)}static mvhd(t,e=1e3){let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.initBox(8+i.length,"mvhd",new Uint8Array(i))}static videoTrak(t){let e=8,i=s.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),r=s.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[i,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"trak",i,r)}static audioTrak(t){let e=8,i=s.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),r=s.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[i,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"trak",i,r)}static tkhd(t){let e=t.id,i=t.duration,r=t.width,n=t.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,n>>>8&255,255&n,0,0]);return s.initBox(8+a.byteLength,"tkhd",a)}static edts(t){let e=new r.Buffer,i=t.duration,n=t.mediaTime;return e.write(s.size(36),s.type("edts")),e.write(s.size(28),s.type("elst")),e.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,1])),e.buffer}static mdia(t){let e=8,i=s.mdhd(t.timescale,t.duration),r=s.hdlr(t.type),n=s.minf(t);return[i,r,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"mdia",i,r,n)}static mdhd(t=1e3,e){let i=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,85,196,0,0]);return s.initBox(12+i.byteLength,"mdhd",s.extension(0,0),i)}static hdlr(t){let e=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(e.splice(8,4,115,111,117,110),e.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),s.initBox(8+e.length,"hdlr",new Uint8Array(e))}static minf(t){let e=8,i="video"===t.type?s.vmhd():s.smhd(),r=s.dinf(),n=s.stbl(t);return[i,r,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"minf",i,r,n)}static vmhd(){return s.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}static smhd(){return s.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}static dinf(){let t=new r.Buffer;return t.write(s.size(36),s.type("dinf"),s.size(28),s.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}static stbl(t){let e=8,i=s.stsd(t),r=s.stts(),n=s.stsc(),a=s.stsz(),o=s.stco();return[i,r,n,a,o].forEach(t=>{e+=t.byteLength}),s.initBox(e,"stbl",i,r,n,a,o)}static stsd(t){let e;return e="audio"===t.type?s.mp4a(t):s.avc1(t),s.initBox(16+e.byteLength,"stsd",s.extension(0,0),new Uint8Array([0,0,0,1]),e)}static mp4a(t){let e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=s.esds(t.config);return s.initBox(8+e.byteLength+i.byteLength,"mp4a",e,i)}static esds(t=[43,146,8,0]){const e=t.length;let i=new r.Buffer,n=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return i.write(s.size(8+n.byteLength),s.type("esds"),n),i.buffer}static avc1(t){let e=new r.Buffer,i=t.width,n=t.height,a=t.parRatio.height,o=t.parRatio.width,d=t.avcc,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,n>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o]);return e.write(s.size(40+l.byteLength+d.byteLength+u.byteLength),s.type("avc1"),l,s.size(8+d.byteLength),s.type("avcC"),d,s.size(20),s.type("btrt"),u,s.size(16),s.type("pasp"),h),e.buffer}static stts(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stts",t)}static stsc(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stsc",t)}static stco(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stco",t)}static stsz(){let t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return s.initBox(20,"stsz",t)}static mvex(t,e=1e3,i){let n=new r.Buffer,a=r.Buffer.writeUint32(t);return n.write(s.size(56),s.type("mvex"),s.size(16),s.type("mehd"),s.extension(0,0),a,s.trex(i)),n.buffer}static trex(t){let e=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return s.initBox(8+e.byteLength,"trex",e)}static moof(t){let e=8,i=s.mfhd(),r=s.traf(t);return[i,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"moof",i,r)}static mfhd(){let t=r.Buffer.writeUint32(s.sequence);return s.sequence+=1,s.initBox(16,"mfhd",s.extension(0,0),t)}static traf(t){let e=8,i=s.tfhd(t.id),r=s.tfdt(t.time),n=s.sdtp(t),a=s.trun(t,n.byteLength);return[i,r,a,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"traf",i,r,a,n)}static tfhd(t){let e=r.Buffer.writeUint32(t);return s.initBox(16,"tfhd",s.extension(0,0),e)}static tfdt(t){return s.initBox(16,"tfdt",s.extension(0,0),r.Buffer.writeUint32(t))}static trun(t,e){let i=new r.Buffer,n=r.Buffer.writeUint32(t.samples.length),a=r.Buffer.writeUint32(92+16*t.samples.length+e);return i.write(s.size(20+16*t.samples.length),s.type("trun"),new Uint8Array([0,0,15,1]),n,a),t.samples.forEach(t=>{const e=t.flags;i.write(new Uint8Array([t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,t.size>>>24&255,t.size>>>16&255,t.size>>>8&255,255&t.size,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.isNonSync,0,0,t.cts>>>24&255,t.cts>>>16&255,t.cts>>>8&255,255&t.cts]))}),i.buffer}static sdtp(t){let e=new r.Buffer;return e.write(s.size(12+t.samples.length),s.type("sdtp"),s.extension(0,0)),t.samples.forEach(t=>{const i=t.flags,r=i.isLeading<<6|i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;e.write(new Uint8Array([r]))}),e.buffer}static mdat(t){let e=new r.Buffer,i=8;t.samples.forEach(t=>{i+=t.size}),e.write(s.size(i),s.type("mdat"));let n=new Uint8Array(i),a=0;return n.set(e.buffer,a),a+=8,t.samples.forEach(t=>{t.buffer.forEach(t=>{n.set(t,a),a+=t.byteLength})}),n}}s.type=t=>new Uint8Array([t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]),s.sequence=1,e.default=s},function(t,e,i){"use strict";t.exports={M3U8Parser:i(38).default,TsDemuxer:i(39).default,Playlist:i(40).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static parse(t,e=""){let i={duration:0},s=t.split(/\r|\n/),n=(s=s.filter(t=>t)).shift();if(!n.match("#EXTM3U"))return null;for(n=s.shift();n;){let t=n.match(/#(.*):(.*)/);if(t&&t.length>2)switch(t[1]){case"EXT-X-VERSION":i.version=parseInt(t[2]);break;case"EXT-X-MEDIA-SEQUENCE":i.sequence=parseInt(t[2]);break;case"EXT-X-TARGETDURATION":i.targetduration=parseFloat(t[2]);break;case"EXTINF":r.parseFrag(t,s,i,e)}n=s.shift()}return i}static parseFrag(t,e,i,r){i.frags||(i.frags=[]);let s={start:i.duration,duration:1e3*parseFloat(t[2])};i.duration+=s.duration;let n=e.shift();n.match(/#(.*):(.*)/)&&(n=e.shift()),s.url=r+n,i.frags.push(s)}static parseURL(t){let e="",i=t.match(/(.*\/).*\.m3u8$/);if(i&&i.length>0)for(let t=0;t<i.length;t++)i[t].match(/.*\/$/g)&&i[t].length>e.length&&(e=i[t]);return e}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(7),s=i(5),n=i(0);const a=n.EVENTS.DEMUX_EVENTS,o={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};class d{constructor(t){this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}init(){this.on(a.DEMUX_START,this.demux.bind(this))}demux(){if(this.demuxing)return;let t=this.inputBuffer,e={pat:[],pmt:[]},i={};for(;t.length>=188;){let r=t.shift(188),s=new n.Stream(r.buffer),a={};d.read(s,a,e),a.pes?(i[a.header.pid]||(i[a.header.pid]=[]),i[a.header.pid].push(a.pes),a.pes.ES.buffer=[a.pes.ES.buffer]):i[a.header.pid]&&i[a.header.pid][i[a.header.pid].length-1].ES.buffer.push(a.payload.stream)}for(let t=0;t<Object.keys(i).length;t++){let e=i[Object.keys(i)[t]];for(let r=0;r<e.length;r++)e[r].id=Object.keys(i)[t],e[r].ES.buffer=d.Merge(e[r].ES.buffer),"audio"===e[r].type?this.pushAudioSample(e[r]):"video"===e[r].type&&this.pushVideoSample(e[r])}}pushAudioSample(t){let e;this._tracks.audioTrack?e=this._tracks.audioTrack:(this._tracks.audioTrack=new s.AudioTrack,(e=this._tracks.audioTrack).meta=new n.AudioTrackMeta({audioSampleRate:t.ES.frequence,sampleRate:t.ES.frequence,channelCount:t.ES.channel,codec:"mp4a.40."+t.ES.audioObjectType,config:t.ES.audioConfig,id:2,sampleRateIndex:t.ES.frequencyIndex}),e.meta.refSampleDuration=Math.floor(1024/e.meta.audioSampleRate*e.meta.timescale),this._hasAudioMeta||(this._hasAudioMeta=!0,this.emit(a.METADATA_PARSED,"audio")));let i=new Uint8Array(t.ES.buffer.buffer.slice(t.ES.buffer.position,t.ES.buffer.length)),r=parseInt(t.pts/90),o=parseInt(t.pts/90),d=new n.AudioTrackSample({dts:r,pts:o,data:i});e.samples.push(d),this._hasVideoMeta&&this._hasAudioMeta&&this.emit(a.DEMUX_COMPLETE,"audio")}pushVideoSample(t){let e,i=r.Nalunit.getNalunits(t.ES.buffer);this._tracks.videoTrack?e=this._tracks.videoTrack:(this._tracks.videoTrack=new s.VideoTrack,(e=this._tracks.videoTrack).meta=new n.VideoTrackMeta);let o=0,d=!1,l=!1;for(let t=0;t<i.length;t++){let r=i[t];if(r.sps){d=r,e.sps=r.body,e.meta.chromaFormat=d.sps.chroma_format,e.meta.codec="avc1.";for(var u=1;u<4;u++){var h=d.body[u].toString(16);h.length<2&&(h="0"+h),e.meta.codec+=h}e.meta.codecHeight=d.sps.codec_size.height,e.meta.codecWidth=d.sps.codec_size.width,e.meta.frameRate=d.sps.frame_rate,e.meta.id=1,e.meta.level=d.sps.level_string,e.meta.presentHeight=d.sps.present_size.height,e.meta.presentWidth=d.sps.present_size.width,e.meta.profile=d.sps.profile_string,e.meta.refSampleDuration=Math.floor(e.meta.timescale*(d.sps.frame_rate.fps_den/d.sps.frame_rate.fps_num)),e.meta.sarRatio=d.sps.sar_ratio?d.sps.sar_ratio:d.sps.par_ratio}else r.pps?(e.pps=r.body,l=r):o+=4+r.body.byteLength}d&&l&&(e.meta.avcc=r.Nalunit.getAvcc(d.body,l.body),this._hasVideoMeta||(this._hasVideoMeta=!0,this.emit(a.METADATA_PARSED,"video")));let c=new Uint8Array(o),f=0,p=!1;for(let t=0;t<i.length;t++){let e=i[t],r=e.body.byteLength;e.idr&&(p=!0),e.pps||e.sps||(c.set(new Uint8Array([r>>>24&255,r>>>16&255,r>>>8&255,255&r]),f),f+=4,c.set(e.body,f),f+=r)}let g=new n.VideoTrackSample({dts:parseInt(t.dts/90),pts:parseInt(t.pts/90),cts:(t.pts-t.dts)/90,originDts:t.dts,isKeyframe:p,data:c});e.samples.push(g),this._hasVideoMeta&&this._hasAudioMeta&&this.emit(a.DEMUX_COMPLETE,"video")}static Merge(t){let e,i=0,r=0;for(let e=0;e<t.length;e++)i+=t[e].length-t[e].position;e=new Uint8Array(i);for(let i=0;i<t.length;i++){let s=t[i];e.set(new Uint8Array(s.buffer,s.position),r),r+=s.length-s.position}return new n.Stream(e.buffer)}static read(t,e,i){d.readHeader(t,e),d.readPayload(t,e,i),"MEDIA"!==e.header.packet||1!==e.header.payload||e.unknownPIDs||(e.pes=d.PES(e))}static readPayload(t,e,i){let r=e.header.pid;switch(r){case 0:d.PAT(t,e,i);break;case 1:d.CAT(t,e,i);break;case 2:d.TSDT(t,e,i);break;case 8191:break;default:if(i.pat.some(t=>t.pid===r))d.PMT(t,e,i);else{let s=i.pmt?i.pmt.filter(t=>t.pid===r):[];s.length>0?d.Media(t,e,o[s[0].streamType][0]):e.unknownPIDs=!0}}}static readHeader(t,e){let i={};i.sync=t.readUint8();let r=t.readUint16();i.error=r>>>15,i.payload=r>>>14&1,i.priority=r>>>13&1,i.pid=8191&r,r=t.readUint8(),i.scrambling=r>>6&3,i.adaptation=r>>4&3,i.continuity=15&r,i.packet=0===i.pid?"PAT":"MEDIA",e.header=i}static PAT(t,e,i){let r={},s=t.readUint8();t.skip(s),s=t.readUint8(),r.tabelID=s,s=t.readUint16(),r.error=s>>>7,r.zero=s>>>6&1,r.sectionLength=4095&s,r.streamID=t.readUint16(),r.current=1&t.readUint8(),r.sectionNumber=t.readUint8(),r.lastSectionNumber=t.readUint8();let n=(r.sectionLength-9)/4,a=[];for(let e=0;e<n;e++){let e=t.readUint16(),i=8191&t.readUint16();a.push({program:e,pid:i,type:0===e?"network":"mapPID"})}a.length>0&&(i.pat=i.pat.concat(a)),r.list=a,r.program=t.readUint16(),r.pid=8191&t.readUint16(),e.payload=r}static PMT(t,e,i){let r={};e.header.packet="PMT";let s=t.readUint8();t.skip(s),s=t.readUint8(),r.tableID=s,s=t.readUint16(),r.sectionLength=4095&s,r.program=t.readUint16(),r.current=1&t.readUint8(),r.order=t.readUint8(),r.lastOrder=t.readUint8(),r.PCR_PID=8191&t.readUint16(),r.programLength=4095&t.readUint16();let n=(r.sectionLength-13)/5,a=[];for(let e=0;e<n;e++)a.push({streamType:t.readUint8(),pid:8191&t.readUint16(),es:4095&t.readUint16()});r.list=a,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(a.map(t=>({pid:t.pid,es:t.es,streamType:t.streamType,program:r.program}))),e.payload=r}static Media(t,e,i){let r=e.header,s={};if(r.type=i,3===r.adaptation&&(s.adaptationLength=t.readUint8(),s.adaptationLength>0)){let e=t.readUint8();s.discontinue=e>>>7,s.access=e>>>6&1,s.priority=e>>>5&1,s.PCR=e>>>4&1,s.OPCR=e>>>3&1,s.splicePoint=e>>>2&1,s.transportPrivate=e>>>1&1,s.adaptationField=1&e;let i=t.position;if(1===s.PCR&&(s.programClockBase=t.readUint32()<<1,e=t.readUint16(),s.programClockBase|=e>>>15,s.programClockExtension=511&e),1===s.OPCR&&(s.originProgramClockBase=t.readUint32()<<1,e=t.readUint16(),s.originProgramClockBase+=e>>>15,s.originProgramClockExtension=511&e),1===s.splicePoint&&(s.spliceCountdown=t.readUint8()),1===s.transportPrivate){let e=t.readUint8(),i=[];for(let r=0;r<e;r++)i.push(t.readUint8())}if(1===s.adaptationField){let e=t.readUint8(),i=t.readUint8(),r=t.position,n=i>>>6&1,a=i>>>5&1;1===i>>>7&&(i=t.readUint16(),s.ltwValid=i>>>15,s.ltwOffset=61439&i),1===n&&(i=t.readUint24(),s.piecewiseRate=4194303&i),1===a&&(i=t.readInt8(),s.spliceType=i>>>4,s.dtsNextAU1=i>>>1&7,s.marker1=1&i,i=t.readUint16(),s.dtsNextAU2=i>>>1,s.marker2=1&i,i=t.readUint16(),s.dtsNextAU3=i),t.skip(e-1-(t.position-r))}let r=s.adaptationLength-1-(t.position-i);t.skip(r)}s.stream=new n.Stream(t.buffer.slice(t.position)),e.payload=s}static PES(t){let e={},i=t.payload.stream;if(1!==i.readUint24())e.ES={},e.ES.buffer=i;else{let t=i.readUint8();t>=224&&t<=239&&(e.type="video"),t>=192&&t<=223&&(e.type="audio");let r=i.readUint16();if(e.packetLength=r,"video"!==e.type&&"audio"!==e.type)throw new Error("format is not supported");{let t=i.readUint8();if(2!==t>>>6)throw new Error("error when parse pes header");t=i.readUint8(),e.ptsDTSFlag=t>>>6,e.escrFlag=t>>>5&1,e.esRateFlag=t>>>4&1,e.dsmFlag=t>>>3&1,e.additionalFlag=t>>>2&1,e.crcFlag=t>>>1&1,e.extensionFlag=1&t,e.pesHeaderLength=i.readUint8();let r=e.pesHeaderLength;if(2===e.ptsDTSFlag){let s=[];t=i.readUint8(),s.push(t>>>1&7),t=i.readUint16(),s.push(t>>>1),t=i.readUint16(),s.push(t>>>1),e.pts=s[0]<<30|s[1]<<15|s[2],r-=5,"video"===e.type&&(e.dts=e.pts)}if(3===e.ptsDTSFlag){let s=[];t=i.readUint8(),s.push(t>>>1&7),t=i.readUint16(),s.push(t>>>1),t=i.readUint16(),s.push(t>>>1),e.pts=s[0]<<30|s[1]<<15|s[2];let n=[];t=i.readUint8(),n.push(t>>>1&7),t=i.readUint16(),n.push(t>>>1),t=i.readUint16(),n.push(t>>>1),e.dts=n[0]<<30|n[1]<<15|n[2],r-=10}if(1===e.escrFlag){let s=[],n=[];t=i.readUint8(),s.push(t>>>3&7),s.push(3&t),t=i.readUint16(),s.push(t>>>13),s.push(3&t),t=i.readUint16(),s.push(t>>>13),n.push(3&t),t=i.readUint8(),n.push(t>>>1),e.escr=300*(s[0]<<30|s[1]<<28|s[2]<<15|s[3]<<13|s[4])+(n[0]<<7|n[1]),r-=6}if(1===e.esRateFlag&&(t=i.readUint24(),e.esRate=t>>>1&4194303,r-=3),1===e.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===e.additionalFlag&&(t=i.readUint8(),e.additionalCopyInfo=127&t,r-=1),1===e.crcFlag&&(e.pesCRC=i.readUint16(),r-=2),1===e.extensionFlag)throw new Error("not support extension");r>0&&i.skip(r),e.ES=d.ES(i,e.type)}}return e}static ES(t,e){let i,r={};if("video"===e){if(1!==(i=t.readUint32())&&(t.back(4),1!==(i=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),r.buffer=t}else{if("audio"!==e)throw new Error(`ES ${e} is not supported`);{if((i=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",r.layer=i>>>1&3,r.absent=1&i,i=t.readUint16(),r.audioObjectType=1+(i>>>14&3),r.profile=r.audioObjectType-1,r.frequencyIndex=i>>>10&15,r.frequence=e[r.frequencyIndex],r.channel=i>>>6&7,r.frameLength=(3&i)<<11|t.readUint16()>>>5,r.audioConfig=d.getAudioConfig(r.audioObjectType,r.channel,r.frequencyIndex),t.skip(1),r.buffer=t}}return r}static TSDT(t,e,i){e.payload={}}static CAT(t,e,i){let r={};r.tableID=t.readUint8();let s=t.readUint16();r.sectionIndicator=s>>>7,r.sectionLength=4095&s,t.skip(2),s=t.readUint8(),r.version=s>>>3,r.currentNextIndicator=1&s,r.sectionNumber=t.readUint8(),r.lastSectionNumber=t.readUint8();let n=(this.sectionLength-9)/4,a=[];for(let t=0;t<n;t++)a.push({});r.crc32=t.readUint32(),e.payload=r}static getAudioConfig(t,e,i){let r,s,n=navigator.userAgent.toLowerCase();return/firefox/i.test(n)?i>=6?(t=5,r=new Array(4),s=i-3):(t=2,r=new Array(2),s=i):-1!==n.indexOf("android")?(t=2,r=new Array(2),s=i):(t=5,r=new Array(4),i>=6?s=i-3:(1===e&&(t=2,r=new Array(2)),s=i)),r[0]=t<<3,r[0]|=(14&i)>>1,r[1]=(1&i)<<7,r[1]|=e<<3,5===t&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),r}get inputBuffer(){return this._context.getInstance(this.configs.inputbuffer)}get _tracks(){return this._context.getInstance("TRACKS")}}e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this._lastget=void 0,this._audoclear=t.autoclear||!1}get list(){return this._list}set baseURL(t){this.baseURL!==t&&(this.clear(),this._baseURL=t)}get baseURL(){return this._baseURL}push(t,e){this._ts[t]={duration:e,downloaded:!1,start:this.duration},this._list[this.duration]=t,this.duration+=e}pushM3U8(t){if(this.version=t.version,this.targetduration=t.targetduration,t.sequence>this.sequence){this.sequence=t.sequence;for(let e=0;e<t.frags.length;e++){let i=t.frags[e];this._ts[i.url]||this.push(i.url,i.duration)}}}getTs(t){let e,i=Object.keys(this._list);if(void 0===t&&(t=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||t>=this.duration)){for(let r=0;r<i.length&&t>=i[r];r++){let t=this._list[i[r]];e={url:t,downloaded:this._ts[t].downloaded,time:parseInt(i[r]),duration:parseInt(this._ts[t].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=e}return e}}clear(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}}}])});