!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],e):(t=t||self,t.H264Player=e(t.Player))}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(){}function i(){i.init.call(this)}function r(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function o(t,e,n){if(e)t.call(n);else for(var i=t.length,r=y(t,i),o=0;o<i;++o)r[o].call(n)}function a(t,e,n,i){if(e)t.call(n,i);else for(var r=t.length,o=y(t,r),a=0;a<r;++a)o[a].call(n,i)}function s(t,e,n,i,r){if(e)t.call(n,i,r);else for(var o=t.length,a=y(t,o),s=0;s<o;++s)a[s].call(n,i,r)}function u(t,e,n,i,r,o){if(e)t.call(n,i,r,o);else for(var a=t.length,s=y(t,a),u=0;u<a;++u)s[u].call(n,i,r,o)}function c(t,e,n,i){if(e)t.apply(n,i);else for(var r=t.length,o=y(t,r),a=0;a<r;++a)o[a].apply(n,i)}function l(t,e,i,o){var a,s,u;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if(s=t._events,s?(s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),u=s[e]):(s=t._events=new n,t._eventsCount=0),u){if("function"==typeof u?u=s[e]=o?[i,u]:[u,i]:o?u.unshift(i):u.push(i),!u.warned&&(a=r(t))&&a>0&&u.length>a){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=u.length,h(c)}}else u=s[e]=i,++t._eventsCount;return t}function h(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function f(t,e,n){function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}var r=!1;return i.listener=n,i}function d(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function p(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}function y(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function v(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":gt(e))&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":gt(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":zt(e))&&"function"!=typeof e?t:e}function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":zt(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t){return!(t<20||t>80)}function M(t,e){return function(n){var i=this;if(!e)return new ne(t);if(ne&&!n){var r=I(`${e}`.replace(/^function.+?{/,"").slice(0,-1));return this[Jt]=new ne(r),ee.revokeObjectURL(r),this[Jt]}var o={postMessage:t=>{i.onmessage&&setTimeout(()=>i.onmessage({data:t,target:o}))}};e.call(o),this.postMessage=(t=>{setTimeout(()=>o.onmessage({data:t,target:i}))}),this.isThisThread=!0}}function I(t){try{return ee.createObjectURL(new Blob([t],{type:Qt}))}catch(n){var e=new te;return e.append(t),ee.createObjectURL(e.getBlob(type))}}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":ye(e))&&"function"!=typeof e?t:e}function V(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":ye(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function H(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":ge(e))&&"function"!=typeof e?t:e}function X(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":ge(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function K(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":Ae(e))&&"function"!=typeof e?t:e}function q(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":Ae(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":Oe(e))&&"function"!=typeof e?t:e}function J(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":Oe(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function et(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}t=t&&t.hasOwnProperty("default")?t.default:t;var nt={VISIBILITY_CHANGE:"VISIBILITY_CHANGE"},it={SEEK:"SEEK"},rt={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},ot={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",SEI_PARSED:"SEI_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},at={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",DETECT_CHANGE_STREAM_DISCONTINUE:"DETECT_CHANGE_STREAM_DISCONTINUE",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT"},st={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},ut={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},ct={START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"},lt=Object.assign({},rt,ot,at,st,ut,it,nt),ht=[],ft=[];for(var dt in lt)lt.hasOwnProperty(dt)&&ht.push(lt[dt]);for(var pt in lt)lt.hasOwnProperty(pt)&&ft.push(lt[pt]);var yt={ALLEVENTS:lt,HLS_EVENTS:ut,REMUX_EVENTS:at,DEMUX_EVENTS:ot,MSE_EVENTS:st,LOADER_EVENTS:rt,FlvAllowedEvents:ht,HlsAllowedEvents:ft,CRYTO_EVENTS:ct,PLAYER_EVENTS:it,BROWSER_EVENTS:nt},vt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),mt=function(t){for(var e in t)if(t.hasOwnProperty(e)&&null===t[e])return!1;return!0},_t=function(){function t(){e(this,t),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return vt(t,[{key:"isComplete",value:function(){return t.isBaseInfoReady(this)&&t.isVideoReady(this)&&t.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(t){return mt(t)}},{key:"isVideoReady",value:function(t){return!t.hasVideo||mt(t.video)}},{key:"isAudioReady",value:function(t){return!t.hasAudio||mt(t.video)}}]),t}();n.prototype=Object.create(null),i.EventEmitter=i,i.usingDomains=!1,i.prototype.domain=void 0,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.init=function(){this.domain=null,i.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return r(this)},i.prototype.emit=function(t){var e,n,i,r,l,h,f,d="error"===t;if(h=this._events)d=d&&null==h.error;else if(!d)return!1;if(f=this.domain,d){if(e=arguments[1],!f){if(e instanceof Error)throw e;var p=new Error('Uncaught, unspecified "error" event. ('+e+")");throw p.context=e,p}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=f,e.domainThrown=!1,f.emit("error",e),!1}if(!(n=h[t]))return!1;var y="function"==typeof n;switch(i=arguments.length){case 1:o(n,y,this);break;case 2:a(n,y,this,arguments[1]);break;case 3:s(n,y,this,arguments[1],arguments[2]);break;case 4:u(n,y,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),l=1;l<i;l++)r[l-1]=arguments[l];c(n,y,this,r)}return!0},i.prototype.addListener=function(t,e){return l(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return l(this,t,e,!0)},i.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,f(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,f(this,t,e)),this},i.prototype.removeListener=function(t,e){var i,r,o,a,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new n:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(o=-1,a=i.length;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){s=i[a].listener,o=a;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new n,this;delete r[t]}else p(i,o);r.removeListener&&this.emit("removeListener",t,s||e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new n,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new n:delete i[t]),this;if(0===arguments.length){for(var r,o=Object.keys(i),a=0;a<o.length;++a)"removeListener"!==(r=o[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new n,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},i.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:v(e):[]},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},Et=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];g(this,t),this._emitter=new i,this._emitter.off||(this._emitter.off=this._emitter.removeListener),this.mediaInfo=new _t,this._instanceMap={},this._clsMap={},this._inited=!1,this.allowedEvents=e,this._hooks={}}return Et(t,[{key:"getInstance",value:function(t){var e=this._instanceMap[t];return e||null}},{key:"initInstance",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r=n[0],o=n[1],a=n[2],s=n[3];if(this._clsMap[t]){var u=new this._clsMap[t](r,o,a,s);return this._instanceMap[t]=u,u.init&&u.init(),u}throw new Error(t+"未在context中注册")}},{key:"init",value:function(t){if(!this._inited){for(var e in this._clsMap)this._clsMap.hasOwnProperty(e)&&!this._instanceMap[e]&&this.initInstance(e,t);this._inited=!0}}},{key:"registry",value:function(t,e){var n=this,i=this._emitter,r=this._isMessageNameValid.bind(this),o=this,a=function(e){function n(e,i,r){g(this,n);var a=m(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,i,r));return a.listeners={},a.onceListeners={},a.TAG=t,a._context=o,a}return _(n,e),Et(n,[{key:"on",value:function(e,n){return r(e),this.listeners[e]?this.listeners[e].push(n):this.listeners[e]=[n],i.on(e+"__TO__"+t,n),i.on(e,n)}},{key:"before",value:function(t,e){r(t),o._hooks[t]?o._hooks[t].push(e):o._hooks[t]=[e]}},{key:"once",value:function(e,n){return r(e),this.onceListeners[e]?this.onceListeners[e].push(n):this.onceListeners[e]=[n],i.once(e+"__TO__"+t,n),i.once(e,n)}},{key:"emit",value:function(t){r(t);var e=o._hooks?o._hooks[t]:null;if(e)for(var n=0,a=e.length;n<a;n++)(0,e[n])();for(var s=arguments.length,u=Array(s>1?s-1:0),c=1;c<s;c++)u[c-1]=arguments[c];return i.emit.apply(i,[t].concat(u))}},{key:"emitTo",value:function(t,e){r(e);for(var n=arguments.length,o=Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];return i.emit.apply(i,[e+"__TO__"+t].concat(o))}},{key:"off",value:function(t,e){return r(t),i.off(t,e)}},{key:"removeListeners",value:function(){var e=Object.prototype.hasOwnProperty.bind(this.listeners);for(var n in this.listeners)if(e(n))for(var r=this.listeners[n]||[],o=0;o<r.length;o++){var a=r[o];i.off(n,a),i.off(n+"__TO__"+t,a)}for(var s in this.onceListeners)if(e(s))for(var u=this.onceListeners[s]||[],c=0;c<u.length;c++){var l=u[c];i.off(s,l),i.off(s+"__TO__"+t,l)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete o._instanceMap[t],bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this))return bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(e);return this._clsMap[t]=a,function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return n.initInstance.apply(n,[t].concat(i))}}},{key:"seek",value:function(t){this._emitter.emit(yt.PLAYER_EVENTS.SEEK,t)}},{key:"destroyInstances",value:function(){var t=this;Object.keys(this._instanceMap).forEach(function(e){t._instanceMap[e].destroy&&t._instanceMap[e].destroy()})}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}},{key:"_isMessageNameValid",value:function(t){if(!this.allowedEvents.indexOf(t)<0)throw new Error("unregistered message name: "+t)}}]),t}(),kt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Tt=function(){function t(e){b(this,t),this.TAG="Golomb",this._buffer=e,this._bufferIndex=0,this._totalBytes=e.byteLength,this._totalBits=8*e.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return kt(t,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),n=new Uint8Array(4);n.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(n.buffer).getUint32(0),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}},{key:"readBits",value:function(t){var e=Math.min(this._currentWordBitsLeft,t),n=this._currentWord>>>32-e;if(t>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=e,this._currentWordBitsLeft>0?this._currentWord<<=e:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),e=t-e,e>0&&this._currentWordBitsLeft?n<<e|this.readBits(e):n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var t=void 0;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}},{key:"readUEG",value:function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}]),t}(),At=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ct=function(){function t(){E(this,t)}return At(t,null,[{key:"_ebsp2rbsp",value:function(t){for(var e=t,n=e.byteLength,i=new Uint8Array(n),r=0,o=0;o<n;o++)o>=2&&3===e[o]&&0===e[o-1]&&0===e[o-2]||(i[r]=e[o],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(e){var n=t._ebsp2rbsp(e),i=new Tt(n);i.readByte();var r=i.readByte();i.readByte();var o=i.readByte();i.readUEG();var a=t.getProfileString(r),s=t.getLevelString(o),u=1,c=420,l=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(c=l[u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)i.readBool()&&(d<6?t._skipScalingList(i,16):t._skipScalingList(i,64));i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();for(var y=i.readUEG(),v=0;v<y;v++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),_=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var b=0,E=0,w=0,k=0;i.readBool()&&(b=i.readUEG(),E=i.readUEG(),w=i.readUEG(),k=i.readUEG());var T=1,A=1,C=0,D=!0,x=0,O=0;if(i.readBool()){if(i.readBool()){var S=i.readByte(),R=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],L=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];S>0&&S<16?(T=R[S-1],A=L[S-1]):255===S&&(T=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var P=i.readBits(32),M=i.readBits(32);D=i.readBool(),C=(x=M)/(O=2*P)}}var I=1;1===T&&1===A||(I=T/A);var B=0,N=0;0===u?(B=1,N=2-g):(B=3===u?1:2,N=(1===u?2:1)*(2-g));var U=16*(m+1),j=16*(_+1)*(2-g);U-=(b+E)*B,j-=(w+k)*N;var F=Math.ceil(U*I);return i.destroy(),i=null,{profile_string:a,level_string:s,bit_depth:h,chroma_format:c,chroma_format_string:t.getChromaFormatString(c),frame_rate:{fixed:D,fps:C,fps_den:O,fps_num:x},par_ratio:{width:T,height:A},codec_size:{width:U,height:j},present_size:{width:F,height:j}}}},{key:"_skipScalingList",value:function(t,e){for(var n=8,i=8,r=0;r<e;r++)0!==i&&(i=(n+t.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(t){var e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},e.frameRate=t.frame_rate;var n=e.frameRate.fps_den,i=e.frameRate.fps_num;return e.refSampleDuration=Math.floor(e.timescale*(n/i)),e}}]),t}(),Dt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),xt=function(){function t(){w(this,t)}return Dt(t,null,[{key:"EBSP2RBSP",value:function(t){return t.filter(function(e,n){return n<2||!(0===t[n-2]&&0===t[n-1]&&3===e)})}},{key:"EBSP2SODB",value:function(t){var e=t[t.byteLength-1];return e&&128===e?t.slice(0,t.byteLength-1):t}}]),t}(),Ot=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),St=function(t){for(var e="",n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return e},Rt=function(){function t(){k(this,t)}return Ot(t,null,[{key:"_resolveNalu",value:function(t){return t.length>=1?xt.EBSP2SODB(xt.EBSP2RBSP(t.slice(1))):null}},{key:"parse",value:function(e){var n=t._resolveNalu(e),i=t.switchPayloadType(n),r=i.payloadType,o=i.offset,a=n.slice(o);switch(r){case 5:return t.user_data_unregistered(a);default:return{code:r,content:a}}}},{key:"switchPayloadType",value:function(t){for(var e=new DataView(t.buffer),n=0,i=0;255===e.getUint8(i);)i++,n+=255;return n+=e.getUint8(i++),{payloadType:n,offset:i}}},{key:"getPayloadLength",value:function(t){for(var e=new DataView(t.buffer),n=0,i=0;255===e.getUint8(i);)i++,n+=255;return n+=e.getUint8(i++),{payloadLength:n,offset:i}}},{key:"user_data_unregistered",value:function(e){var n=t.getPayloadLength(e),i=n.payloadLength,r=n.offset;if(i<16)return{uuid:"",content:null};var o=e.slice(r);return{code:5,uuid:St(o.slice(0,16)),content:St(o.slice(16,i))}}}]),t}(),Lt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Pt=function(){function t(){T(this,t)}return Lt(t,null,[{key:"getNalunits",value:function(e){if(e.length-e.position<4)return[];var n=e.dataview,i=e.position;return 1===n.getInt32(i)||0===n.getInt16(i)&&1===n.getInt8(i+2)?t.getAnnexbNals(e):t.getAvccNals(e)}},{key:"getAnnexbNals",value:function(e){for(var n=[],i=t.getHeaderPositionAnnexB(e),r=i.pos,o=r;r<e.length-4;){var a=e.buffer.slice(r,r+i.headerLength);i.pos===e.position&&e.skip(i.headerLength),o=(i=t.getHeaderPositionAnnexB(e)).pos;var s={header:a,body:new Uint8Array(e.buffer.slice(r+a.byteLength,o))};t.analyseNal(s),s.type<=9&&0!==s.type&&n.push(s),e.skip(o-e.position),r=o}return n}},{key:"getAvccNals",value:function(e){for(var n=[];e.position<e.length-4;){var i=e.dataview.getInt32(e.dataview.position);if(!(e.length-e.position>=i))break;var r=e.buffer.slice(e.position,e.position+4);e.skip(4);var o=new Uint8Array(e.buffer.slice(e.position,e.position+i));e.skip(i);var a={header:r,body:o};t.analyseNal(a),a.type<=9&&0!==a.type&&n.push(a)}return n}},{key:"analyseNal",value:function(t){var e=31&t.body[0];switch(t.type=e,e){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:t.sei=Rt.parse(t.body);break;case 7:t.sps=Ct.parseSPS(t.body);break;case 8:t.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(t){for(var e=t.position,n=0,i=t.length;3!==n&&4!==n&&e<i-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?n=4:1===t.dataview.getInt8(e+2)?n=3:e++:e++;return e===i-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(n=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?n=3:e=i)),{pos:e,headerLength:n}}},{key:"getAvcc",value:function(t,e){var n=new Uint8Array(t.byteLength+e.byteLength+11);n[0]=1,n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=255,n[5]=225;var i=6;return n.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),i),i+=2,n.set(t,i),i+=t.byteLength,n[i]=1,i++,n.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),i),i+=2,n.set(e,i),n}}]),t}(),Mt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),It=function(){function t(e){if(A(this,t),!(e instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0}return Mt(t,[{key:"back",value:function(t){this.position-=t}},{key:"skip",value:function(e){for(var n=Math.floor(e/4),i=e%4,r=0;r<n;r++)t.readByte(this.dataview,4);i>0&&t.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return t.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return t.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return t.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return t.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return t.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return t.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return t.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return t.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(t){this.dataview.position=t},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(t,e,n){var i=void 0;switch(e){case 1:i=n?t.getInt8(t.position):t.getUint8(t.position);break;case 2:i=n?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(n)throw new Error("not supported for readByte 3");i=t.getUint8(t.position)<<16,i|=t.getUint8(t.position+1)<<8,i|=t.getUint8(t.position+2);break;case 4:i=n?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(n)throw new Error("not supported for readBody 8");i=t.getUint32(t.position)<<32,i|=t.getUint32(t.position+4);break;default:i=""}return t.position+=e,i}}]),t}(),Bt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Nt=(function(){function t(e){C(this,t);var n={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return e?Object.assign({},n,e):n}Bt(t,[{key:"destroy",value:function(){this.init=null}}])}(),function(){function t(e){C(this,t);var n={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return e?Object.assign({},n,e):n}return Bt(t,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),t}()),Ut=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),jt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D(this,t),this._player=e.player,this.videoMeta=new Nt,this.videoTrack={samples:[]},this.fps=e.fps||30,this.currentSampleIdx=0,this.duration=0}return Ut(t,[{key:"init",value:function(){this.initEvents()}},{key:"initEvents",value:function(){this.on(yt.LOADER_EVENTS.LOADER_DATALOADED,this.handleDataLoaded.bind(this))}},{key:"load",value:function(t){this.emit(yt.LOADER_EVENTS.LADER_START,t)}},{key:"handleDataLoaded",value:function(){var t=this,e=this.buffer,n=e.shift(e.length);e.clear();var i=new It(n.buffer),r=Pt.getNalunits(i),o=r.pop(),a=new Uint8Array(o.body.byteLength+4);a.set(new Uint8Array(o.header),0),a.set(new Uint8Array(o.body),4),e.push(a);var s=void 0,u=void 0;r.forEach(function(e){var n=Math.floor(1e3*t.currentSampleIdx++/t.fps),i={dts:n,pts:n,data:null,isKeyframe:!1};e.sps?(s=!0,t.videoMeta.sps=e.body,t.videoMeta.presentHeight=e.sps.present_size.height,t.videoMeta.presentWidth=e.sps.present_size.width):e.pps&&(u=!0,t.videoMeta.pps=e.body);var r=new Uint8Array(e.body.byteLength+4);r.set([0,0,0,1],0),r.set(e.body,4),i.data=r,i.isKeyframe=e.idr,t.videoTrack.samples.push(i)}),s&&u&&!this.videoMetaInited&&(this._player.video.setVideoMeta(this.videoMeta),this.videoMetaInited=!0),this.intervalId||(this.intervalId=setInterval(function(){t.videoTrack.samples.length?t._player.video.onDemuxComplete(t.videoTrack):clearInterval(t.intervalId)},500)),this.duration=Math.round(Math.floor(this.currentSampleIdx/this.fps)),this._player.emit("durationchange")}},{key:"destroy",value:function(){this._player=null,this.videoMeta=null,this.videoTrack={samples:[]},this.fps=null,this.currentSampleIdx=null}},{key:"buffer",get:function(){return this._context.getInstance("LOADER_BUFFER")}}]),t}(),Ft=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Gt=function(){function t(e){x(this,t),this.length=e||0,this.historyLen=e||0,this.array=[],this.offset=0}return Ft(t,[{key:"push",value:function(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}},{key:"shift",value:function(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){var e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){var n=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,n}for(var i=new Uint8Array(t),r=0;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){var o=this.array[0].slice(this.offset,this.offset+t);i.set(o,r),this.offset+=t,this.length-=t,t=0;break}var a=this.array[0].length-this.offset;i.set(this.array[0].slice(this.offset,this.array[0].length),r),this.array.shift(),this.offset=0,r+=a,this.length-=a,t-=a}return i}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(t,e){for(var n=0,i=this.offset+t;i<this.offset+e+t;)i<this.array[0].length?n=256*n+this.array[0][i]:this.array[1]&&(n=256*n+this.array[1][i-this.array[0].length]),i++;return n}}]),t}(),Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht="function"==typeof Symbol&&"symbol"===Vt(Symbol.iterator)?function(t){return void 0===t?"undefined":Vt(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":Vt(t)},Wt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Xt=yt.LOADER_EVENTS,Yt=function(){function t(e){O(this,t),this.configs=Object.assign({},e),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}return Wt(t,[{key:"init",value:function(){this.on(Xt.LADER_START,this.load.bind(this))}},{key:"load",value:function(t,e){var n=this;this.url=t,this._canceled=!1;var i=this.getParams(e);return this.loading=!0,fetch(this.url,i).then(function(t){if(t.ok)return n.status=t.status,Promise.resolve().then(function(){n._onFetchResponse(t)}),Promise.resolve(t);n.loading=!1,n.emit(Xt.LOADER_ERROR,n.TAG,new Error(t.status+" ("+t.statusText+")"))}).catch(function(t){throw n.loading=!1,n.emit(Xt.LOADER_ERROR,n.TAG,t),t})}},{key:"_onFetchResponse",value:function(t){var e=this,n=this._context.getInstance(this.buffer),i=++this._loaderTaskNo;if(!0===t.ok)switch(this.readtype){case 2:t.json().then(function(t){e.loading=!1,e._canceled||e._destroyed||(n?(n.push(t),e.emit(Xt.LOADER_COMPLETE,n)):e.emit(Xt.LOADER_COMPLETE,t))});break;case 1:t.text().then(function(t){e.loading=!1,e._canceled||e._destroyed||(n?(n.push(t),e.emit(Xt.LOADER_COMPLETE,n)):e.emit(Xt.LOADER_COMPLETE,t))});break;case 3:t.arrayBuffer().then(function(t){e.loading=!1,e._canceled||e._destroyed||(n?(n.push(new Uint8Array(t)),e.emit(Xt.LOADER_COMPLETE,n)):e.emit(Xt.LOADER_COMPLETE,t))});break;case 0:default:return this._onReader(t.body.getReader(),i)}}},{key:"_onReader",value:function(t,e){var n=this,i=this._context.getInstance(this.buffer);if(!i&&this._reader||this._destroyed)try{this._reader.cancel()}catch(t){}this._reader=t,!1!==this.loading&&this._reader&&this._reader.read().then(function(r){if(!n._canceled&&!n._destroyed)return r.done?(n.loading=!1,n.status=0,void Promise.resolve().then(function(){n.emit(Xt.LOADER_COMPLETE,i)})):(i.push(r.value),Promise.resolve().then(function(){n.emit(Xt.LOADER_DATALOADED,i)}),n._onReader(t,e));if(n._reader)try{n._reader.cancel()}catch(t){}}).catch(function(t){throw n.loading=!1,n.emit(Xt.LOADER_ERROR,n.TAG,t),t})}},{key:"getParams",value:function(t){var e=Object.assign({},t),n=new Headers,i={method:"GET",headers:n,mode:"cors",cache:"default"};if("object"===Ht(this.configs.headers)){var r=this.configs.headers;for(var o in r)r.hasOwnProperty(o)&&n.append(o,r[o])}if("object"===Ht(e.headers)){var a=e.headers;for(var s in a)a.hasOwnProperty(s)&&n.append(s,a[s])}return!1===e.cors&&(i.mode="same-origin"),e.withCredentials&&(i.credentials="include"),i}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(t){}this._reader=null,this.loading=!1}this._canceled=!0}},{key:"destroy",value:function(){this._destroyed=!0,this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),t}();(function(){function t(t){var e=dt.has(t);return t=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t),!e&&t}function e(t){var e=t.isConnected;if(void 0!==e)return e;if(pt(t))return!0;for(;t&&!(t.__CE_isImportDocument||t instanceof Document);)t=t.parentNode||(window.ShadowRoot&&t instanceof ShadowRoot?t.host:void 0);return!(!t||!(t.__CE_isImportDocument||t instanceof Document))}function n(t){var e=t.children;if(e)return Array.prototype.slice.call(e);for(e=[],t=t.firstChild;t;t=t.nextSibling)t.nodeType===Node.ELEMENT_NODE&&e.push(t);return e}function i(t,e){for(;e&&e!==t&&!e.nextSibling;)e=e.parentNode;return e&&e!==t?e.nextSibling:null}function r(t,e,n){for(var o=t;o;){if(o.nodeType===Node.ELEMENT_NODE){var a=o;e(a);var s=a.localName;if("link"===s&&"import"===a.getAttribute("rel")){if(o=a.import,void 0===n&&(n=new Set),o instanceof Node&&!n.has(o))for(n.add(o),o=o.firstChild;o;o=o.nextSibling)r(o,e,n);o=i(t,a);continue}if("template"===s){o=i(t,a);continue}if(a=a.__CE_shadowRoot)for(a=a.firstChild;a;a=a.nextSibling)r(a,e,n)}o=o.firstChild?o.firstChild:i(t,o)}}function o(t,e,n){t[e]=n}function a(t){var e=document;this.c=t,this.a=e,this.b=void 0,k(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function s(t){t.b&&t.b.disconnect()}function u(){var t=this;this.b=this.a=void 0,this.c=new Promise(function(e){t.b=e,t.a&&e(t.a)})}function c(t){if(t.a)throw Error("Already resolved.");t.a=void 0,t.b&&t.b(void 0)}function l(t){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=t,this.j=new Map,this.c=function(t){return t()},this.a=!1,this.h=[],this.m=t.f?new a(t):void 0}function h(e,n){if(!t(n))throw new SyntaxError("The element name '"+n+"' is not valid.");if(p(e,n))throw Error("A custom element with name '"+n+"' has already been defined.");if(e.i)throw Error("A custom element is already being defined.")}function f(t,e,n){t.i=!0;var i;try{var r=function(t){var e=o[t];if(void 0!==e&&!(e instanceof Function))throw Error("The '"+t+"' callback must be a function.");return e},o=n.prototype;if(!(o instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var a=r("connectedCallback"),s=r("disconnectedCallback"),u=r("adoptedCallback"),c=(i=r("attributeChangedCallback"))&&n.observedAttributes||[]}catch(t){throw t}finally{t.i=!1}return n={localName:e,constructorFunction:n,connectedCallback:a,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:i,observedAttributes:c,constructionStack:[]},t.g.set(e,n),t.l.set(n.constructorFunction,n),n}function d(t){if(!1!==t.a){t.a=!1;for(var e=[],n=t.h,i=new Map,r=0;r<n.length;r++)i.set(n[r],[]);for(k(t.b,document,{upgrade:function(n){if(void 0===n.__CE_state){var r=n.localName,o=i.get(r);o?o.push(n):t.g.has(r)&&e.push(n)}}}),r=0;r<e.length;r++)T(t.b,e[r]);for(r=0;r<n.length;r++){for(var o=n[r],a=i.get(o),s=0;s<a.length;s++)T(t.b,a[s]);(o=t.j.get(o))&&c(o)}n.length=0}}function p(t,e){var n=t.g.get(e);if(n)return n;if(n=t.f.get(e)){t.f.delete(e);try{return f(t,e,n())}catch(t){C(t)}}}function y(){var t=vt&&vt.noDocumentConstructionObserver,e=vt&&vt.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=e,this.f=!t}function v(t,e,n,i){var o=window.ShadyDOM;if(t.shadyDomFastWalk&&o&&o.inUse){if(e.nodeType===Node.ELEMENT_NODE&&n(e),e.querySelectorAll)for(t=o.nativeMethods.querySelectorAll.call(e,"*"),e=0;e<t.length;e++)n(t[e])}else r(e,n,i)}function m(t,e){t.a=!0,t.b.push(e)}function _(t,e){t.a=!0,t.c.push(e)}function g(t,e){t.a&&v(t,e,function(e){return b(t,e)})}function b(t,e){if(t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var n=0;n<t.b.length;n++)t.b[n](e);for(n=0;n<t.c.length;n++)t.c[n](e)}}function E(t,e){var n=[];for(v(t,e,function(t){return n.push(t)}),e=0;e<n.length;e++){var i=n[e];1===i.__CE_state?t.connectedCallback(i):T(t,i)}}function w(t,e){var n=[];for(v(t,e,function(t){return n.push(t)}),e=0;e<n.length;e++){var i=n[e];1===i.__CE_state&&t.disconnectedCallback(i)}}function k(t,e,n){var i=(n=void 0===n?{}:n).s,r=n.upgrade||function(e){return T(t,e)},o=[];for(v(t,e,function(e){if(t.a&&b(t,e),"link"===e.localName&&"import"===e.getAttribute("rel")){var n=e.import;n instanceof Node&&(n.__CE_isImportDocument=!0,n.__CE_registry=document.__CE_registry),n&&"complete"===n.readyState?n.__CE_documentLoadHandled=!0:e.addEventListener("load",function(){var n=e.import;if(!n.__CE_documentLoadHandled){n.__CE_documentLoadHandled=!0;var o=new Set;i&&(i.forEach(function(t){return o.add(t)}),o.delete(n)),k(t,n,{s:o,upgrade:r})}})}else o.push(e)},i),e=0;e<o.length;e++)r(o[e])}function T(t,n){try{var i=n.ownerDocument,r=i.__CE_registry,o=r&&(i.defaultView||i.__CE_isImportDocument)?p(r,n.localName):void 0;if(o&&void 0===n.__CE_state){o.constructionStack.push(n);try{try{if(new o.constructorFunction!==n)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{o.constructionStack.pop()}}catch(t){throw n.__CE_state=2,t}if(n.__CE_state=1,n.__CE_definition=o,o.attributeChangedCallback&&n.hasAttributes()){var a=o.observedAttributes;for(o=0;o<a.length;o++){var s=a[o],u=n.getAttribute(s);null!==u&&t.attributeChangedCallback(n,s,null,u,null)}}e(n)&&t.connectedCallback(n)}}catch(t){C(t)}}function A(t,e,n,i){var r=e.__CE_registry;if(r&&(null===i||"http://www.w3.org/1999/xhtml"===i)&&(r=p(r,n)))try{var o=new r.constructorFunction;if(void 0===o.__CE_state||void 0===o.__CE_definition)throw Error("Failed to construct '"+n+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==o.namespaceURI)throw Error("Failed to construct '"+n+"': The constructed element's namespace must be the HTML namespace.");if(o.hasAttributes())throw Error("Failed to construct '"+n+"': The constructed element must not have any attributes.");if(null!==o.firstChild)throw Error("Failed to construct '"+n+"': The constructed element must not have any children.");if(null!==o.parentNode)throw Error("Failed to construct '"+n+"': The constructed element must not have a parent node.");if(o.ownerDocument!==e)throw Error("Failed to construct '"+n+"': The constructed element's owner document is incorrect.");if(o.localName!==n)throw Error("Failed to construct '"+n+"': The constructed element's local name is incorrect.");return o}catch(r){return C(r),e=null===i?M.call(e,n):I.call(e,i,n),Object.setPrototypeOf(e,HTMLUnknownElement.prototype),e.__CE_state=2,e.__CE_definition=void 0,b(t,e),e}return e=null===i?M.call(e,n):I.call(e,i,n),b(t,e),e}function C(t){var e=t.message,n=t.sourceURL||t.fileName||"",i=t.line||t.lineNumber||0,r=t.column||t.columnNumber||0,o=void 0;void 0===ErrorEvent.prototype.initErrorEvent?o=new ErrorEvent("error",{cancelable:!0,message:e,filename:n,lineno:i,colno:r,error:t}):((o=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,e,n,i),o.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===o.error&&Object.defineProperty(o,"error",{configurable:!0,enumerable:!0,get:function(){return t}}),window.dispatchEvent(o),o.defaultPrevented||console.error(t)}function D(t){window.HTMLElement=function(){function e(){var e=this.constructor,n=document.__CE_registry.l.get(e);if(!n)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var i=n.constructionStack;if(0===i.length)return i=M.call(document,n.localName),Object.setPrototypeOf(i,e.prototype),i.__CE_state=1,i.__CE_definition=n,b(t,i),i;var r=i.length-1,o=i[r];if(o===yt)throw Error("Failed to construct '"+n.localName+"': This element was already constructed.");return i[r]=yt,Object.setPrototypeOf(o,e.prototype),b(t,o),o}return e.prototype=ct.prototype,Object.defineProperty(e.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:e}),e}()}function x(t,n,i){function r(n){return function(i){for(var r=[],o=0;o<arguments.length;++o)r[o]=arguments[o];o=[];for(var a=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(n.apply(this,r),r=0;r<a.length;r++)w(t,a[r]);if(e(this))for(r=0;r<o.length;r++)(a=o[r])instanceof Element&&E(t,a)}}void 0!==i.prepend&&o(n,"prepend",r(i.prepend)),void 0!==i.append&&o(n,"append",r(i.append))}function O(t){o(Document.prototype,"createElement",function(e){return A(t,this,e,null)}),o(Document.prototype,"importNode",function(e,n){return e=B.call(this,e,!!n),this.__CE_registry?k(t,e):g(t,e),e}),o(Document.prototype,"createElementNS",function(e,n){return A(t,this,n,e)}),x(t,Document.prototype,{prepend:N,append:U})}function S(t){function i(n,i){Object.defineProperty(n,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,n);else{var r=void 0;if(this.firstChild){var o=this.childNodes,a=o.length;if(0<a&&e(this)){r=Array(a);for(var s=0;s<a;s++)r[s]=o[s]}}if(i.set.call(this,n),r)for(n=0;n<r.length;n++)w(t,r[n])}}})}o(Node.prototype,"insertBefore",function(i,r){if(i instanceof DocumentFragment){var o=n(i);if(i=H.call(this,i,r),e(this))for(r=0;r<o.length;r++)E(t,o[r]);return i}return o=i instanceof Element&&e(i),r=H.call(this,i,r),o&&w(t,i),e(this)&&E(t,i),r}),o(Node.prototype,"appendChild",function(i){if(i instanceof DocumentFragment){var r=n(i);if(i=V.call(this,i),e(this))for(var o=0;o<r.length;o++)E(t,r[o]);return i}return r=i instanceof Element&&e(i),o=V.call(this,i),r&&w(t,i),e(this)&&E(t,i),o}),o(Node.prototype,"cloneNode",function(e){return e=G.call(this,!!e),this.ownerDocument.__CE_registry?k(t,e):g(t,e),e}),o(Node.prototype,"removeChild",function(n){var i=n instanceof Element&&e(n),r=W.call(this,n);return i&&w(t,n),r}),o(Node.prototype,"replaceChild",function(i,r){if(i instanceof DocumentFragment){var o=n(i);if(i=X.call(this,i,r),e(this))for(w(t,r),r=0;r<o.length;r++)E(t,o[r]);return i}o=i instanceof Element&&e(i);var a=X.call(this,i,r),s=e(this);return s&&w(t,r),o&&w(t,i),s&&E(t,i),a}),Y&&Y.get?i(Node.prototype,Y):m(t,function(t){i(t,{enumerable:!0,configurable:!0,get:function(){for(var t=[],e=this.firstChild;e;e=e.nextSibling)e.nodeType!==Node.COMMENT_NODE&&t.push(e.textContent);return t.join("")},set:function(t){for(;this.firstChild;)W.call(this,this.firstChild);null!=t&&""!==t&&V.call(this,document.createTextNode(t))}})})}function R(t){function n(n){return function(i){for(var r=[],o=0;o<arguments.length;++o)r[o]=arguments[o];o=[];for(var a=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(n.apply(this,r),r=0;r<a.length;r++)w(t,a[r]);if(e(this))for(r=0;r<o.length;r++)(a=o[r])instanceof Element&&E(t,a)}}var i=Element.prototype;void 0!==ot&&o(i,"before",n(ot)),void 0!==at&&o(i,"after",n(at)),void 0!==st&&o(i,"replaceWith",function(n){for(var i=[],r=0;r<arguments.length;++r)i[r]=arguments[r];r=[];for(var o=[],a=0;a<i.length;a++){var s=i[a];if(s instanceof Element&&e(s)&&o.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(a=e(this),st.apply(this,i),i=0;i<o.length;i++)w(t,o[i]);if(a)for(w(t,this),i=0;i<r.length;i++)(o=r[i])instanceof Element&&E(t,o)}),void 0!==ut&&o(i,"remove",function(){var n=e(this);ut.call(this),n&&w(t,this)})}function L(t){function n(n,i){Object.defineProperty(n,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){var r=this,o=void 0;if(e(this)&&(o=[],v(t,this,function(t){t!==r&&o.push(t)})),i.set.call(this,n),o)for(var a=0;a<o.length;a++){var s=o[a];1===s.__CE_state&&t.disconnectedCallback(s)}return this.ownerDocument.__CE_registry?k(t,this):g(t,this),n}})}function i(n,i){o(n,"insertAdjacentElement",function(n,r){var o=e(r);return n=i.call(this,n,r),o&&w(t,r),e(n)&&E(t,r),n})}function r(e,n){function i(e,n){for(var i=[];e!==n;e=e.nextSibling)i.push(e);for(n=0;n<i.length;n++)k(t,i[n])}o(e,"insertAdjacentHTML",function(t,e){if("beforebegin"===(t=t.toLowerCase())){var r=this.previousSibling;n.call(this,t,e),i(r||this.parentNode.firstChild,this)}else if("afterbegin"===t)r=this.firstChild,n.call(this,t,e),i(this.firstChild,r);else if("beforeend"===t)r=this.lastChild,n.call(this,t,e),i(r||this.firstChild,null);else{if("afterend"!==t)throw new SyntaxError("The value provided ("+String(t)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,n.call(this,t,e),i(this.nextSibling,r)}})}z&&o(Element.prototype,"attachShadow",function(e){if(e=z.call(this,e),t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var n=0;n<t.b.length;n++)t.b[n](e)}return this.__CE_shadowRoot=e}),K&&K.get?n(Element.prototype,K):lt&&lt.get?n(HTMLElement.prototype,lt):_(t,function(t){n(t,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(t){var e="template"===this.localName,n=e?this.content:this,i=I.call(document,this.namespaceURI,this.localName);for(i.innerHTML=t;0<n.childNodes.length;)W.call(n,n.childNodes[0]);for(t=e?i.content:i;0<t.childNodes.length;)V.call(n,t.childNodes[0])}})}),o(Element.prototype,"setAttribute",function(e,n){if(1!==this.__CE_state)return Z.call(this,e,n);var i=q.call(this,e);Z.call(this,e,n),n=q.call(this,e),t.attributeChangedCallback(this,e,i,n,null)}),o(Element.prototype,"setAttributeNS",function(e,n,i){if(1!==this.__CE_state)return Q.call(this,e,n,i);var r=J.call(this,e,n);Q.call(this,e,n,i),i=J.call(this,e,n),t.attributeChangedCallback(this,n,r,i,e)}),o(Element.prototype,"removeAttribute",function(e){if(1!==this.__CE_state)return $.call(this,e);var n=q.call(this,e);$.call(this,e),null!==n&&t.attributeChangedCallback(this,e,n,null,null)}),o(Element.prototype,"removeAttributeNS",function(e,n){if(1!==this.__CE_state)return tt.call(this,e,n);var i=J.call(this,e,n);tt.call(this,e,n);var r=J.call(this,e,n);i!==r&&t.attributeChangedCallback(this,n,i,r,e)}),ht?i(HTMLElement.prototype,ht):et&&i(Element.prototype,et),ft?r(HTMLElement.prototype,ft):nt&&r(Element.prototype,nt),x(t,Element.prototype,{prepend:it,append:rt}),R(t)}function P(){var t=new y;D(t),O(t),x(t,DocumentFragment.prototype,{prepend:j,append:F}),S(t),L(t),t=new l(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}var M=window.Document.prototype.createElement,I=window.Document.prototype.createElementNS,B=window.Document.prototype.importNode,N=window.Document.prototype.prepend,U=window.Document.prototype.append,j=window.DocumentFragment.prototype.prepend,F=window.DocumentFragment.prototype.append,G=window.Node.prototype.cloneNode,V=window.Node.prototype.appendChild,H=window.Node.prototype.insertBefore,W=window.Node.prototype.removeChild,X=window.Node.prototype.replaceChild,Y=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),z=window.Element.prototype.attachShadow,K=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),q=window.Element.prototype.getAttribute,Z=window.Element.prototype.setAttribute,$=window.Element.prototype.removeAttribute,J=window.Element.prototype.getAttributeNS,Q=window.Element.prototype.setAttributeNS,tt=window.Element.prototype.removeAttributeNS,et=window.Element.prototype.insertAdjacentElement,nt=window.Element.prototype.insertAdjacentHTML,it=window.Element.prototype.prepend,rt=window.Element.prototype.append,ot=window.Element.prototype.before,at=window.Element.prototype.after,st=window.Element.prototype.replaceWith,ut=window.Element.prototype.remove,ct=window.HTMLElement,lt=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),ht=window.HTMLElement.prototype.insertAdjacentElement,ft=window.HTMLElement.prototype.insertAdjacentHTML,dt=new Set;"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach(function(t){return dt.add(t)});var pt=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);a.prototype.f=function(t){var e=this.a.readyState;for("interactive"!==e&&"complete"!==e||s(this),e=0;e<t.length;e++)for(var n=t[e].addedNodes,i=0;i<n.length;i++)k(this.c,n[i])},l.prototype.o=function(t,e){var n=this;if(!(e instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");h(this,t),this.f.set(t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return d(n)}))},l.prototype.define=function(t,e){var n=this;if(!(e instanceof Function))throw new TypeError("Custom element constructors must be functions.");h(this,t),f(this,t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return d(n)}))},l.prototype.upgrade=function(t){k(this.b,t)},l.prototype.get=function(t){if(t=p(this,t))return t.constructorFunction},l.prototype.whenDefined=function(e){if(!t(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var n=this.j.get(e);if(n)return n.c;n=new u,this.j.set(e,n);var i=this.g.has(e)||this.f.has(e);return e=-1===this.h.indexOf(e),i&&e&&c(n),n.c},l.prototype.polyfillWrapFlushCallback=function(t){this.m&&s(this.m);var e=this.c;this.c=function(n){return t(function(){return e(n)})}},window.CustomElementRegistry=l,l.prototype.define=l.prototype.define,l.prototype.upgrade=l.prototype.upgrade,l.prototype.get=l.prototype.get,l.prototype.whenDefined=l.prototype.whenDefined,l.prototype.polyfillDefineLazy=l.prototype.o,l.prototype.polyfillWrapFlushCallback=l.prototype.polyfillWrapFlushCallback,y.prototype.connectedCallback=function(t){var e=t.__CE_definition;if(e.connectedCallback)try{e.connectedCallback.call(t)}catch(t){C(t)}},y.prototype.disconnectedCallback=function(t){var e=t.__CE_definition;if(e.disconnectedCallback)try{e.disconnectedCallback.call(t)}catch(t){C(t)}},y.prototype.attributeChangedCallback=function(t,e,n,i,r){var o=t.__CE_definition;if(o.attributeChangedCallback&&-1<o.observedAttributes.indexOf(e))try{o.attributeChangedCallback.call(t,e,n,i,r)}catch(t){C(t)}};var yt=new function(){},vt=window.customElements;vt&&!vt.forcePolyfill&&"function"==typeof vt.define&&"function"==typeof vt.get||P(),window.__CE_installPolyfill=P}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var t=HTMLElement,e={HTMLElement:function(){return Reflect.construct(t,[],this.constructor)}};window.HTMLElement=e.HTMLElement,HTMLElement.prototype=t.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,t)}}();var zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},qt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Zt=30,$t=function(){function t(e){L(this,t),this.options=Object.assign({},e||{}),this.options.interval&&P(1e3/this.options.interval)||(this.options.interval=1e3/30),this.callbacks=[]}return qt(t,[{key:"start",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.callbacks=e}},{key:"onTick",value:function(){for(var t=0,e=this.callbacks.length;t<e;t++)(0,this.callbacks[t])()}},{key:"setInterval",value:function(t){return P(1e3/t)||(t=1e3/30),this.options.interval=t,this}}]),t}(),Jt=(function(t){function e(t){L(this,e);var n=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.prev=null,n.timerId=null,n._subTimerId=null,n._tickFunc=e.getTickFunc(),n.tick=n.tick.bind(n),n}R(e,t),qt(e,[{key:"start",value:function(){for(var t,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=Kt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this)).call.apply(t,[this].concat(i)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var t=this._tickFunc;this.timerId=t(this.tick)}},{key:"stop",value:function(){this.timerId&&e.getCancelFunc()(this.timerId)}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==e.getTickFunc()}}])}($t),function(t){function e(t){L(this,e);var n=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.timeoutId=null,n}R(e,t),qt(e,[{key:"start",value:function(){for(var t,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=Kt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this)).call.apply(t,[this].concat(i)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var t=this;this.timeoutId=window.setTimeout(function(){t.stop(),t.tick()},this.options.interval)}},{key:"stop",value:function(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}])}($t),"undefined"==typeof Symbol?"__target":Symbol()),Qt="application/javascript",te=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,ee=window.URL||window.webkitURL,ne=window.Worker;if(ne){var ie,re=I("self.onmessage = function () {}"),oe=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");(ie=new ne(re)).postMessage(oe,[oe.buffer])}catch(t){ne=null}finally{ee.revokeObjectURL(re),ie&&ie.terminate()}}var ae=new M("./worker.js",function(t,e){function n(){(a=new o(this)).init()}function i(t){a||r.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder_1583333072684.js"),addOnPostRun(n.bind(r))}var r=this,o=function(t){this.inited=!1,this.self=t,this.meta=this.self.meta,this.infolist={},t.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),t.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};o.prototype.toU8Array=function(t,e){return this.self.HEAPU8.subarray(t,t+e)},o.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},o.prototype.broadwayOnPictureDecoded=function(t,e,n,i,r,o){var a=Object.assign({},this.infolist[o]),s=n,u=n/2;!this.meta||444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=n);var c=this.toU8Array(t,i*s+r*u*2);this.infolist[o]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;this.self.postMessage({msg:"DECODED",width:e,height:n,yLinesize:i,uvLinesize:r,info:a,buffer:h},[h])},o.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},o.prototype.decode=function(t,e){var n=parseInt((new Date).getTime()),i=n-1e9*Math.floor(n/1e9);this.infolist[i]=e,this.streamBuffer.set(t),Module._broadwayPlayStream(t.length,i)},o.prototype.destroy=function(){Module._broadwayExit()},o.prototype.updateMeta=function(t){this.meta=t};var a;r.addEventListener("message",function(t){var e=t.data;if(e.msg)switch(e.msg){case"init":console.log(e),r.meta=e.meta,i();break;case"updatemeta":r.meta=e.meta,a.updateMeta(e.meta);break;case"decode":a.decode(e.data,e.info);break;case"destory":a.destroy()}else r.postMessage({msg:"ERROR:invalid message"})},!1)}),se=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ue=function(){function t(e){if(B(this,t),!(e instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0}return se(t,[{key:"back",value:function(t){this.position-=t}},{key:"skip",value:function(e){for(var n=Math.floor(e/4),i=e%4,r=0;r<n;r++)t.readByte(this.dataview,4);i>0&&t.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return t.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return t.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return t.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return t.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return t.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return t.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return t.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return t.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(t){this.dataview.position=t},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(t,e,n){var i=void 0;switch(e){case 1:i=n?t.getInt8(t.position):t.getUint8(t.position);break;case 2:i=n?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(n)throw new Error("not supported for readByte 3");i=t.getUint8(t.position)<<16,i|=t.getUint8(t.position+1)<<8,i|=t.getUint8(t.position+2);break;case 4:i=n?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(n)throw new Error("not supported for readBody 8");i=t.getUint32(t.position)<<32,i|=t.getUint32(t.position+4);break;default:i=""}return t.position+=e,i}}]),t}(),ce=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),le=function(){function t(e){N(this,t),this.configs=Object.assign({},e),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this._initMeta(),this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return ce(t,[{key:"_initMeta",value:function(){this.chroma=this.meta.chromaFormat,this.height=this.meta.presentHeight,this.width=this.meta.presentWidth,this.canvas.width=this.meta.presentWidth,this.canvas.height=this.meta.presentHeight}},{key:"_initContextGL",value:function(){for(var t=this.canvas,e=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!e&&i<n.length;){var r=n[i];try{e=this.contextOptions?t.getContext(r,this.contextOptions):t.getContext(r)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++i}this.contextGL=e}},{key:"_initProgram",value:function(){var t,e,n=this.contextGL;t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),e=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var i=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1],r=n.createShader(n.VERTEX_SHADER);n.shaderSource(r,t),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+n.getShaderInfoLog(r));var o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(o,e),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+n.getShaderInfoLog(o));var a=n.createProgram();n.attachShader(a,r),n.attachShader(a,o),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||console.log("Program failed to compile: "+n.getProgramInfoLog(a)),n.useProgram(a);var s=n.getUniformLocation(a,"YUV2RGB");n.uniformMatrix4fv(s,!1,i),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var t=this.contextGL,e=this.shaderProgram,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var i=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var o=t.getAttribLocation(e,"texturePos");t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.texturePosBuffer=r;var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"uTexturePos");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),this.uTexturePosBuffer=a;var u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var c=t.getAttribLocation(e,"vTexturePos");t.enableVertexAttribArray(c),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var t=this.contextGL,e=this.shaderProgram,n=this._initTexture(),i=t.getUniformLocation(e,"ySampler");t.uniform1i(i,0),this.yTextureRef=n;var r=this._initTexture(),o=t.getUniformLocation(e,"uSampler");t.uniform1i(o,1),this.uTextureRef=r;var a=this._initTexture(),s=t.getUniformLocation(e,"vSampler");t.uniform1i(s,2),this.vTextureRef=a}},{key:"_initTexture",value:function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e}},{key:"_drawPictureGL",value:function(t,e,n,i,r){var o=i*n,a=r*n/2;444!==this.chroma&&422!==this.chroma||(a*=2);var s={yData:(t=new Uint8Array(t)).subarray(0,o),uData:t.subarray(o,o+a),vData:t.subarray(o+a,o+a+a)};this._drawPictureGL420(s,e,n,i,r)}},{key:"_drawPictureGL420",value:function(t,e,n,i,r){var o=this.contextGL,a=this.texturePosBuffer,s=this.uTexturePosBuffer,u=this.vTexturePosBuffer,c=this.yTextureRef,l=this.uTextureRef,h=this.vTextureRef,f=t.yData,d=t.uData,p=t.vData,y=i,v=n,m=e/2,_=n/2;422!==this.chroma&&444!==this.chroma||(_=n);var g=r,b=_,E=this.canvas.width/this.width,w=this.canvas.height/this.height,k=0,T=0,A=this.canvas.width,C=this.canvas.height;E<w?(C=this.height*this.canvas.width/this.width,T=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(A=this.width*this.canvas.height/this.height,k=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),o.viewport(k,T,A,C);var D=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferData(o.ARRAY_BUFFER,D,o.DYNAMIC_DRAW);var x=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,x,o.DYNAMIC_DRAW);var O=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,O,o.DYNAMIC_DRAW),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,c),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,y,v,0,o.LUMINANCE,o.UNSIGNED_BYTE,f),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,l),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,m,_,0,o.LUMINANCE,o.UNSIGNED_BYTE,d),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,h),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,g,b,0,o.LUMINANCE,o.UNSIGNED_BYTE,p),o.drawArrays(o.TRIANGLE_STRIP,0,4)}},{key:"_drawPictureRGB",value:function(t){}},{key:"render",value:function(t,e,n,i,r){this.contextGL?this._drawPictureGL(t,e,n,i,r):this._drawPictureRGB(t)}},{key:"resetMeta",value:function(t){this.meta=Object.assign({},t),this._initMeta()}}]),t}(),he=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),fe=function(){function t(e){U(this,t),this.config=Object.assign({},e),this.type=this.config.type,this.reset()}return he(t,[{key:"reset",value:function(){this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}},{key:"push",value:function(t){if("video"===this.type){if(t.isKeyframe){var e={samples:[],start:t.dts,end:t.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=e),this.currentGop=e,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(t),t.dts<this.currentGop.start&&(this.currentGop.start=t.dts),t.dts>this.currentGop.end&&(this.currentGop.end=t.dts))}}},{key:"get",value:function(t){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===t)return this._getNext()}}},{key:"_getNext",value:function(){if(this._lastGet){var t=this._lastGet.gop,e=t.samples[this._lastGet.index+1];if(e)return this._lastGet.index=this._lastGet.index+1,e;if(!(t=t.nextGop)||t.samples.length<1)return;return e=t.samples[0],this._lastGet={gop:t,index:0},e}var n=this.buffer[0];if(!(n.samples.length<1))return this._lastGet={gop:n,index:0},n.samples[0]}},{key:"remove",value:function(t,e){if(!(this.buffer.length<0))for(var n=0,i=this.buffer[0];i;)i.end<e&&i.start>=t?(this.buffer.splice(n,1),i=this.buffer[n]):(n+=1,i=this.buffer[n])}}]),t}(),de=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),pe=function(){function t(e){j(this,t),this.ranges=e||[]}return de(t,[{key:"start",value:function(t){return this.ranges[t]?this.ranges[t].start:0}},{key:"end",value:function(t){return this.ranges[t]?this.ranges[t].end:0}},{key:"add",value:function(t){this.ranges.push(t)}},{key:"length",get:function(){return this.ranges.length}}]),t}(),ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),me={VIDEO_EVENTS:"VIDEO_EVENTS"},_e=function(t){function e(t){F(this,e);var n=G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.config=Object.assign({},t),n.canvas=n.config.canvas?n.config.canvas:document.createElement("canvas"),n.source=new fe({type:"video"}),n.preloadTime=n.config.preloadTime||3,n.onFirstFrame=void 0,n.oncanplay=void 0,n.initParameters(),n.canvas.style.maxWidth="100%",n.canvas.style.maxHeight="100%",n.canvas.style.top=0,n.canvas.style.bottom=0,n.canvas.style.left=0,n.canvas.style.right=0,n.canvas.style.margin="auto",n.canvas.style.position="absolute",n.handleMessage=n.handleMessage.bind(n),n}return V(e,t),ve(e,[{key:"initParameters",value:function(){this.meta=void 0,this.readyStatus=0,this.paused=!0,this.currentTime=0,this._seekState=1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null,this._seekState=1}},{key:"reset",value:function(){this.initParameters(),this.source.reset()}},{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){this.wasmworker=new ae,this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",this.handleMessage)}},{key:"setVideoMetaData",value:function(t){if(this.meta=t,!this._decoderInited)return void this.initWasmWorker();this.wasmworker.postMessage({msg:"updatemeta",meta:this.meta}),this.pushAvcc(t)}},{key:"pushAvcc",value:function(t){this._avccpushed=!0;var e=new Uint8Array(t.sps.byteLength+4);if(e.set([0,0,0,1]),e.set(t.sps,4),this.wasmworker.postMessage({msg:"decode",data:e}),(e=new Uint8Array(t.pps.byteLength+4)).set([0,0,0,1]),e.set(t.pps,4),this.wasmworker.postMessage({msg:"decode",data:e}),this.yuvCanvas)this.yuvCanvas.resetMeta(t);else{var n=Object.assign({meta:t,canvas:this.canvas},this.config);this.yuvCanvas=new le(n)}this.readyStatus=1}},{key:"decodeVideo",value:function(t){if(this._decoderInited){this._avccpushed||this.pushAvcc(this.meta);for(var e=t.samples,n=e.shift();n;)this._baseDts||(this._baseDts=n.dts),this.source.push(n),n=e.shift();this.preload()}}},{key:"preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){var t=this.source.get();for(t&&(this._lastSampleDts=t.dts,this._analyseNal(t));t&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(t=this.source.get())&&(this._analyseNal(t),this._lastSampleDts=t.dts)}}},{key:"_analyseNal",value:function(t){for(var e=Pt.getNalunits(new ue(t.data.buffer)),n=0,i=0;i<e.length;i++)n+=e[i].body.byteLength+4;for(var r=0,o=new Uint8Array(n),a=0;a<e.length;a++){var s=e[a];o.set([0,0,0,1],r),r+=4,o.set(new Uint8Array(s.body),r),r+=s.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:o,info:{dts:t.dts,pts:t.pts?t.pts:t.dts+t.cts,key:t.isKeyframe}})}},{key:"decodeVideoBuffer",value:function(t){if(!this._decoderInited)return void this.initWasmWorker();this.wasmworker.postMessage({msg:"decode",data:t})}},{key:"_onDecoded",value:function(t){var e=t.info.dts;this._decodedFrames[e]=t;var n=Object.keys(this._decodedFrames).length;1==this.readyStatus&&n>0&&(this.readyStatus=2,this.emit(me.VIDEO_EVENTS,"loadeddata")),4==this._seekState&&(this.readyStatus=2,this._seekState=1),n>10?(this.playFinish&&this.playFinish(),2==this.readyStatus&&(this.readyStatus=3,this.emit(me.VIDEO_EVENTS,"canplay")),this.oncanplay&&this.oncanplay(),3==this.readyStatus&&n>2*(this.meta.frameRate.fps||60)&&(this.readyStatus=4,this.emit(me.VIDEO_EVENTS,"canplaythrough"))):this.readyStatus=2}},{key:"play",value:function(){var t=this;return this.paused=!1,new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null})}},{key:"_onTimer",value:function(t){if(this.paused)return!1;if(this.meta){var e=Object.keys(this._decodedFrames);if(e.length>0){this.currentTime=t;for(var n=-1,i=0;i<e.length&&Number.parseInt(e[i])-this._baseDts<=this.currentTime;i++)n=Number.parseInt(e[i-1]);var r=this._decodedFrames[n];return!!r&&(2==this._seekState&&(this._seekState=4,this.emit(me.VIDEO_EVENTS,"seeked")),this.yuvCanvas.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),!0)}}this._lastRenderTime=Date.now()}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1);for(var t=Object.keys(this._decodedFrames),e=0;e<t.length;e++)Number.parseInt(t[e])<this.currentTime&&delete this._decodedFrames[t[e]]}},{key:"destroy",value:function(){this.destroyWorker(),this.canvas=null,this._decodedFrames={},this.source=null,this._decoderInited=!1,this._isSeeking=!1}},{key:"destroyWorker",value:function(){this.wasmworker&&(this.wasmworker.removeEventListener("message",this.handleMessage),this.wasmworker.postMessage({msg:"destroy"})),this.wasmworker=null}},{key:"handleMessage",value:function(t){switch(t.data.msg){case"DECODER_READY":this._decoderInited=!0,this.pushAvcc(this.meta);break;case"DECODED":this._onDecoded(t.data)}}},{key:"setVideoSeeking",value:function(){this._seekState=2,this.emit(me.VIDEO_EVENTS,"seeking")}},{key:"buffered",get:function(){var t=[],e={start:null,end:null},n=Object.keys(this._decodedFrames);return n.length&&(e.start=Number.parseInt(n[0]),e.end=Number.parseInt(n[n.length-1])),null!==e.start&&null!==e.end&&(e.start=(e.start-this._baseDts)/1e3,e.end=(e.end-this._baseDts)/1e3,t.push(e)),new pe(t)}},{key:"videoWidth",get:function(){return this.canvas.width}},{key:"videoHeight",get:function(){return this.canvas.height}},{key:"seeking",get:function(){return 2==this._seekState}},{key:"readyState",get:function(){return this.readyStatus}}]),e}(i),ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},be=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ee=function(t){function e(t){H(this,e);var n=W(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.config=Object.assign({},t);var i=window.AudioContext||window.webkitAudioContext;return n.context=new i,n.gainNode=n.context.createGain(),n.gainNode.connect(n.context.destination),n.meta=void 0,n.samples=[],n.preloadTime=n.config.preloadTime||3,n.duration=0,n._currentBuffer=void 0,n._nextBuffer=void 0,n._lastpts=void 0,n._preDecode=[],n._currentTime=0,n._decoding=!1,n._volume=Number.parseFloat(n.config.volume)===n.config.volume?n.config.volume:.6,n.gainNode.gain.value=n._volume,n._played=!1,n.paused=!0,n.playFinish=null,n.waitNextID=null,n.destroyed=!1,n}return X(e,t),be(e,[{key:"decodeAudio",value:function(t){var e=t.samples,n=t.meta,i=e;t.samples=[],n&&this.setAudioData(i)}},{key:"setAudioData",value:function(t){for(var e=0;e<t.length;e++)t[e].pts=void 0===t[e].pts?t[e].dts:t[e].pts,this._preDecode.push(t[e]);this.preload()}},{key:"preload",value:function(){this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(!this._decoding){this._decoding=!0;for(var t=this._preDecode,n=[],i=this,r=t.shift();r;){var o=e.getAACData(this.meta,r);n.push(o),this._lastpts=r.pts,r=t.shift()}var a=e.combileData(n);try{this.context.decodeAudioData(a.buffer,function(t){var e=i.context.createBufferSource();e.buffer=t,i.samples.push({time:i.duration,duration:t.duration,data:e}),i.duration+=t.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime)),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC(),i.playFinish&&i.playFinish()},function(t){console.error(t)})}catch(t){console.error(t)}}}},{key:"onSourceEnded",value:function(){var t=this;if(!this.destroyed){if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(function(){t.onSourceEnded()},200));var e=this._nextBuffer.data;e.start(),e.connect(this.gainNode);var n=this;setTimeout(function(){n.onSourceEnded.call(t)},1e3*e.buffer.duration-3),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}}},{key:"play",value:function(){var t=this;if(!this.playFinish){this._played=!0,"suspended"===this.context.state&&this.context.resume();var e=this,n=function(){var n=t._currentBuffer.data;n.start(),n.connect(t.gainNode),t.paused=!1,setTimeout(function(){e.onSourceEnded.call(t)},1e3*n.buffer.duration-20)};return this._currentBuffer?(n(),Promise.resolve()):new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null,n()})}}},{key:"pause",value:function(){var t=this.context;"running"===t.state&&t.suspend(),this.paused=!0}},{key:"getTimeBuffer",value:function(t){for(var e=void 0,n=0;n<this.samples.length;n++){var i=this.samples[n];if(i.time<=t&&i.time+i.duration>t){e=i;break}}return e}},{key:"setAudioMetaData",value:function(t){this.meta=t}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this._preDecode=[],this.paused=!0,this.context.close(),this.destroyed=!0}},{key:"mute",value:function(){this.gainNode.gain.value=0}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(t){this.gainNode.gain.value=t?0:this._volume,"suspended"!==this.context.state||this.paused||this.context.resume()}},{key:"volume",get:function(){return"suspended"===this.context.state||this.paused||this.muted?0:this._volume},set:function(t){return t<0?(this._volume=0,void(this.gainNode.gain.value=0)):t>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=t,void(this.gainNode.gain.value=t))}}],[{key:"getAACData",value:function(t,n){var i=new Uint8Array(n.data.byteLength+7),r=e.getAdts(t,n.data);return i.set(r),i.set(n.data,7),i}},{key:"combileData",value:function(t){for(var e=0,n=0,i=t.length;n<i;n++)e+=t[n].byteLength;for(var r=new Uint8Array(e),o=0,a=0,s=t.length;a<s;a++)r.set(t[a],o),o+=t[a].byteLength;return r}},{key:"getAdts",value:function(t,e){var n=new Uint8Array(7);n[0]=255,n[1]=240,n[1]=1|n[1],n[2]=192&t.objectType-1<<6,n[2]=n[2]|60&t.sampleRateIndex<<2,n[2]=n[2]|1&t.channelCount>>2,n[3]=192&t.channelCount<<6;var i=e.byteLength+7;return n[3]=n[3]|3&i>>11,n[4]=255&i>>3,n[5]=224&i<<5,n[5]=31|n[5],n[6]=252,n}}]),e}(i),we=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ke=function(){function t(e){Y(this,t),this.aCtx=e.aCtx,this.vCtx=e.vCtx,this.video=e.video,this.timeoutId=null,this.start=null}return we(t,[{key:"doReconcile",value:function(){var t=this,e=this.vCtx.currentTime||0,n=void 0,i=e-(n=this.video.noAudio?e:1e3*this.aCtx.currentTime||0);this.timeoutId||(i>200?(this.video.start+=i,this.vCtx.pause(),this.timeoutId=setTimeout(function(){t.vCtx.play(),t.timeoutId=null},i)):i<-120&&(this.video.start+=i))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null,this.timeoutId&&clearTimeout(this.timeoutId)}}]),t}(),Te=new M("./tickworker.js",function(t,e){var n,i=this;i.addEventListener("message",function(t){switch(t.data.msg){case"start":clearInterval(n),n=setInterval(function(){i.postMessage("tick")},t.data.interval);break;case"stop":clearInterval(n)}},!1)}),Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),De=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},xe=function(t){function e(t){z(this,e);var n=K(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.timeoutId=null,n.worker=new Te,n.handleMessage=n.handleMessage.bind(n),n.worker.addEventListener("message",n.handleMessage),n}return q(e,t),Ce(e,[{key:"handleMessage",value:function(){this.onTick()}},{key:"start",value:function(){for(var t,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=De(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this)).call.apply(t,[this].concat(i)),this.onTick(),this.worker.postMessage({msg:"start",interval:this.options.interval})}},{key:"stop",value:function(){this.worker.postMessage({msg:"stop"}),this.worker=null}},{key:"setInterval",value:function(t){De(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setInterval",this).call(this,t),this.onTick(),this.worker.postMessage({msg:"start",interval:this.config.interval})}}]),e}($t),Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Re=function(t){function e(){Z(this,e);var t=$(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._canvas=document.createElement("canvas"),t.handleAudioSourceEnd=t.handleAudioSourceEnd.bind(t),t.played=!1,t.pendingPlayTask=null,t._waiting=!1,t._paused=!0,t.videoMetaInited=!1,t.audioMetaInited=!1,t.handleVCtxInnerEvent=t.handleVCtxInnerEvent.bind(t),t._err=null,t.init(),t._lastTimeupdateStamp=0,t._volumeEventStamp=0,t._hasDispatch=!1,t._fps=Zt,t}return J(e,t),Se(e,[{key:"init",value:function(){var t=this;this._destroyed=!1,this.vCtx=new _e(Object.assign({canvas:this._canvas,preloadTime:1/0},{style:{width:this.width,height:this.height}})),this.vCtx.oncanplay=function(){t.played||t.contains(t._canvas)||(t.appendChild(t._canvas),t.autoplay&&t._innerDispatchEvent("play"))},this.vCtx.on(me.VIDEO_EVENTS,this.handleVCtxInnerEvent)}},{key:"_initAudio",value:function(){var t=this.getAttribute("volume"),e=this.muted?0:Number.parseFloat(t);this.noAudio||(this.aCtx=new Ee({volume:e})),this.ticker=new xe({interval:1e3/this._fps}),this.reconciler=new ke({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.noAudio||this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleVCtxInnerEvent",value:function(t){this._innerDispatchEvent(t)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer(),this.aCtx.preload(),this.vCtx.preload()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"_destroyAudio",value:function(){this.audioMetaInited=!1,this.noAudio||(this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd),this.aCtx.destroy()),this.ticker.stop(),this.start=null,this.reconciler.destroy(),this.aCtx=null,this.ticker=null,this.pendingPlayTask=null,this.played=!1,this._hasDispatch=!1}},{key:"_destroyVideo",value:function(){this.videoMetaInited=!1,this.vCtx.removeAllListeners(),this.vCtx.destroy(),this.vCtx=null}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this._destroyVideo(),this._destroyAudio())}},{key:"onDemuxComplete",value:function(t,e){this.noAudio||this.aCtx.decodeAudio(e),this.vCtx.decodeVideo(t)}},{key:"decodeVideoBuffer",value:function(t){this.vCtx.decodeVideoBuffer(t)}},{key:"setAudioMeta",value:function(t){this.noAudio||(this.audioMetaInited&&(this.aCtx.destroy(),this.aCtx=new Ee({})),this.aCtx.setAudioMetaData(t),this.audioMetaInited=!0)}},{key:"setVideoMeta",value:function(t){this.vCtx.setVideoMetaData(t),this.videoMetaInited=!0}},{key:"handleMediaInfo",value:function(){this._innerDispatchEvent("durationchange"),this._innerDispatchEvent("loadedmetadata"),this._innerDispatchEvent("seeking"),this._innerDispatchEvent("seeked")}},{key:"handleEnded",value:function(){this._innerDispatchEvent("ended")}},{key:"handleErr",value:function(t,e){this._err={},this._err.code=t,this._err.message=e,this._innerDispatchEvent("error")}},{key:"_innerDispatchEvent",value:function(t){this.dispatchEvent(new Event(t))}},{key:"disconnectedCallback",value:function(){this._destroyAudio()}},{key:"connectedCallback",value:function(){this._initAudio(),this.vCtx.reset()}},{key:"play",value:function(){var t=this;if(!this.pendingPlayTask){this._innerDispatchEvent("play"),this.autoplay||this._hasDispatch||(this._innerDispatchEvent("waiting"),this._hasDispatch=!0,this._waiting=!0);var e=null;e=this.noAudio?Promise.resolve():this.aCtx.play(),this.pendingPlayTask=Promise.all([this.vCtx.play(),e.then(function(){t.aCtx&&(t.aCtx.muted=!0)})]).then(function(){t.aCtx&&(t.aCtx.muted=!1),t.ticker.start(function(){t.start||(t.start=Date.now(),t._lastTimeupdateStamp=t.start);var e=t._currentTime;if(t._currentTime=Date.now()-t.start,t.vCtx._onTimer(t._currentTime)){t._waiting&&(t._innerDispatchEvent("playing"),t._waiting=!1);var n=Date.now();n-t._lastTimeupdateStamp>=250&&(t._lastTimeupdateStamp=n,t._innerDispatchEvent("timeupdate"),t.vCtx.preload())}else t._currentTime=e,t._waiting||t.paused||(t._waiting=!0,t._innerDispatchEvent("waiting"))}),t.pendingPlayTask=null,t.played=!0,t._paused=!1})}}},{key:"pause",value:function(){var t=this;this._paused=!0,this.noAudio||this.aCtx.pause(),this.vCtx.pause(),Promise.resolve().then(function(){t._innerDispatchEvent("pause")})}},{key:"load",value:function(){}},{key:"onValueChange",value:function(){var t=Date.now();t-this._volumeEventStamp<200||(this._volumeEventStamp=t,this._innerDispatchEvent("volumechange"))}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("width",e),this.style.width=e,this._canvas.width=t}},{key:"height",get:function(){return this.getAttribute("height")},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("height",e),this.style.height=e,this._canvas.height=t}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(t){this.setAttribute("src",t)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0},set:function(t){var e=Number.parseFloat(t);if(!isNaN(e)&&this.start&&this.currentTime){this.vCtx.setVideoSeeking();var n=this.currentTime-e;this.start+=1e3*n}return e}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(t){this.setAttribute("playbackrate",t),this.noAudio||(this.aCtx.playbackRate=t),this.vCtx.playbackRate=t,this._innerDispatchEvent("ratechange")}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&"true"==this.getAttribute("autoplay")},set:function(t){this.setAttribute("autoplay",t)}},{key:"volume",get:function(){return this.noAudio?0:this.aCtx.volume},set:function(t){this.noAudio||(this.setAttribute("volume",t),this.aCtx.volume=t,t>0&&this.muted&&this.aCtx.mute(),this.onValueChange())}},{key:"muted",get:function(){var t="true"===this.getAttribute("muted");return void 0!==t?t:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(t){this.noAudio||(this.setAttribute("muted",t),this.aCtx.muted=!!t,this.onValueChange())}},{key:"error",get:function(){return this._err||this.vCtx.error||(this.noAudio?null:this.aCtx.error)}},{key:"buffered",get:function(){return this.vCtx.buffered}},{key:"noAudio",get:function(){return"true"===this.getAttribute("noaudio")}},{key:"networkState",get:function(){return 0}},{key:"fps",get:function(){return this._fps},set:function(t){P(t)||(t=Zt),this._fps=t,this.ticker&&this.ticker.setInterval(1e3/t)}}]),e}(HTMLElement);customElements.define("mobile-video",Re);var Le=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Pe=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)};return function(t){function e(t){Q(this,e),t.mediaType||(t.mediaType="mobile-video");var n=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.handleTimeupdate=n.handleTimeupdate.bind(n),n.hasPlayed=!1,n}return et(e,t),Le(e,[{key:"start",value:function(){this.context=new wt(yt.HlsAllowedEvents),this.context.registry("LOADER_BUFFER",Gt),this.core=this.context.registry("RAW_264_CONTROLLER",jt)({player:this,fps:this.config.fps}),this.config.isLive||(this.context.registry("FETCH_LOADER",Yt),this.core.load(this.config.url)),this.context.init(),Pe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this).call(this),this.video.setAttribute("noaudio",!0),this.video.addEventListener("timeupdate",this.handleTimeupdate,!1)}},{key:"replay",value:function(){this.video._cleanBuffer(),this.currentTime=0,this.start(),this.play()}},{key:"handleTimeupdate",value:function(){this.config.isLive?this.video._cleanBuffer():this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}},{key:"destroy",value:function(t){Pe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this,t),this.core.destroy(),this.context.destroy(),this.core=null,this.context=null}},{key:"pushBuffer",value:function(t){this.buffer&&(this.buffer.push(t),this.core.handleDataLoaded())}},{key:"buffer",get:function(){return this.context.getInstance("LOADER_BUFFER")}},{key:"currentTime",set:function(t){var n=Pe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"currentTime",this),i=this.getBufferedRange();i[0]<=t&&i[1]>=t?this.video.currentTime=t:this.video.currentTime=n},get:function(){return Pe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"currentTime",this)}},{key:"duration",get:function(){return this.core&&this.core.duration?this.core.duration:this.video.duration}}]),e}(t)});
//# sourceMappingURL=index.min.js.map
