window.FlvPlayer=function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,i){"use strict";e.exports={Context:i(13).default,EVENTS:i(6).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,MediaInfo:i(5).default,MediaSample:i(19).default,MediaSegment:i(20).default,MediaSegmentList:i(21).default,AudioTrackMeta:i(7).AudioTrackMeta,VideoTrackMeta:i(7).VideoTrackMeta,AudioTrackSample:i(8).AudioTrackSample,VideoTrackSample:i(8).VideoTrackSample,Mse:i(22).default,Stream:i(23).default,Buffer:i(24).default,Crypto:i(27).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=(r(l,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"distroy",value:function(){this.reset(),this.id=-1}}]),l);function l(){o(this,l),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}t.default=u;t.AudioTrack=(s(f,u),f);function f(){o(this,f);var e=a(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));return e.TAG="AudioTrack",e.type="audio",e}t.VideoTrack=(s(d,u),r(d,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),d);function d(){o(this,d);var e=a(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return e.TAG="VideoTrack",e.type="video",e.dropped=0,e}t.Tracks=(r(c,[{key:"destroy",value:function(){this.audioTrack=null,this.videoTrack=null}}]),c);function c(){o(this,c),this.audioTrack=null,this.videoTrack=null}},function(e,t,i){"use strict";e.exports={Nalunit:i(37).default,SpsParser:i(9).default,Compatibility:i(39).default}},function(e,t,i){"use strict";e.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(10).XgBuffer,RemuxBuffer:i(10).RemuxBuffer,PreSource:i(41).default}},function(e,t){e.exports=window.Player},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});function n(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0}var a=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(s,[{key:"isComplete",value:function(){return s.isBaseInfoReady(this)&&s.isVideoReady(this)&&s.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(e){return n(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||n(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||n(e.video)}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},n={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT"},s={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},u=Object.assign({},r,n,a,s,o),l=[],f=[];for(var d in u)u.hasOwnProperty(d)&&l.push(u[d]);for(var c in u)u.hasOwnProperty(c)&&f.push(u[c]);t.default={ALLEVENTS:u,HLS_EVENTS:o,REMUX_EVENTS:a,DEMUX_EVENTS:n,MSE_EVENTS:s,LOADER_EVENTS:r,FlvAllowedEvents:l,HlsAllowedEvents:f,CRYTO_EVENTS:{START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.AudioTrackMeta=(r(s,[{key:"destroy",value:function(){this.init=null}}]),s);function s(e){a(this,s);var t={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return e?Object.assign({},t,e):t}t.VideoTrackMeta=(r(o,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),o);function o(e){a(this,o);var t={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return e?Object.assign({},t,e):t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.AudioTrackSample=(r(s,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,data:new Uint8Array}}}]),s);function s(e){a(this,s);var t=s.getDefault();return e?Object.assign({},t,e):t}t.VideoTrackSample=(r(o,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}]),o);function o(e){a(this,o);var t=o.getDefault();return e?Object.assign({},t,e):t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(38),I=(a=s)&&a.__esModule?a:{default:a};var o=(r(j,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)2<=a&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)}},{key:"parseSPS",value:function(e){var t=j._ebsp2rbsp(e),i=new I.default(t);i.readByte();var r=i.readByte();i.readByte();var n=i.readByte();i.readUEG();var a=j.getProfileString(r),s=j.getLevelString(n),o=1,u=420,l=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(o=i.readUEG())&&i.readBits(1),o<=3&&(u=[0,420,422,444][o]),l=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==o?8:12,d=0;d<f;d++)i.readBool()&&j._skipScalingList(i,d<6?16:64);i.readUEG();var c=i.readUEG();if(0===c)i.readUEG();else if(1===c){i.readBits(1),i.readSEG(),i.readSEG();for(var h=i.readUEG(),p=0;p<h;p++)i.readSEG()}i.readUEG(),i.readBits(1);var v=i.readUEG(),y=i.readUEG(),m=i.readBits(1);0===m&&i.readBits(1),i.readBits(1);var g=0,_=0,b=0,k=0;i.readBool()&&(g=i.readUEG(),_=i.readUEG(),b=i.readUEG(),k=i.readUEG());var E=1,S=1,w=0,A=!0,T=0,O=0;if(i.readBool()){if(i.readBool()){var D=i.readByte();0<D&&D<16?(E=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][D-1],S=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][D-1]):255===D&&(E=i.readByte()<<8|i.readByte(),S=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var R=i.readBits(32),U=i.readBits(32);A=i.readBool(),w=(T=U)/(O=2*R)}}var L=1;1===E&&1===S||(L=E/S);var M=0,x=0;x=0===o?(M=1,2-m):(M=3===o?1:2,(1===o?2:1)*(2-m));var C=16*(v+1),P=16*(y+1)*(2-m);C-=(g+_)*M,P-=(b+k)*x;var B=Math.ceil(C*L);return i.destroy(),i=null,{profile_string:a,level_string:s,bit_depth:l,chroma_format:u,chroma_format_string:j.getChromaFormatString(u),frame_rate:{fixed:A,fps:w,fps_den:O,fps_num:T},par_ratio:{width:E,height:S},codec_size:{width:C,height:P},present_size:{width:B,height:P}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var i=t.frameRate.fps_den,r=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(i/r))}}]),j);function j(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,j)}t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.XgBuffer=(r(s,[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){var t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){var i=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,i}for(var r=new Uint8Array(e),n=0;0<this.array.length&&0<e;){if(this.offset+e<this.array[0].length){var a=this.array[0].slice(this.offset,this.offset+e);r.set(a,n),this.offset+=e,this.length-=e,e=0;break}var s=this.array[0].length-this.offset;r.set(this.array[0].slice(this.offset,this.array[0].length),n),this.array.shift(),this.offset=0,n+=s,this.length-=s,e-=s}return r}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){for(var i=0,r=this.offset+e;r<this.offset+t+e;)r<this.array[0].length?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++;return i}}]),s);function s(e){a(this,s),this.length=e||0,this.historyLen=e||0,this.array=[],this.offset=0}t.RemuxBuffer=(r(o,[{key:"destroy",value:function(){this.video=[],this.audio=[]}}]),o);function o(){a(this,o),this.video=[],this.audio=[]}},function(e,t,i){e.exports=i(12)},function(e,t,i){"use strict";var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:s(n,t,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0}var a=l(i(4)),o=i(0),u=l(i(28));function l(e){return e&&e.__esModule?e:{default:e}}var f=o.EVENTS.FlvAllowedEvents,d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,a.default),r(c,[{key:"start",value:function(){this.initFlv(),this.context.init(),s(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"start",this).call(this,this.flv.mse.url)}},{key:"initFlvEvents",value:function(e){var t=this,i=this;e.once(o.EVENTS.REMUX_EVENTS.INIT_SEGMENT,function(){if(a.default.util.addClass(i.root,"xgplayer-is-live"),!a.default.util.findDom(t.root,"xg-live")){var e=a.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");i.controls.appendChild(e)}}),e.once(o.EVENTS.LOADER_EVENTS.LOADER_COMPLETE,function(){i.paused?i.emit("ended"):t.loaderCompleteTimer=setInterval(function(){var e=i.getBufferedRange()[1];Math.abs(i.currentTime-e)<.5&&(i.emit("ended"),window.clearInterval(t.loaderCompleteTimer))},200)})}},{key:"initEvents",value:function(){var i=this;this.on("timeupdate",function(){i.loadData()}),this.on("seeking",function(){var e=i.currentTime,t=i.getBufferedRange();(e>t[1]||e<t[0])&&i.flv.seek(i.currentTime)})}},{key:"initFlv",value:function(){var e=this.context.registry("FLV_CONTROLLER",u.default)(this);this.initFlvEvents(e),this.flv=e}},{key:"play",value:function(){var t=this;this._hasStart?this._destroy().then(function(){t.context=new o.Context(f);var e=t.context.registry("FLV_CONTROLLER",u.default)(t);t.initFlvEvents(e),t.flv=e,t.context.init(),s(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"start",t).call(t,e.mse.url),s(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"play",t).call(t)}):s(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"play",this).call(this)}},{key:"pause",value:function(){s(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"pause",this).call(this),this.flv&&this.flv.pause()}},{key:"loadData",value:function(e){var t=0<arguments.length&&void 0!==e?e:this.currentTime;this.flv&&this.flv.seek(t)}},{key:"destroy",value:function(){var e=this;this._destroy().then(function(){s(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"destroy",e).call(e)})}},{key:"_destroy",value:function(){var e=this;return this.flv.mse.destroy().then(function(){e.context.destroy(),e.flv=null,e.context=null,e.loaderCompleteTimer&&window.clearInterval(e.loaderCompleteTimer)})}},{key:"src",get:function(){return this.currentSrc},set:function(e){var t=this;this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",function(){t.start(e)}),this.once("canplay",function(){t.play()})),this.once("canplay",function(){t.currentTime=0})}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return t.context=new o.Context(f),t.initEvents(),t.loaderCompleteTimer=null,t}e.exports=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function s(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:s(n,t,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0}var n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,o=i(5),u=(a=o)&&a.__esModule?a:{default:a},l=i(14);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c="__TO__",f=(n(h,[{key:"getInstance",value:function(e){var t=this._instanceMap[e];return t||null}},{key:"initInstance",value:function(e){if(this._clsMap[e]){for(var t=arguments.length,i=Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var n=new(Function.prototype.bind.apply(this._clsMap[e],[null].concat(i)));return(this._instanceMap[e]=n).init&&n.init(),n}throw new Error(e+"未在context中注册")}},{key:"init",value:function(e){if(!this._inited){for(var t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(l,e){var r=this,f=this._emitter,o=this._isMessageNameValid.bind(this),u=this,t=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,e),n(a,[{key:"on",value:function(e,t){return o(e),this.listeners[e]?this.listeners[e].push(t):this.listeners[e]=[t],f.on(e+c+l,t),f.on(e,t)}},{key:"before",value:function(e,t){o(e),u._hooks[e]?u._hooks[e].push(t):u._hooks[e]=[t]}},{key:"once",value:function(e,t){return o(e),this.onceListeners[e]?this.onceListeners[e].push(t):this.onceListeners[e]=[t],f.once(e+c+l,t),f.once(e,t)}},{key:"emit",value:function(e){o(e),u._emitCounter[e]?(u._emitCounter[e]+=1,1e4<u._emitCounter[e]&&window.console&&window.console.warn("invoke: ",e)):u._emitCounter[e]=1;var t=u._hooks?u._hooks[e]:null;if(t)for(var i=0,r=t.length;i<r;i++)(0,t[i])();for(var n=arguments.length,a=Array(1<n?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return f.emit.apply(f,[e].concat(a))}},{key:"emitTo",value:function(e,t){o(t);for(var i=arguments.length,r=Array(2<i?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return f.emit.apply(f,[t+c+e].concat(r))}},{key:"off",value:function(e,t){return o(e),f.off(e,t)}},{key:"removeListeners",value:function(){var e=Object.prototype.hasOwnProperty.bind(this.listeners);for(var t in this.listeners)if(e(t))for(var i=this.listeners[t]||[],r=0;r<i.length;r++){var n=i[r];f.off(t,n),f.off(t+c+l,n)}for(var a in this.onceListeners)if(e(a))for(var s=this.onceListeners[a]||[],o=0;o<s.length;o++){var u=s[o];f.off(a,u),f.off(a+c+l,u)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete u._instanceMap[l],s(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"destroy",this))return s(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"destroy",this).call(this)}}]),a);function a(){var e;d(this,a);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i)));return n.listeners={},n.onceListeners={},n.TAG=l,n._context=u,n}return this._clsMap[l]=t,function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.initInstance.apply(r,[l].concat(t))}}},{key:"destroyInstances",value:function(){var t=this;Object.keys(this._instanceMap).forEach(function(e){t._instanceMap[e].destroy&&t._instanceMap[e].destroy()})}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this._emitCounter={},this.destroyInstances()}},{key:"_isMessageNameValid",value:function(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error("unregistered message name: "+e)}}]),h);function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];d(this,h),this._emitter=new l.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new u.default,this.allowedEvents=e,this._hooks={},this._emitCounter={}}t.default=f},function(e,t,i){"use strict";var r,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n="object"===("undefined"==typeof Reflect?"undefined":u(Reflect))?Reflect:null,f=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}((e.exports=s).EventEmitter=s).prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,i,r){var n,a,s;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===i?"undefined":u(i)));if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),0<(n=l(e))&&s.length>n&&!s.warned){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=s.length,console&&console.warn}return e}function c(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,f(this.listener,this.target,e))}.bind(r);return n.listener=i,r.wrapFn=n}function h(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):v(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var a;if(0<t.length&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var o=n[e];if(void 0===o)return!1;if("function"==typeof o)f(o,this,t);else{var u=o.length,l=v(o,u);for(i=0;i<u;++i)f(l[i],this,t)}return!0},s.prototype.on=s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":u(t)));return this.on(e,c(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":u(t)));return this.prependListener(e,c(this,e,t)),this},s.prototype.off=s.prototype.removeListener=function(e,t){var i,r,n,a,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":u(t)));if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,a=i.length-1;0<=a;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,n=a;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},s.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,a=Object.keys(i);for(r=0;r<a.length;++r)"removeListener"!==(n=a[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return 0<this._eventsCount?r(this._events):[]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]),a={get device(){var e=a.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){var t=navigator.userAgent.toLowerCase(),i={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(i).filter(function(e){return i[e].test(t)}))[0]},get os(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),n=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||n&&/(?:Tablet)/.test(e),s=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:s,isAndroid:r,isPc:!s&&!r&&!i,isSymbian:i,isWindowsPhone:t,isFireFox:n}},get isLe(){return n}};t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]);t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(u,null,[{key:"decode",value:function(e){for(var t=[],i=e,r=0,n=e.length;r<n;)if(i[r]<128)t.push(String.fromCharCode(i[r])),++r;else{if(!(i[r]<192))if(i[r]<224){if(u._checkContinuation(i,r,1)){var a=(31&i[r])<<6|63&i[r+1];if(128<=a){t.push(String.fromCharCode(65535&a)),r+=2;continue}}}else if(i[r]<240){if(u._checkContinuation(i,r,2)){var s=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(2048<=s&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),r+=3;continue}}}else if(i[r]<248&&u._checkContinuation(i,r,3)){var o=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(65536<o&&o<1114112){o-=65536,t.push(String.fromCharCode(o>>>10|55296)),t.push(String.fromCharCode(1023&o|56320)),r+=4;continue}}t.push(String.fromCharCode(65533)),++r}return t.join("")}},{key:"_checkContinuation",value:function(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u)}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(s,null,[{key:"getDefaultInf",value:function(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}]),s);function s(e){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t=s.getDefaultInf();if(!e||"[object Object]"!==Object.prototype.toString.call(e))return t;var i=Object.assign({},t,e);Object.entries(i).forEach(function(e){var t=a(e,2),i=t[0],r=t[1];n[i]=r})}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"addRAP",value:function(e){e.isRAP=!0,this.randomAccessPoints.push(e)}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,r=0,n=0,a=i,s=0;if(e<t[0].originDts)return s=-1;for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>t[r].lastSample.originDts&&e<t[r+1].originDts){s=r;break}t[r].originDts<e?n=r+1:a=r-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&e.originStartDts>=t[i].lastSample.originDts&&(i===t.length-1||i<t.length-1&&e.originStartDts<t[i+1].originStartDts)?r=i+1:0<t.length&&(r=this._searchNearestSegmentBefore(e.originStartDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,e)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return 0<=t?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!==t?t.lastSample:null}},{key:"getLastRAPBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].randomAccessPoints;0===i.length&&0<t;)t--,i=this._list[t].randomAccessPoints;return 0<i.length?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this._type=e,this._list=[],this._lastAppendLocation=-1}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"init",value:function(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}},{key:"onTimeUpdate",value:function(){this.emit("TIME_UPDATE",this.container)}},{key:"onWaiting",value:function(){this.emit("WAITING",this.container)}},{key:"onSourceOpen",value:function(){this.addSourceBuffers()}},{key:"onUpdateEnd",value:function(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}},{key:"addSourceBuffers",value:function(){if("open"===this.mediaSource.readyState){var e=this._context.getInstance("PRE_SOURCE_BUFFER"),t=this._context.getInstance("TRACKS"),i=void 0;e=e.sources;for(var r=!1,n=0,a=Object.keys(e).length;n<a;n++){var s=Object.keys(e)[n];if("audio"===s?i=t.audioTrack:"video"===s&&(i=t.videoTrack),i){var o="audio"===s?21:40;i.meta&&i.meta.refSampleDuration&&(o=i.meta.refSampleDuration),e[s].data.length>=this.preloadTime/o&&(r=!0)}}if(r){if(0<Object.keys(this.sourceBuffers).length)return;for(var u=0,l=Object.keys(e).length;u<l;u++){var f=Object.keys(e)[u],d=e[f],c="video"===f?"video/mp4;codecs="+d.mimetype:"audio/mp4;codecs="+d.mimetype,h=this.mediaSource.addSourceBuffer(c);(this.sourceBuffers[f]=h).addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}}},{key:"doAppend",value:function(){var e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e)for(var t=0;t<Object.keys(this.sourceBuffers).length;t++){var i=Object.keys(this.sourceBuffers)[t],r=this.sourceBuffers[i];if(!r.updating){var n=e.sources[i];if(n&&!n.inited)r.appendBuffer(n.init.buffer.buffer),n.inited=!0;else if(n){var a=n.data.shift();a&&r.appendBuffer(a.buffer.buffer)}}}}},{key:"endOfStream",value:function(){var e=this.mediaSource,t=e.readyState,i=e.activeSourceBuffers;if("open"===t&&0===i.length)try{this.mediaSource.endOfStream()}catch(e){}}},{key:"remove",value:function(e,t){for(var i=1<arguments.length&&void 0!==t?t:0,r=0;r<Object.keys(this.sourceBuffers).length;r++){var n=this.sourceBuffers[Object.keys(this.sourceBuffers)[r]];n.updating||n.remove(i,e)}}},{key:"removeBuffers",value:function(){for(var i=this,n=[],e=function(e){var r=i.sourceBuffers[Object.keys(i.sourceBuffers)[e]];r.removeEventListener("updateend",i.onUpdateEnd);var t=void 0;t=r.updating?new Promise(function(i){r.addEventListener("updateend",function e(){var t=3;setTimeout(function e(){r.updating?0<t?(setTimeout(e,200),t--):i():(a.clearBuffer(r),r.addEventListener("updateend",function(){i()}))},200),r.removeEventListener("updateend",e)})}):new Promise(function(e){a.clearBuffer(r),r.addEventListener("updateend",function(){e()})}),n.push(t)},t=0;t<Object.keys(this.sourceBuffers).length;t++)e(t);return Promise.all(n)}},{key:"destroy",value:function(){var i=this;return this.removeBuffers().then(function(){for(var e=0;e<Object.keys(i.sourceBuffers).length;e++){var t=i.sourceBuffers[Object.keys(i.sourceBuffers)[e]];i.mediaSource.removeSourceBuffer(t),delete i.sourceBuffers[Object.keys(i.sourceBuffers)[e]]}i.container.removeEventListener("timeupdate",i.onTimeUpdate),i.container.removeEventListener("waiting",i.onWaiting),i.mediaSource.removeEventListener("sourceopen",i.onSourceOpen),i.endOfStream(),window.URL.revokeObjectURL(i.url),i.url=null,i.configs={},i.container=null,i.mediaSource=null,i.sourceBuffers={},i.preloadTime=1})}}],[{key:"clearBuffer",value:function(e){for(var t=e.buffered,i=.1,r=0,n=t.length;r<n;r++)i=t.end(r);try{e.remove(0,i)}catch(e){}}}]),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.configs=Object.assign({},e),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(e){for(var t=Math.floor(e/4),i=e%4,r=0;r<t;r++)a.readByte(this.dataview,4);0<i&&a.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return a.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return a.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return a.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return a.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return a.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return a.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return a.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return a.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,i){var r=void 0;switch(t){case 1:r=i?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=i?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(i)throw new Error("not supported for readByte 3");r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=i?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(i)throw new Error("not supported for readBody 8");r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),a);function a(e){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),!(e instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(25),o=(a=s)&&a.__esModule?a:{default:a};var u=(r(l,[{key:"write",value:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];i.forEach(function(e){t.buffer=(0,o.default)(Uint8Array,t.buffer,e)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}},{key:"readAsInt",value:function(e){var t="";return e.forEach(function(e){t+=function(e){return e.toString(16).padStart(2,"0")}(e)}),parseInt(t,16)}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.buffer=e||new Uint8Array(0)}t.default=u},function(e,t,i){"use strict";var r,n=i(26),a=(r=n)&&r.__esModule?r:{default:r};e.exports=a.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,i=arguments.length,r=Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var a=!0,s=!1,o=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){t+=u.value.length}}catch(e){s=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw o}}var f=new e(t),d=0,c=!0,h=!1,p=void 0;try{for(var v,y=r[Symbol.iterator]();!(c=(v=y.next()).done);c=!0){var m=v.value;f.set(m,d),d+=m.length}}catch(e){h=!0,p=e}finally{try{!c&&y.return&&y.return()}finally{if(h)throw p}}return f}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(6);var o=((a=s)&&a.__esModule?a:{default:a}).default.CRYTO_EVENTS,u=(r(l,[{key:"init",value:function(){this.on(o.START_DECRYPT,this.decript.bind(this))}},{key:"decript",value:function(){var t=this;this.aeskey?this.decriptData():this.crypto.subtle.importKey("raw",this.key.buffer,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(function(e){t.aeskey=e,t.decriptData()})}},{key:"decriptData",value:function(){var t=this,e=this._context.getInstance(this.inputBuffer),i=this._context.getInstance(this.outputBuffer),r=e.shift();r&&this.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv.buffer},this.aeskey,r).then(function(e){i.push(new Uint8Array(e)),t.emit(o.DECRYPTED),t.decriptData(r)})}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.inputBuffer=e.inputbuffer,this.outputBuffer=e.outputbuffer,this.key=e.key,this.iv=e.iv,this.method=e.method,this.crypto=window.crypto||window.msCrypto}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=c(i(29)),s=i(32),o=i(34),u=i(3),l=i(0),f=i(2),d=c(i(4));function c(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var p=l.EVENTS.REMUX_EVENTS,v=l.EVENTS.DEMUX_EVENTS,y=l.EVENTS.LOADER_EVENTS,m=l.EVENTS.MSE_EVENTS,g=(r(_,[{key:"warn",value:function(){}}]),_);function _(){h(this,_)}var b=(r(k,[{key:"init",value:function(){this._context.registry("FETCH_LOADER",s.FetchLoader),this._context.registry("LOADER_BUFFER",u.XgBuffer),this._context.registry("FLV_DEMUXER",o.FlvDemuxer),this._context.registry("TRACKS",u.Tracks),this._context.registry("MP4_REMUXER",a.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",u.PreSource),!1!==this._player.config.compatibility&&this._context.registry("COMPATIBILITY",f.Compatibility),this._context.registry("LOGGER",g),this.mse=this._context.registry("MSE",l.Mse)({container:this._player.video}),this._handleTimeUpdate=this._handleTimeUpdate.bind(this),this.initListeners()}},{key:"initListeners",value:function(){this.on(y.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(y.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(v.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(v.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(v.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(v.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(p.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(p.MEDIA_SEGMENT,this._handleMediaSegment.bind(this)),this.on(p.RANDOM_ACCESS_POINT,this._handleAddRAP.bind(this)),this.on(m.SOURCE_UPDATE_END,this._handleSourceUpdateEnd.bind(this)),this._player.on("timeupdate",this._handleTimeUpdate)}},{key:"_handleMediaInfo",value:function(){this._context.mediaInfo||this.emit(v.DEMUX_ERROR,new Error("failed to get mediainfo"))}},{key:"_handleLoaderDataLoaded",value:function(){this.emitTo("FLV_DEMUXER",v.DEMUX_START)}},{key:"_handleMetadataParsed",value:function(e){this.emit(p.REMUX_METADATA,e)}},{key:"_handleDemuxComplete",value:function(){this.emit(p.REMUX_MEDIA)}},{key:"_handleAppendInitSegment",value:function(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}},{key:"_handleMediaSegment",value:function(){this.mse.addSourceBuffers(),this.mse.doAppend()}},{key:"_handleSourceUpdateEnd",value:function(){var e=this._player.currentTime,t=this._player.video,i=this._player.config.preloadTime||5,r=t.buffered.length;if(0!==r){var n=t.buffered.end(r-1);2*i<n-e&&(this._player.currentTime=n-i),this.mse.doAppend()}}},{key:"_handleTimeUpdate",value:function(){var e=this,t=this._player.currentTime,i=this._player.video,r=i.buffered;if(r&&r.length){var n=[0,0],a=i.currentTime;if(r)for(var s=0,o=r.length;s<o&&(n[0]=r.start(s),n[1]=r.end(s),!(n[0]<=a&&a<=n[1]));s++);var u=n[0],l=n[1];if(l<a||a<u)i.currentTime=u;else if(10<t-u||1<r.length){if(this.bufferClearTimer||!this.state.randomAccessPoints.length)return;for(var f=1/0,d=0;d<this.state.randomAccessPoints.length;d++){var c=Math.ceil(this.state.randomAccessPoints[d]/1e3);if(t-10<c)break;f=c}this.mse.remove(Math.min(f,t-10,l-10),0),this.bufferClearTimer=setTimeout(function(){e.bufferClearTimer=null},5e3)}}}},{key:"_handleNetworkError",value:function(e,t){this._player.emit("error",new d.default.Errors("network",this._player.config.url)),this._onError(y.LOADER_ERROR,e,t,!0)}},{key:"_handleDemuxError",value:function(e,t,i){void 0===i&&(i=!1),this._player.emit("error",new d.default.Errors("parse",this._player.config.url)),this._onError(y.LOADER_ERROR,e,t,i)}},{key:"_handleAddRAP",value:function(e){this.state.randomAccessPoints&&this.state.randomAccessPoints.push(e)}},{key:"_onError",value:function(e,t,i,r){var n={errorType:e,errorDetails:"["+t+"]: "+i.message,errorFatal:r||!1};this._player.emit("FLV_ERROR",n)}},{key:"seek",value:function(){this.state.initSegmentArrived||this.loadData()}},{key:"loadData",value:function(){this.emit(y.LADER_START,this._player.config.url)}},{key:"pause",value:function(){var e=this._context.getInstance("FETCH_LOADER");e&&e.cancel()}},{key:"destroy",value:function(){this._player.off("timeupdate",this._handleTimeUpdate),this._player=null,this.mse=null,this.state.randomAccessPoints=[]}}]),k);function k(e){h(this,k),this.TAG="FLVController",this._player=e,this.state={initSegmentArrived:!1,randomAccessPoints:[]},this.bufferClearTimer=null}t.default=b},function(e,t,i){"use strict";e.exports={Mp4Remuxer:i(30).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,b=i(0),s=i(31),k=(a=s)&&a.__esModule?a:{default:a};var E=b.EVENTS.REMUX_EVENTS,o=(r(u,[{key:"init",value:function(){this.on(E.REMUX_MEDIA,this.remux.bind(this)),this.on(E.REMUX_METADATA,this.onMetaDataReady.bind(this)),this.on(E.DETECT_CHANGE_STREAM,this.resetDtsBase.bind(this))}},{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null}},{key:"remux",value:function(){var e=this._context.getInstance("TRACKS"),t=e.audioTrack,i=e.videoTrack;this._isDtsBaseInited||this.calcDtsBase(t,i),this._remuxVideo(i),this._remuxAudio(t)}},{key:"resetDtsBase",value:function(){this._dtsBase=0,this._dtsBaseInited=!1}},{key:"seek",value:function(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()}},{key:"onMetaDataReady",value:function(e){var t=void 0;t="audio"===e?this._context.getInstance("TRACKS").audioTrack:this._context.getInstance("TRACKS").videoTrack;var i=this._context.getInstance("PRE_SOURCE_BUFFER"),r=i.getSource(e);(r=r||i.createSource(e)).mimetype=t.meta.codec,r.init=this.remuxInitSegment(e,t.meta),this.emit(E.INIT_SEGMENT,e)}},{key:"remuxInitSegment",value:function(e,t){var i=new b.Buffer,r=k.default.ftyp(),n=k.default.moov({type:e,meta:t});return i.write(r,n),i}},{key:"calcDtsBase",value:function(e,t){if(e.samples.length||t.samples.length){var i=1/0,r=1/0;e.samples&&e.samples.length&&(i=e.samples[0].dts),t.samples&&t.samples.length&&(r=t.samples[0].dts),this._dtsBase=Math.min(i,r),this._isDtsBaseInited=!0}}},{key:"_remuxVideo",value:function(e){var t=e;if(e.samples&&e.samples.length){for(var i=t.samples,r=-1,n=null,a=[],s={samples:[]},o=1e4;i.length&&0<o--;){var u=i.shift(),l=u.isKeyframe,f=u.options;if(!this.isFirstAudio&&f&&f.meta){n=this.remuxInitSegment("video",f.meta),f.meta=null,i.unshift(u),f.isContinue||this.resetDtsBase();break}var d=u.dts-this._dtsBase;-1===r&&(r=d);var c=void 0,h=void 0;void 0!==u.pts&&(c=(h=u.pts-this._dtsBase)-d),void 0!==u.cts&&(h=u.cts+d,c=u.cts);var p={buffer:[],size:0};s.samples.push(p),p.buffer.push(u.data),p.size+=u.data.byteLength;var v=0;v=u.duration?u.duration:1<=i.length?i[0].dts-this._dtsBase-d:1<=a.length?a[a.length-1].duration:this.videoMeta.refSampleDuration,this.videoAllDuration+=v,a.push({dts:d,cts:c,pts:h,data:u.data,size:u.data.byteLength,isKeyframe:l,duration:v,flags:{isLeading:0,dependsOn:l?2:1,isDependedOn:l?1:0,hasRedundancy:0,isNonSync:l?0:1},originDts:d,type:"video"}),l&&this.emit(E.RANDOM_ACCESS_POINT,h)}var y=new b.Buffer;if(a.length){var m=k.default.moof({id:t.meta.id,time:r,samples:a}),g=k.default.mdat(s);y.write(m,g),this.writeToSource("video",y)}if(n&&(this.writeToSource("video",n),i.length))return t.samples=i,this._remuxVideo(t);this.isFirstVideo=!1,this.emit(E.MEDIA_SEGMENT,"video");var _=a[a.length-1];this._videoNextDts=_.dts+_.duration,t.samples=[],t.length=0}}},{key:"_remuxAudio",value:function(e){var t=e.samples,i=-1,r=[],n=null,a={samples:[]};if(t&&t.length){for(var s=1e4,o=!1;t.length&&0<s--;){var u=t.shift(),l=u.data,f=u.options;if(!this.isFirstAudio&&f&&f.meta){n=this.remuxInitSegment("audio",f.meta),f.meta=null,t.unshift(u),f.isContinue||this.resetDtsBase();break}var d=u.dts-this._dtsBase,c=d;o||(i=d,o=!0);var h=0;h=u.duration?u.duration:this.audioMeta.refSampleDurationFixed?this.audioMeta.refSampleDurationFixed:1<=t.length?t[0].dts-this._dtsBase-d:1<=r.length?r[r.length-1].duration:this.audioMeta.refSampleDuration,this.audioAllDuration+=h;var p={dts:d,pts:d,cts:0,size:l.byteLength,duration:u.duration?u.duration:h,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:c,type:"audio"},v={buffer:[],size:0};v.buffer.push(l),v.size+=l.byteLength,a.samples.push(v),r.push(p)}var y=new b.Buffer;if(r.length){var m=k.default.moof({id:e.meta.id,time:i,samples:r}),g=k.default.mdat(a);y.write(m,g),this.writeToSource("audio",y)}if(n&&(this.writeToSource("audio",n),t.length))return e.samples=t,this._remuxAudio(e);this.isFirstAudio=!1,this.emit(E.MEDIA_SEGMENT,"audio",y);var _=r[r.length-1];this._videoNextDts=_.dts+_.duration,e.samples=[],e.length=0}}},{key:"writeToSource",value:function(e,t){var i=this._context.getInstance("PRE_SOURCE_BUFFER"),r=i.getSource(e);(r=r||i.createSource(e)).data.push(t)}},{key:"initSilentAudio",value:function(e,t){var i=u.getSilentFrame(this._audioMeta.channelCount);return{dts:e,pts:e,cts:0,duration:t,unit:i,size:i.byteLength,originDts:e,type:"video"}}},{key:"videoMeta",get:function(){return this._context.getInstance("TRACKS").videoTrack.meta}},{key:"audioMeta",get:function(){return this._context.getInstance("TRACKS").audioTrack.meta}}],[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this._dtsBase=0,this._isDtsBaseInited=!1,this._audioNextDts=null,this._videoNextDts=null,this._videoSegmentList=new b.MediaSegmentList("video"),this._audioSegmentList=new b.MediaSegmentList("audio");var e=b.sniffer.browser;this._fillSilenceFrame="ie"===e,this.isFirstVideo=!0,this.isFirstAudio=!0,this.videoAllDuration=0,this.audioAllDuration=0}t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=i(0);var a=(r(d,null,[{key:"size",value:function(e){return f.Buffer.writeUint32(e)}},{key:"initBox",value:function(e,t){for(var i=new f.Buffer,r=arguments.length,n=Array(2<r?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return i.write.apply(i,[d.size(e),d.type(t)].concat(n)),i.buffer}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){return d.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}},{key:"moov",value:function(e){var t=e.type,i=e.meta,r=8,n=d.mvhd(i.duration,i.timescale),a=void 0;a="video"===t?d.videoTrak(i):d.audioTrak(i);var s=d.mvex(i.duration,i.timescale||1e3,i.id);return[n,a,s].forEach(function(e){r+=e.byteLength}),d.initBox(r,"moov",n,a,s)}},{key:"mvhd",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:1e3,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d.initBox(8+r.length,"mvhd",new Uint8Array(r))}},{key:"videoTrak",value:function(e){var t=8,i=d.tkhd({id:1,duration:e.duration,timescale:e.timescale||1e3,width:e.presentWidth,height:e.presentHeight,type:"video"}),r=d.mdia({type:"video",timescale:e.timescale||1e3,duration:e.duration,avcc:e.avcc,parRatio:e.parRatio,width:e.presentWidth,height:e.presentHeight});return[i,r].forEach(function(e){t+=e.byteLength}),d.initBox(t,"trak",i,r)}},{key:"audioTrak",value:function(e){var t=8,i=d.tkhd({id:2,duration:e.duration,timescale:e.timescale||1e3,width:0,height:0,type:"audio"}),r=d.mdia({type:"audio",timescale:e.timescale||1e3,duration:e.duration,channelCount:e.channelCount,samplerate:e.sampleRate,config:e.config});return[i,r].forEach(function(e){t+=e.byteLength}),d.initBox(t,"trak",i,r)}},{key:"tkhd",value:function(e){var t=e.id,i=e.duration,r=e.width,n=e.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,n>>>8&255,255&n,0,0]);return d.initBox(8+a.byteLength,"tkhd",a)}},{key:"edts",value:function(e){var t=new f.Buffer,i=e.duration,r=e.mediaTime;return t.write(d.size(36),d.type("edts")),t.write(d.size(28),d.type("elst")),t.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,1])),t.buffer}},{key:"mdia",value:function(e){var t=8,i=d.mdhd(e.timescale,e.duration),r=d.hdlr(e.type),n=d.minf(e);return[i,r,n].forEach(function(e){t+=e.byteLength}),d.initBox(t,"mdia",i,r,n)}},{key:"mdhd",value:function(e,t){var i=0<arguments.length&&void 0!==e?e:1e3,r=new Uint8Array([0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t,85,196,0,0]);return d.initBox(12+r.byteLength,"mdhd",d.extension(0,0),r)}},{key:"hdlr",value:function(e){var t=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===e&&(t.splice.apply(t,[8,4].concat([115,111,117,110])),t.splice.apply(t,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),d.initBox(8+t.length,"hdlr",new Uint8Array(t))}},{key:"minf",value:function(e){var t=8,i="video"===e.type?d.vmhd():d.smhd(),r=d.dinf(),n=d.stbl(e);return[i,r,n].forEach(function(e){t+=e.byteLength}),d.initBox(t,"minf",i,r,n)}},{key:"vmhd",value:function(){return d.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}},{key:"smhd",value:function(){return d.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}},{key:"dinf",value:function(){var e=new f.Buffer;return e.write(d.size(36),d.type("dinf"),d.size(28),d.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),e.buffer}},{key:"stbl",value:function(e){var t=8,i=d.stsd(e),r=d.stts(),n=d.stsc(),a=d.stsz(),s=d.stco();return[i,r,n,a,s].forEach(function(e){t+=e.byteLength}),d.initBox(t,"stbl",i,r,n,a,s)}},{key:"stsd",value:function(e){var t=void 0;return t="audio"===e.type?d.mp4a(e):d.avc1(e),d.initBox(16+t.byteLength,"stsd",d.extension(0,0),new Uint8Array([0,0,0,1]),t)}},{key:"mp4a",value:function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.samplerate>>8&255,255&e.samplerate,0,0]),i=d.esds(e.config);return d.initBox(8+t.byteLength+i.byteLength,"mp4a",t,i)}},{key:"esds",value:function(e){var t=0<arguments.length&&void 0!==e?e:[43,146,8,0],i=t.length,r=new f.Buffer,n=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t).concat([6,1,2]));return r.write(d.size(8+n.byteLength),d.type("esds"),n),r.buffer}},{key:"avc1",value:function(e){var t=new f.Buffer,i=e.width,r=e.height,n=e.parRatio.height,a=e.parRatio.width,s=e.avcc,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,r>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),l=new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a]);return t.write(d.size(40+o.byteLength+s.byteLength+u.byteLength),d.type("avc1"),o,d.size(8+s.byteLength),d.type("avcC"),s,d.size(20),d.type("btrt"),u,d.size(16),d.type("pasp"),l),t.buffer}},{key:"stts",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return d.initBox(16,"stts",e)}},{key:"stsc",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return d.initBox(16,"stsc",e)}},{key:"stco",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return d.initBox(16,"stco",e)}},{key:"stsz",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return d.initBox(20,"stsz",e)}},{key:"mvex",value:function(e,t,i){var r=i,n=new f.Buffer,a=f.Buffer.writeUint32(e);return n.write(d.size(56),d.type("mvex"),d.size(16),d.type("mehd"),d.extension(0,0),a,d.trex(r)),n.buffer}},{key:"trex",value:function(e){var t=new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.initBox(8+t.byteLength,"trex",t)}},{key:"moof",value:function(e){var t=8,i=d.mfhd(),r=d.traf(e);return[i,r].forEach(function(e){t+=e.byteLength}),d.initBox(t,"moof",i,r)}},{key:"mfhd",value:function(){var e=f.Buffer.writeUint32(d.sequence);return d.sequence+=1,d.initBox(16,"mfhd",d.extension(0,0),e)}},{key:"traf",value:function(e){var t=8,i=d.tfhd(e.id),r=d.tfdt(e.time),n=d.sdtp(e),a=d.trun(e,n.byteLength);return[i,r,a,n].forEach(function(e){t+=e.byteLength}),d.initBox(t,"traf",i,r,a,n)}},{key:"tfhd",value:function(e){var t=f.Buffer.writeUint32(e);return d.initBox(16,"tfhd",d.extension(0,0),t)}},{key:"tfdt",value:function(e){return d.initBox(16,"tfdt",d.extension(0,0),f.Buffer.writeUint32(e))}},{key:"trun",value:function(e,t){var i=new f.Buffer,r=f.Buffer.writeUint32(e.samples.length),n=f.Buffer.writeUint32(92+16*e.samples.length+t);return i.write(d.size(20+16*e.samples.length),d.type("trun"),new Uint8Array([0,0,15,1]),r,n),e.samples.forEach(function(e){var t=e.flags;i.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))}),i.buffer}},{key:"sdtp",value:function(e){var r=new f.Buffer;return r.write(d.size(12+e.samples.length),d.type("sdtp"),d.extension(0,0)),e.samples.forEach(function(e){var t=e.flags,i=t.isLeading<<6|t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;r.write(new Uint8Array([i]))}),r.buffer}},{key:"mdat",value:function(e){var t=new f.Buffer,i=8;e.samples.forEach(function(e){i+=e.size}),t.write(d.size(i),d.type("mdat"));var r=new Uint8Array(i),n=0;return r.set(t.buffer,n),n+=8,e.samples.forEach(function(e){e.buffer.forEach(function(e){r.set(e,n),n+=e.byteLength})}),r}}]),d);function d(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d)}a.type=function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])},a.sequence=1,t.default=a},function(e,t,i){"use strict";e.exports={FetchLoader:i(33).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=i(0).EVENTS.LOADER_EVENTS,s=(r(o,[{key:"init",value:function(){this.on(a.LADER_START,this.load.bind(this))}},{key:"load",value:function(e,t){var i=this;this.url=e,this._canceled=!1;var r=this.getParams(t);return i.loading=!0,fetch(this.url,r).then(function(e){if(e.ok)return i.status=e.status,i._onFetchResponse(e);i.loading=!1,i.emit(a.LOADER_ERROR,i.TAG,new Error("invalid response."))}).catch(function(e){throw i.loading=!1,i.emit(a.LOADER_ERROR,i.TAG,e),new Error(e.message)})}},{key:"_onFetchResponse",value:function(e){var t=this,i=this._context.getInstance(this.buffer);this._loaderTaskNo++;var r=this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case 2:e.json().then(function(e){t.loading=!1,t._canceled||t._destroyed||(i?(i.push(e),t.emit(a.LOADER_COMPLETE,i)):t.emit(a.LOADER_COMPLETE,e))});break;case 1:e.text().then(function(e){t.loading=!1,t._canceled||t._destroyed||(i?(i.push(e),t.emit(a.LOADER_COMPLETE,i)):t.emit(a.LOADER_COMPLETE,e))});break;case 3:e.arrayBuffer().then(function(e){t.loading=!1,t._canceled||t._destroyed||(i?(i.push(new Uint8Array(e)),t.emit(a.LOADER_COMPLETE,i)):t.emit(a.LOADER_COMPLETE,e))});break;case 0:default:return this._onReader(e.body.getReader(),r)}}},{key:"_onReader",value:function(t,i){var r=this._context.getInstance(this.buffer);if(!r&&this._reader||this._destroyed)try{this._reader.cancel()}catch(e){}if(this._reader=t,!1!==this.loading){var n=this;this._reader&&this._reader.read().then(function(e){if(e.done)return n.loading=!1,n.status=0,void n.emit(a.LOADER_COMPLETE,r);if(!n._canceled&&!n._destroyed)return r.push(e.value),n.emit(a.LOADER_DATALOADED,r),n._onReader(t,i);if(n._reader)try{n._reader.cancel()}catch(e){}}).catch(function(e){n.loading=!1,n.emit(a.LOADER_ERROR,n.TAG,e)})}}},{key:"getParams",value:function(e){var t=Object.assign({},e),i=new Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"===u(this.configs.headers)){var n=this.configs.headers;for(var a in n)n.hasOwnProperty(a)&&i.append(a,n[a])}if("object"===u(t.headers)){var s=t.headers;for(var o in s)s.hasOwnProperty(o)&&i.append(o,s[o])}return!1===t.cors&&(r.mode="same-origin"),t.withCredentials&&(r.credentials="include"),r}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(e){}this._reader=null,this.loading=!1,this._canceled=!0}}},{key:"destroy",value:function(){this._destroyed=!0,this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),o);function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.configs=Object.assign({},e),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}t.default=s},function(e,t,i){"use strict";e.exports={M3U8Parser:i(35).default,TsDemuxer:i(36).default,Playlist:i(42).default,FlvDemuxer:i(43).default}},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(l,null,[{key:"parse",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:"",r={duration:0};if(e&&e.split){var n=e.split(/\r|\n/),a=(n=n.filter(function(e){return e})).shift();if(!a.match("#EXTM3U"))throw new Error('Invalid m3u8 file: not "#EXTM3U"');a=n.shift();for(var s=!1;a;){var o=a.match(/#(.[A-Z|-]*):(.*)/),u=a.match(/#(.[A-Z|-]*)/);if(u&&o&&2<o.length)switch(o[1]){case"EXT-X-VERSION":r.version=parseInt(o[2]);break;case"EXT-X-MEDIA-SEQUENCE":r.sequence=parseInt(o[2]);break;case"EXT-X-TARGETDURATION":r.targetduration=parseFloat(o[2]);break;case"EXTINF":l.parseFrag(o,n,r,i,s),s=!1;break;case"EXT-X-KEY":l.parseDecrypt(o[2],r)}if(u&&1<u.length)switch(u[1]){case"EXT-X-DISCONTINUITY":s=!0}a=n.shift()}return r}}},{key:"parseFrag",value:function(e,t,i,r,n){i.frags||(i.frags=[]);var a={start:i.duration,duration:1e3*parseFloat(e[2])};i.duration+=a.duration;var s=t.shift();s.match(/#(.*):(.*)/)&&(s=t.shift()),0<s.length&&"/"===s.charAt(0)&&r.match(/.*\/\/.*\.\w+/g)&&(r=r.match(/.*\/\/.*\.\w+/g)[0]),s.match(/.*:\/\/.*/)?a.url=s:a.url=r+s,a.discontinue=n,i.frags.push(a)}},{key:"parseURL",value:function(e){var t="",i=e.match(/(.*\/).*\.m3u8/);if(i&&0<i.length)for(var r=0;r<i.length;r++)i[r].match(/.*\/$/g)&&i[r].length>t.length&&(t=i[r]);return t}},{key:"parseDecrypt",value:function(e,t){t.encrypt={};var i=e.split(",");for(var r in i){var n=i[r];if(n.match(/METHOD=(.*)/)&&(t.encrypt.method=n.match(/METHOD=(.*)/)[1]),n.match(/URI="(.*)"/)&&(t.encrypt.uri=n.match(/URI="(.*)"/)[1]),n.match(/IV=0x(.*)/)){var a=n.match(/IV=0x(.*)/)[1],s=Math.ceil(a.length/2);t.encrypt.ivb=new Uint8Array(s);for(var o=s-1;0<=o;o--){var u=parseInt(a.substr(2*o,2),16);t.encrypt.ivb[o]=u}t.encrypt.iv=a}}}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l)}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=i(2),k=i(3),E=i(0);var S=E.EVENTS.DEMUX_EVENTS,a={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]},s=(r(w,[{key:"init",value:function(){this.on(S.DEMUX_START,this.demux.bind(this))}},{key:"demux",value:function(e){if(!this.demuxing){for(var t=this.inputBuffer,i={pat:[],pmt:[]},r={};188<=t.length;){for(1<=t.length&&71!==t.array[0][t.offset]&&this.emit(S.DEMUX_ERROR,this.TAG,new Error("Untrust sync code: "+t.array[0][t.offset]+", try to recover;"),!1);1<=t.length&&71!==t.array[0][t.offset];)t.shift(1);var n=t.shift(188),a=new E.Stream(n.buffer),s={};w.read(a,s,i),s.pes?(r[s.header.pid]||(r[s.header.pid]=[]),r[s.header.pid].push(s.pes),s.pes.ES.buffer=[s.pes.ES.buffer]):r[s.header.pid]&&r[s.header.pid][r[s.header.pid].length-1].ES.buffer.push(s.payload.stream)}for(var o=e,u=e,l=0;l<Object.keys(r).length;l++)for(var f=r[Object.keys(r)[l]],d=0;d<f.length;d++)f[d].id=Object.keys(r)[l],f[d].ES.buffer=w.Merge(f[d].ES.buffer),"audio"===f[d].type?(this.pushAudioSample(f[d],o),o={}):"video"===f[d].type&&(this.pushVideoSample(f[d],u),u={});this._hasAudioMeta&&this.emit(S.DEMUX_COMPLETE,"audio"),this._hasVideoMeta&&this.emit(S.DEMUX_COMPLETE,"video")}}},{key:"pushAudioSample",value:function(e,t){var i=void 0;this._tracks.audioTrack||(this._tracks.audioTrack=new k.AudioTrack),i=this._tracks.audioTrack;var r=new E.AudioTrackMeta({audioSampleRate:e.ES.frequence,sampleRate:e.ES.frequence,channelCount:e.ES.channel,codec:"mp4a.40."+e.ES.audioObjectType,config:e.ES.audioConfig,id:2,sampleRateIndex:e.ES.frequencyIndex});r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale);var n=w.compaireMeta(i.meta,r,!0);this._hasAudioMeta&&n||(i.meta=r,this._hasAudioMeta=!0,this.emit(S.METADATA_PARSED,"audio"));var a=new Uint8Array(e.ES.buffer.buffer.slice(e.ES.buffer.position,e.ES.buffer.length)),s=parseInt(e.pts/90),o=parseInt(e.pts/90),u=new E.AudioTrackSample({dts:s,pts:o,data:a,options:t});i.samples.push(u)}},{key:"pushVideoSample",value:function(e,t){var i=b.Nalunit.getNalunits(e.ES.buffer),r=void 0,n=new E.VideoTrackMeta;this._tracks.videoTrack||(this._tracks.videoTrack=new k.VideoTrack),r=this._tracks.videoTrack;for(var a=0,s=!1,o=!1,u=0;u<i.length;u++){var l=i[u];if(l.sps){s=l,r.sps=l.body,n.chromaFormat=s.sps.chroma_format,n.codec="avc1.";for(var f=1;f<4;f++){var d=s.body[f].toString(16);d.length<2&&(d="0"+d),n.codec+=d}n.codecHeight=s.sps.codec_size.height,n.codecWidth=s.sps.codec_size.width,n.frameRate=s.sps.frame_rate,n.id=1,n.level=s.sps.level_string,n.presentHeight=s.sps.present_size.height,n.presentWidth=s.sps.present_size.width,n.profile=s.sps.profile_string,n.refSampleDuration=Math.floor(n.timescale*(s.sps.frame_rate.fps_den/s.sps.frame_rate.fps_num)),n.sarRatio=s.sps.sar_ratio?s.sps.sar_ratio:s.sps.par_ratio}else l.pps?(r.pps=l.body,o=l):a+=4+l.body.byteLength}if(s&&o){n.avcc=b.Nalunit.getAvcc(s.body,o.body);var c=w.compaireMeta(r.meta,n,!0);this._hasVideoMeta&&c||(t?t.meta=Object.assign({},n):t={meta:Object.assign({},n)},r.meta=n,this._hasVideoMeta=!0,this.emit(S.METADATA_PARSED,"video"))}for(var h=new Uint8Array(a),p=0,v=!1,y=0;y<i.length;y++){var m=i[y],g=m.body.byteLength;m.idr&&(v=!0),m.pps||m.sps||(h.set(new Uint8Array([g>>>24&255,g>>>16&255,g>>>8&255,255&g]),p),p+=4,h.set(m.body,p),p+=g)}var _=new E.VideoTrackSample({dts:parseInt(e.dts/90),pts:parseInt(e.pts/90),cts:(e.pts-e.dts)/90,originDts:e.dts,isKeyframe:v,data:h,options:t});r.samples.push(_)}},{key:"destory",value:function(){this.off(S.DEMUX_START,this.demux),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}},{key:"inputBuffer",get:function(){return this._context.getInstance(this.configs.inputbuffer)}},{key:"_tracks",get:function(){return this._context.getInstance("TRACKS")}}],[{key:"compaireArray",value:function(e,t,i){var r=0,n=0;if("Uint8Array"===i?(r=e.byteLength,n=t.byteLength):"Array"===i&&(r=e.length,n=t.length),r!==n)return!1;for(var a=0;a<r;a++)if(e[a]!==t[a])return!1;return!0}},{key:"compaireMeta",value:function(e,t,i){if(!e||!t)return!1;for(var r=0,n=Object.keys(e).length;r<n;r++){var a=e[Object.keys(e)[r]],s=t[Object.keys(e)[r]];if("object"!==(void 0===a?"undefined":o(a))){if(i&&"duration"!==Object.keys(e)[r]&&"refSampleDuration"!==Object.keys(e)[r]&&"refSampleDurationFixed"!==Object.keys(e)[r]&&a!==s)return!1}else if(void 0!==a.byteLength){if(void 0===s.byteLength)return!1;if(!w.compaireArray(a,s,"Uint8Array"))return!1}else if(void 0!==a.length){if(void 0===s.length)return!1;if(!w.compaireArray(a,s,"Array"))return!1}else if(!w.compaireMeta(a,s))return!1}return!0}},{key:"Merge",value:function(e){for(var t=void 0,i=0,r=0,n=0;n<e.length;n++)i+=e[n].length-e[n].position;t=new Uint8Array(i);for(var a=0;a<e.length;a++){var s=e[a];t.set(new Uint8Array(s.buffer,s.position),r),r+=s.length-s.position}return new E.Stream(t.buffer)}},{key:"read",value:function(e,t,i){w.readHeader(e,t),w.readPayload(e,t,i),"MEDIA"!==t.header.packet||1!==t.header.payload||t.unknownPIDs||(t.pes=w.PES(t))}},{key:"readPayload",value:function(e,t,i){var r=t.header.pid;switch(r){case 0:w.PAT(e,t,i);break;case 1:w.CAT(e,t,i);break;case 2:w.TSDT(e,t,i);break;case 8191:break;default:if(i.pat.some(function(e){return e.pid===r}))w.PMT(e,t,i);else{var n=i.pmt?i.pmt.filter(function(e){return e.pid===r}):[];0<n.length?w.Media(e,t,a[n[0].streamType][0]):t.unknownPIDs=!0}}}},{key:"readHeader",value:function(e,t){var i={};i.sync=e.readUint8();var r=e.readUint16();i.error=r>>>15,i.payload=r>>>14&1,i.priority=r>>>13&1,i.pid=8191&r,r=e.readUint8(),i.scrambling=r>>6&3,i.adaptation=r>>4&3,i.continuity=15&r,i.packet=0===i.pid?"PAT":"MEDIA",t.header=i}},{key:"PAT",value:function(e,t,i){var r={},n=e.readUint8();e.skip(n),n=e.readUint8(),r.tabelID=n,n=e.readUint16(),r.error=n>>>7,r.zero=n>>>6&1,r.sectionLength=4095&n,r.streamID=e.readUint16(),r.current=1&e.readUint8(),r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();for(var a=(r.sectionLength-9)/4,s=[],o=0;o<a;o++){var u=e.readUint16(),l=8191&e.readUint16();s.push({program:u,pid:l,type:0===u?"network":"mapPID"})}0<s.length&&(i.pat=i.pat.concat(s)),r.list=s,r.program=e.readUint16(),r.pid=8191&e.readUint16(),t.payload=r}},{key:"PMT",value:function(e,t,i){var r={};t.header.packet="PMT";var n=e.readUint8();e.skip(n),n=e.readUint8(),r.tableID=n,n=e.readUint16(),r.sectionLength=4095&n,r.program=e.readUint16(),r.current=1&e.readUint8(),r.order=e.readUint8(),r.lastOrder=e.readUint8(),r.PCR_PID=8191&e.readUint16(),r.programLength=4095&e.readUint16();for(var a=(r.sectionLength-13)/5,s=[],o=0;o<a;o++)s.push({streamType:e.readUint8(),pid:8191&e.readUint16(),es:4095&e.readUint16()});r.list=s,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(s.map(function(e){return{pid:e.pid,es:e.es,streamType:e.streamType,program:r.program}})),t.payload=r}},{key:"Media",value:function(e,t,i){var r=t.header,n={};if(r.type=i,3===r.adaptation&&(n.adaptationLength=e.readUint8(),0<n.adaptationLength)){var a=e.readUint8();n.discontinue=a>>>7,n.access=a>>>6&1,n.priority=a>>>5&1,n.PCR=a>>>4&1,n.OPCR=a>>>3&1,n.splicePoint=a>>>2&1,n.transportPrivate=a>>>1&1,n.adaptationField=1&a;var s=e.position;if(1===n.PCR&&(n.programClockBase=e.readUint32()<<1,a=e.readUint16(),n.programClockBase|=a>>>15,n.programClockExtension=511&a),1===n.OPCR&&(n.originProgramClockBase=e.readUint32()<<1,a=e.readUint16(),n.originProgramClockBase+=a>>>15,n.originProgramClockExtension=511&a),1===n.splicePoint&&(n.spliceCountdown=e.readUint8()),1===n.transportPrivate)for(var o=e.readUint8(),u=[],l=0;l<o;l++)u.push(e.readUint8());if(1===n.adaptationField){var f=e.readUint8(),d=e.readUint8(),c=e.position,h=d>>>6&1,p=d>>>5&1;1==d>>>7&&(d=e.readUint16(),n.ltwValid=d>>>15,n.ltwOffset=61439&d),1==h&&(d=e.readUint24(),n.piecewiseRate=4194303&d),1==p&&(d=e.readInt8(),n.spliceType=d>>>4,n.dtsNextAU1=d>>>1&7,n.marker1=1&d,d=e.readUint16(),n.dtsNextAU2=d>>>1,n.marker2=1&d,d=e.readUint16(),n.dtsNextAU3=d),e.skip(f-1-(e.position-c))}var v=n.adaptationLength-1-(e.position-s);e.skip(v)}n.stream=new E.Stream(e.buffer.slice(e.position)),t.payload=n}},{key:"PES",value:function(e){var t={},i=e.payload.stream;if(1!==i.readUint24())t.ES={},t.ES.buffer=i;else{var r=i.readUint8();224<=r&&r<=239&&(t.type="video"),192<=r&&r<=223&&(t.type="audio");var n=i.readUint16();if(t.packetLength=n,"video"!==t.type&&"audio"!==t.type)throw new Error("format is not supported");var a=i.readUint8();if(2!=a>>>6)throw new Error("error when parse pes header");a=i.readUint8(),t.ptsDTSFlag=a>>>6,t.escrFlag=a>>>5&1,t.esRateFlag=a>>>4&1,t.dsmFlag=a>>>3&1,t.additionalFlag=a>>>2&1,t.crcFlag=a>>>1&1,t.extensionFlag=1&a,t.pesHeaderLength=i.readUint8();var s=t.pesHeaderLength;if(2===t.ptsDTSFlag){var o=[];a=i.readUint8(),o.push(a>>>1&7),a=i.readUint16(),o.push(a>>>1),a=i.readUint16(),o.push(a>>>1),t.pts=o[0]<<30|o[1]<<15|o[2],s-=5,"video"===t.type&&(t.dts=t.pts)}if(3===t.ptsDTSFlag){var u=[];a=i.readUint8(),u.push(a>>>1&7),a=i.readUint16(),u.push(a>>>1),a=i.readUint16(),u.push(a>>>1),t.pts=u[0]<<30|u[1]<<15|u[2];var l=[];a=i.readUint8(),l.push(a>>>1&7),a=i.readUint16(),l.push(a>>>1),a=i.readUint16(),l.push(a>>>1),t.dts=l[0]<<30|l[1]<<15|l[2],s-=10}if(1===t.escrFlag){var f=[],d=[];a=i.readUint8(),f.push(a>>>3&7),f.push(3&a),a=i.readUint16(),f.push(a>>>13),f.push(3&a),a=i.readUint16(),f.push(a>>>13),d.push(3&a),a=i.readUint8(),d.push(a>>>1),t.escr=300*(f[0]<<30|f[1]<<28|f[2]<<15|f[3]<<13|f[4])+(d[0]<<7|d[1]),s-=6}if(1===t.esRateFlag&&(a=i.readUint24(),t.esRate=a>>>1&4194303,s-=3),1===t.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===t.additionalFlag&&(a=i.readUint8(),t.additionalCopyInfo=127&a,s-=1),1===t.crcFlag&&(t.pesCRC=i.readUint16(),s-=2),1===t.extensionFlag)throw new Error("not support extension");0<s&&i.skip(s),t.ES=w.ES(i,t.type)}return t}},{key:"ES",value:function(e,t){var i=void 0,r={};if("video"===t){if(1!==(i=e.readUint32())&&(e.back(4),1!==(i=e.readUint24())))throw new Error("h264 nal header parse failed");e.skip(2),r.buffer=e}else{if("audio"!==t)throw new Error("ES "+t+" is not supported");if((i=e.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");r.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",r.layer=i>>>1&3,r.absent=1&i,i=e.readUint16(),r.audioObjectType=1+(i>>>14&3),r.profile=r.audioObjectType-1,r.frequencyIndex=i>>>10&15,r.frequence=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][r.frequencyIndex],r.channel=i>>>6&7,r.frameLength=(3&i)<<11|e.readUint16()>>>5,w.getAudioConfig(r),e.skip(1),r.buffer=e}return r}},{key:"TSDT",value:function(e,t){t.payload={}}},{key:"CAT",value:function(e,t){var i={};i.tableID=e.readUint8();var r=e.readUint16();i.sectionIndicator=r>>>7,i.sectionLength=4095&r,e.skip(2),r=e.readUint8(),i.version=r>>>3,i.currentNextIndicator=1&r,i.sectionNumber=e.readUint8(),i.lastSectionNumber=e.readUint8();for(var n=(this.sectionLength-9)/4,a=[],s=0;s<n;s++)a.push({});i.crc32=e.readUint32(),t.payload=i}},{key:"getAudioConfig",value:function(e){var t=navigator.userAgent.toLowerCase(),i=void 0,r=void 0;r=/firefox/i.test(t)?6<=e.frequencyIndex?(e.audioObjectType=5,i=new Array(4),e.frequencyIndex-3):(e.audioObjectType=2,i=new Array(2),e.frequencyIndex):-1!==t.indexOf("android")?(e.audioObjectType=2,i=new Array(2),e.frequencyIndex):(e.audioObjectType=5,i=new Array(4),6<=e.frequencyIndex?e.frequencyIndex-3:(1===e.channel&&(e.audioObjectType=2,i=new Array(2)),e.frequencyIndex)),i[0]=e.audioObjectType<<3,i[0]|=(14&e.frequencyIndex)>>1,i[1]=(1&e.frequencyIndex)<<7,i[1]|=e.channel<<3,5===e.audioObjectType&&(i[1]|=(14&r)>>1,i[2]=(1&r)<<7,i[2]|=8,i[3]=0),e.audioConfig=i}}]),w);function w(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),this.configs=Object.assign({},e),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(9),o=(a=s)&&a.__esModule?a:{default:a};var u=(r(l,null,[{key:"getNalunits",value:function(e){if(e.length-e.position<4)return[];var t=e.dataview,i=e.position;return 1===t.getInt32(i)||0===t.getInt16(i)&&1===t.getInt8(i+2)?l.getAnnexbNals(e):l.getAvccNals(e)}},{key:"getAnnexbNals",value:function(e){for(var t=[],i=l.getHeaderPositionAnnexB(e),r=i.pos,n=r;r<e.length-4;){var a=e.buffer.slice(r,r+i.headerLength);i.pos===e.position&&e.skip(i.headerLength),n=(i=l.getHeaderPositionAnnexB(e)).pos;var s={header:a,body:new Uint8Array(e.buffer.slice(r+a.byteLength,n))};l.analyseNal(s),t.push(s),e.skip(n-e.position),r=n}return t}},{key:"getAvccNals",value:function(e){for(var t=[];e.position<e.length-4;){var i=e.dataview.getInt32();if(!(e.length-e.position>=i))break;var r=e.buffer.slice(e.position,e.position+4);e.skip(4);var n=e.buffer.slice(e.position,e.position+i);e.skip(i);var a={header:r,body:n};l.analyseNal(a),t.push(a)}return t}},{key:"analyseNal",value:function(e){switch(31&e.body[0]){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:break;case 7:e.sps=o.default.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,i=0;3!==i&&4!==i&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(i=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=e.length)),{pos:t,headerLength:i}}},{key:"getAvcc",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength+11);i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225;var r=6;return i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),r),r+=2,i.set(e,r),i[r+=e.byteLength]=1,r++,i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),r),r+=2,i.set(t,r),i}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l)}t.default=u},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),i=this._currentWord>>>32-t;if(32<e)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,0<this._currentWordBitsLeft?this._currentWord<<=t:0<this._totalBytes-this._bufferIndex&&this._fillCurrentWord(),0<(t=e-t)&&this._currentWordBitsLeft?i<<t|this.readBits(t):i}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.TAG="Golomb",this._buffer=e,this._bufferIndex=0,this._totalBytes=e.byteLength,this._totalBits=8*e.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(0),o=i(40),L=(a=o)&&a.__esModule?a:{default:a};var u=s.EVENTS.REMUX_EVENTS,l=s.EVENTS.LOADER_EVENTS,f=(r(M,[{key:"init",value:function(){var e=this;this.before(u.REMUX_MEDIA,this.doFix.bind(this)),this.on(l.LOADER_COMPLETE,function(){e.videoLastSample&&e.videoTrack.samples.unshift(e.videoLastSample)})}},{key:"reset",value:function(){this.nextAudioDts=null,this.nextVideoDts=null,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.filledAudioSamples=[],this.filledVideoSamples=[]}},{key:"doFix",value:function(){var e=this.getFirstSample(),t=e.isFirstAudioSamples,i=e.isFirstVideoSamples;this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples);var r=M.detactChangeStream(this.videoTrack.samples),n=r.changed,a=r.changedIdx;n&&!t?this.fixChangeStreamVideo(a):this.doFixVideo(i);var s=M.detactChangeStream(this.audioTrack.samples),o=s.changed,u=s.changedIdx;o?this.fixChangeStreamAudio(u):this.doFixAudio(t),this.removeInvalidSamples()}},{key:"doFixVideo",value:function(e,t){for(var i=this.videoTrack,r=i.samples,n=i.meta,a=0,s=r.length;a<s;a++){var o=r[a];o.originDts=o.dts}if((!n.frameRate||!1!==n.frameRate.fixed)&&r&&r.length&&this._firstVideoSample){var u=r[0];if(r.length,0<this._videoLargeGap&&M.doFixLargeGap(r,this._videoLargeGap),u.dts!==this._firstVideoSample.dts&&t&&(t&&(this.nextVideoDts=t),this._videoLargeGap=this.nextVideoDts-u.dts,M.doFixLargeGap(r,this._videoLargeGap)),u.dts,e&&this._firstAudioSample){var l=this._firstVideoSample.dts,f=l-this._firstAudioSample.dts;if(f>2*n.refSampleDuration)for(var d=Math.floor(f/n.refSampleDuration),c=0;c<d;c++){var h=Object.assign({},u);h.dts=l-(c+1)*n.refSampleDuration,h.pts=h.dts+h.cts,r.unshift(h),this.filledVideoSamples.push({dts:h.dts,size:h.data.byteLength})}}var p=r.pop();if(r.length&&(r[r.length-1].duration=p.dts-r[r.length-1].dts),this.videoLastSample){var v=this.videoLastSample;v.duration=u.dts-v.dts,r.unshift(this.videoLastSample)}this.videoLastSample=p,this.videoTrack.samples=r}}},{key:"doFixAudio",value:function(e,t){var i=this.audioTrack,r=i.samples,n=i.meta;if(r&&r.length){for(var a=0,s=r.length;a<s;a++){var o=r[a];o.originDts=o.dts}var u=r.length,l=L.default.getSilentFrame(n.codec,n.channelCount),f=this._firstAudioSample,d=r[0];if(0<this._audioLargeGap&&M.doFixLargeGap(r,this._audioLargeGap),d.dts!==this._firstAudioSample.dts&&(t||M.detectLargeGap(this.nextAudioDts,d))&&(t&&(this.nextAudioDts=t),this._audioLargeGap=this.nextAudioDts-d.dts,M.doFixLargeGap(r,this._audioLargeGap)),this._firstVideoSample&&e){var c=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(f.dts-c>n.refSampleDuration)for(var h=Math.floor((f.dts-c)/n.refSampleDuration),p=0;p<h;p++){var v={data:l,datasize:l.byteLength,dts:f.dts-(p+1)*n.refSampleDuration,filtered:0};r.unshift(v),this.filledAudioSamples.push({dts:v.dts,size:v.data.byteLength})}}var y=void 0,m=r[0].dts;if(this.nextAudioDts){y=m-this.nextAudioDts;var g=Math.abs(y);if(g>n.refSampleDuration&&1===u&&1===this.lastAudioSamplesLen&&(n.refSampleDurationFixed=void 0),y>2*n.refSampleDuration)if(1===u&&1===this.lastAudioSamplesLen)n.refSampleDurationFixed=void 0!==n.refSampleDurationFixed?n.refSampleDurationFixed+y:n.refSampleDuration+y;else for(var _=Math.floor(y/n.refSampleDuration),b=0;b<_;b++){var k=m-(b+1)*n.refSampleDuration,E=Object.assign({},r[0],{dts:k>this.nextAudioDts?k:this.nextAudioDts});this.filledAudioSamples.push({dts:E.dts,size:E.data.byteLength}),this.audioTrack.samples.unshift(E)}else g<=n.refSampleDuration&&0<g?(r[0].dts=this.nextAudioDts,r[0].pts=this.nextAudioDts):y<0&&M.doFixLargeGap(r,-1*y)}var S=r[r.length-1].originDts,w=r[r.length-1].originDts,A=2<=r.length?S-r[r.length-2].originDts:n.refSampleDuration;this.lastAudioSamplesLen=u,this.nextAudioDts=n.refSampleDurationFixed?w+n.refSampleDurationFixed:w+A,this.lastAudioDts=w,r[r.length-1].duration=A;for(var T=0,O=r.length;T<O;T++){var D=r[T],R=r[T+1];if(!R)break;var U=R.dts-D.dts;r[T].duration=U}this.audioTrack.samples=M.sortAudioSamples(r)}}},{key:"fixChangeStreamVideo",value:function(e){var t=this.videoTrack,i=t.samples,r=t.meta,n=0===e?this.getStreamChangeStart(i[0]):i[e-1].dts,a=i[e].dts;if(Math.abs(n-a)<=2*r.refSampleDuration)return i[e].options?i[e].options.isContinue=!0:i[e].options={isContinue:!0},this.doFixVideo(!1);var s=i.slice(0,e),o=i.slice(e),u=i[0],l=o[0].dts-u.dts,f=u.options&&u.options.start+l?u.options.start:null;this.videoTrack.samples=i.slice(0,e),this.doFixVideo(!1),this.videoTrack.samples=i.slice(e),this.doFixVideo(!1,f),this.videoTrack.samples=s.concat(o)}},{key:"fixChangeStreamAudio",value:function(e){var t=this.audioTrack,i=t.samples,r=t.meta,n=0===e?this.getStreamChangeStart(i[0]):i[e-1].dts,a=i[e].dts;if(Math.abs(n-a)<=2*r.refSampleDuration)return i[e].options?i[e].options.isContinue=!0:i[e].options={isContinue:!0},this.doFixAudio(!1);var s=i.slice(0,e),o=i.slice(e),u=i[0],l=o[0].dts-u.dts,f=u.options&&u.options.start+l?u.options.start:null;this.audioTrack.samples=s,this.doFixAudio(!1),this.audioTrack.samples=o,this.doFixAudio(!1,f),this.audioTrack.samples=s.concat(o)}},{key:"getFirstSample",value:function(){var e=this.videoTrack.samples,t=this.audioTrack.samples,i=!1,r=!1;return!this._firstVideoSample&&e.length&&(this._firstVideoSample=M.findFirstVideoSample(e),i=!0),!this._firstAudioSample&&t.length&&(this._firstAudioSample=M.findFirstAudioSample(t),r=!0),{isFirstVideoSamples:i,isFirstAudioSamples:r}}},{key:"fixRefSampleDuration",value:function(e,t){var i="video"===e.type,r=i?this.allVideoSamplesCount:this.allAudioSamplesCount,n=i?this._firstVideoSample.dts:this._firstAudioSample.dts,a=i?this.filledVideoSamples.length:this.filledAudioSamples.length;if(!e.refSampleDuration||e.refSampleDuration<=0||Number.isNaN(e.refSampleDuration)){if(1<=t.length){var s=t[t.length-1].dts;e.refSampleDuration=Math.floor((s-n)/(r+a-1))}}else if(e.refSampleDuration&&5<=t.length){var o=(t[t.length-1].dts-t[0].dts)/(t.length-1);e.refSampleDuration=Math.floor(Math.abs(e.refSampleDuration-o)<=5?e.refSampleDuration:o)}}},{key:"recordSamplesCount",value:function(){var e=this.audioTrack,t=this.videoTrack;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){var i=this._firstVideoSample,r=this._firstAudioSample;this.audioTrack.samples=this.audioTrack.samples.filter(function(e,t){return e===r||e.dts>r.dts}),this.videoTrack.samples=this.videoTrack.samples.filter(function(e,t){return e===i||e.dts>i.dts})}},{key:"getStreamChangeStart",value:function(e){return e.options&&e.options.start?e.options.start-this.dtsBase:1/0}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks?this.tracks.audioTrack:null}},{key:"videoTrack",get:function(){return this.tracks?this.tracks.videoTrack:null}},{key:"dtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e?e._dtsBase:0}}],[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:e.sort(function(e,t){return e.dts-t.dts})}},{key:"findFirstAudioSample",value:function(e){return e&&0!==e.length?M.sortAudioSamples(e)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;for(var t=e.sort(function(e,t){return e.dts-t.dts}),i=0,r=t.length;i<r;i++)if(t[i].isKeyframe)return t[i]}},{key:"detectLargeGap",value:function(e,t){if(null!==e){var i=t.dts||0,r=1e3<=e-i||1e3<=i-e,n=t.options&&t.options.discontinue;return r||n}}},{key:"doFixLargeGap",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];n.dts+=t,n.pts&&(n.pts+=t)}}},{key:"detactChangeStream",value:function(e){for(var t=!1,i=-1,r=0,n=e.length;r<n;r++)if(e[r].options&&e[r].options.meta){t=!0,i=r;break}return{changed:t,changedIdx:i}}}]),M);function M(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,M),this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.videoLastSample=null,this.audioLastSample=null,this._videoLargeGap=0,this._audioLargeGap=0}t.default=f},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});function a(){n(this,a),this.mimetype="",this.init=null,this.data=[]}var s=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(o,[{key:"getSource",value:function(e){return this.sources[e]}},{key:"createSource",value:function(e){return this.sources[e]=new a,this.sources[e]}},{key:"clear",value:function(){this.sources={}}},{key:"destroy",value:function(){this.sources={}}}]),o);function o(){n(this,o),this.sources={}}t.default=s},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"push",value:function(e,t,i){this._ts[e]||(this._ts[e]={duration:t,downloaded:!1,downloading:!1,start:this.duration,discontinue:!!i},this._list[this.duration]=e,this.duration+=t,this.fragLength+=1)}},{key:"deleteFrag",value:function(e){this._ts[e]&&(this._ts[e].start>this._lastget.time&&(this._lastget={duration:this._ts[e].duration,time:this._ts[e].start,downloaded:!1,downloading:!1,url:e}),delete this._list[this._ts[e].start],delete this._ts[e],this.fragLength-=1)}},{key:"pushM3U8",value:function(e,t){if(!e)throw new Error("No m3u8 data received.");if(this.version=e.version,this.targetduration=e.targetduration,e.encrypt&&!this.encrypt&&(this.encrypt=e.encrypt),!(e.sequence>this.sequence))throw new Error("Old m3u8 file received, "+e.sequence);this.sequence=e.sequence;for(var i=[],r=0;r<e.frags.length;r++){var n=e.frags[r];this._ts[n.url]||(i.push(n.url),this.push(n.url,n.duration,n.discontinue))}if(i.length<1)throw new Error("Can not read ts file list.");if(t)for(var a=this.getTsList(),s=0;s<a.length;s++)i.indexOf(a[s])<0&&this.deleteFrag(a[s])}},{key:"getTsList",value:function(){return Object.keys(this._ts)}},{key:"downloaded",value:function(e,t){var i=this._ts[e];i&&(i.downloaded=t)}},{key:"downloading",value:function(e,t){var i=this._ts[e];i&&(i.downloading=t)}},{key:"getTsByName",value:function(e){return this._ts[e]}},{key:"getTs",value:function(e){var t=Object.keys(this._list),i=void 0;if(void 0===e&&(e=this._lastget?this._lastget.time+this._lastget.duration:0),!(t.length<1||e>=this.duration)){t.sort(function(e,t){return parseFloat(e)-parseFloat(t)});for(var r=0;r<t.length&&e>=parseInt(t[r]);r++){var n=this._list[t[r]];i={url:n,downloaded:this._ts[n].downloaded,downloading:this._ts[n].downloading,time:parseInt(t[r]),duration:parseInt(this._ts[n].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=i}return i}}},{key:"clear",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}},{key:"clearDownloaded",value:function(){for(var e=0,t=Object.keys(this._ts).length;e<t;e++){var i=this._ts[Object.keys(this._ts)[e]];i.downloaded=!1,i.downloading=!1}}},{key:"destroy",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=!1}},{key:"list",get:function(){return this._list}},{key:"baseURL",set:function(e){this.baseURL!==e&&(this.clear(),this._baseURL=e)},get:function(){return this._baseURL}}]),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=e.autoclear||!1}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,_=i(0),b=i(2),s=i(3),o=i(44),f=(a=o)&&a.__esModule?a:{default:a};var d=_.EVENTS.DEMUX_EVENTS,u=(r(l,[{key:"init",value:function(){this.on(d.DEMUX_START,this.doParseFlv.bind(this))}},{key:"doParseFlv",value:function(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;for(var e=1e4;this._parseFlvTag()&&0<e--;);this.emit(d.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;var t=this.loaderBuffer.shift(13);this.parseFlvHeader(t),this.doParseFlv()}}},{key:"parseFlvHeader",value:function(e){if(l.isFlvFile(e)){this._firstFragmentLoaded=!0;var t=l.getPlayType(e[4]);t.hasVideo&&this.initVideoTrack(),t.hasAudio&&this.initAudioTrack()}else this.emit(d.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}},{key:"initVideoTrack",value:function(){this._trackNum++;var e=new s.VideoTrack;e.meta=new _.VideoTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;var e=new s.AudioTrack;e.meta=new _.AudioTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"_parseFlvTag",value:function(){if(this.loaderBuffer.length<11)return null;var e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}},{key:"_parseFlvTagHeader",value:function(){var e=0,t={},i=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&i)>>>5,t.tagType=31&i,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&0<this.loaderBuffer.length&&this.loaderBuffer.shift(1),this.emit(d.DEMUX_ERROR,this.TAG,new Error("tagType "+t.tagType),!1),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);var r=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);var n=this.loaderBuffer.shift(1)[0];return 0<n&&(r+=16777216*n),t.dts=r,this.loaderBuffer.shift(3),t}},{key:"_processChunk",value:function(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}},{key:"_parseScriptData",value:function(e){var t=this.tracks.audioTrack,i=this.tracks.videoTrack,r=this.loaderBuffer.shift(e.datasize),n=(new f.default).resolve(r,r.length),a=this._context.onMetaData=n?n.onMetaData:void 0;if(this._context.mediaInfo.duration=a.duration,this._context.mediaInfo.hasVideo=a.hasVideo,this._context.mediaInfo.hsaAudio=a.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(d.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){var s=t.meta;switch(a.audiosamplerate&&(s.sampleRate=a.audiosamplerate),a.audiochannels&&(s.channelCount=a.audiochannels),a.audiosamplerate){case 44100:s.sampleRateIndex=4;break;case 22050:s.sampleRateIndex=7;break;case 11025:s.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){var o=i.meta;if("number"==typeof a.framerate){var u=Math.floor(1e3*a.framerate);if(0<u){var l=u/1e3;o.frameRate||(o.frameRate={}),o.frameRate.fixed=!0,o.frameRate.fps=l,o.frameRate.fps_num=u,o.frameRate.fps_den=1e3}}}}},{key:"_aacSequenceHeaderParser",value:function(e){var t={hasSpecificConfig:!0};t.objectType=e[1]>>>3,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2],t.codec="mp4a.40."+t.objectType;var i=window.navigator.userAgent.toLowerCase(),r=void 0,n=void 0,a=t.sampleRateIndex;return-1!==i.indexOf("firefox")?r=6<=t.sampleRateIndex?(t.objectType=5,n=new Array(4),a-3):(t.objectType=2,n=new Array(2),a):-1!==i.indexOf("android")?(t.objectType=2,n=new Array(2),r=a):(t.objectType=5,r=t.sampleRateIndex,n=new Array(4),6<=t.sampleRateIndex?r=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,n=new Array(2),r=t.sampleRateIndex)),n[0]=t.objectType<<3,n[0]|=(15&t.sampleRateIndex)>>>1,n[1]=(15&t.sampleRateIndex)<<7,n[1]|=(15&t.channelCount)<<3,5===t.objectType&&(n[1]|=(15&r)>>>1,n[2]=(1&r)<<7,n[2]|=8,n[3]=0),t.config=n,t}},{key:"_parseAACData",value:function(e){var t=this.tracks.audioTrack;if(t){var i=t.meta;i||(t.meta=new _.AudioTrackMeta,i=t.meta);var r=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);var n=(240&r)>>>4;10!=(t.format=n)&&this.emit(d.DEMUX_ERROR,new Error("invalid audio format: "+n)),10!=n||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(r),i.sampleRateIndex=(12&r)>>>2,i.frameLenth=(2&r)>>>1,i.channelCount=1&r,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));var a=i.audioSampleRate,s=i.sampleRateIndex,o=i.refSampleDuration;delete e.tagType;var u=this._datasizeValidator(e.datasize);if(0===e.data[0]){var l=this._aacSequenceHeaderParser(e.data);a=l.audiosamplerate||i.audioSampleRate,s=l.sampleRateIndex||i.sampleRateIndex,o=Math.floor(1024/a*i.timescale),i.channelCount=l.channelCount,i.sampleRate=a,i.sampleRateIndex=s,i.refSampleDuration=o,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=l.config;var f=this._context.mediaInfo.audio;f.codec=l.codec,f.channelCount=l.channelCount,f.sampleRate=a,f.sampleRateIndex=l.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(d.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&this.emit(d.AUDIO_METADATA_CHANGE),this._hasAudioSequence=!0,this._metaChange=!0}else this._metaChange&&(e.options={meta:t.meta},this._metaChange=!1),e.data=e.data.slice(1,e.data.length),t.samples.push(e);u||this.emit(d.DEMUX_ERROR,this.TAG,new Error("TAG length error at "+e.datasize),!1)}}},{key:"_parseHevcData",value:function(e){var t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;var i=15&t;if(this.tracks.videoTrack.codecID=i,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12==i){var r=this.loaderBuffer.shift(e.datasize-5);if(e.data=r,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.emit(d.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1);var n={},a=0;for(n.cts=e.cts,n.dts=e.dts;e.data.length>a;){var s=e.data.slice(Number.parseInt(a),4+a);n.size=s[3],n.size+=256*s[2],n.size+=256*s[1]*256,n.size+=256*s[0]*256*256,a+=4,n.data=e.data.slice(Number.parseInt(a),n.size+a),a+=n.size,this.tracks.videoTrack.samples.push(n),this.emit(d.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(d.METADATA_PARSED,"video"):this.emit(d.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1))}else if(7==i){var o=this.loaderBuffer.shift(e.datasize-5);if(0===o[4]&&0===o[5]&&0===o[6]&&1===o[7]){for(var u=0,l=0;l<4;l++)u=256*u+o[l];u-=4,(o=o.slice(4,o.length))[3]=u%256,u=(u-o[3])/256,o[2]=u%256,u=(u-o[2])/256,o[1]=u%256,o[0]=(u-o[1])/256}if(e.data=o,0===e.avcPacketType)this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(d.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&this.emit(d.VIDEO_METADATA_CHANGE),this._hasVideoSequence=!0),this._metaChange=!0;else{if(!this._datasizeValidator(e.datasize))return void this.emit(d.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1);this._metaChange&&(e.options={meta:Object.assign({},this.tracks.videoTrack.meta)},this._metaChange=!1),this.tracks.videoTrack.samples.push(e)}}else this.emit(d.DEMUX_ERROR,this.TAG,new Error("video codeid is "+i),!1),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.emit(d.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1),this.tracks.videoTrack.samples.push(e),this.emit(d.DEMUX_COMPLETE);delete e.tagType}},{key:"_avcSequenceHeaderParser",value:function(e){var t=this.tracks.videoTrack;if(t){var i=0;t.meta||(t.meta=new _.VideoTrackMeta);var r=t.meta;r.configurationVersion=e[0],r.avcProfileIndication=e[1],r.profileCompatibility=e[2],r.avcLevelIndication=e[3]/10,r.nalUnitLength=1+(3&e[4]);var n=31&e[5];i=6;for(var a={},s=0;s<n;s++){var o=255*e[i]+e[i+1];i+=2;for(var u=new Uint8Array(o),l=0;l<o;l++)u[l]=e[i+l];for(var f="avc1.",d=1;d<4;d++){var c=u[d].toString(16);c.length<2&&(c="0"+c),f+=c}r.codec=f,i+=o,this.tracks.videoTrack.meta.sps=u,a=b.SpsParser.parseSPS(u)}var h=e[i];i++;for(var p=0;p<h;p++){var v=255*e[i]+e[i+1];i+=2;for(var y=new Uint8Array(v),m=0;m<v;m++)y[m]=e[i+m];i+=v,this.tracks.videoTrack.meta.pps=y}Object.assign(r,b.SpsParser.toVideoMeta(a));var g=this._context.mediaInfo.video;g.codec=r.codec,g.profile=r.profile,g.level=r.level,g.chromaFormat=r.chromaFormat,g.frameRate=r.frameRate,g.parRatio=r.parRatio,g.width=g.width===r.presentWidth?g.width:r.presentWidth,g.height=g.height===r.presentHeight?g.width:r.presentHeight,r.duration=this._context.mediaInfo.duration*r.timescale,r.avcc=new Uint8Array(e.length),r.avcc.set(e),t.meta=r}}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e){var t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}},{key:"loaderBuffer",get:function(){var e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(d.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}}],[{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=i(0);var D=0,R=1,U=2,L=3,M=8,x=9,C=10,P=11,B=12,a=(r(s,[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");var i={},r=this.parseValue(e),n=this.parseValue(e,t-r.bodySize);return i[r.data]=n.data,this.resetStatus(),i}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t=new DataView(e,this.readOffset).getUint16(0,!O.isLe),i="";i=0<t?O.UTF8.decode(new Uint8Array(e,this.readOffset+2,t)):"";var r=t+2;return this.readOffset+=r,{data:i,bodySize:t+2}}},{key:"parseDate",value:function(e,t){var i=new DataView(e,this.readOffset,t),r=i.getFloat64(0,!O.isLe);return r+=60*i.getInt16(8,!O.isLe)*1e3,this.readOffset+=10,{data:new Date(r),bodySize:10}}},{key:"parseObject",value:function(e,t){var i=this.parseString(e,t),r=this.parseValue(e,t-i.bodySize);return{data:{name:i.data,value:r.data},bodySize:i.bodySize+r.bodySize,isObjEnd:r.isObjEnd}}},{key:"parseLongString",value:function(e){var t=new DataView(e,this.readOffset).getUint32(0,!O.isLe),i="";return i=0<t?O.UTF8.decode(new Uint8Array(e,this.readOffset+2,t)):"",this.readOffset+=t+4,{data:i,bodySize:t+4}}},{key:"parseValue",value:function(e,t){var i=new ArrayBuffer;i=e instanceof ArrayBuffer?e:e.buffer;var r=D,n=R,a=U,s=L,o=M,u=x,l=C,f=P,d=B,c=new DataView(i,this.readOffset,t),h=!1,p=c.getUint8(0),v=1;this.readOffset+=1;var y=null;switch(p){case r:y=c.getFloat64(1,!O.isLe),this.readOffset+=8,v+=8;break;case n:y=!!c.getUint8(1),this.readOffset+=1,v+=1;break;case a:var m=this.parseString(i);y=m.data,v+=m.bodySize;break;case s:y={};var g=0;for(16777215&c.getUint32(t-4,!O.isLe)&&(g=3);v<t-4;){var _=this.parseObject(i,t-v-g);if(_.isObjectEnd)break;y[_.data.name]=_.data.value,v+=_.bodySize}v<=t-3&&9==(16777215&c.getUint32(v-1,!O.isLe))&&(this.readOffset+=3,v+=3);break;case o:y={},v+=4,this.readOffset+=4;var b=0;for(9==(16777215&c.getUint32(t-4,!O.isLe))&&(b=3);v<t-8;){var k=this.parseObject(i,t-v-b);if(k.isObjectEnd)break;y[k.data.name]=k.data.value,v+=k.bodySize}v<=t-3&&9==(16777215&c.getUint32(v-1,!O.isLe))&&(v+=3,this.readOffset+=3);break;case u:h=!(y=null);break;case l:y=[];var E=c.getUint32(1,!O.isLe);v+=4,this.readOffset+=4;for(var S=0;S<E;S++){var w=this.parseValue(i,t-v);y.push(w.data),v+=w.bodySize}break;case f:var A=this.parseDate(i,t-1);y=A.data,v+=A.bodySize;break;case d:var T=this.parseLongString(i,t-1);y=T.data,v+=T.bodySize;break;default:v=t}return{data:y,bodySize:v,isObjEnd:h}}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.offset=0,this.readOffset=this.offset}t.default=a}]);