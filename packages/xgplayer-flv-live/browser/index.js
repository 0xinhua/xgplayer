window.FlvPlayer=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=47)}([function(e,t,i){"use strict";e.exports={Context:i(12).default,EVENTS:i(14).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,MediaInfo:i(5).default,MediaSample:i(19).default,MediaSegment:i(20).default,MediaSegmentList:i(21).default,AudioTrackMeta:i(6).AudioTrackMeta,VideoTrackMeta:i(6).VideoTrackMeta,AudioTrackSample:i(7).AudioTrackSample,VideoTrackSample:i(7).VideoTrackSample,Mse:i(22).default,Stream:i(8).default,Buffer:i(23).default,MobileVideo:i(26)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}}t.default=r;t.AudioTrack=class extends r{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}};t.VideoTrack=class extends r{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}};t.Tracks=class{constructor(){this.audioTrack=null,this.videoTrack=null}}},function(e,t,i){"use strict";e.exports={Nalunit:i(9).default,SpsParser:i(10).default,Compatibility:i(41).default}},function(e,t,i){"use strict";e.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(11).XgBuffer,RemuxBuffer:i(11).RemuxBuffer,PreSource:i(43).default}},function(e,t){e.exports=window.Player},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=e=>{for(let t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0};class s{constructor(){this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}isComplete(){return s.isBaseInfoReady(this)&&s.isVideoReady(this)&&s.isAudioReady(this)}static isBaseInfoReady(e){return r(e)}static isVideoReady(e){return!e.hasVideo||r(e.video)}static isAudioReady(e){return!e.hasAudio||r(e.video)}}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AudioTrackMeta=class{constructor(e){const t={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return e?Object.assign({},t,e):t}};t.VideoTrackMeta=class{constructor(e){const t={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return e?Object.assign({},t,e):t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){let t=r.getDefault();return e?Object.assign({},t,e):t}static getDefault(){return{dts:null,pts:null,data:new Uint8Array}}}t.AudioTrackSample=r;class s{constructor(e){let t=s.getDefault();return e?Object.assign({},t,e):t}static getDefault(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}t.VideoTrackSample=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){if(!(e instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(e){this.dataview.position=e}get position(){return this.dataview.position}back(e){this.position-=e}skip(e){let t=Math.floor(e/4),i=e%4;for(let e=0;e<t;e++)r.readByte(this.dataview,4);i>0&&r.readByte(this.dataview,i)}static readByte(e,t,i){let r;switch(t){case 1:r=i?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=i?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(i)throw new Error("not supported for readByte 3");r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=i?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(i)throw new Error("not supported for readBody 8");r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}readUint8(){return r.readByte(this.dataview,1)}readUint16(){return r.readByte(this.dataview,2)}readUint24(){return r.readByte(this.dataview,3)}readUint32(){return r.readByte(this.dataview,4)}readUint64(){return r.readByte(this.dataview,8)}readInt8(){return r.readByte(this.dataview,1,!0)}readInt16(){return r.readByte(this.dataview,2,!0)}readInt32(){return r.readByte(this.dataview,4,!0)}writeUint32(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(10),n=(r=s)&&r.__esModule?r:{default:r};class a{static getNalunits(e){if(e.length-e.position<4)return[];let t=e.dataview,i=e.position;return 1===t.getInt32(i)||0===t.getInt16(i)&&1===t.getInt8(i+2)?a.getAnnexbNals(e):a.getAvccNals(e)}static getAnnexbNals(e){let t=[],i=a.getHeaderPositionAnnexB(e),r=i.pos,s=r;for(;r<e.length-4;){let n=e.buffer.slice(r,r+i.headerLength);i.pos===e.position&&e.skip(i.headerLength),s=(i=a.getHeaderPositionAnnexB(e)).pos;let o={header:n,body:new Uint8Array(e.buffer.slice(r+n.byteLength,s))};a.analyseNal(o),t.push(o),e.skip(s-e.position),r=s}return t}static getAvccNals(e){let t=[];for(;e.position<e.length-4;){let i=e.dataview.getInt32(e.position);if(!(e.length-e.position>=i))break;{let r=e.buffer.slice(e.position,e.position+4);e.skip(4);let s=e.buffer.slice(e.position,e.position+i);e.skip(i);let n={header:r,body:s};a.analyseNal(n),t.push(n)}}return t}static analyseNal(e){switch(31&e.body[0]){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:break;case 7:e.sps=n.default.parseSPS(e.body);break;case 8:e.pps=!0}}static getHeaderPositionAnnexB(e){let t=e.position,i=0;for(;3!==i&&4!==i&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(i=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=e.length)),{pos:t,headerLength:i}}static getAvcc(e,t){let i=new Uint8Array(e.byteLength+t.byteLength+11);i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225;let r=6;return i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),r),r+=2,i.set(e,r),i[r+=e.byteLength]=1,r++,i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),r),r+=2,i.set(t,r),i}}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(29),n=(r=s)&&r.__esModule?r:{default:r};class a{static _ebsp2rbsp(e){let t=e,i=t.byteLength,r=new Uint8Array(i),s=0;for(let e=0;e<i;e++)e>=2&&3===t[e]&&0===t[e-1]&&0===t[e-2]||(r[s]=t[e],s++);return new Uint8Array(r.buffer,0,s)}static parseSPS(e){let t=a._ebsp2rbsp(e),i=new n.default(t);i.readByte();let r=i.readByte();i.readByte();let s=i.readByte();i.readUEG();let o=a.getProfileString(r),l=a.getLevelString(s),u=1,d=420,c=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(d=c[u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool())){let e=3!==u?8:12;for(let t=0;t<e;t++)i.readBool()&&(t<6?a._skipScalingList(i,16):a._skipScalingList(i,64))}i.readUEG();let f=i.readUEG();if(0===f)i.readUEG();else if(1===f){i.readBits(1),i.readSEG(),i.readSEG();let e=i.readUEG();for(let t=0;t<e;t++)i.readSEG()}i.readUEG(),i.readBits(1);let p=i.readUEG(),m=i.readUEG(),_=i.readBits(1);0===_&&i.readBits(1),i.readBits(1);let g=0,y=0,v=0,b=0;i.readBool()&&(g=i.readUEG(),y=i.readUEG(),v=i.readUEG(),b=i.readUEG());let E=1,A=1,S=0,w=!0,T=0,D=0;if(i.readBool()){if(i.readBool()){let e=i.readByte(),t=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],r=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];e>0&&e<16?(E=t[e-1],A=r[e-1]):255===e&&(E=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){let e=i.readBits(32),t=i.readBits(32);w=i.readBool(),S=(T=t)/(D=2*e)}}let M=1;1===E&&1===A||(M=E/A);let R=0,x=0;if(0===u)R=1,x=2-_;else{R=3===u?1:2,x=(1===u?2:1)*(2-_)}let k=16*(p+1),U=16*(m+1)*(2-_);k-=(g+y)*R,U-=(v+b)*x;let O=Math.ceil(k*M);return i.destroy(),i=null,{profile_string:o,level_string:l,bit_depth:h,chroma_format:d,chroma_format_string:a.getChromaFormatString(d),frame_rate:{fixed:w,fps:S,fps_den:D,fps_num:T},par_ratio:{width:E,height:A},codec_size:{width:k,height:U},present_size:{width:O,height:U}}}static _skipScalingList(e,t){let i=8,r=8,s=0;for(let n=0;n<t;n++)0!==r&&(r=(i+(s=e.readSEG())+256)%256),i=0===r?i:r}static getProfileString(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(e){return(e/10).toFixed(1)}static getChromaFormatString(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}static toVideoMeta(e){let t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;let i=t.frameRate.fps_den,r=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(i/r))}}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.XgBuffer=class{constructor(e){this.length=e||0,this.historyLen=e||0,this.array=[],this.offset=0}push(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}shift(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){let t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){let t=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,t}let t=new Uint8Array(e),i=0;for(;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){let r=this.array[0].slice(this.offset,this.offset+e);t.set(r,i),this.offset+=e,this.length-=e,e=0;break}{let r=this.array[0].length-this.offset;t.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=r,this.length-=r,e-=r}}return t}clear(){this.array=[],this.length=0,this.offset=0}destroy(){this.clear(),this.historyLen=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(e,t){let i=0,r=this.offset+e;for(;r<this.offset+t+e;)r<this.array[0].length?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++;return i}};t.RemuxBuffer=class{constructor(){this.video=[],this.audio=[]}destroy(){this.video=[],this.audio=[]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(5),n=(r=s)&&r.__esModule?r:{default:r},a=i(13);const o="__TO__";t.default=class{constructor(e=[]){this._emitter=new a.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new n.default,this.allowedEvents=e,this._hooks={}}getInstance(e){return this._instanceMap[e]?this._instanceMap[e]:null}initInstance(e,...t){if(this._clsMap[e]){const i=new this._clsMap[e](...t);return this._instanceMap[e]=i,i.init&&i.init(),i}throw new Error(`${e}未在context中注册`)}init(e){if(!this._inited){for(let t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}registry(e,t){const i=this._emitter,r=this._isMessageNameValid.bind(this),s=this;return this._clsMap[e]=class extends t{constructor(...t){super(...t),this.listeners={},this.onceListeners={},this.TAG=e,this._context=s}on(t,s){return r(t),this.listeners[t]?this.listeners[t].push(s):this.listeners[t]=[s],i.on(`${t}${o}${e}`,s),i.on(t,s)}before(e,t){r(e),s._hooks[e]?s._hooks[e].push(t):s._hooks[e]=[t]}once(t,s){return r(t),this.onceListeners[t]?this.onceListeners[t].push(s):this.onceListeners[t]=[s],i.once(`${t}${o}${e}`,s),i.once(t,s)}emit(e,...t){r(e);const n=s._hooks[e];if(n)for(let e=0,t=n.length;e<t;e++){(0,n[e])()}return i.emit(e,...t)}emitTo(e,t,...s){return r(t),i.emit(`${t}${o}${e}`,...s)}off(e,t){return r(e),i.off(e,t)}removeListeners(){const t=Object.prototype.hasOwnProperty.bind(this.listeners);for(let r in this.listeners)if(t(r)){const t=this.listeners[r]||[];for(let s=0;s<t.length;s++){const n=t[s];i.off(r,n),i.off(`${r}${o}${e}`,n)}}for(let r in this.onceListeners)if(t(r)){const t=this.onceListeners[r]||[];for(let s=0;s<t.length;s++){const n=t[s];i.off(r,n),i.off(`${r}${o}${e}`,n)}}}destroy(){this.removeListeners(),delete s._instanceMap[e],super.destroy&&super.destroy()}},(...t)=>this.initInstance(e,...t)}destroyInstances(){Object.keys(this._instanceMap).forEach(e=>{this._instanceMap[e].destroy&&this._instanceMap[e].destroy()})}destroy(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this.destroyInstances()}_isMessageNameValid(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error(`unregistered message name: ${e}`)}}},function(e,t,i){"use strict";var r,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,i,r){var s,n,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),n=e._events),a=n[t]),void 0===a)a=n[t]=i,++e._eventsCount;else if("function"==typeof a?a=n[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(s=u(e))>0&&a.length>s&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,o=l,console&&console.warn&&console.warn(o)}return e}function c(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,n(this.listener,this.target,e))}function h(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},s=c.bind(r);return s.listener=i,r.wrapFn=s,s}function f(e,t,i){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(s):m(s,s.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var u=l.length,d=m(l,u);for(i=0;i<u;++i)n(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,s,n,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,n=i.length-1;n>=0;n--)if(i[n]===t||i[n].listener===t){a=i[n].listener,s=n;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var s,n=Object.keys(i);for(r=0;r<n.length;++r)"removeListener"!==(s=n[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},s={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},n={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},a={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},l=Object.assign({},r,s,n,a,o),u=[],d=[];for(let e in l)l.hasOwnProperty(e)&&u.push(l[e]);for(let e in l)l.hasOwnProperty(e)&&d.push(l[e]);t.default={ALLEVENTS:l,HLS_EVENTS:o,REMUX_EVENTS:n,DEMUX_EVENTS:s,MSE_EVENTS:a,LOADER_EVENTS:r,FlvAllowedEvents:u,HlsAllowedEvents:d}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=function(){const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),s={get device(){let e=s.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){let e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter(i=>t[i].test(e)))[0]},get os(){let e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),s=/(?:Firefox)/.test(e),n=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||s&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!n;return{isTablet:n,isPhone:a,isAndroid:r,isPc:!a&&!r&&!i,isSymbian:i,isWindowsPhone:t,isFireFox:s}},get isLe(){return r}};t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=function(){const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static decode(e){const t=[],i=e;let s=0;const n=e.length;for(;s<n;)if(i[s]<128)t.push(String.fromCharCode(i[s])),++s;else{if(i[s]<192);else if(i[s]<224){if(r._checkContinuation(i,s,1)){const e=(31&i[s])<<6|63&i[s+1];if(e>=128){t.push(String.fromCharCode(65535&e)),s+=2;continue}}}else if(i[s]<240){if(r._checkContinuation(i,s,2)){const e=(15&i[s])<<12|(63&i[s+1])<<6|63&i[s+2];if(e>=2048&&55296!=(63488&e)){t.push(String.fromCharCode(65535&e)),s+=3;continue}}}else if(i[s]<248&&r._checkContinuation(i,s,3)){let e=(7&i[s])<<18|(63&i[s+1])<<12|(63&i[s+2])<<6|63&i[s+3];if(e>65536&&e<1114112){e-=65536,t.push(String.fromCharCode(e>>>10|55296)),t.push(String.fromCharCode(1023&e|56320)),s+=4;continue}}t.push(String.fromCharCode(65533)),++s}return t.join("")}static _checkContinuation(e,t,i){let r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){let t=r.getDefaultInf();if(!e||"[object Object]"!==Object.prototype.toString.call(e))return t;let i=Object.assign({},t,e);Object.entries(i).forEach(([e,t])=>{this[e]=t})}static getDefaultInf(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}addRAP(e){e.isRAP=!0,this.randomAccessPoints.push(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this._type=e,this._list=[],this._lastAppendLocation=-1}get type(){return this._type}get length(){return this._list.length}isEmpty(){return 0===this._list.length}clear(){this._list=[],this._lastAppendLocation=-1}_searchNearestSegmentBefore(e){let t=this._list;if(0===t.length)return-2;let i=t.length-1,r=0,s=0,n=i,a=0;if(e<t[0].originDts)return a=-1;for(;s<=n;){if((r=s+Math.floor((n-s)/2))===i||e>t[r].lastSample.originDts&&e<t[r+1].originDts){a=r;break}t[r].originDts<e?s=r+1:n=r-1}return a}_searchNearestSegmentAfter(e){return this._searchNearestSegmentBefore(e)+1}append(e){let t=this._list,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&e.originStartDts>=t[i].lastSample.originDts&&(i===t.length-1||i<t.length-1&&e.originStartDts<t[i+1].originStartDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(e.originStartDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,e)}getLastSegmentBefore(e){let t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}getLastSampleBefore(e){let t=this.getLastSegmentBefore(e);return null!==t?t.lastSample:null}getLastRAPBefore(e){let t=this._searchNearestSegmentBefore(e),i=this._list[t].randomAccessPoints;for(;0===i.length&&t>0;)t--,i=this._list[t].randomAccessPoints;return i.length>0?i[i.length-1]:null}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.configs=Object.assign({},e),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1}init(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen.bind(this)),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.container.addEventListener("waiting",this.onWaiting.bind(this))}onTimeUpdate(){this.emit("TIME_UPDATE",this.container)}onWaiting(){this.emit("WAITING",this.container)}onSourceOpen(){this.addSourceBuffers()}onUpdateEnd(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}addSourceBuffers(){if("open"!==this.mediaSource.readyState)return;let e,t=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");t=t.sources;let r=!1;for(let s=0,n=Object.keys(t).length;s<n;s++){let n=Object.keys(t)[s];if("audio"===n?e=i.audioTrack:"video"===n&&(e=i.videoTrack),e){let i="audio"===n?21:40;e.meta&&e.meta.refSampleDuration&&(i=e.meta.refSampleDuration),t[n].data.length>=this.preloadTime/i&&(r=!0)}}if(r){if(Object.keys(this.sourceBuffers).length>0)return;for(let e=0,i=Object.keys(t).length;e<i;e++){let i=Object.keys(t)[e],r=t[i],s="video"===i?"video/mp4;codecs="+r.mimetype:"audio/mp4;codecs="+r.mimetype,n=this.mediaSource.addSourceBuffer(s);this.sourceBuffers[i]=n,n.addEventListener("updateend",this.onUpdateEnd.bind(this)),this.doAppend()}}}doAppend(){let e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e)for(let t=0;t<Object.keys(this.sourceBuffers).length;t++){let i=Object.keys(this.sourceBuffers)[t],r=this.sourceBuffers[i];if(!r.updating){let t=e.sources[i];if(t&&!t.inited)r.appendBuffer(t.init.buffer.buffer),t.inited=!0;else if(t){let e=t.data.shift();e&&r.appendBuffer(e.buffer.buffer)}}}}endOfStream(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}remove(e){for(let t=0;t<Object.keys(this.sourceBuffers).length;t++){let i=this.sourceBuffers[Object.keys(this.sourceBuffers)[t]];i.updating||i.remove(0,e)}}destroy(){this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.configs={},this.container=null,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=1;for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let t=this.sourceBuffers[Object.keys(this.sourceBuffers)[e]];t.removeEventListener("updateend",this.onUpdateEnd),this.mediaSource.removeSourceBuffer(t),delete this.sourceBuffers[Object.keys(this.sourceBuffers)[e]]}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(24),n=(r=s)&&r.__esModule?r:{default:r};t.default=class{constructor(e){this.buffer=e||new Uint8Array(0)}write(...e){e.forEach(e=>{this.buffer=(0,n.default)(Uint8Array,this.buffer,e)})}static writeUint32(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}static readAsInt(e){let t="";return e.forEach(e=>{t+=function(e){return e.toString(16).padStart(2,"0")}(e)}),parseInt(t,16)}}},function(e,t,i){"use strict";var r,s=i(25),n=(r=s)&&r.__esModule?r:{default:r};e.exports=n.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var n=!0,a=!1,o=void 0;try{for(var l,u=r[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var d=l.value;t+=d.length}}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}var c=new e(t),h=0,f=!0,p=!1,m=void 0;try{for(var _,g=r[Symbol.iterator]();!(f=(_=g.next()).done);f=!0){var y=_.value;c.set(y,h),h+=y.length}}catch(e){p=!0,m=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw m}}return c}},function(e,t,i){"use strict";var r=n(i(27)),s=n(i(32));function n(e){return e&&e.__esModule?e:{default:e}}class a extends HTMLElement{constructor(e){super(),this.vCtx=new r.default,this.aCtx=new s.default(e),this.historyTime=0}destroy(){}onDemuxComplete(e,t){this.vCtx.decodeVideo(e)}setAudioMeta(e){this.aCtx.setAudioMetaData(e)}setVideoMeta(e){console.log(e),this.vCtx.setVideoMetaData(e)}get currentTime(){}play(){this.aCtx.play(),this.vCtx.play()}}customElements.define("mobile-video",a)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(28)),s=a(i(8)),n=a(i(9));function a(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(e){this.canvas=document.createElement("canvas"),this.config=Object.assign({},e),this._decoderInited=!1,this.oncanplay=void 0,this.meta=void 0,this._avccpushed=!1,this.initWasmWorker()}initWasmWorker(){let e=this;this.wasmworker=(0,r.default)(30),this.wasmworker.addEventListener("message",t=>{switch(t.data.msg){case"WASM_LOADED":e._decoderInited=!0;break;case"DECODED":console.log("decoded",t.data)}})}setVideoMetaData(e){if(this.meta=e,!this._decoderInited)return;this._avccpushed=!0;let t=new Uint8Array(e.sps.byteLength+4);t.set([0,0,0,1]),t.set(e.sps,4),this.wasmworker.postMessage({msg:"decode",data:t.buffer}),(t=new Uint8Array(e.pps.byteLength+4)).set([0,0,0,1]),t.set(e.pps,4),this.wasmworker.postMessage({msg:"decode",data:t.buffer})}decodeVideo(e){if(!this._decoderInited)return;this._avccpushed||this.setVideoMetaData(this.meta);let{samples:t}=e,i=t.shift();if(!i)return;let r=n.default.getAvccNals(new s.default(i.data.buffer)),a=0;for(let e=0;e<r.length;e++){a+=r[e].body.byteLength+4}let o=0,l=new Uint8Array(a);for(let e=0;e<r.length;e++){let t=r[e];l.set([0,0,0,1],o),o+=4,l.set(new Uint8Array(t.body),o),o+=t.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:l.buffer})}play(){}}},function(e,t,i){"use strict";function r(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var r=i(i.s=ENTRY_MODULE);return r.default||r}var s="[\\.|\\-|\\+|\\w|/|@]+",n="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,r){var o={};o[r]=[];var l=t.toString(),u=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return o;for(var d,c=u[1],h=new RegExp("(\\\\n|\\W)"+a(c)+n,"g");d=h.exec(l);)"dll-reference"!==d[3]&&o[r].push(d[3]);for(h=new RegExp("\\("+a(c)+'\\("(dll-reference\\s('+s+'))"\\)\\)'+n,"g");d=h.exec(l);)e[d[2]]||(o[r].push(d[1]),e[d[2]]=i(d[1]).m),o[d[2]]=o[d[2]]||[],o[d[2]].push(d[4]);for(var f,p=Object.keys(o),m=0;m<p.length;m++)for(var _=0;_<o[p[m]].length;_++)f=o[p[m]][_],isNaN(1*f)||(o[p[m]][_]=1*o[p[m]][_]);return o}function l(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var s={main:i.m},n=t.all?{main:Object.keys(s.main)}:function(e,t){for(var i={main:[t]},r={main:[]},s={main:{}};l(i);)for(var n=Object.keys(i),a=0;a<n.length;a++){var u=n[a],d=i[u].pop();if(s[u]=s[u]||{},!s[u][d]&&e[u][d]){s[u][d]=!0,r[u]=r[u]||[],r[u].push(d);for(var c=o(e,e[u][d],u),h=Object.keys(c),f=0;f<h.length;f++)i[h[f]]=i[h[f]]||[],i[h[f]]=i[h[f]].concat(c[h[f]])}}return r}(s,e),a="";Object.keys(n).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;n[e][t];)t++;n[e].push(t),s[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map((function(t){return JSON.stringify(t)+": "+s[e][t].toString()})).join(",")+"});\n"})),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map((function(e){return JSON.stringify(e)+": "+s.main[e].toString()})).join(",")+"}))(self);";var u=new window.Blob([a],{type:"text/javascript"});if(t.bare)return u;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),c=new window.Worker(d);return c.objectURL=d,c}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.TAG="Golomb",this._buffer=e,this._bufferIndex=0,this._totalBytes=e.byteLength,this._totalBits=8*e.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}destroy(){this._buffer=null}_fillCurrentWord(){let e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0,!1),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}readBits(e){if(e<=this._currentWordBitsLeft){let t=this._currentWord>>>32-e;return this._currentWord<<=e,this._currentWordBitsLeft-=e,t}let t=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;let i=e-this._currentWordBitsLeft;this._fillCurrentWord();let r=Math.min(i,this._currentWordBitsLeft),s=this._currentWord>>>32-r;return this._currentWord<<=r,this._currentWordBitsLeft-=r,t=t<<r|s}readBool(){return 1===this.readBits(1)}readByte(){return this.readBits(8)}_skipLeadingZero(){let e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}readUEG(){let e=this._skipLeadingZero();return this.readBits(e+1)-1}readSEG(){let e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}},function(e,t,i){"use strict";(function(t){var i,r={isInited:!1,onWasmCompiled:void 0,onFrameDecoded:void 0},s=void 0!==s?s:{},n={};for(i in s)s.hasOwnProperty(i)&&(n[i]=s[i]);var a,o=[],l="./this.program",u=!1,d=!1;u="object"==typeof window,d="function"==typeof importScripts,a="object"==typeof t&&"object"==typeof t.versions&&"string"==typeof t.versions.node;var c,h="";(u||d)&&(d?h=self.location.href:document.currentScript&&(h=document.currentScript.src),h=0!==h.indexOf("blob:")?h.substr(0,h.lastIndexOf("/")+1):"",function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},d&&(c=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),function(e,t,i){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):i()},r.onerror=i,r.send(null)});var f=s.print||console.log.bind(console),p=s.printErr||console.warn.bind(console);for(i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);n=null,s.arguments&&(o=s.arguments),s.thisProgram&&(l=s.thisProgram),s.quit&&s.quit;function m(e){var t=P[j>>2],i=t+e+15&-16;return i>fe()&&Q(),P[j>>2]=i,t}function _(e){_.shown||(_.shown={}),_.shown[e]||(_.shown[e]=1,p(e))}var g={"f64-rem":function(e,t){return e%t},debugger:function(){}};new Array(0);var y,v,b=0;s.wasmBinary&&(y=s.wasmBinary),s.noExitRuntime&&s.noExitRuntime,"object"!=typeof WebAssembly&&p("no native wasm support detected");var E=new WebAssembly.Table({initial:209,maximum:209,element:"anyfunc"}),A=!1;function S(e,t){e||Q("Assertion failed: "+t)}function w(e){var t=s["_"+e];return S(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function T(e,t,i,r,s){var n={string:function(e){var t=0;if(null!=e&&0!==e){var i=1+(e.length<<2);U(e,t=Re(i),i)}return t},array:function(e){var t=Re(e.length);return function(e,t){B.set(e,t)}(e,t),t}};var a=w(e),o=[],l=0;if(r)for(var u=0;u<r.length;u++){var d=n[i[u]];d?(0===l&&(l=ke()),o[u]=d(r[u])):o[u]=r[u]}var c=a.apply(null,o);return c=function(e){return"string"===t?x(e):"boolean"===t?Boolean(e):e}(c),0!==l&&xe(l),c}s.cwrap=function(e,t,i,r){var s=(i=i||[]).every((function(e){return"number"===e}));return"string"!==t&&s&&!r?w(e):function(){return T(e,t,i,arguments)}};function D(e){return q?De(e):m(e)}var M="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(e,t,i){for(var r=t+i,s=t;e[s]&&!(s>=r);)++s;if(s-t>16&&e.subarray&&M)return M.decode(e.subarray(t,s));for(var n="";t<s;){var a=e[t++];if(128&a){var o=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if((a=224==(240&a)?(15&a)<<12|o<<6|l:(7&a)<<18|o<<12|l<<6|63&e[t++])<65536)n+=String.fromCharCode(a);else{var u=a-65536;n+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else n+=String.fromCharCode((31&a)<<6|o)}else n+=String.fromCharCode(a)}return n}function x(e,t){return e?R(I,e,t):""}function k(e,t,i,r){if(!(r>0))return 0;for(var s=i,n=i+r-1,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(o<=127){if(i>=n)break;t[i++]=o}else if(o<=2047){if(i+1>=n)break;t[i++]=192|o>>6,t[i++]=128|63&o}else if(o<=65535){if(i+2>=n)break;t[i++]=224|o>>12,t[i++]=128|o>>6&63,t[i++]=128|63&o}else{if(i+3>=n)break;t[i++]=240|o>>18,t[i++]=128|o>>12&63,t[i++]=128|o>>6&63,t[i++]=128|63&o}}return t[i]=0,i-s}function U(e,t,i){return k(e,I,t,i)}function O(e){for(var t=0,i=0;i<e.length;++i){var r=e.charCodeAt(i);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++i)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function L(e,t,i){for(var r=0;r<e.length;++r)B[t++>>0]=e.charCodeAt(r);i||(B[t>>0]=0)}var C,B,I,P,F;var N,j=34336,V=s.TOTAL_MEMORY||33554432;function z(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?s.dynCall_v(i):s.dynCall_vi(i,t.arg):i(void 0===t.arg?null:t.arg)}else t()}}(v=s.wasmMemory?s.wasmMemory:new WebAssembly.Memory({initial:V/65536,maximum:V/65536}))&&(C=v.buffer),V=C.byteLength,C=N=C,s.HEAP8=B=new Int8Array(N),s.HEAP16=new Int16Array(N),s.HEAP32=P=new Int32Array(N),s.HEAPU8=I=new Uint8Array(N),s.HEAPU16=new Uint16Array(N),s.HEAPU32=new Uint32Array(N),s.HEAPF32=new Float32Array(N),s.HEAPF64=F=new Float64Array(N),P[j>>2]=5277424;var G=[],H=[],W=[],X=[],q=!1;function $(e,t,i){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function K(e,t,i){if(e<=0)return e;var r=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=r&&(t<=32||e>r)&&(e=-2*r+e),e}Math.abs,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.atan2,Math.exp,Math.log,Math.sqrt,Math.ceil,Math.floor,Math.pow,Math.imul,Math.fround,Math.round,Math.min,Math.max,Math.clz32,Math.trunc;var Y=0,J=null,Z=null;function Q(e){throw s.onAbort&&s.onAbort(e),f(e+=""),p(e),A=!0,1,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}s.preloadedImages={},s.preloadedAudios={};var ee="data:application/octet-stream;base64,";function te(e){return String.prototype.startsWith?e.startsWith(ee):0===e.indexOf(ee)}var ie,re="http://sf1-ttcdn-tos.pstatp.com/obj/ttfe/media/decoder_em.wasm";function se(){try{if(y)return new Uint8Array(y);if(c)return c(re);throw"both async and sync fetching of the wasm failed"}catch(e){Q(e)}}te(re)||(ie=re,re=s.locateFile?s.locateFile(ie,h):h+ie),s.asm=function(){var e={env:Ee,wasi_unstable:Ee,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:g};function t(e,t){var i=e.exports;s.asm=i,r.onWasmCompiled&&r.onWasmCompiled(s),function(e){if(Y--,s.monitorRunDependencies&&s.monitorRunDependencies(Y),0==Y&&(null!==J&&(clearInterval(J),J=null),Z)){var t=Z;Z=null,t()}}()}function i(e){t(e.instance)}function n(t){return(y||!u&&!d||"function"!=typeof fetch?new Promise((function(e,t){e(se())})):fetch(re,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+re+"'";return e.arrayBuffer()})).catch((function(){return se()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){p("failed to asynchronously prepare wasm: "+e),Q(e)}))}if(Y++,s.monitorRunDependencies&&s.monitorRunDependencies(Y),s.instantiateWasm)try{return s.instantiateWasm(e,t)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(y||"function"!=typeof WebAssembly.instantiateStreaming||te(re)||"function"!=typeof fetch)return n(i);fetch(re,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),n(i)}))}))}(),{}};var ne=[function(e,t,i,n,a,o,l){!function(e,t,i,n,a,o,l){var u,d=new Uint8Array(n*a*3/2);for(u=0;u<a;u++){var c=s.HEAP8.subarray(e+u*o,e+u*o+n);d.set(c,u*n)}var h=n*a;for(u=0;u<a/2;u++){c=s.HEAP8.subarray(t+u*l,t+u*l+n/2);d.set(c,h+u*n/2)}var f=h+n*a/4;for(u=0;u<a/2;u++){c=s.HEAP8.subarray(i+u*l,i+u*l+n/2);d.set(c,f+u*n/2)}r.onFrameDecoded(d)}(e,t,i,n,a,o,l)}];H.push({func:function(){Te()}});var ae=34528;function oe(e){return e}function le(e){return e.replace(/\b__Z[\w\d_]+/g,(function(e){var t=oe(e);return e===t?e:t+" ["+e+"]"}))}function ue(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}var de={};var ce={buffers:[null,[],[]],printChar:function(e,t){var i=ce.buffers[e];0===t||10===t?((1===e?f:p)(R(i,0)),i.length=0):i.push(t)},varargs:0,get:function(e){return ce.varargs+=4,P[ce.varargs-4>>2]},getStr:function(){return x(ce.get())},get64:function(){var e=ce.get();ce.get();return e},getZero:function(){ce.get()}};function he(e,t,i,r){try{for(var s=0,n=0;n<i;n++){for(var a=P[t+8*n>>2],o=P[t+(8*n+4)>>2],l=0;l<o;l++)ce.printChar(e,I[a+l]);s+=o}return P[r>>2]=s,0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Q(e),-e.errno}}function fe(){return B.length}function pe(e){return e<0||0===e&&1/e==-1/0}function me(e,t){S(0==(3&t));var i=e,r=t;function s(e){var t;return r=function(e,t){return"double"===t||"i64"===t?7&e&&(S(4==(7&e)),e+=4):S(0==(3&e)),e}(r,e),"double"===e?(t=F[r>>3],r+=8):"i64"==e?(t=[P[r>>2],P[r+4>>2]],r+=8):(S(0==(3&r)),e="i32",t=P[r>>2],r+=4),t}for(var n,a,o,l,u,d=[];;){var c=i;if(0===(n=B[i>>0]))break;if(a=B[i+1>>0],37==n){var h=!1,f=!1,p=!1,m=!1,_=!1;e:for(;;){switch(a){case 43:h=!0;break;case 45:f=!0;break;case 35:p=!0;break;case 48:if(m)break e;m=!0;break;case 32:_=!0;break;default:break e}a=B[++i+1>>0]}var g=0;if(42==a)g=s("i32"),a=B[++i+1>>0];else for(;a>=48&&a<=57;)g=10*g+(a-48),a=B[++i+1>>0];var y,v=!1,b=-1;if(46==a){if(b=0,v=!0,42==(a=B[++i+1>>0]))b=s("i32"),i++;else for(;;){var E=B[i+1>>0];if(E<48||E>57)break;b=10*b+(E-48),i++}a=B[i+1>>0]}switch(b<0&&(b=6,v=!1),String.fromCharCode(a)){case"h":104==B[i+2>>0]?(i++,y=1):y=2;break;case"l":108==B[i+2>>0]?(i++,y=8):y=4;break;case"L":case"q":case"j":y=8;break;case"z":case"t":case"I":y=4;break;default:y=null}switch(y&&i++,a=B[i+1>>0],String.fromCharCode(a)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":var A=100==a||105==a;if(o=s("i"+8*(y=y||4)),8==y&&(l=o[0],u=o[1],o=117==a?+(l>>>0)+4294967296*+(u>>>0):+(l>>>0)+4294967296*+(0|u)),y<=4)o=(A?K:$)(o&Math.pow(256,y)-1,8*y);var w=Math.abs(o),T="";if(100==a||105==a)R=K(o,8*y).toString(10);else if(117==a)R=$(o,8*y).toString(10),o=Math.abs(o);else if(111==a)R=(p?"0":"")+w.toString(8);else if(120==a||88==a){if(T=p&&0!=o?"0x":"",o<0){o=-o,R=(w-1).toString(16);for(var D=[],M=0;M<R.length;M++)D.push((15-parseInt(R[M],16)).toString(16));for(R=D.join("");R.length<2*y;)R="f"+R}else R=w.toString(16);88==a&&(T=T.toUpperCase(),R=R.toUpperCase())}else 112==a&&(0===w?R="(nil)":(T="0x",R=w.toString(16)));if(v)for(;R.length<b;)R="0"+R;for(o>=0&&(h?T="+"+T:_&&(T=" "+T)),"-"==R.charAt(0)&&(T="-"+T,R=R.substr(1));T.length+R.length<g;)f?R+=" ":m?R="0"+R:T=" "+T;(R=T+R).split("").forEach((function(e){d.push(e.charCodeAt(0))}));break;case"f":case"F":case"e":case"E":case"g":case"G":var R;if(o=s("double"),isNaN(o))R="nan",m=!1;else if(isFinite(o)){var x=!1,k=Math.min(b,20);if(103==a||71==a){x=!0,b=b||1;var U=parseInt(o.toExponential(k).split("e")[1],10);b>U&&U>=-4?(a=(103==a?"f":"F").charCodeAt(0),b-=U+1):(a=(103==a?"e":"E").charCodeAt(0),b--),k=Math.min(b,20)}101==a||69==a?(R=o.toExponential(k),/[eE][-+]\d$/.test(R)&&(R=R.slice(0,-1)+"0"+R.slice(-1))):102!=a&&70!=a||(R=o.toFixed(k),0===o&&pe(o)&&(R="-"+R));var O=R.split("e");if(x&&!p)for(;O[0].length>1&&-1!=O[0].indexOf(".")&&("0"==O[0].slice(-1)||"."==O[0].slice(-1));)O[0]=O[0].slice(0,-1);else for(p&&-1==R.indexOf(".")&&(O[0]+=".");b>k++;)O[0]+="0";R=O[0]+(O.length>1?"e"+O[1]:""),69==a&&(R=R.toUpperCase()),o>=0&&(h?R="+"+R:_&&(R=" "+R))}else R=(o<0?"-":"")+"inf",m=!1;for(;R.length<g;)f?R+=" ":R=!m||"-"!=R[0]&&"+"!=R[0]?(m?"0":" ")+R:R[0]+"0"+R.slice(1);a<97&&(R=R.toUpperCase()),R.split("").forEach((function(e){d.push(e.charCodeAt(0))}));break;case"s":var L=s("i8*"),C=L?Me(L):"(null)".length;if(v&&(C=Math.min(C,b)),!f)for(;C<g--;)d.push(32);if(L)for(M=0;M<C;M++)d.push(I[L++>>0]);else d=d.concat(be("(null)".substr(0,C),!0));if(f)for(;C<g--;)d.push(32);break;case"c":for(f&&d.push(s("i8"));--g>0;)d.push(32);f||d.push(s("i8"));break;case"n":var N=s("i32*");P[N>>2]=d.length;break;case"%":d.push(n);break;default:for(M=c;M<i+2;M++)d.push(B[M>>0])}i+=2}else d.push(n),i+=1}return d}function _e(e){if(!e||!e.callee||!e.callee.name)return[null,"",""];e.callee.toString();var t=e.callee.name,i="(",r=!0;for(var s in e){var n=e[s];r||(i+=", "),r=!1,i+="number"==typeof n||"string"==typeof n?n:"("+typeof n+")"}i+=")";var a=e.callee.caller;return r&&(i=""),[e=a?a.arguments:[],t,i]}function ge(e){var t=ue(),i=t.lastIndexOf("_emscripten_log"),r=t.lastIndexOf("_emscripten_get_callstack"),s=t.indexOf("\n",Math.max(i,r))+1;t=t.slice(s),8&e&&"undefined"==typeof emscripten_source_map&&(_('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),e^=8,e|=16);var n=null;if(128&e)for(n=_e(arguments);n[1].indexOf("_emscripten_")>=0;)n=_e(n[0]);var a=t.split("\n");t="";var o=new RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),l=new RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),u=new RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(var d in a){var c=a[d],h="",f="",p=0,m=0,g=u.exec(c);if(g&&5==g.length)h=g[1],f=g[2],p=g[3],m=g[4];else{if((g=o.exec(c))||(g=l.exec(c)),!(g&&g.length>=4)){t+=c+"\n";continue}h=g[1],f=g[2],p=g[3],m=0|g[4]}var y=32&e?oe(h):h;y||(y=h);var v=!1;if(8&e){var b=emscripten_source_map.originalPositionFor({line:p,column:m});(v=b&&b.source)&&(64&e&&(b.source=b.source.substring(b.source.replace(/\\/g,"/").lastIndexOf("/")+1)),t+="    at "+y+" ("+b.source+":"+b.line+":"+b.column+")\n")}(16&e||!v)&&(64&e&&(f=f.substring(f.replace(/\\/g,"/").lastIndexOf("/")+1)),t+=(v?"     = "+h:"    at "+y)+" ("+f+":"+p+":"+m+")\n"),128&e&&n[0]&&(n[1]==h&&n[2].length>0&&(t=t.replace(/\s+$/,""),t+=" with values: "+n[1]+n[2]+"\n"),n=_e(n[0]))}return t=t.replace(/\s+$/,"")}function ye(e,t){24&e&&(t=t.replace(/\s+$/,""),t+=(t.length>0?"\n":"")+ge(e)),1&e?4&e?console.error(t):2&e?console.warn(t):console.log(t):6&e?p(t):f(t)}function ve(e){Q("OOM")}function be(e,t,i){var r=i>0?i:O(e)+1,s=new Array(r),n=k(e,s,0,s.length);return t&&(s.length=n),s}var Ee={___assert_fail:function(e,t,i,r){Q("Assertion failed: "+x(e)+", at: "+[t?x(t):"unknown filename",i,r?x(r):"unknown function"])},___buildEnvironment:function e(t){var i,r;e.called?(r=P[t>>2],i=P[r>>2]):(e.called=!0,de.USER=de.LOGNAME="web_user",de.PATH="/",de.PWD="/",de.HOME="/home/web_user",de.LANG=("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",de._=l,i=D(1024),r=D(256),P[r>>2]=i,P[t>>2]=r);var s=[],n=0;for(var a in de)if("string"==typeof de[a]){var o=a+"="+de[a];s.push(o),n+=o.length}if(n>1024)throw new Error("Environment size exceeded TOTAL_ENV_SIZE!");for(var u=0;u<s.length;u++){L(o=s[u],i),P[r+4*u>>2]=i,i+=o.length+1}P[r+4*s.length>>2]=0},___cxa_uncaught_exceptions:function(){return we.uncaught_exceptions},___gxx_personality_v0:function(){},___syscall140:function(e,t){ce.varargs=t;try{ce.getStreamFromFD(),ce.get(),ce.get(),ce.get(),ce.get();return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Q(e),-e.errno}},___syscall6:function(e,t){ce.varargs=t;try{ce.getStreamFromFD();return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Q(e),-e.errno}},___wasi_fd_write:function(){return he.apply(null,arguments)},__emscripten_traverse_stack:_e,__formatString:me,__memory_base:1024,__reallyNegative:pe,__table_base:0,_emscripten_asm_const_iiiiiiii:function(e,t,i,r,s,n,a,o){return ne[e](t,i,r,s,n,a,o)},_emscripten_get_callstack_js:ge,_emscripten_get_heap_size:fe,_emscripten_log:function(e,t){var i=P[t>>2];t+=4;var r="";if(i)for(var s=me(i,t),n=0;n<s.length;++n)r+=String.fromCharCode(s[n]);ye(e,r)},_emscripten_log_js:ye,_emscripten_memcpy_big:function(e,t,i){I.set(I.subarray(t,t+i),e)},_emscripten_resize_heap:function(e){ve()},_fd_write:he,_gettimeofday:function(e){var t=Date.now();return P[e>>2]=t/1e3|0,P[e+4>>2]=t%1e3*1e3|0,0},abort:Q,abortOnCannotGrowMemory:ve,demangle:oe,demangleAll:le,flush_NO_FILESYSTEM:function(){var e=s._fflush;e&&e(0);var t=ce.buffers;t[1].length&&ce.printChar(1,10),t[2].length&&ce.printChar(2,10)},getTempRet0:function(){return b},jsStackTrace:ue,memory:v,setTempRet0:function(e){b=e},stackTrace:function(){var e=ue();return s.extraStackTrace&&(e+="\n"+s.extraStackTrace()),le(e)},table:E,tempDoublePtr:ae},Ae=s.asm({},Ee,C);s.asm=Ae;var Se,we=s.__ZSt18uncaught_exceptionv=function(){return s.asm.__ZSt18uncaught_exceptionv.apply(null,arguments)},Te=(s.___cxa_can_catch=function(){return s.asm.___cxa_can_catch.apply(null,arguments)},s.___cxa_is_pointer_type=function(){return s.asm.___cxa_is_pointer_type.apply(null,arguments)},s.___emscripten_environ_constructor=function(){return s.asm.___emscripten_environ_constructor.apply(null,arguments)}),De=(s.___errno_location=function(){return s.asm.___errno_location.apply(null,arguments)},s.__get_daylight=function(){return s.asm.__get_daylight.apply(null,arguments)},s.__get_timezone=function(){return s.asm.__get_timezone.apply(null,arguments)},s.__get_tzname=function(){return s.asm.__get_tzname.apply(null,arguments)},s._close_decoder=function(){return s.asm._close_decoder.apply(null,arguments)},s._decode_h264buffer=function(){return s.asm._decode_h264buffer.apply(null,arguments)},s._decode_nal=function(){return s.asm._decode_nal.apply(null,arguments)},s._emscripten_get_sbrk_ptr=function(){return s.asm._emscripten_get_sbrk_ptr.apply(null,arguments)},s._free=function(){return s.asm._free.apply(null,arguments)},s._malloc=function(){return s.asm._malloc.apply(null,arguments)}),Me=(s._memcpy=function(){return s.asm._memcpy.apply(null,arguments)},s._memmove=function(){return s.asm._memmove.apply(null,arguments)},s._memset=function(){return s.asm._memset.apply(null,arguments)},s._open_decoder=function(){return s.asm._open_decoder.apply(null,arguments)},s._strlen=function(){return s.asm._strlen.apply(null,arguments)}),Re=(s.establishStackSpace=function(){return s.asm.establishStackSpace.apply(null,arguments)},s.stackAlloc=function(){return s.asm.stackAlloc.apply(null,arguments)}),xe=s.stackRestore=function(){return s.asm.stackRestore.apply(null,arguments)},ke=s.stackSave=function(){return s.asm.stackSave.apply(null,arguments)};s.dynCall_ii=function(){return s.asm.dynCall_ii.apply(null,arguments)},s.dynCall_iidiiii=function(){return s.asm.dynCall_iidiiii.apply(null,arguments)},s.dynCall_iii=function(){return s.asm.dynCall_iii.apply(null,arguments)},s.dynCall_iiii=function(){return s.asm.dynCall_iiii.apply(null,arguments)},s.dynCall_iiiii=function(){return s.asm.dynCall_iiiii.apply(null,arguments)},s.dynCall_iiiiii=function(){return s.asm.dynCall_iiiiii.apply(null,arguments)},s.dynCall_iiiiiiii=function(){return s.asm.dynCall_iiiiiiii.apply(null,arguments)},s.dynCall_iiiiiiiiii=function(){return s.asm.dynCall_iiiiiiiiii.apply(null,arguments)},s.dynCall_jiji=function(){return s.asm.dynCall_jiji.apply(null,arguments)},s.dynCall_v=function(){return s.asm.dynCall_v.apply(null,arguments)},s.dynCall_vi=function(){return s.asm.dynCall_vi.apply(null,arguments)},s.dynCall_vii=function(){return s.asm.dynCall_vii.apply(null,arguments)},s.dynCall_viii=function(){return s.asm.dynCall_viii.apply(null,arguments)},s.dynCall_viiii=function(){return s.asm.dynCall_viiii.apply(null,arguments)},s.dynCall_viiiii=function(){return s.asm.dynCall_viiiii.apply(null,arguments)},s.dynCall_viiiiii=function(){return s.asm.dynCall_viiiiii.apply(null,arguments)},s.dynCall_viiiiiiii=function(){return s.asm.dynCall_viiiiiiii.apply(null,arguments)};s.asm=Ae;function Ue(e){function t(){Se||(Se=!0,A||(q=!0,z(H),z(W),s.onRuntimeInitialized&&s.onRuntimeInitialized(),function(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)e=s.postRun.shift(),X.unshift(e);var e;z(X)}()))}e=e||o,Y>0||(!function(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)e=s.preRun.shift(),G.unshift(e);var e;z(G)}(),Y>0||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),t()}),1)):t()))}if(Z=function e(){Se||Ue(),Se||(Z=e)},s.run=Ue,s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();Ue();var Oe=s.cwrap("open_decoder","number",null),Le=s.cwrap("close_decoder",null,["number"]),Ce=(s.cwrap("decode_h264buffer","number",["number","array","number"]),s.cwrap("decode_nal","number",["number","array","number"]));let Be;s.asm&&Object.keys(s.asm).length>0&&(Be=Oe()),e.exports=function(e){r.onWasmCompiled=function(t){Be=Oe(),e.postMessage({msg:"WASM_LOADED"})},r.onFrameDecoded=function(t){console.log(t),e.postMessage({msg:"DECODED",data:t})},e.addEventListener("message",(function(t){var i,r,n=t.data;switch(n.msg){case"close":Le(Be);case"decode":i=n.data,r=new Uint8Array(i),Ce(Be,r,r.length);case"inited":e.postMessage({msg:"INITED_ECHO",data:!!(s.asm&&Object.keys(s.asm).length>0)})}}))}}).call(this,i(31))},function(e,t,i){"use strict";var r,s,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(e){s=o}}();var u,d=[],c=!1,h=-1;function f(){c&&u&&(c=!1,u.length?d=u.concat(d):h=-1,d.length&&p())}function p(){if(!c){var e=l(f);c=!0;for(var t=d.length;t;){for(u=d,d=[];++h<t;)u&&u[h].run();h=-1,t=d.length}u=null,c=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function _(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new m(e,t)),1!==d.length||c||l(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=_,n.addListener=_,n.once=_,n.off=_,n.removeListener=_,n.removeAllListeners=_,n.emit=_,n.prependListener=_,n.prependOnceListener=_,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.config=Object.assign({},e),this.context=new AudioContext,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.meta=void 0,this.samples=[],this.preloadTime=this.config.preloadTime||3,this.duration=0,this._currentBuffer=void 0,this._nextBuffer=void 0,this._lastpts=void 0,this._preDecode=[],this._currentTime=0,this._decoding=!1,this._played=!1}get currentTime(){return this._currentTime}setAudioData(e){for(let t=0;t<e.length;t++)e[t].pts=void 0===e[t].pts?e[t].dts:e[t].pts,this._preDecode.push(e[t]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}decodeAAC(){if(this._decoding)return;this._decoding=!0;let e=this._preDecode,t=[],i=this,s=e.shift();for(;s;){let i=r.getAACData(this.meta,s);t.push(i),this._lastpts=s.pts,s=e.shift()}let n=r.combileData(t);try{this.context.decodeAudioData(n.buffer,(function(e){let t=i.context.createBufferSource();t.buffer=e,t.onended=i.onSourceEnded.bind(i),i.samples.push({time:i.duration,duration:e.duration,data:t}),i.duration+=e.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime),i._played&&i.play()),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC()}))}catch(e){console.error(e)}}onSourceEnded(){if(!this._nextBuffer||!this._played)return;let e=this._nextBuffer.data;e.start(),e.connect(this.gainNode),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration))}play(){if(this._played=!0,!this._currentBuffer)return;let e=this._currentBuffer.data;e.connect(this.gainNode),e.start()}getTimeBuffer(e){let t;for(let i=0;i<this.samples.length;i++){let r=this.samples[i];if(r.time<=e&&r.time+r.duration>e){t=r;break}}return t}setAudioMetaData(e){this.meta=e}static getAACData(e,t){let i=new Uint8Array(t.data.byteLength+7),s=r.getAdts(e,t.data);return i.set(s),i.set(t.data,7),i}static combileData(e){let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i].byteLength;let i=new Uint8Array(t),r=0;for(let t=0,s=e.length;t<s;t++)i.set(e[t],r),r+=e[t].byteLength;return i}static getAdts(e,t){let i=new Uint8Array(7);i[0]=255,i[1]=240,i[1]=1|i[1],i[2]=192&e.objectType-1<<6,i[2]=i[2]|60&e.sampleRateIndex<<2,i[2]=i[2]|1&e.channelCount>>2,i[3]=192&e.channelCount<<6;let r=t.byteLength+7;return i[3]=i[3]|3&r>>11,i[4]=255&r>>3,i[5]=224&r<<5,i[5]=31|i[5],i[6]=252,i}}t.default=r},function(e,t,i){"use strict";e.exports={Mp4Remuxer:i(34).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(0),n=i(35),a=(r=n)&&r.__esModule?r:{default:r};const o=s.EVENTS.REMUX_EVENTS;class l{constructor(){this._dtsBase=0,this._isDtsBaseInited=!1,this.videoAllDuration=0,this.audioAllDuration=0}init(){this.on(o.REMUX_MEDIA,this.remux.bind(this)),this.on(o.REMUX_METADATA,this.onMetaDataReady.bind(this))}destroy(){this._dtsBase=-1,this._dtsBaseInited=!1}reset(){this._dtsBase=0,this._isDtsBaseInited=!1}remux(){const{audioTrack:e,videoTrack:t}=this._context.getInstance("TRACKS");!this._isDtsBaseInited&&this.calcDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}seek(){}onMetaDataReady(e){let t,i,r=new s.Buffer,n=a.default.ftyp();if("audio"===e){const{audioTrack:e}=this._context.getInstance("TRACKS");i=e}else{const{videoTrack:e}=this._context.getInstance("TRACKS");i=e}t=a.default.moov({type:e,meta:i.meta}),r.write(n,t);let l=this._context.getInstance("PRE_SOURCE_BUFFER"),u=l.getSource(e);u||(u=l.createSource(e)),u.mimetype=i.meta.codec,u.init=r,this.emit(o.INIT_SEGMENT,e)}calcDtsBase(e,t){if(!e.samples.length&&!t.samples.length)return;let i=1/0,r=1/0;e.samples&&e.samples.length&&(i=e.samples[0].dts),t.samples&&t.samples.length&&(r=t.samples[0].dts),this._dtsBase=Math.min(i,r),this._isDtsBaseInited=!0}_remuxVideo(e){const t=e;if(!e.samples||!e.samples.length)return;let{samples:i}=t,r=-1;const n=[],l={samples:[]};for(;i.length;){const e=i.shift(),{isKeyframe:t}=e;let s,a,o=e.dts-this._dtsBase;-1===r&&(r=o),e.pts&&(s=(a=e.pts-this._dtsBase)-o),e.cts&&(a=e.cts+o,s=e.cts);let u={buffer:[],size:0};l.samples.push(u),u.buffer.push(e.data),u.size+=e.data.byteLength;let d=0;if(i.length>=1){d=i[0].dts-this._dtsBase-o}else d=n.length>=1?n[n.length-1].duration:this.videoMeta.refSampleDuration;this.videoAllDuration+=d,n.push({dts:o,cts:s,pts:a,data:e.data,size:e.data.byteLength,isKeyframe:t,duration:d,flags:{isLeading:0,dependsOn:t?2:1,isDependedOn:t?1:0,hasRedundancy:0,isNonSync:t?0:1},originDts:o,type:"video"})}let u=new s.Buffer;const d=a.default.moof({id:t.meta.id,time:r,samples:n}),c=a.default.mdat(l);u.write(d,c),t.samples=[],t.length=0;let h=this._context.getInstance("PRE_SOURCE_BUFFER"),f=h.getSource("video");f||(f=h.createSource("video")),f.data.push(u),this.emit(o.MEDIA_SEGMENT,"video")}_remuxAudio(e){const{samples:t}=e;let i=-1,r=[];const n={samples:[]};if(!t||!t.length)return;let l=!1;for(;t.length;){let e=t.shift();const{data:s}=e;let a=e.dts-this._dtsBase;const o=a;l||(i=a,l=!0);let u=0;if(this.audioMeta.refSampleDurationFixed)u=this.audioMeta.refSampleDurationFixed;else if(t.length>=1){u=t[0].dts-this._dtsBase-a}else u=r.length>=1?r[r.length-1].duration:this.audioMeta.refSampleDuration;this.audioAllDuration+=u;const d={dts:a,pts:a,cts:0,size:s.byteLength,duration:e.duration?e.duration:u,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:o,type:"audio"};let c={buffer:[],size:0};c.buffer.push(s),c.size+=s.byteLength,n.samples.push(c),r.push(d)}const u=new s.Buffer,d=a.default.moof({id:e.meta.id,time:i,samples:r}),c=a.default.mdat(n);u.write(d,c),e.samples=[],e.length=0;let h=this._context.getInstance("PRE_SOURCE_BUFFER"),f=h.getSource("audio");f||(f=h.createSource("audio")),f.data.push(u),this.emit(o.MEDIA_SEGMENT,"audio",u)}initSilentAudio(e,t){const i=l.getSilentFrame(this.audioMeta.channelCount);return{dts:e,pts:e,cts:0,duration:t,unit:i,size:i.byteLength,originDts:e,type:"video"}}get videoMeta(){return this._context.getInstance("TRACKS").videoTrack.meta}get audioMeta(){return this._context.getInstance("TRACKS").audioTrack.meta}static getSilentFrame(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0);class s{static size(e){return r.Buffer.writeUint32(e)}static initBox(e,t,...i){const n=new r.Buffer;return n.write(s.size(e),s.type(t),...i),n.buffer}static extension(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}static ftyp(){return s.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}static moov({type:e,meta:t}){let i,r=8,n=s.mvhd(t.duration,t.timescale);i="video"===e?s.videoTrak(t):s.audioTrak(t);let a=s.mvex(t.duration,t.timescale||1e3,t.id);return[n,i,a].forEach(e=>{r+=e.byteLength}),s.initBox(r,"moov",n,i,a)}static mvhd(e,t=1e3){let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.initBox(8+i.length,"mvhd",new Uint8Array(i))}static videoTrak(e){let t=8,i=s.tkhd({id:1,duration:e.duration,timescale:e.timescale||1e3,width:e.presentWidth,height:e.presentHeight,type:"video"}),r=s.mdia({type:"video",timescale:e.timescale||1e3,duration:e.duration,avcc:e.avcc,parRatio:e.parRatio,width:e.presentWidth,height:e.presentHeight});return[i,r].forEach(e=>{t+=e.byteLength}),s.initBox(t,"trak",i,r)}static audioTrak(e){let t=8,i=s.tkhd({id:2,duration:e.duration,timescale:e.timescale||1e3,width:0,height:0,type:"audio"}),r=s.mdia({type:"audio",timescale:e.timescale||1e3,duration:e.duration,channelCount:e.channelCount,samplerate:e.sampleRate,config:e.config});return[i,r].forEach(e=>{t+=e.byteLength}),s.initBox(t,"trak",i,r)}static tkhd(e){let t=e.id,i=e.duration,r=e.width,n=e.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,n>>>8&255,255&n,0,0]);return s.initBox(8+a.byteLength,"tkhd",a)}static edts(e){let t=new r.Buffer,i=e.duration,n=e.mediaTime;return t.write(s.size(36),s.type("edts")),t.write(s.size(28),s.type("elst")),t.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,1])),t.buffer}static mdia(e){let t=8,i=s.mdhd(e.timescale,e.duration),r=s.hdlr(e.type),n=s.minf(e);return[i,r,n].forEach(e=>{t+=e.byteLength}),s.initBox(t,"mdia",i,r,n)}static mdhd(e=1e3,t){let i=new Uint8Array([0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,85,196,0,0]);return s.initBox(12+i.byteLength,"mdhd",s.extension(0,0),i)}static hdlr(e){let t=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===e&&(t.splice(8,4,115,111,117,110),t.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),s.initBox(8+t.length,"hdlr",new Uint8Array(t))}static minf(e){let t=8,i="video"===e.type?s.vmhd():s.smhd(),r=s.dinf(),n=s.stbl(e);return[i,r,n].forEach(e=>{t+=e.byteLength}),s.initBox(t,"minf",i,r,n)}static vmhd(){return s.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}static smhd(){return s.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}static dinf(){let e=new r.Buffer;return e.write(s.size(36),s.type("dinf"),s.size(28),s.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),e.buffer}static stbl(e){let t=8,i=s.stsd(e),r=s.stts(),n=s.stsc(),a=s.stsz(),o=s.stco();return[i,r,n,a,o].forEach(e=>{t+=e.byteLength}),s.initBox(t,"stbl",i,r,n,a,o)}static stsd(e){let t;return t="audio"===e.type?s.mp4a(e):s.avc1(e),s.initBox(16+t.byteLength,"stsd",s.extension(0,0),new Uint8Array([0,0,0,1]),t)}static mp4a(e){let t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.samplerate>>8&255,255&e.samplerate,0,0]),i=s.esds(e.config);return s.initBox(8+t.byteLength+i.byteLength,"mp4a",t,i)}static esds(e=[43,146,8,0]){const t=e.length;let i=new r.Buffer,n=new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e).concat([6,1,2]));return i.write(s.size(8+n.byteLength),s.type("esds"),n),i.buffer}static avc1(e){let t=new r.Buffer,i=e.width,n=e.height,a=e.parRatio.height,o=e.parRatio.width,l=e.avcc,u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,n>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),c=new Uint8Array([a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o]);return t.write(s.size(40+u.byteLength+l.byteLength+d.byteLength),s.type("avc1"),u,s.size(8+l.byteLength),s.type("avcC"),l,s.size(20),s.type("btrt"),d,s.size(16),s.type("pasp"),c),t.buffer}static stts(){let e=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stts",e)}static stsc(){let e=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stsc",e)}static stco(){let e=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stco",e)}static stsz(){let e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return s.initBox(20,"stsz",e)}static mvex(e,t=1e3,i){let n=new r.Buffer,a=r.Buffer.writeUint32(e);return n.write(s.size(56),s.type("mvex"),s.size(16),s.type("mehd"),s.extension(0,0),a,s.trex(i)),n.buffer}static trex(e){let t=new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return s.initBox(8+t.byteLength,"trex",t)}static moof(e){let t=8,i=s.mfhd(),r=s.traf(e);return[i,r].forEach(e=>{t+=e.byteLength}),s.initBox(t,"moof",i,r)}static mfhd(){let e=r.Buffer.writeUint32(s.sequence);return s.sequence+=1,s.initBox(16,"mfhd",s.extension(0,0),e)}static traf(e){let t=8,i=s.tfhd(e.id),r=s.tfdt(e.time),n=s.sdtp(e),a=s.trun(e,n.byteLength);return[i,r,a,n].forEach(e=>{t+=e.byteLength}),s.initBox(t,"traf",i,r,a,n)}static tfhd(e){let t=r.Buffer.writeUint32(e);return s.initBox(16,"tfhd",s.extension(0,0),t)}static tfdt(e){return s.initBox(16,"tfdt",s.extension(0,0),r.Buffer.writeUint32(e))}static trun(e,t){let i=new r.Buffer,n=r.Buffer.writeUint32(e.samples.length),a=r.Buffer.writeUint32(92+16*e.samples.length+t);return i.write(s.size(20+16*e.samples.length),s.type("trun"),new Uint8Array([0,0,15,1]),n,a),e.samples.forEach(e=>{const t=e.flags;i.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))}),i.buffer}static sdtp(e){let t=new r.Buffer;return t.write(s.size(12+e.samples.length),s.type("sdtp"),s.extension(0,0)),e.samples.forEach(e=>{const i=e.flags,r=i.isLeading<<6|i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;t.write(new Uint8Array([r]))}),t.buffer}static mdat(e){let t=new r.Buffer,i=8;e.samples.forEach(e=>{i+=e.size}),t.write(s.size(i),s.type("mdat"));let n=new Uint8Array(i),a=0;return n.set(t.buffer,a),a+=8,e.samples.forEach(e=>{e.buffer.forEach(e=>{n.set(e,a),a+=e.byteLength})}),n}}s.type=e=>new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]),s.sequence=1,t.default=s},function(e,t,i){"use strict";e.exports={FetchLoader:i(37).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0).EVENTS.LOADER_EVENTS,s=0,n=1,a=2,o=3;t.default=class{constructor(e){this.configs=Object.assign({},e),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}init(){this.on(r.LADER_START,this.load.bind(this))}static get type(){return"loader"}load(e,t){let i=this;this.url=e,this._canceled=!1;let s=this.getParams(t);return i.loading=!0,fetch(this.url,s).then((function(e){if(e.ok)return i.status=e.status,i._onFetchResponse(e);i.emit(r.LOADER_ERROR,i,e),i.loading=!1})).catch((function(e){throw i.emit(r.LOADER_ERROR,i,e),i.loading=!1,new Error(e.message)}))}_onFetchResponse(e){let t=this,i=this._context.getInstance(this.buffer);this._loaderTaskNo++;let l=this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case a:e.json().then(e=>{t.loading=!1,t._canceled||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))});break;case n:e.text().then(e=>{t.loading=!1,t._canceled||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))});break;case o:e.arrayBuffer().then(e=>{t.loading=!1,t._canceled||(i?(i.push(new Uint8Array(e)),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))});break;case s:default:return this._onReader(e.body.getReader(),l)}}_onReader(e,t){let i=this._context.getInstance(this.buffer);if(i||this._reader.cancel(),this._reader=e,!1===this.loading)return;let s=this;this._reader&&this._reader.read().then((function(n){return n.done?(s.loading=!1,s.status=0,void s.emit(r.LOADER_COMPLETE,i)):s._canceled?void s._reader.cancel():(i.push(n.value),s.emit(r.LOADER_DATALOADED,i),s._onReader(e,t))})).catch(e=>{console.error(e),s.emit(r.LOADER_ERROR,s,e),s.loading=!1})}getParams(e){let t=Object.assign({},e),i=new Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let e=this.configs.headers;for(let t in e)e.hasOwnProperty(t)&&i.append(t,e[t])}if("object"==typeof t.headers){let e=t.headers;for(let t in e)e.hasOwnProperty(t)&&i.append(t,e[t])}return!1===t.cors&&(r.mode="same-origin"),t.withCredentials&&(r.credentials="include"),r}cancel(){this._reader&&(this._reader.cancel(),this._reader=null,this.loading=!1,this._canceled=!0)}destroy(){this.cancel()}}},function(e,t,i){"use strict";e.exports={M3U8Parser:i(39).default,TsDemuxer:i(40).default,Playlist:i(44).default,FlvDemuxer:i(45).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static parse(e,t=""){let i={duration:0};if(!e||!e.split)return;let s=e.split(/\r|\n/),n=(s=s.filter(e=>e)).shift();if(!n.match("#EXTM3U"))return null;for(n=s.shift();n;){let e=n.match(/#(.*):(.*)/);if(e&&e.length>2)switch(e[1]){case"EXT-X-VERSION":i.version=parseInt(e[2]);break;case"EXT-X-MEDIA-SEQUENCE":i.sequence=parseInt(e[2]);break;case"EXT-X-TARGETDURATION":i.targetduration=parseFloat(e[2]);break;case"EXTINF":r.parseFrag(e,s,i,t)}n=s.shift()}return i}static parseFrag(e,t,i,r){i.frags||(i.frags=[]);let s={start:i.duration,duration:1e3*parseFloat(e[2])};i.duration+=s.duration;let n=t.shift();n.match(/#(.*):(.*)/)&&(n=t.shift()),n.length>0&&"/"===n.charAt(0)&&r.match(/.*\/\/.*\.\w+/g)&&(r=r.match(/.*\/\/.*\.\w+/g)[0]),n.match(/.*:\/\/.*/)?s.url=n:s.url=r+n,i.frags.push(s)}static parseURL(e){let t="",i=e.match(/(.*\/).*\.m3u8/);if(i&&i.length>0)for(let e=0;e<i.length;e++)i[e].match(/.*\/$/g)&&i[e].length>t.length&&(t=i[e]);return t}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),s=i(3),n=i(0);const a=n.EVENTS.DEMUX_EVENTS,o={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};class l{constructor(e){this.configs=Object.assign({},e),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}init(){this.on(a.DEMUX_START,this.demux.bind(this))}demux(){if(this.demuxing)return;let e=this.inputBuffer,t={pat:[],pmt:[]},i={};for(;e.length>=188;){for(;e.length>=1&&71!==e.array[0][e.offset];)e.shift(1);let r=e.shift(188),s=new n.Stream(r.buffer),a={};l.read(s,a,t),a.pes?(i[a.header.pid]||(i[a.header.pid]=[]),i[a.header.pid].push(a.pes),a.pes.ES.buffer=[a.pes.ES.buffer]):i[a.header.pid]&&i[a.header.pid][i[a.header.pid].length-1].ES.buffer.push(a.payload.stream)}for(let e=0;e<Object.keys(i).length;e++){let t=i[Object.keys(i)[e]];for(let r=0;r<t.length;r++)t[r].id=Object.keys(i)[e],t[r].ES.buffer=l.Merge(t[r].ES.buffer),"audio"===t[r].type?this.pushAudioSample(t[r]):"video"===t[r].type&&this.pushVideoSample(t[r])}this._hasAudioMeta&&this.emit(a.DEMUX_COMPLETE,"audio"),this._hasVideoMeta&&this.emit(a.DEMUX_COMPLETE,"video")}pushAudioSample(e){let t;this._tracks.audioTrack?t=this._tracks.audioTrack:(this._tracks.audioTrack=new s.AudioTrack,(t=this._tracks.audioTrack).meta=new n.AudioTrackMeta({audioSampleRate:e.ES.frequence,sampleRate:e.ES.frequence,channelCount:e.ES.channel,codec:"mp4a.40."+e.ES.audioObjectType,config:e.ES.audioConfig,id:2,sampleRateIndex:e.ES.frequencyIndex}),t.meta.refSampleDuration=Math.floor(1024/t.meta.audioSampleRate*t.meta.timescale),this._hasAudioMeta||(this._hasAudioMeta=!0,this.emit(a.METADATA_PARSED,"audio")));let i=new Uint8Array(e.ES.buffer.buffer.slice(e.ES.buffer.position,e.ES.buffer.length)),r=parseInt(e.pts/90),o=parseInt(e.pts/90),l=new n.AudioTrackSample({dts:r,pts:o,data:i});t.samples.push(l)}pushVideoSample(e){let t,i=r.Nalunit.getNalunits(e.ES.buffer);this._tracks.videoTrack?t=this._tracks.videoTrack:(this._tracks.videoTrack=new s.VideoTrack,(t=this._tracks.videoTrack).meta=new n.VideoTrackMeta);let o=0,u=!1,d=!1;for(let e=0;e<i.length;e++){let r=i[e];if(r.sps){if(t.sps&&l.compaireUint8(r.body,t.sps))continue;u=r,t.sps=r.body,t.meta.chromaFormat=u.sps.chroma_format,t.meta.codec="avc1.";for(var c=1;c<4;c++){var h=u.body[c].toString(16);h.length<2&&(h="0"+h),t.meta.codec+=h}t.meta.codecHeight=u.sps.codec_size.height,t.meta.codecWidth=u.sps.codec_size.width,t.meta.frameRate=u.sps.frame_rate,t.meta.id=1,t.meta.level=u.sps.level_string,t.meta.presentHeight=u.sps.present_size.height,t.meta.presentWidth=u.sps.present_size.width,t.meta.profile=u.sps.profile_string,t.meta.refSampleDuration=Math.floor(t.meta.timescale*(u.sps.frame_rate.fps_den/u.sps.frame_rate.fps_num)),t.meta.sarRatio=u.sps.sar_ratio?u.sps.sar_ratio:u.sps.par_ratio}else r.pps?(t.pps=r.body,d=r):o+=4+r.body.byteLength}u&&d&&(t.meta.avcc=r.Nalunit.getAvcc(u.body,d.body),this._hasVideoMeta||(this._hasVideoMeta=!0,this.emit(a.METADATA_PARSED,"video")));let f=new Uint8Array(o),p=0,m=!1;for(let e=0;e<i.length;e++){let t=i[e],r=t.body.byteLength;t.idr&&(m=!0),t.pps||t.sps||(f.set(new Uint8Array([r>>>24&255,r>>>16&255,r>>>8&255,255&r]),p),p+=4,f.set(t.body,p),p+=r)}let _=new n.VideoTrackSample({dts:parseInt(e.dts/90),pts:parseInt(e.pts/90),cts:(e.pts-e.dts)/90,originDts:e.dts,isKeyframe:m,data:f});t.samples.push(_)}destory(){this.off(a.DEMUX_START,this.demux),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}static compaireUint8(e,t){if(e.byteLength!==t.byteLength)return!1;let i=!0;for(let r=0;r<e.byteLength;r++)e[r]!==t[r]&&(i=!1);return i}static Merge(e){let t,i=0,r=0;for(let t=0;t<e.length;t++)i+=e[t].length-e[t].position;t=new Uint8Array(i);for(let i=0;i<e.length;i++){let s=e[i];t.set(new Uint8Array(s.buffer,s.position),r),r+=s.length-s.position}return new n.Stream(t.buffer)}static read(e,t,i){l.readHeader(e,t),l.readPayload(e,t,i),"MEDIA"!==t.header.packet||1!==t.header.payload||t.unknownPIDs||(t.pes=l.PES(t))}static readPayload(e,t,i){let r=t.header.pid;switch(r){case 0:l.PAT(e,t,i);break;case 1:l.CAT(e,t,i);break;case 2:l.TSDT(e,t,i);break;case 8191:break;default:if(i.pat.some(e=>e.pid===r))l.PMT(e,t,i);else{let s=i.pmt?i.pmt.filter(e=>e.pid===r):[];s.length>0?l.Media(e,t,o[s[0].streamType][0]):t.unknownPIDs=!0}}}static readHeader(e,t){let i={};i.sync=e.readUint8();let r=e.readUint16();i.error=r>>>15,i.payload=r>>>14&1,i.priority=r>>>13&1,i.pid=8191&r,r=e.readUint8(),i.scrambling=r>>6&3,i.adaptation=r>>4&3,i.continuity=15&r,i.packet=0===i.pid?"PAT":"MEDIA",t.header=i}static PAT(e,t,i){let r={},s=e.readUint8();e.skip(s),s=e.readUint8(),r.tabelID=s,s=e.readUint16(),r.error=s>>>7,r.zero=s>>>6&1,r.sectionLength=4095&s,r.streamID=e.readUint16(),r.current=1&e.readUint8(),r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();let n=(r.sectionLength-9)/4,a=[];for(let t=0;t<n;t++){let t=e.readUint16(),i=8191&e.readUint16();a.push({program:t,pid:i,type:0===t?"network":"mapPID"})}a.length>0&&(i.pat=i.pat.concat(a)),r.list=a,r.program=e.readUint16(),r.pid=8191&e.readUint16(),t.payload=r}static PMT(e,t,i){let r={};t.header.packet="PMT";let s=e.readUint8();e.skip(s),s=e.readUint8(),r.tableID=s,s=e.readUint16(),r.sectionLength=4095&s,r.program=e.readUint16(),r.current=1&e.readUint8(),r.order=e.readUint8(),r.lastOrder=e.readUint8(),r.PCR_PID=8191&e.readUint16(),r.programLength=4095&e.readUint16();let n=(r.sectionLength-13)/5,a=[];for(let t=0;t<n;t++)a.push({streamType:e.readUint8(),pid:8191&e.readUint16(),es:4095&e.readUint16()});r.list=a,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(a.map(e=>({pid:e.pid,es:e.es,streamType:e.streamType,program:r.program}))),t.payload=r}static Media(e,t,i){let r=t.header,s={};if(r.type=i,3===r.adaptation&&(s.adaptationLength=e.readUint8(),s.adaptationLength>0)){let t=e.readUint8();s.discontinue=t>>>7,s.access=t>>>6&1,s.priority=t>>>5&1,s.PCR=t>>>4&1,s.OPCR=t>>>3&1,s.splicePoint=t>>>2&1,s.transportPrivate=t>>>1&1,s.adaptationField=1&t;let i=e.position;if(1===s.PCR&&(s.programClockBase=e.readUint32()<<1,t=e.readUint16(),s.programClockBase|=t>>>15,s.programClockExtension=511&t),1===s.OPCR&&(s.originProgramClockBase=e.readUint32()<<1,t=e.readUint16(),s.originProgramClockBase+=t>>>15,s.originProgramClockExtension=511&t),1===s.splicePoint&&(s.spliceCountdown=e.readUint8()),1===s.transportPrivate){let t=e.readUint8(),i=[];for(let r=0;r<t;r++)i.push(e.readUint8())}if(1===s.adaptationField){let t=e.readUint8(),i=e.readUint8(),r=e.position,n=i>>>6&1,a=i>>>5&1;1===i>>>7&&(i=e.readUint16(),s.ltwValid=i>>>15,s.ltwOffset=61439&i),1===n&&(i=e.readUint24(),s.piecewiseRate=4194303&i),1===a&&(i=e.readInt8(),s.spliceType=i>>>4,s.dtsNextAU1=i>>>1&7,s.marker1=1&i,i=e.readUint16(),s.dtsNextAU2=i>>>1,s.marker2=1&i,i=e.readUint16(),s.dtsNextAU3=i),e.skip(t-1-(e.position-r))}let r=s.adaptationLength-1-(e.position-i);e.skip(r)}s.stream=new n.Stream(e.buffer.slice(e.position)),t.payload=s}static PES(e){let t={},i=e.payload.stream;if(1!==i.readUint24())t.ES={},t.ES.buffer=i;else{let e=i.readUint8();e>=224&&e<=239&&(t.type="video"),e>=192&&e<=223&&(t.type="audio");let r=i.readUint16();if(t.packetLength=r,"video"!==t.type&&"audio"!==t.type)throw new Error("format is not supported");{let e=i.readUint8();if(2!==e>>>6)throw new Error("error when parse pes header");e=i.readUint8(),t.ptsDTSFlag=e>>>6,t.escrFlag=e>>>5&1,t.esRateFlag=e>>>4&1,t.dsmFlag=e>>>3&1,t.additionalFlag=e>>>2&1,t.crcFlag=e>>>1&1,t.extensionFlag=1&e,t.pesHeaderLength=i.readUint8();let r=t.pesHeaderLength;if(2===t.ptsDTSFlag){let s=[];e=i.readUint8(),s.push(e>>>1&7),e=i.readUint16(),s.push(e>>>1),e=i.readUint16(),s.push(e>>>1),t.pts=s[0]<<30|s[1]<<15|s[2],r-=5,"video"===t.type&&(t.dts=t.pts)}if(3===t.ptsDTSFlag){let s=[];e=i.readUint8(),s.push(e>>>1&7),e=i.readUint16(),s.push(e>>>1),e=i.readUint16(),s.push(e>>>1),t.pts=s[0]<<30|s[1]<<15|s[2];let n=[];e=i.readUint8(),n.push(e>>>1&7),e=i.readUint16(),n.push(e>>>1),e=i.readUint16(),n.push(e>>>1),t.dts=n[0]<<30|n[1]<<15|n[2],r-=10}if(1===t.escrFlag){let s=[],n=[];e=i.readUint8(),s.push(e>>>3&7),s.push(3&e),e=i.readUint16(),s.push(e>>>13),s.push(3&e),e=i.readUint16(),s.push(e>>>13),n.push(3&e),e=i.readUint8(),n.push(e>>>1),t.escr=300*(s[0]<<30|s[1]<<28|s[2]<<15|s[3]<<13|s[4])+(n[0]<<7|n[1]),r-=6}if(1===t.esRateFlag&&(e=i.readUint24(),t.esRate=e>>>1&4194303,r-=3),1===t.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===t.additionalFlag&&(e=i.readUint8(),t.additionalCopyInfo=127&e,r-=1),1===t.crcFlag&&(t.pesCRC=i.readUint16(),r-=2),1===t.extensionFlag)throw new Error("not support extension");r>0&&i.skip(r),t.ES=l.ES(i,t.type)}}return t}static ES(e,t){let i,r={};if("video"===t){if(1!==(i=e.readUint32())&&(e.back(4),1!==(i=e.readUint24())))throw new Error("h264 nal header parse failed");e.skip(2),r.buffer=e}else{if("audio"!==t)throw new Error(`ES ${t} is not supported`);{if((i=e.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const t=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",r.layer=i>>>1&3,r.absent=1&i,i=e.readUint16(),r.audioObjectType=1+(i>>>14&3),r.profile=r.audioObjectType-1,r.frequencyIndex=i>>>10&15,r.frequence=t[r.frequencyIndex],r.channel=i>>>6&7,r.frameLength=(3&i)<<11|e.readUint16()>>>5,r.audioConfig=l.getAudioConfig(r.audioObjectType,r.channel,r.frequencyIndex),e.skip(1),r.buffer=e}}return r}static TSDT(e,t,i){t.payload={}}static CAT(e,t,i){let r={};r.tableID=e.readUint8();let s=e.readUint16();r.sectionIndicator=s>>>7,r.sectionLength=4095&s,e.skip(2),s=e.readUint8(),r.version=s>>>3,r.currentNextIndicator=1&s,r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();let n=(this.sectionLength-9)/4,a=[];for(let e=0;e<n;e++)a.push({});r.crc32=e.readUint32(),t.payload=r}static getAudioConfig(e,t,i){let r,s,n=navigator.userAgent.toLowerCase();return/firefox/i.test(n)?i>=6?(e=5,r=new Array(4),s=i-3):(e=2,r=new Array(2),s=i):-1!==n.indexOf("android")?(e=2,r=new Array(2),s=i):(e=5,r=new Array(4),i>=6?s=i-3:(1===t&&(e=2,r=new Array(2)),s=i)),r[0]=e<<3,r[0]|=(14&i)>>1,r[1]=(1&i)<<7,r[1]|=t<<3,5===e&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),r}get inputBuffer(){return this._context.getInstance(this.configs.inputbuffer)}get _tracks(){return this._context.getInstance("TRACKS")}}t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(0),n=i(42),a=(r=n)&&r.__esModule?r:{default:r};const{REMUX_EVENTS:o}=s.EVENTS;class l{constructor(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}init(){this.before(o.REMUX_MEDIA,this.doFix.bind(this))}reset(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}doFix(){const{isFirstAudioSamples:e,isFirstVideoSamples:t}=this.getFirstSample();this.removeInvalidSamples(),this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples),this.doFixVideo(t),this.doFixAudio(e)}doFixVideo(e){let{samples:t,meta:i}=this.videoTrack;if(i.frameRate&&!1===i.frameRate.fixed)return;if(!t||!t.length||!this._firstVideoSample)return;const r=t[0],s=r.dts,n=t.length;if(e&&this._firstAudioSample){const e=this._firstVideoSample.dts,s=e-this._firstAudioSample.dts;if(s>2*i.refSampleDuration){const n=Math.floor(s/i.refSampleDuration);for(let s=0;s<n;s++){const n=Object.assign({},r);n.dts=e-(s+1)*i.refSampleDuration,n.pts=n.dts+n.cts,t.unshift(n),this.filledVideoSamples.push({dts:n.dts,size:n.data.byteLength})}}}let a;if(this.nextVideoDts){a=s-this.nextVideoDts;const e=Math.abs(a);if(a>2*i.refSampleDuration){const e=Math.floor(a/i.refSampleDuration);for(let r=0;r<e;r++){const e=Object.assign({},t[0]),n=s-(r+1)*i.refSampleDuration;e.dts=n>this.nextVideoDts?n:this.nextVideoDts,e.pts=e.dts+e.cts,this.videoTrack.samples.unshift(e),this.filledVideoSamples.push({dts:e.dts,size:e.data.byteLength})}}else e<=10&&e>0&&(t[0].dts=this.nextVideoDts,t[0].originDts=t[0].dts,t[0].cts=t[0].cts||t[0].pts-t[0].dts,t[0].pts=t[0].dts+t[0].cts)}const o=t[t.length-1].dts,l=t.length>=2?o-t[t.length-2].dts:i.refSampleDuration;this.lastVideoSamplesLen=n,this.nextVideoDts=o+l,this.lastVideoDts=o;for(let e=0,r=t.length;e<r;e++){const r=t[e],s=t[e+1];if(!s)break;const n=s.dts-r.dts;if(n>2*i.refSampleDuration){let a=Math.floor(n/i.refSampleDuration),o=0;for(;o<a;){const n=Object.assign({},s);n.dts=r.dts+(o+1)*i.refSampleDuration,n.pts=n.dts+n.cts,n<s.dts&&(t.splice(e,0,n),this.filledVideoSamples.push({dts:n.dts,size:n.data.byteLength})),o++,e++}}}this.videoTrack.samples=t}doFixAudio(e){let{samples:t,meta:i}=this.audioTrack;if(!t||!t.length)return;const r=t.length,s=a.default.getSilentFrame(i.codec,i.channelCount),n=this._firstAudioSample;if(t=l.sortAudioSamples(t),this._firstVideoSample&&e){const e=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(n.dts-e>i.refSampleDuration){const r=Math.floor((n.dts-e)/i.refSampleDuration);for(let e=0;e<r;e++){const r={data:s,datasize:s.byteLength,dts:n.dts-(e+1)*i.refSampleDuration,filtered:0};t.unshift(r),this.filledAudioSamples.push({dts:r.dts,size:r.data.byteLength})}}}let o;const u=t[0].dts;if(this.nextAudioDts){o=u-this.nextAudioDts;const e=Math.abs(o);if(e>i.refSampleDuration&&1===r&&1===this.lastAudioSamplesLen&&(i.refSampleDurationFixed=void 0),o>2*i.refSampleDuration)if(1===r&&1===this.lastAudioSamplesLen)i.refSampleDurationFixed=void 0!==i.refSampleDurationFixed?i.refSampleDurationFixed+o:i.refSampleDuration+o;else{const e=Math.floor(o/i.refSampleDuration);for(let r=0;r<e;r++){const e=u-(r+1)*i.refSampleDuration,s=Object.assign({},t[0],{dts:e>this.nextAudioDts?e:this.nextAudioDts});this.filledAudioSamples.push({dts:s.dts,size:s.data.byteLength}),this.audioTrack.samples.unshift(s)}}else e<=10&&e>0&&(t[0].dts=this.nextAudioDts,t[0].pts=this.nextAudioDts)}const d=t[t.length-1].dts,c=t.length>=2?d-t[t.length-2].dts:i.refSampleDuration;this.lastAudioSamplesLen=r,this.nextAudioDts=i.refSampleDurationFixed?d+i.refSampleDurationFixed:d+c,this.lastAudioDts=d;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=t[e+1];if(!r)break;const s=r.dts-i.dts;t[e].duration=s}this.audioTrack.samples=l.sortAudioSamples(t)}getFirstSample(){let{samples:e}=this.videoTrack,{samples:t}=this.audioTrack,i=!1,r=!1;return!this._firstVideoSample&&e.length&&(this._firstVideoSample=l.findFirstVideoSample(e),i=!0),!this._firstAudioSample&&t.length&&(this._firstAudioSample=l.findFirstAudioSample(t),r=!0),{isFirstVideoSamples:i,isFirstAudioSamples:r}}fixRefSampleDuration(e,t){const i="video"===e.type,r=i?this.allVideoSamplesCount:this.allAudioSamplesCount,s=i?this._firstVideoSample.dts:this._firstAudioSample.dts,n=i?this.filledVideoSamples.length:this.filledAudioSamples.length;if(!e.refSampleDuration||e.refSampleDuration<=0||Number.isNaN(e.refSampleDuration)){if(t.length>=1){const i=t[t.length-1].dts;e.refSampleDuration=Math.floor((i-s)/(r+n-1))}}else if(e.refSampleDuration&&t.length>=3){const i=(t[t.length-1].dts-t[0].dts)/t.length;e.refSampleDuration=Math.abs(e.refSampleDuration-i)<=e.refSampleDuration?e.refSampleDuration:i}}recordSamplesCount(){const{audioTrack:e,videoTrack:t}=this;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}removeInvalidSamples(){const{_firstVideoSample:e,_firstAudioSample:t}=this;this.audioTrack.samples=this.audioTrack.samples.filter(e=>e.dts>=t.dts&&(void 0===this.lastAudioDts||e.dts>this.lastAudioDts)),this.videoTrack.samples=this.videoTrack.samples.filter(t=>t.dts>=e.dts&&(void 0===this.lastVideoDts||t.dts>this.lastVideoDts))}static sortAudioSamples(e){return 1===e.length?e:e.sort((e,t)=>e.dts-t.dts)}static findFirstAudioSample(e){return e&&0!==e.length?l.sortAudioSamples(e)[0]:null}static findFirstVideoSample(e){if(!e.length)return null;const t=e.sort((e,t)=>e.dts-t.dts);for(let e=0,i=t.length;e<i;e++)if(t[e].isKeyframe)return t[e]}get tracks(){return this._context.getInstance("TRACKS")}get audioTrack(){return this.tracks?this.tracks.audioTrack:null}get videoTrack(){return this.tracks?this.tracks.videoTrack:null}}t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.mimetype="",this.init=null,this.data=[]}}t.default=class{constructor(){this.sources={}}getSource(e){return this.sources[e]}createSource(e){return this.sources[e]=new r,this.sources[e]}clear(){this.sources={}}destroy(){this.sources={}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=e.autoclear||!1}get list(){return this._list}set baseURL(e){this.baseURL!==e&&(this.clear(),this._baseURL=e)}get baseURL(){return this._baseURL}push(e,t){this._ts[e]||(this._ts[e]={duration:t,downloaded:!1,downloading:!1,start:this.duration},this._list[this.duration]=e,this.duration+=t,this.fragLength+=1)}deleteFrag(e){this._ts[e]&&(this._ts[e].start>this._lastget.time&&(this._lastget={duration:this._ts[e].duration,time:this._ts[e].start,downloaded:!1,downloading:!1,url:e}),delete this._list[this._ts[e].start],delete this._ts[e],this.fragLength-=1)}pushM3U8(e,t){if(e&&(this.version=e.version,this.targetduration=e.targetduration,e.sequence>this.sequence)){this.sequence=e.sequence;let i=[];for(let t=0;t<e.frags.length;t++){let r=e.frags[t];this._ts[r.url]||(i.push(r.url),this.push(r.url,r.duration))}if(t){let e=this.getTsList();for(let t=0;t<e.length;t++)i.indexOf(e[t])<0&&this.deleteFrag(e[t])}}}getTsList(){return Object.keys(this._ts)}downloaded(e,t){let i=this._ts[e];i&&(i.downloaded=t)}downloading(e,t){let i=this._ts[e];i&&(i.downloading=t)}getTsByName(e){return this._ts[e]}getTs(e){let t,i=Object.keys(this._list);if(void 0===e&&(e=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||e>=this.duration)){i.sort((e,t)=>parseFloat(e)-parseFloat(t));for(let r=0;r<i.length&&e>=parseInt(i[r]);r++){let e=this._list[i[r]];t={url:e,downloaded:this._ts[e].downloaded,downloading:this._ts[e].downloading,time:parseInt(i[r]),duration:parseInt(this._ts[e].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=t}return t}}clear(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}clearDownloaded(){for(let e=0,t=Object.keys(this._ts).length;e<t;e++){let t=this._ts[Object.keys(this._ts)[e]];t.downloaded=!1,t.downloading=!1}}destroy(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=i(0),n=i(2),a=i(3),o=i(46),l=(r=o)&&r.__esModule?r:{default:r};const u=s.EVENTS.DEMUX_EVENTS;class d{constructor(){this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}init(){this.on(u.DEMUX_START,this.doParseFlv.bind(this))}static isFlvFile(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}static getPlayType(e){const t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}doParseFlv(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;let e;do{e=this._parseFlvTag()}while(e);this.emit(u.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;const e=this.loaderBuffer.shift(13);this.parseFlvHeader(e),this.doParseFlv()}}parseFlvHeader(e){if(d.isFlvFile(e)){this._firstFragmentLoaded=!0;const t=d.getPlayType(e[4]);t.hasVideo&&this.initVideoTrack(),t.hasAudio&&this.initAudioTrack()}else this.emit(u.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}initVideoTrack(){this._trackNum++;let e=new a.VideoTrack;e.meta=new s.VideoTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}initAudioTrack(){this._trackNum++;let e=new a.AudioTrack;e.meta=new s.AudioTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}_parseFlvTag(){if(this.loaderBuffer.length<11)return null;let e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}_parseFlvTagHeader(){let e=0,t={},i=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&i)>>>5,t.tagType=31&i,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.logger.warn(this.TAG,"tagType "+t.tagType),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);let r=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);let s=this.loaderBuffer.shift(1)[0];return s>0&&(r+=16777216*s),t.dts=r,this.loaderBuffer.shift(3),t}_processChunk(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}_parseScriptData(e){let t=this.tracks.audioTrack,i=this.tracks.videoTrack,r=this.loaderBuffer.shift(e.datasize);const s=(new l.default).resolve(r,r.length),n=this._context.onMetaData=s?s.onMetaData:void 0;if(this._context.mediaInfo.duration=n.duration,this._context.mediaInfo.hasVideo=n.hasVideo,this._context.mediaInfo.hsaAudio=n.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(u.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){let e=t.meta;switch(n.audiosamplerate&&(e.sampleRate=n.audiosamplerate),n.audiochannels&&(e.channelCount=n.audiochannels),n.audiosamplerate){case 44100:e.sampleRateIndex=4;break;case 22050:e.sampleRateIndex=7;break;case 11025:e.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){let e=i.meta;if("number"==typeof n.framerate){let t=Math.floor(1e3*n.framerate);if(t>0){let i=t/1e3;e.frameRate||(e.frameRate={}),e.frameRate.fixed=!0,e.frameRate.fps=i,e.frameRate.fps_num=t,e.frameRate.fps_den=1e3}}}}_aacSequenceHeaderParser(e){let t={hasSpecificConfig:!0};t.objectType=e[1]>>>3,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2],t.codec=`mp4a.40.${t.objectType}`;let i,r,s=window.navigator.userAgent.toLowerCase(),n=t.sampleRateIndex;return-1!==s.indexOf("firefox")?t.sampleRateIndex>=6?(t.objectType=5,r=new Array(4),i=n-3):(t.objectType=2,r=new Array(2),i=n):-1!==s.indexOf("android")?(t.objectType=2,r=new Array(2),i=n):(t.objectType=5,i=t.sampleRateIndex,r=new Array(4),t.sampleRateIndex>=6?i=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,r=new Array(2),i=t.sampleRateIndex)),r[0]=t.objectType<<3,r[0]|=(15&t.sampleRateIndex)>>>1,r[1]=(15&t.sampleRateIndex)<<7,r[1]|=(15&t.channelCount)<<3,5===t.objectType&&(r[1]|=(15&i)>>>1,r[2]=(1&i)<<7,r[2]|=8,r[3]=0),t.config=r,t}_parseAACData(e){let t=this.tracks.audioTrack;if(!t)return;let i=t.meta;i||(i=new s.AudioTrackMeta);let r=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);let n=(240&r)>>>4;t.format=n,10!==n&&this.emit(u.DEMUX_ERROR,new Error(`invalid audio format: ${n}`)),10!==n||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(r),i.sampleRateIndex=(12&r)>>>2,i.frameLenth=(2&r)>>>1,i.channelCount=1&r,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));let a=i.audioSampleRate,o=i.sampleRateIndex,l=i.refSampleDuration;delete e.tagType;let d=this._datasizeValidator(e.datasize);if(0===e.data[0]){let t=this._aacSequenceHeaderParser(e.data);a=t.audiosamplerate||i.audioSampleRate,o=t.sampleRateIndex||i.sampleRateIndex,l=Math.floor(1024/a*i.timescale),i.channelCount=t.channelCount,i.sampleRate=a,i.sampleRateIndex=o,i.refSampleDuration=l,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=t.config,i.objectType=t.objectType;const r=this._context.mediaInfo.audio;r.codec=t.codec,r.channelCount=t.channelCount,r.sampleRate=a,r.sampleRateIndex=t.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(u.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&this.emit(u.AUDIO_METADATA_CHANGE),this._hasAudioSequence=!0}else e.data=e.data.slice(1,e.data.length),t.samples.push(e);if(!d){const t=new Error("TAG length error at "+e.datasize);this.emit(u.DEMUX_ERROR,t.message),this.logger.warn(this.TAG,t.message)}}_parseHevcData(e){let t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;let i=15&t;if(this.tracks.videoTrack.codecID=i,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){const t=this.loaderBuffer.shift(e.datasize-5);if(e.data=t,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.logger.warn(this.TAG,`invalid video tag datasize: ${e.datasize}`);let t={},i=0;for(t.cts=e.cts,t.dts=e.dts;e.data.length>i;){let r=e.data.slice(Number.parseInt(i),4+i);t.size=r[3],t.size+=256*r[2],t.size+=256*r[1]*256,t.size+=256*r[0]*256*256,i+=4,t.data=e.data.slice(Number.parseInt(i),t.size+i),i+=t.size,this.tracks.videoTrack.samples.push(t),this.emit(u.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(u.METADATA_PARSED,"video"):this.logger.warn(this.TAG,`invalid video tag datasize: ${e.datasize}`))}else if(7===i){let t=this.loaderBuffer.shift(e.datasize-5);if(0===t[4]&&0===t[5]&&0===t[6]&&1===t[7]){let e=0;for(let i=0;i<4;i++)e=256*e+t[i];e-=4,(t=t.slice(4,t.length))[3]=e%256,e=(e-t[3])/256,t[2]=e%256,e=(e-t[2])/256,t[1]=e%256,t[0]=(e-t[1])/256}if(e.data=t,0===e.avcPacketType){this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(u.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&this.emit(u.VIDEO_METADATA_CHANGE),this._hasVideoSequence=!0)}else{if(!this._datasizeValidator(e.datasize))return void this.logger.warn(this.TAG,`invalid video tag datasize: ${e.datasize}`);this.tracks.videoTrack.samples.push(e)}}else this.logger.warn(this.TAG,`video codeid is ${i}`),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.logger.warn(this.TAG,`invalid video tag datasize: ${e.datasize}`),this.tracks.videoTrack.samples.push(e),this.emit(u.DEMUX_COMPLETE);delete e.tagType}_avcSequenceHeaderParser(e){let t=this.tracks.videoTrack;if(!t)return;let i=0;t.meta||(t.meta=new s.VideoTrackMeta);let r=t.meta;r.configurationVersion=e[0],r.avcProfileIndication=e[1],r.profileCompatibility=e[2],r.avcLevelIndication=e[3]/10,r.nalUnitLength=1+(3&e[4]);let a=31&e[5];i=6;let o={};for(let t=0;t<a;t++){let t=255*e[i]+e[i+1];i+=2;let s=new Uint8Array(t);for(let r=0;r<t;r++)s[r]=e[i+r];let a="avc1.";for(let e=1;e<4;e++){let t=s[e].toString(16);t.length<2&&(t="0"+t),a+=t}r.codec=a,i+=t,this.tracks.videoTrack.meta.sps=s,o=n.SpsParser.parseSPS(s)}let l=e[i];i++;for(let t=0;t<l;t++){let t=255*e[i]+e[i+1];i+=2;let r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e[i+s];i+=t,this.tracks.videoTrack.meta.pps=r}Object.assign(r,n.SpsParser.toVideoMeta(o));const u=this._context.mediaInfo.video;u.codec=r.codec,u.profile=r.profile,u.level=r.level,u.chromaFormat=r.chromaFormat,u.frameRate=r.frameRate,u.parRatio=r.parRatio,u.width=u.width===r.presentWidth?u.width:r.presentWidth,u.height=u.height===r.presentHeight?u.width:r.presentHeight,r.duration=this._context.mediaInfo.duration*r.timescale,r.avcc=new Uint8Array(e.length),r.avcc.set(e),t.meta=r}_switchAudioSampleRate(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}_switchAudioSamplingFrequency(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}_switchAudioChannel(e){return[1,2][1&e]}_datasizeValidator(e){let t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}get loaderBuffer(){if(this._context.getInstance("LOADER_BUFFER"))return this._context.getInstance("LOADER_BUFFER");this.emit(u.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}get tracks(){return this._context.getInstance("TRACKS")}get logger(){return this._context.getInstance("LOGGER")}}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0);const s={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12};t.default=class{constructor(){this.offset=0,this.readOffset=this.offset}resolve(e,t){if(t<3)throw new Error("not enough data for metainfo");const i={},r=this.parseValue(e),s=this.parseValue(e,t-r.bodySize);return i[r.data]=s.data,this.resetStatus(),i}resetStatus(){this.offset=0,this.readOffset=this.offset}parseString(e){const t=new DataView(e,this.readOffset).getUint16(0,!r.isLe);let i="";i=t>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,t)):"";let s=t+2;return this.readOffset+=s,{data:i,bodySize:t+2}}parseDate(e,t){const i=new DataView(e,this.readOffset,t);let s=i.getFloat64(0,!r.isLe);return s+=60*i.getInt16(8,!r.isLe)*1e3,this.readOffset+=10,{data:new Date(s),bodySize:10}}parseObject(e,t){const i=this.parseString(e,t),r=this.parseValue(e,t-i.bodySize);return{data:{name:i.data,value:r.data},bodySize:i.bodySize+r.bodySize,isObjEnd:r.isObjEnd}}parseLongString(e){const t=new DataView(e,this.readOffset).getUint32(0,!r.isLe);let i="";return i=t>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,t)):"",this.readOffset+=t+4,{data:i,bodySize:t+4}}parseValue(e,t){let i=new ArrayBuffer;i=e instanceof ArrayBuffer?e:e.buffer;const{NUMBER:n,BOOLEAN:a,STRING:o,OBJECT:l,MIX_ARRAY:u,OBJECT_END:d,STRICT_ARRAY:c,DATE:h,LONE_STRING:f}=s,p=new DataView(i,this.readOffset,t);let m=!1;const _=p.getUint8(0);let g=1;this.readOffset+=1;let y=null;switch(_){case n:y=p.getFloat64(1,!r.isLe),this.readOffset+=8,g+=8;break;case a:y=!!p.getUint8(1),this.readOffset+=1,g+=1;break;case o:{const e=this.parseString(i);y=e.data,g+=e.bodySize;break}case l:{y={};let e=0;for(16777215&p.getUint32(t-4,!r.isLe)&&(e=3);g<t-4;){const r=this.parseObject(i,t-g-e);if(r.isObjectEnd)break;y[r.data.name]=r.data.value,g+=r.bodySize}if(g<=t-3){9===(16777215&p.getUint32(g-1,!r.isLe))&&(this.readOffset+=3,g+=3)}break}case u:{y={},g+=4,this.readOffset+=4;let e=0;for(9==(16777215&p.getUint32(t-4,!r.isLe))&&(e=3);g<t-8;){const r=this.parseObject(i,t-g-e);if(r.isObjectEnd)break;y[r.data.name]=r.data.value,g+=r.bodySize}if(g<=t-3){9===(16777215&p.getUint32(g-1,!r.isLe))&&(g+=3,this.readOffset+=3)}break}case d:y=null,m=!0;break;case c:{y=[];const e=p.getUint32(1,!r.isLe);g+=4,this.readOffset+=4;for(let r=0;r<e;r++){const e=this.parseValue(i,t-g);y.push(e.data),g+=e.bodySize}break}case h:{const e=this.parseDate(i,t-1);y=e.data,g+=e.bodySize;break}case f:{const e=this.parseLongString(i,t-1);y=e.data,g+=e.bodySize;break}default:g=t}return{data:y,bodySize:g,isObjEnd:m}}}},function(e,t,i){e.exports=i(48)},function(e,t,i){"use strict";var r=a(i(4)),s=i(0),n=a(i(49));function a(e){return e&&e.__esModule?e:{default:e}}const o=s.EVENTS.FlvAllowedEvents;class l extends r.default{constructor(e){super(e),this.context=new s.Context(o),this.initEvents()}start(){this.initFlv(),this.context.init(),super.start(this.flv.mse.url)}initFlvEvents(e){const t=this;e.once(s.EVENTS.REMUX_EVENTS.INIT_SEGMENT,()=>{if(r.default.util.addClass(t.root,"xgplayer-is-live"),!r.default.util.findDom(this.root,"xg-live")){const e=r.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");t.controls.appendChild(e)}}),e.once(s.EVENTS.LOADER_EVENTS.LOADER_COMPLETE,()=>{if(!t.paused){const e=setInterval(()=>{const i=t.getBufferedRange()[1];Math.abs(t.currentTime-i)<.5&&(t.emit("ended"),window.clearInterval(e))},200)}})}initEvents(){this.on("timeupdate",()=>{this.loadData()}),this.on("seeking",()=>{const e=this.currentTime,t=this.getBufferedRange();(e>t[1]||e<t[0])&&this.flv.seek(this.currentTime)})}initFlv(){const e=this.context.registry("FLV_CONTROLLER",n.default)(this);this.initFlvEvents(e),this.flv=e}play(){if(this._hasStart){this._destroy(),this.context=new s.Context(o);const e=this.context.registry("FLV_CONTROLLER",n.default)(this);this.initFlvEvents(e),this.flv=e,this.context.init(),super.start(e.mse.url),super.play()}else super.play()}pause(){super.pause(),this.flv&&this.flv.pause()}loadData(e=this.currentTime){this.flv&&this.flv.seek(e)}destroy(){this._destroy(),super.destroy()}_destroy(){this.context.destroy(),this.flv=null,this.context=null}get src(){return this.currentSrc}set src(e){this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",()=>{this.start(e)}),this.once("canplay",()=>{this.play()})),this.once("canplay",()=>{this.currentTime=0})}}e.exports=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(i(33)),s=i(36),n=i(38),a=i(3),o=i(0),l=i(2),u=d(i(4));function d(e){return e&&e.__esModule?e:{default:e}}const c=o.EVENTS.REMUX_EVENTS,h=o.EVENTS.DEMUX_EVENTS,f=o.EVENTS.LOADER_EVENTS,p=o.EVENTS.MSE_EVENTS,m="FLVController";class _{warn(){}}t.default=class{constructor(e){this.TAG=m,this._player=e,this.state={initSegmentArrived:!1}}init(){this._context.registry("FETCH_LOADER",s.FetchLoader),this._context.registry("LOADER_BUFFER",a.XgBuffer),this._context.registry("FLV_DEMUXER",n.FlvDemuxer),this._context.registry("TRACKS",a.Tracks),this._context.registry("MP4_REMUXER",r.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",a.PreSource),this._context.registry("COMPATIBILITY",l.Compatibility),this._context.registry("LOGGER",_),this.mse=this._context.registry("MSE",o.Mse)({container:this._player.video}),this.initListeners()}initListeners(){this.on(f.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(f.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(h.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(h.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(h.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(h.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(c.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(c.MEDIA_SEGMENT,this._handleMediaSegment.bind(this)),this.on(p.SOURCE_UPDATE_END,this._handleSourceUpdateEnd.bind(this)),this._player.on("timeupdate",this._handleTimeUpdate.bind(this))}_handleMediaInfo(){this._context.mediaInfo||this.emit(h.DEMUX_ERROR,new Error("failed to get mediainfo"))}_handleLoaderDataLoaded(){this.emitTo("FLV_DEMUXER",h.DEMUX_START)}_handleMetadataParsed(e){this.emit(c.REMUX_METADATA,e)}_handleDemuxComplete(){this.emit(c.REMUX_MEDIA)}_handleAppendInitSegment(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}_handleMediaSegment(){this.mse.addSourceBuffers(),this.mse.doAppend()}_handleSourceUpdateEnd(){const e=this._player.currentTime,t=this._player.video,i=this._player.config.preloadTime||5,{length:r}=t.buffered;if(0===r)return;const s=t.buffered.end(r-1);s-e>2*i&&(this._player.currentTime=s-i)}_handleTimeUpdate(){const e=this._player.currentTime;e>2&&this.mse.remove(e-2)}_handleNetworkError(){this._player.emit("error",new u.default.Errors("network",this._player.config.url))}_handleDemuxError(){this._player.emit("error",new u.default.Errors("parse",this._player.config.url))}seek(){this.state.initSegmentArrived||this.loadData()}loadData(){this.emit(f.LADER_START,this._player.config.url)}pause(){const e=this._context.getInstance("FETCH_LOADER");e&&e.cancel()}}}]);