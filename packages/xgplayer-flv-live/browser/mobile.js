window.FlvPlayer=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=54)}([function(e,t,i){"use strict";e.exports={Context:i(14).default,EVENTS:i(2).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,PageVisibility:i(19).default,MediaInfo:i(6).default,MediaSample:i(20).default,MediaSegment:i(21).default,MediaSegmentList:i(22).default,AudioTrackMeta:i(8).AudioTrackMeta,VideoTrackMeta:i(8).VideoTrackMeta,AudioTrackSample:i(9).AudioTrackSample,VideoTrackSample:i(9).VideoTrackSample,Mse:i(23).default,Stream:i(10).default,Buffer:i(24).default,MobileVideo:i(27),Crypto:i(37).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}let s=function(){function e(){o(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return n(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"distroy",value:function(){this.reset(),this.id=-1}}]),e}();t.default=s;t.AudioTrack=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.TAG="AudioTrack",e.type="audio",e}return a(t,e),t}(s),t.VideoTrack=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.TAG="VideoTrack",e.type="video",e.dropped=0,e}return a(t,e),n(t,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),t}(s),t.Tracks=function(){function e(){o(this,e),this.audioTrack=null,this.videoTrack=null}return n(e,[{key:"destroy",value:function(){this.audioTrack=null,this.videoTrack=null}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},r={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM"},o={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},s={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},u={VISIBILITY_CHANGE:"VISIBILITY_CHANGE"},l=Object.assign({},n,r,a,o,s,u),c=[],f=[];for(let e in l)l.hasOwnProperty(e)&&c.push(l[e]);for(let e in l)l.hasOwnProperty(e)&&f.push(l[e]);t.default={ALLEVENTS:l,HLS_EVENTS:s,REMUX_EVENTS:a,DEMUX_EVENTS:r,MSE_EVENTS:o,LOADER_EVENTS:n,FlvAllowedEvents:c,HlsAllowedEvents:f,CRYTO_EVENTS:{START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"},BROWSER_EVENTS:u}},function(e,t,i){"use strict";e.exports={Nalunit:i(11).default,SpsParser:i(12).default,Compatibility:i(46).default}},function(e,t,i){"use strict";e.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(13).XgBuffer,RemuxBuffer:i(13).RemuxBuffer,PreSource:i(48).default}},function(e,t){e.exports=window.Player},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();const r=e=>{for(let t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0};let a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return n(e,[{key:"isComplete",value:function(){return e.isBaseInfoReady(this)&&e.isVideoReady(this)&&e.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(e){return r(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||r(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||r(e.video)}}]),e}();t.default=a},function(e,t,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,i,n){var r,a,o,s;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),o=a[t]),void 0===o)o=a[t]=i,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=l(e))>0&&o.length>r&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,console&&console.warn&&console.warn(s)}return e}function f(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function h(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=f.bind(n);return r.listener=i,n.wrapFn=r,r}function d(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):y(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function y(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var l=u.length,c=y(u,l);for(i=0;i<l;++i)a(c[i],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var i,n,r,a,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.AudioTrackMeta=function(){function e(t){r(this,e);const i={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},i,t):i}return n(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),t.VideoTrackMeta=function(){function e(t){r(this,e);const i={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},i,t):i}return n(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.AudioTrackSample=function(){function e(t){r(this,e);let i=e.getDefault();return t?Object.assign({},i,t):i}return n(e,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,data:new Uint8Array}}}]),e}(),t.VideoTrackSample=function(){function e(t){r(this,e);let i=e.getDefault();return t?Object.assign({},i,t):i}return n(e,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return n(e,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(t){let i=Math.floor(t/4),n=t%4;for(let t=0;t<i;t++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,i){let n;switch(t){case 1:n=i?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=i?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(i)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=i?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(i)throw new Error("not supported for readBody 8");n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(12),o=(n=a)&&n.__esModule?n:{default:n};let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];let i=t.dataview,n=t.position;return 1===i.getInt32(n)||0===i.getInt16(n)&&1===i.getInt8(n+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){let i=[],n=e.getHeaderPositionAnnexB(t),r=n.pos,a=r;for(;r<t.length-4;){let o=t.buffer.slice(r,r+n.headerLength);n.pos===t.position&&t.skip(n.headerLength),a=(n=e.getHeaderPositionAnnexB(t)).pos;let s={header:o,body:new Uint8Array(t.buffer.slice(r+o.byteLength,a))};e.analyseNal(s),i.push(s),t.skip(a-t.position),r=a}return i}},{key:"getAvccNals",value:function(t){let i=[];for(;t.position<t.length-4;){let n=t.dataview.getInt32(t.position);if(!(t.length-t.position>=n))break;{let r=t.buffer.slice(t.position,t.position+4);t.skip(4);let a=t.buffer.slice(t.position,t.position+n);t.skip(n);let o={header:r,body:a};e.analyseNal(o),i.push(o)}}return i}},{key:"analyseNal",value:function(e){switch(31&e.body[0]){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:break;case 7:e.sps=o.default.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){let t=e.position,i=0;for(;3!==i&&4!==i&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(i=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=e.length)),{pos:t,headerLength:i}}},{key:"getAvcc",value:function(e,t){let i=new Uint8Array(e.byteLength+t.byteLength+11);i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225;let n=6;return i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),n),n+=2,i.set(e,n),i[n+=e.byteLength]=1,n++,i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),n),n+=2,i.set(t,n),i}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(30),o=(n=a)&&n.__esModule?n:{default:n};let s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"_ebsp2rbsp",value:function(e){let t=e,i=t.byteLength,n=new Uint8Array(i),r=0;for(let e=0;e<i;e++)e>=2&&3===t[e]&&0===t[e-1]&&0===t[e-2]||(n[r]=t[e],r++);return new Uint8Array(n.buffer,0,r)}},{key:"parseSPS",value:function(t){let i=e._ebsp2rbsp(t),n=new o.default(i);n.readByte();let r=n.readByte();n.readByte();let a=n.readByte();n.readUEG();let s=e.getProfileString(r),u=e.getLevelString(a),l=1,c=420,f=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(l=n.readUEG())&&n.readBits(1),l<=3&&(c=f[l]),h=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool())){let t=3!==l?8:12;for(let i=0;i<t;i++)n.readBool()&&(i<6?e._skipScalingList(n,16):e._skipScalingList(n,64))}n.readUEG();let d=n.readUEG();if(0===d)n.readUEG();else if(1===d){n.readBits(1),n.readSEG(),n.readSEG();let e=n.readUEG();for(let t=0;t<e;t++)n.readSEG()}n.readUEG(),n.readBits(1);let p=n.readUEG(),y=n.readUEG(),m=n.readBits(1);0===m&&n.readBits(1),n.readBits(1);let v=0,g=0,_=0,b=0;n.readBool()&&(v=n.readUEG(),g=n.readUEG(),_=n.readUEG(),b=n.readUEG());let E=1,w=1,k=0,T=!0,A=0,S=0;if(n.readBool()){if(n.readBool()){let e=n.readByte(),t=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],i=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];e>0&&e<16?(E=t[e-1],w=i[e-1]):255===e&&(E=n.readByte()<<8|n.readByte(),w=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){let e=n.readBits(32),t=n.readBits(32);T=n.readBool(),k=(A=t)/(S=2*e)}}let x=1;1===E&&1===w||(x=E/w);let D=0,O=0;if(0===l)D=1,O=2-m;else{D=3===l?1:2,O=(1===l?2:1)*(2-m)}let C=16*(p+1),R=16*(y+1)*(2-m);C-=(v+g)*D,R-=(_+b)*O;let L=Math.ceil(C*x);return n.destroy(),n=null,{profile_string:s,level_string:u,bit_depth:h,chroma_format:c,chroma_format_string:e.getChromaFormatString(c),frame_rate:{fixed:T,fps:k,fps_den:S,fps_num:A},par_ratio:{width:E,height:w},codec_size:{width:C,height:R},present_size:{width:L,height:R}}}},{key:"_skipScalingList",value:function(e,t){let i=8,n=8,r=0;for(let a=0;a<t;a++)0!==n&&(n=(i+(r=e.readSEG())+256)%256),i=0===n?i:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){let t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;let i=t.frameRate.fps_den,n=t.frameRate.fps_num;return t.refSampleDuration=Math.floor(t.timescale*(i/n)),t}}]),e}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.XgBuffer=function(){function e(t){r(this,e),this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}return n(e,[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){let t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){let t=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,t}let t=new Uint8Array(e),i=0;for(;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){let n=this.array[0].slice(this.offset,this.offset+e);t.set(n,i),this.offset+=e,this.length-=e,e=0;break}{let n=this.array[0].length-this.offset;t.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=n,this.length-=n,e-=n}}return t}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){let i=0,n=this.offset+e;for(;n<this.offset+t+e;)n<this.array[0].length?i=256*i+this.array[0][n]:this.array[1]&&(i=256*i+this.array[1][n-this.array[0].length]),n++;return i}}]),e}(),t.RemuxBuffer=function(){function e(){r(this,e),this.video=[],this.audio=[]}return n(e,[{key:"destroy",value:function(){this.video=[],this.audio=[]}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(6),s=(n=o)&&n.__esModule?n:{default:n},u=i(7);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}let c=function(){function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];l(this,e),this._emitter=new u.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new s.default,this.allowedEvents=t,this._hooks={}}return a(e,[{key:"getInstance",value:function(e){const t=this._instanceMap[e];return t||null}},{key:"initInstance",value:function(e){if(this._clsMap[e]){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];const r=new(Function.prototype.bind.apply(this._clsMap[e],[null].concat(i)));return this._instanceMap[e]=r,r.init&&r.init(),r}throw new Error(`${e}未在context中注册`)}},{key:"init",value:function(e){if(!this._inited){for(let t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(e,t){var i=this;const n=this._emitter,o=this._isMessageNameValid.bind(this),s=this,u=function(t){function i(){var t;l(this,i);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(r)));return o.listeners={},o.onceListeners={},o.TAG=e,o._context=s,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,t),a(i,[{key:"on",value:function(t,i){return o(t),this.listeners[t]?this.listeners[t].push(i):this.listeners[t]=[i],n.on(`${t}__TO__${e}`,i),n.on(t,i)}},{key:"before",value:function(e,t){o(e),s._hooks[e]?s._hooks[e].push(t):s._hooks[e]=[t]}},{key:"once",value:function(t,i){return o(t),this.onceListeners[t]?this.onceListeners[t].push(i):this.onceListeners[t]=[i],n.once(`${t}__TO__${e}`,i),n.once(t,i)}},{key:"emit",value:function(e){o(e);const t=s._hooks?s._hooks[e]:null;if(t)for(let e=0,i=t.length;e<i;e++){(0,t[e])()}for(var i=arguments.length,r=Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return n.emit.apply(n,[e].concat(r))}},{key:"emitTo",value:function(e,t){o(t);for(var i=arguments.length,r=Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return n.emit.apply(n,[`${t}__TO__${e}`].concat(r))}},{key:"off",value:function(e,t){return o(e),n.off(e,t)}},{key:"removeListeners",value:function(){const t=Object.prototype.hasOwnProperty.bind(this.listeners);for(let i in this.listeners)if(t(i)){const t=this.listeners[i]||[];for(let r=0;r<t.length;r++){const a=t[r];n.off(i,a),n.off(`${i}__TO__${e}`,a)}}for(let i in this.onceListeners)if(t(i)){const t=this.onceListeners[i]||[];for(let r=0;r<t.length;r++){const a=t[r];n.off(i,a),n.off(`${i}__TO__${e}`,a)}}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete s._instanceMap[e],r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this))return r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(t);return this._clsMap[e]=u,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.initInstance.apply(i,[e].concat(n))}}},{key:"destroyInstances",value:function(){Object.keys(this._instanceMap).forEach(e=>{this._instanceMap[e].destroy&&this._instanceMap[e].destroy()})}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}},{key:"_isMessageNameValid",value:function(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error(`unregistered message name: ${e}`)}}]),e}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=function(){const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),r={get device(){let e=r.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){let e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter(i=>t[i].test(e)))[0]},get os(){let e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isAndroid:n,isPc:!o&&!n&&!i,isSymbian:i,isWindowsPhone:t,isFireFox:r}},get isLe(){return n}};t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=function(){const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"decode",value:function(t){const i=[],n=t;let r=0;const a=t.length;for(;r<a;)if(n[r]<128)i.push(String.fromCharCode(n[r])),++r;else{if(n[r]<192);else if(n[r]<224){if(e._checkContinuation(n,r,1)){const e=(31&n[r])<<6|63&n[r+1];if(e>=128){i.push(String.fromCharCode(65535&e)),r+=2;continue}}}else if(n[r]<240){if(e._checkContinuation(n,r,2)){const e=(15&n[r])<<12|(63&n[r+1])<<6|63&n[r+2];if(e>=2048&&55296!=(63488&e)){i.push(String.fromCharCode(65535&e)),r+=3;continue}}}else if(n[r]<248&&e._checkContinuation(n,r,3)){let e=(7&n[r])<<18|(63&n[r+1])<<12|(63&n[r+2])<<6|63&n[r+3];if(e>65536&&e<1114112){e-=65536,i.push(String.fromCharCode(e>>>10|55296)),i.push(String.fromCharCode(1023&e|56320)),r+=4;continue}}i.push(String.fromCharCode(65533)),++r}return i.join("")}},{key:"_checkContinuation",value:function(e,t,i){let n=e;if(t+i<n.length){for(;i--;)if(128!=(192&n[++t]))return!1;return!0}return!1}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(2);const o=((n=a)&&n.__esModule?n:{default:n}).default.BROWSER_EVENTS;let s,u;void 0!==document.hidden?(s="hidden",u="visibilitychange"):void 0!==document.msHidden?(s="msHidden",u="msvisibilitychange"):void 0!==document.webkitHidden&&(s="webkitHidden",u="webkitvisibilitychange");let l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callbacks={onShow:[],onHidden:[]},this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.init()}return r(e,[{key:"init",value:function(){document.addEventListener(u,this.handleVisibilityChange,!1)}},{key:"handleVisibilityChange",value:function(){this.emit(o.VISIBILITY_CHANGE,document[s])}},{key:"destroy",value:function(){document.removeEventListener(u,this.handleVisibilityChange)}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);let i=e.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return i;let n=Object.assign({},i,t);Object.entries(n).forEach(e=>{let[t,i]=e;this[t]=i})}return n(e,null,[{key:"getDefaultInf",value:function(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}return n(e,[{key:"addRAP",value:function(e){e.isRAP=!0,this.randomAccessPoints.push(e)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return n(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){let t=this._list;if(0===t.length)return-2;let i=t.length-1,n=0,r=0,a=i,o=0;if(e<t[0].originDts)return o=-1;for(;r<=a;){if((n=r+Math.floor((a-r)/2))===i||e>t[n].lastSample.originDts&&e<t[n+1].originDts){o=n;break}t[n].originDts<e?r=n+1:a=n-1}return o}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){let t=this._list,i=this._lastAppendLocation,n=0;-1!==i&&i<t.length&&e.originStartDts>=t[i].lastSample.originDts&&(i===t.length-1||i<t.length-1&&e.originStartDts<t[i+1].originStartDts)?n=i+1:t.length>0&&(n=this._searchNearestSegmentBefore(e.originStartDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,e)}},{key:"getLastSegmentBefore",value:function(e){let t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){let t=this.getLastSegmentBefore(e);return null!==t?t.lastSample:null}},{key:"getLastRAPBefore",value:function(e){let t=this._searchNearestSegmentBefore(e),i=this._list[t].randomAccessPoints;for(;0===i.length&&t>0;)t--,i=this._list[t].randomAccessPoints;return i.length>0?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}return n(e,[{key:"init",value:function(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}},{key:"onTimeUpdate",value:function(){this.emit("TIME_UPDATE",this.container)}},{key:"onWaiting",value:function(){this.emit("WAITING",this.container)}},{key:"onSourceOpen",value:function(){this.addSourceBuffers()}},{key:"onUpdateEnd",value:function(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}},{key:"addSourceBuffers",value:function(){if("open"!==this.mediaSource.readyState)return;let e,t=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");t=t.sources;let n=!1;for(let r=0,a=Object.keys(t).length;r<a;r++){let a=Object.keys(t)[r];if("audio"===a?e=i.audioTrack:"video"===a&&(e=i.videoTrack),e){let i="audio"===a?21:40;e.meta&&e.meta.refSampleDuration&&(i=e.meta.refSampleDuration),t[a].data.length>=this.preloadTime/i&&(n=!0)}}if(n){if(Object.keys(this.sourceBuffers).length>0)return;for(let e=0,i=Object.keys(t).length;e<i;e++){let i=Object.keys(t)[e],n=t[i],r="video"===i?"video/mp4;codecs="+n.mimetype:"audio/mp4;codecs="+n.mimetype,a=this.mediaSource.addSourceBuffer(r);this.sourceBuffers[i]=a,a.addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}},{key:"doAppend",value:function(){let e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e)for(let t=0;t<Object.keys(this.sourceBuffers).length;t++){let i=Object.keys(this.sourceBuffers)[t],n=this.sourceBuffers[i];if(!n.updating){let t=e.sources[i];if(t&&!t.inited)n.appendBuffer(t.init.buffer.buffer),t.inited=!0;else if(t){let e=t.data.shift();e&&n.appendBuffer(e.buffer.buffer)}}}}},{key:"endOfStream",value:function(){const{readyState:e,activeSourceBuffers:t}=this.mediaSource;if("open"===e&&0===t.length)try{this.mediaSource.endOfStream()}catch(e){}}},{key:"remove",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<Object.keys(this.sourceBuffers).length;i++){let n=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];n.updating||n.remove(t,e)}}},{key:"removeBuffers",value:function(){const t=[];for(let i=0;i<Object.keys(this.sourceBuffers).length;i++){let n,r=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];r.removeEventListener("updateend",this.onUpdateEnd),r.updating?n=new Promise(t=>{const i=function(){let n=3;const a=()=>{r.updating?n>0?(setTimeout(a,200),n--):t():(e.clearBuffer(r),t())};setTimeout(a,200),r.removeEventListener("updateend",i)};r.addEventListener("updateend",i)}):(e.clearBuffer(r),n=Promise.resolve()),t.push(n)}return Promise.all(t)}},{key:"destroy",value:function(){return this.removeBuffers().then(()=>{for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let t=this.sourceBuffers[Object.keys(this.sourceBuffers)[e]];this.mediaSource.removeSourceBuffer(t),delete this.sourceBuffers[Object.keys(this.sourceBuffers)[e]]}this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.endOfStream(),window.URL.revokeObjectURL(this.url),this.url=null,this.configs={},this.container=null,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=1})}}],[{key:"clearBuffer",value:function(e){const t=e.buffered;let i=.1;for(let e=0,n=t.length;e<n;e++)i=t.end(e);try{e.remove(0,i)}catch(e){}}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(25),o=(n=a)&&n.__esModule?n:{default:n};let s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=t||new Uint8Array(0)}return r(e,[{key:"write",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(e=>{this.buffer=(0,o.default)(Uint8Array,this.buffer,e)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}},{key:"readAsInt",value:function(e){let t="";return e.forEach(e=>{t+=function(e){return e.toString(16).padStart(2,"0")}(e)}),parseInt(t,16)}}]),e}();t.default=s},function(e,t,i){"use strict";var n,r=i(26),a=(n=r)&&n.__esModule?n:{default:n};e.exports=a.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=!0,o=!1,s=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;t+=c.length}}catch(e){o=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}var f=new e(t),h=0,d=!0,p=!1,y=void 0;try{for(var m,v=n[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var g=m.value;f.set(g,h),h+=g.length}}catch(e){p=!0,y=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw y}}return f}},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=s(i(28)),a=s(i(35)),o=i(36);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}let l=function(){function e(t){u(this,e),this.aCtx=t.aCtx,this.vCtx=t.vCtx,this.video=t.video,this.timeoutId=null,this.start=null}return n(e,[{key:"doReconcile",value:function(){const e=(this.vCtx.currentTime||0)-1e3*(this.aCtx.currentTime||0);this.timeoutId||(e>200?(this.video.start+=e,this.vCtx.pause(),this.timeoutId=setTimeout(()=>{this.vCtx.play(),this.timeoutId=null},e)):e<-120&&(this.video.start+=e))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null}}]),e}(),c=function(e){function t(){u(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._canvas=document.createElement("canvas"),e.handleAudioSourceEnd=e.handleAudioSourceEnd.bind(e),e.played=!1,e.pendingPlayTask=null,e._paused=!0,e.videoMetaInited=!1,e.audioMetaInited=!1,e.init(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,HTMLElement),n(t,[{key:"init",value:function(){this.vCtx=new r.default(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}})),this.aCtx=new a.default({}),this.ticker=new((0,o.getTicker)()),this.reconciler=new l({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.dispatchEvent(new Event("waiting")),this.vCtx.oncanplay=()=>{this.played||this.appendChild(this._canvas),this.dispatchEvent(new Event("canplay"))},this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"destroy",value:function(){this.aCtx.destroy(),this.vCtx.destroy(),this.ticker.stop(),this.start=null,this.reconciler.destroy(),this.aCtx=null,this.vCtx=null,this.ticker=null}},{key:"onDemuxComplete",value:function(e,t){this.aCtx.decodeAudio(t),this.vCtx.decodeVideo(e)}},{key:"setAudioMeta",value:function(e){this.audioMetaInited&&(this.aCtx.destroy(),this.aCtx=new a.default({})),this.aCtx.setAudioMetaData(e),this.audioMetaInited=!0}},{key:"setVideoMeta",value:function(e){this.videoMetaInited&&(this.vCtx.destroy(),this.vCtx=new r.default(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}}))),this.vCtx.setVideoMetaData(e),this.videoMetaInited=!0}},{key:"play",value:function(){this.pendingPlayTask||(this.played&&(this.destroy(),this.init()),this.pendingPlayTask=Promise.all([this.vCtx.play(),this.aCtx.play().then(()=>{this.aCtx.muted=!0})]).then(()=>{this.aCtx.muted=!1,this.ticker.start(()=>{this.start||(this.start=Date.now()),this._currentTime=Date.now()-this.start,this.vCtx._onTimer(this._currentTime)}),this.pendingPlayTask=null,this.played=!0,this.dispatchEvent(new Event("playing")),this.dispatchEvent(new Event("play")),this._paused=!1}))}},{key:"pause",value:function(){this._paused=!0,this.aCtx.pause(),this.vCtx.pause(),this.dispatchEvent(new Event("pause"))}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){this.style.display="inline-block";const t="number"==typeof e?`${e}px`:e;this.setAttribute("width",t),this.style.width=t,this._canvas.style.width=t,this._canvas.width=e}},{key:"height",get:function(){return this.getAttribute("height")},set:function(e){this.style.display="inline-block";const t="number"==typeof e?`${e}px`:e;this.setAttribute("height",t),this.style.height=t,this._canvas.style.height=t,this._canvas.height=e}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(e){this.setAttribute("src",e)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(e){this.setAttribute("playbackrate",e),this.aCtx.playbackRate=e,this.vCtx.playbackRate=e,this.dispatchEvent(new Event("ratechange"))}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"volume",get:function(){return this.aCtx.volume},set:function(e){this.setAttribute("volume",e),this.aCtx.volume=e}},{key:"muted",get:function(){const e="true"===this.getAttribute("muted");return void 0!==e?e:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(e){this.setAttribute("muted",e),this.aCtx.muted=!!e}},{key:"error",get:function(){return this.vCtx.error||this.aCtx.error}},{key:"buffered",get:function(){return this.vCtx.buffered}}]),t}();customElements.define("mobile-video",c)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=c(i(29)),a=c(i(10)),o=c(i(11)),s=c(i(31)),u=c(i(32)),l=c(i(33));function c(e){return e&&e.__esModule?e:{default:e}}let f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({},t),this.canvas=this.config.canvas?this.config.canvas:document.createElement("canvas"),this.source=new u.default({type:"video"}),this.preloadTime=this.config.preloadTime||3,this.oncanplay=void 0,this.onFirstFrame=void 0,this.meta=void 0,this.readyStatus=0,this.paused=!0,this.count=0,this.currentTime=0,this.lastPlayed=0,this._decoderInited=!1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null}return n(e,[{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){let e=this;this.wasmworker=(0,r.default)(34),this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",t=>{switch(t.data.msg){case"DECODER_READY":e._decoderInited=!0;break;case"DECODED":this._onDecoded(t.data)}})}},{key:"setVideoMetaData",value:function(e){if(this.meta=e,!this._decoderInited)return void this.initWasmWorker();this._avccpushed=!0;let t=new Uint8Array(e.sps.byteLength+4);if(t.set([0,0,0,1]),t.set(e.sps,4),this.wasmworker.postMessage({msg:"decode",data:t}),(t=new Uint8Array(e.pps.byteLength+4)).set([0,0,0,1]),t.set(e.pps,4),this.wasmworker.postMessage({msg:"decode",data:t}),!this.yuvCanvas){let t=Object.assign({meta:e,canvas:this.canvas},this.config);this.yuvCanvas=new s.default(t)}this.readyStatus=1}},{key:"decodeVideo",value:function(e){if(!this._decoderInited)return;this._avccpushed||this.setVideoMetaData(this.meta);let{samples:t}=e,i=t.shift();for(;i;)this._baseDts||(this._baseDts=i.dts),this.source.push(i),i=t.shift();this._preload()}},{key:"_preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){let e=this.source.get();for(e&&(this._lastSampleDts=e.dts,this._analyseNal(e));e&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(e=this.source.get())&&(this._analyseNal(e),this._lastSampleDts=e.dts)}}},{key:"_analyseNal",value:function(e){let t=o.default.getAvccNals(new a.default(e.data.buffer)),i=0;for(let e=0;e<t.length;e++){i+=t[e].body.byteLength+4}let n=0,r=new Uint8Array(i);for(let e=0;e<t.length;e++){let i=t[e];r.set([0,0,0,1],n),n+=4,r.set(new Uint8Array(i.body),n),n+=i.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:r,info:{dts:e.dts,pts:e.pts?e.pts:e.dts+e.cts,key:e.isKeyframe}})}},{key:"_onDecoded",value:function(e){let{dts:t}=e.info;this._decodedFrames[t]=e,Object.keys(this._decodedFrames).length>10&&(this.playFinish&&this.playFinish(),this.oncanplay&&this.oncanplay())}},{key:"play",value:function(){return this.paused=!1,new Promise(e=>{this.playFinish=e}).then(()=>{this.playFinish=null})}},{key:"_onTimer",value:function(e){if(!this.paused){if(this.meta){this.meta.frameRate&&this.meta.frameRate.fixed&&this.meta.frameRate.fps;let t=Object.keys(this._decodedFrames);if(t.length>0){this.currentTime=e;let i=-1;for(let e=0;e<t.length&&Number.parseInt(t[e])-this._baseDts<=this.currentTime;e++)i=Number.parseInt(t[e-1]);let n=this._decodedFrames[i];n&&this.yuvCanvas.render(n.buffer,n.width,n.height,n.yLinesize,n.uvLinesize);for(let e=0;e<t.length;e++)Number.parseInt(t[e])<i&&delete this._decodedFrames[t[e]]}}this._lastRenderTime=Date.now()}}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1)}},{key:"destroy",value:function(){this.wasmworker.postMessage({msg:"destroy"}),this.wasmworker=null,this.canvas=null,this.source=null,this._decoderInited=!1}},{key:"buffered",get:function(){const e=[];let t={start:null,end:null};for(let e=0;e<this.source.buffer.length;e++){const{start:i,end:n}=this.source.buffer[e];t.start||(t.start=i),t.end||(t.end=n),i-t.end>1e3?(t.start=t.start/1e3,t.end=t.end/1e3,t={start:i,end:n}):t.end=n}return null!==t.start&&null!==t.end&&(t.start=t.start/1e3,t.end=t.end/1e3,e.push(t)),new l.default(e)}}]),e}();t.default=f},function(e,t,i){"use strict";function n(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var n=i(i.s=ENTRY_MODULE);return n.default||n}var r="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+r+").*?\\)";function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,n){var s={};s[n]=[];var u=t.toString(),l=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var c,f=l[1],h=new RegExp("(\\\\n|\\W)"+o(f)+a,"g");c=h.exec(u);)"dll-reference"!==c[3]&&s[n].push(c[3]);for(h=new RegExp("\\("+o(f)+'\\("(dll-reference\\s('+r+'))"\\)\\)'+a,"g");c=h.exec(u);)e[c[2]]||(s[n].push(c[1]),e[c[2]]=i(c[1]).m),s[c[2]]=s[c[2]]||[],s[c[2]].push(c[4]);for(var d,p=Object.keys(s),y=0;y<p.length;y++)for(var m=0;m<s[p[y]].length;m++)d=s[p[y]][m],isNaN(1*d)||(s[p[y]][m]=1*s[p[y]][m]);return s}function u(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},a=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},n={main:[]},r={main:{}};u(i);)for(var a=Object.keys(i),o=0;o<a.length;o++){var l=a[o],c=i[l].pop();if(r[l]=r[l]||{},!r[l][c]&&e[l][c]){r[l][c]=!0,n[l]=n[l]||[],n[l].push(c);for(var f=s(e,e[l][c],l),h=Object.keys(f),d=0;d<h.length;d++)i[h[d]]=i[h[d]]||[],i[h[d]]=i[h[d]].concat(f[h[d]])}}return n}(r,e),o="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+r[e][t].toString()})).join(",")+"});\n"})),o=o+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+r.main[e].toString()})).join(",")+"}))(self);";var l=new window.Blob([o],{type:"text/javascript"});if(t.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),f=new window.Worker(c);return f.objectURL=c,f}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return n(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){let e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){let t=Math.min(this._currentWordBitsLeft,e),i=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?i<<t|this.readBits(t):i}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){let e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){let e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){let e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configs=Object.assign({},t),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this.chroma=this.meta.chromaFormat,this.height=this.meta.presentHeight,this.width=this.meta.presentWidth,this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return n(e,[{key:"_initContextGL",value:function(){for(var e=this.canvas,t=null,i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!t&&n<i.length;){var r=i[n];try{t=this.contextOptions?e.getContext(r,this.contextOptions):e.getContext(r)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++n}this.contextGL=t}},{key:"_initProgram",value:function(){var e,t,i=this.contextGL;e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),t=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var n=i.createShader(i.VERTEX_SHADER);i.shaderSource(n,e),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+i.getShaderInfoLog(n));var r=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+i.getShaderInfoLog(r));var a=i.createProgram();i.attachShader(a,n),i.attachShader(a,r),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)||console.log("Program failed to compile: "+i.getProgramInfoLog(a)),i.useProgram(a);var o=i.getUniformLocation(a,"YUV2RGB");i.uniformMatrix4fv(o,!1,[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1]),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.texturePosBuffer=r;var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=o;var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var l=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram,i=this._initTexture(),n=e.getUniformLocation(t,"ySampler");e.uniform1i(n,0),this.yTextureRef=i;var r=this._initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=r;var o=this._initTexture(),s=e.getUniformLocation(t,"vSampler");e.uniform1i(s,2),this.vTextureRef=o}},{key:"_initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"_drawPictureGL",value:function(e,t,i,n,r){var a=n*i,o=r*i/2;444!==this.chroma&&422!==this.chroma||(o*=2);let s={yData:(e=new Uint8Array(e)).subarray(0,a),uData:e.subarray(a,a+o),vData:e.subarray(a+o,a+o+o)};this._drawPictureGL420(s,t,i,n,r)}},{key:"_drawPictureGL420",value:function(e,t,i,n,r){var a=this.contextGL,o=this.texturePosBuffer,s=this.uTexturePosBuffer,u=this.vTexturePosBuffer,l=this.yTextureRef,c=this.uTextureRef,f=this.vTextureRef,h=e.yData,d=e.uData,p=e.vData,y=n,m=i,v=t/2,g=i/2;422!==this.chroma&&444!==this.chroma||(g=i);var _=r,b=g;let E=this.canvas.width/this.width,w=this.canvas.height/this.height,k=0,T=0,A=this.canvas.width,S=this.canvas.height;E<w?(S=this.height*this.canvas.width/this.width,T=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(A=this.width*this.canvas.height/this.height,k=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),a.viewport(k,T,A,S);var x=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,x,a.DYNAMIC_DRAW);var D=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,D,a.DYNAMIC_DRAW);var O=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,u),a.bufferData(a.ARRAY_BUFFER,O,a.DYNAMIC_DRAW),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,y,m,0,a.LUMINANCE,a.UNSIGNED_BYTE,h),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,v,g,0,a.LUMINANCE,a.UNSIGNED_BYTE,d),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,f),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,_,b,0,a.LUMINANCE,a.UNSIGNED_BYTE,p),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},{key:"_drawPictureRGB",value:function(e){}},{key:"render",value:function(e,t,i,n,r){this.contextGL?this._drawPictureGL(e,t,i,n,r):this._drawPictureRGB(e)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({},t),this.type=this.config.type,this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}return n(e,[{key:"push",value:function(e){if("video"===this.type){if(e.isKeyframe){let t={samples:[],start:e.dts,end:e.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=t),this.currentGop=t,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(e),e.dts<this.currentGop.start&&(this.currentGop.start=e.dts),e.dts>this.currentGop.end&&(this.currentGop.end=e.dts))}}},{key:"get",value:function(e){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===e){return this._getNext()}}}},{key:"_getNext",value:function(){if(this._lastGet){let e=this._lastGet.gop,t=e.samples[this._lastGet.index+1];if(t)return this._lastGet.index=this._lastGet.index+1,t;if(!(e=e.nextGop)||e.samples.length<1)return;return t=e.samples[0],this._lastGet={gop:e,index:0},t}{let e=this.buffer[0];if(e.samples.length<1)return;return this._lastGet={gop:e,index:0},e.samples[0]}}},{key:"remove",value:function(e,t){if(this.buffer.length<0)return;let i=0,n=this.buffer[0];for(;n;)n.end<t&&n.start>=e?(this.buffer.splice(i,1),n=this.buffer[i]):(i+=1,n=this.buffer[i])}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ranges=t||[]}return n(e,[{key:"start",value:function(e){return this.ranges[e]?this.ranges[e].start:0}},{key:"end",value:function(e){return this.ranges[e]?this.ranges[e].end:0}},{key:"add",value:function(e){this.ranges.push(e)}},{key:"length",get:function(){return this.ranges.length}}]),e}();t.default=r},function(e,t,i){"use strict";var n,r=function(e){this.inited=!1,this.self=e,this.meta=this.self.meta,this.infolist={},e.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),e.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};function a(){(n=new r(this)).init()}function o(e){self.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder.js"),addOnPostRun(a.bind(self))}r.prototype.toU8Array=function(e,t){return this.self.HEAPU8.subarray(e,e+t)},r.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},r.prototype.broadwayOnPictureDecoded=function(e,t,i,n,r,a){let o=Object.assign({},this.infolist[a]),s=i,u=i/2;444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=i);let l=this.toU8Array(e,n*s+r*u*2);this.infolist[a]=null;let c=new Uint8Array(l.length);c.set(l);let f=c.buffer;this.self.postMessage({msg:"DECODED",width:t,height:i,yLinesize:n,uvLinesize:r,info:o,buffer:f},[f])},r.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},r.prototype.decode=function(e,t){let i=parseInt((new Date).getTime()),n=i-1e9*Math.floor(i/1e9);this.infolist[n]=t,this.streamBuffer.set(e),Module._broadwayPlayStream(e.length,n)},r.prototype.destroy=function(){Module._broadwayExit()},e.exports=function(e){e.addEventListener("message",(function(t){var i=t.data;if(i.msg)switch(i.msg){case"init":console.log(i),e.meta=i.meta,o();break;case"decode":n.decode(i.data,i.info);break;case"destory":n.destroy()}else e.postMessage({msg:"ERROR:invalid message"})}),!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(7);let o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.config=Object.assign({},e);let n=window.AudioContext||window.webkitAudioContext;return i.context=new n,i.gainNode=i.context.createGain(),i.gainNode.connect(i.context.destination),i.meta=void 0,i.samples=[],i.preloadTime=i.config.preloadTime||3,i.duration=0,i._currentBuffer=void 0,i._nextBuffer=void 0,i._lastpts=void 0,i._preDecode=[],i._currentTime=0,i._decoding=!1,i._volume=i.config.volume||.6,i._played=!1,i.playFinish=null,i.waitNextID=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"decodeAudio",value:function(e){let{samples:t}=e,i=t;e.samples=[],this.setAudioData(i)}},{key:"setAudioData",value:function(e){for(let t=0;t<e.length;t++)e[t].pts=void 0===e[t].pts?e[t].dts:e[t].pts,this._preDecode.push(e[t]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(this._decoding)return;this._decoding=!0;let e=this._preDecode,i=[],n=this,r=e.shift();for(;r;){let n=t.getAACData(this.meta,r);i.push(n),this._lastpts=r.pts,r=e.shift()}let a=t.combileData(i);try{this.context.decodeAudioData(a.buffer,(function(e){let t=n.context.createBufferSource();t.buffer=e,n.samples.push({time:n.duration,duration:e.duration,data:t}),n.duration+=e.duration,n._currentBuffer||(n._currentBuffer=n.getTimeBuffer(n.currentTime)),!n._nextBuffer&&n._currentBuffer&&(n._nextBuffer=n.getTimeBuffer(n.currentTime+n._currentBuffer.duration)),n._decoding=!1,(n._preDecode.length>0&&n._preDecode[n._preDecode.length-1].pts-n._lastpts)/1e3>=n.preloadTime&&n.decodeAAC(),n.playFinish&&n.playFinish()}),e=>{console.error(e)})}catch(e){console.error(e)}}},{key:"onSourceEnded",value:function(){if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(()=>{this.onSourceEnded()},200));let e=this._nextBuffer.data;e.start(),e.connect(this.gainNode);let t=this;setTimeout(()=>{t.onSourceEnded.call(this)},1e3*e.buffer.duration-10),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}},{key:"play",value:function(){if(this.playFinish)return;this._played=!0,"suspended"===this.context.state&&this.context.resume();let e=this;const t=()=>{let t=this._currentBuffer.data;t.connect(this.gainNode),t.start(),setTimeout(()=>{e.onSourceEnded.call(this)},1e3*t.buffer.duration-10)};return this._currentBuffer?(t(),Promise.resolve()):new Promise(e=>{this.playFinish=e}).then(()=>{this.playFinish=null,t()})}},{key:"pause",value:function(){const e=this.context;"running"===e.state&&e.suspend()}},{key:"getTimeBuffer",value:function(e){let t;for(let i=0;i<this.samples.length;i++){let n=this.samples[i];if(n.time<=e&&n.time+n.duration>e){t=n;break}}return t}},{key:"setAudioMetaData",value:function(e){this.meta=e}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this.context.close()}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(e){this.gainNode.gain.value=e?0:this._volume}},{key:"volume",get:function(){return this._volume},set:function(e){return e<0?(this._volume=0,void(this.gainNode.gain.value=0)):e>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=e,void(this.gainNode.gain.value=e))}}],[{key:"getAACData",value:function(e,i){let n=new Uint8Array(i.data.byteLength+7),r=t.getAdts(e,i.data);return n.set(r),n.set(i.data,7),n}},{key:"combileData",value:function(e){let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].byteLength;let i=new Uint8Array(t),n=0;for(let t=0,r=e.length;t<r;t++)i.set(e[t],n),n+=e[t].byteLength;return i}},{key:"getAdts",value:function(e,t){let i=new Uint8Array(7);i[0]=255,i[1]=240,i[1]=1|i[1],i[2]=192&e.objectType-1<<6,i[2]=i[2]|60&e.sampleRateIndex<<2,i[2]=i[2]|1&e.channelCount>>2,i[3]=192&e.channelCount<<6;let n=t.byteLength+7;return i[3]=i[3]|3&n>>11,i[4]=255&n>>3,i[5]=224&n<<5,i[5]=31|i[5],i[6]=252,i}}]),t}(((n=a)&&n.__esModule?n:{default:n}).default);t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}let u=function(){function e(t){s(this,e),this.options=Object.assign({},t||{},{interval:16}),this.callbacks=[]}return r(e,[{key:"start",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.callbacks=t}},{key:"onTick",value:function(){for(let e=0,t=this.callbacks.length;e<t;e++){(0,this.callbacks[e])()}}},{key:"setInterval",value:function(e){return this.options.interval=e,this}}]),e}(),l=function(e){function t(e){s(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.prev=null,i.timerId=null,i._subTimerId=null,i._tickFunc=t.getTickFunc(),i.tick=i.tick.bind(i),i}return o(t,e),r(t,[{key:"start",value:function(){for(var e,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];(e=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this)).call.apply(e,[this].concat(r)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){const{_tickFunc:e}=this;this.timerId=e(this.tick)}},{key:"stop",value:function(){if(this.timerId){t.getCancelFunc()(this.timerId)}}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==t.getTickFunc()}}]),t}(u),c=function(e){function t(e){s(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.timeoutId=null,i}return o(t,e),r(t,[{key:"start",value:function(){for(var e,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];(e=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"nextTick",this)).call.apply(e,[this].concat(r)),this.timeoutId=window.setInterval(()=>{this.onTick()},this.options.interval||16)}},{key:"stop",value:function(){this.timeoutId&&window.clearInterval(this.timeoutId)}}]),t}(u);t.getTicker=()=>l.isSupported()?l:c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(2);const o=((n=a)&&n.__esModule?n:{default:n}).default.CRYTO_EVENTS;let s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inputBuffer=t.inputbuffer,this.outputBuffer=t.outputbuffer,this.key=t.key,this.iv=t.iv,this.method=t.method,this.crypto=window.crypto||window.msCrypto}return r(e,[{key:"init",value:function(){this.on(o.START_DECRYPT,this.decript.bind(this))}},{key:"decript",value:function(){if(this.aeskey)this.decriptData();else{this.crypto.subtle.importKey("raw",this.key.buffer,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(e=>{this.aeskey=e,this.decriptData()})}}},{key:"decriptData",value:function(){let e=this._context.getInstance(this.inputBuffer),t=this._context.getInstance(this.outputBuffer),i=e.shift();i&&this.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv.buffer},this.aeskey,i).then(e=>{t.push(new Uint8Array(e)),this.emit(o.DECRYPTED),this.decriptData(i)})}}]),e}();t.default=s},function(e,t,i){"use strict";e.exports={Mp4Remuxer:i(39).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),o=i(40),s=(n=o)&&n.__esModule?n:{default:n};const u=a.EVENTS.REMUX_EVENTS;let l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dtsBase=0,this._isDtsBaseInited=!1,this.isFirstVideo=!0,this.isFirstAudio=!0,this.videoAllDuration=0,this.audioAllDuration=0}return r(e,[{key:"init",value:function(){this.on(u.REMUX_MEDIA,this.remux.bind(this)),this.on(u.REMUX_METADATA,this.onMetaDataReady.bind(this)),this.on(u.DETECT_CHANGE_STREAM,this.resetDtsBase.bind(this))}},{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1}},{key:"reset",value:function(){this._dtsBase=0,this._isDtsBaseInited=!1}},{key:"remux",value:function(){const{audioTrack:e,videoTrack:t}=this._context.getInstance("TRACKS");!this._isDtsBaseInited&&this.calcDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"resetDtsBase",value:function(){this._dtsBase=0,this._dtsBaseInited=!1}},{key:"seek",value:function(){}},{key:"onMetaDataReady",value:function(e){let t;if("audio"===e){const{audioTrack:e}=this._context.getInstance("TRACKS");t=e}else{const{videoTrack:e}=this._context.getInstance("TRACKS");t=e}let i=this._context.getInstance("PRE_SOURCE_BUFFER"),n=i.getSource(e);n||(n=i.createSource(e)),n.mimetype=t.meta.codec,n.init=this.remuxInitSegment(e,t.meta),this.emit(u.INIT_SEGMENT,e)}},{key:"remuxInitSegment",value:function(e,t){let i=new a.Buffer,n=s.default.ftyp(),r=s.default.moov({type:e,meta:t});return i.write(n,r),i}},{key:"calcDtsBase",value:function(e,t){if(!e.samples.length&&!t.samples.length)return;let i=1/0,n=1/0;e.samples&&e.samples.length&&(i=e.samples[0].dts),t.samples&&t.samples.length&&(n=t.samples[0].dts),this._dtsBase=Math.min(i,n),this._isDtsBaseInited=!0}},{key:"_remuxVideo",value:function(e){const t=e;if(!e.samples||!e.samples.length)return;let{samples:i}=t,n=-1,r=null;const o=[],l={samples:[]};for(;i.length;){const e=i.shift(),{isKeyframe:t,options:a}=e;if(!this.isFirstAudio&&a&&a.meta){r=this.remuxInitSegment("video",a.meta),a.meta=null,i.unshift(e),a.isContinue||this.resetDtsBase();break}let s,u,c=e.dts-this._dtsBase;-1===n&&(n=c),void 0!==e.pts&&(s=(u=e.pts-this._dtsBase)-c),void 0!==e.cts&&(u=e.cts+c,s=e.cts);let f={buffer:[],size:0};l.samples.push(f),f.buffer.push(e.data),f.size+=e.data.byteLength;let h=0;if(i.length>=1){h=i[0].dts-this._dtsBase-c}else h=o.length>=1?o[o.length-1].duration:this.videoMeta.refSampleDuration;this.videoAllDuration+=h,o.push({dts:c,cts:s,pts:u,data:e.data,size:e.data.byteLength,isKeyframe:t,duration:h,flags:{isLeading:0,dependsOn:t?2:1,isDependedOn:t?1:0,hasRedundancy:0,isNonSync:t?0:1},originDts:c,type:"video"})}let c=new a.Buffer;if(o.length){const e=s.default.moof({id:t.meta.id,time:n,samples:o}),i=s.default.mdat(l);c.write(e,i),this.writeToSource("video",c)}if(r&&(this.writeToSource("video",r),i.length))return t.samples=i,this._remuxVideo(t);this.isFirstVideo=!1,this.emit(u.MEDIA_SEGMENT,"video");const f=o[o.length-1];this._videoNextDts=f.dts+f.duration,t.samples=[],t.length=0}},{key:"_remuxAudio",value:function(e){const{samples:t}=e;let i=-1,n=[],r=null;const o={samples:[]};if(!t||!t.length)return;let l=!1;for(;t.length;){let e=t.shift();const{data:a,options:s}=e;if(!this.isFirstAudio&&s&&s.meta){r=this.remuxInitSegment("audio",s.meta),s.meta=null,t.unshift(e),s.isContinue||this.resetDtsBase();break}let u=e.dts-this._dtsBase;const c=u;l||(i=u,l=!0);let f=0;if(this.audioMeta.refSampleDurationFixed)f=this.audioMeta.refSampleDurationFixed;else if(t.length>=1){f=t[0].dts-this._dtsBase-u}else f=n.length>=1?n[n.length-1].duration:this.audioMeta.refSampleDuration;this.audioAllDuration+=f;const h={dts:u,pts:u,cts:0,size:a.byteLength,duration:e.duration?e.duration:f,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:c,type:"audio"};let d={buffer:[],size:0};d.buffer.push(a),d.size+=a.byteLength,o.samples.push(d),n.push(h)}const c=new a.Buffer;if(n.length){const t=s.default.moof({id:e.meta.id,time:i,samples:n}),r=s.default.mdat(o);c.write(t,r),this.writeToSource("audio",c)}if(r&&(this.writeToSource("audio",r),t.length))return e.samples=t,this._remuxAudio(e);this.isFirstAudio=!1,this.emit(u.MEDIA_SEGMENT,"audio",c);const f=n[n.length-1];this._videoNextDts=f.dts+f.duration,e.samples=[],e.length=0}},{key:"writeToSource",value:function(e,t){let i=this._context.getInstance("PRE_SOURCE_BUFFER"),n=i.getSource(e);n||(n=i.createSource(e)),n.data.push(t)}},{key:"initSilentAudio",value:function(t,i){const n=e.getSilentFrame(this.audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:i,unit:n,size:n.byteLength,originDts:t,type:"video"}}},{key:"videoMeta",get:function(){return this._context.getInstance("TRACKS").videoTrack.meta}},{key:"audioMeta",get:function(){return this._context.getInstance("TRACKS").audioTrack.meta}}],[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(0);let a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"size",value:function(e){return r.Buffer.writeUint32(e)}},{key:"initBox",value:function(t,i){const n=new r.Buffer;for(var a=arguments.length,o=Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];return n.write.apply(n,[e.size(t),e.type(i)].concat(o)),n.buffer}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){return e.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}},{key:"moov",value:function(t){let i,{type:n,meta:r}=t,a=8,o=e.mvhd(r.duration,r.timescale);i="video"===n?e.videoTrak(r):e.audioTrak(r);let s=e.mvex(r.duration,r.timescale||1e3,r.id);return[o,i,s].forEach(e=>{a+=e.byteLength}),e.initBox(a,"moov",o,i,s)}},{key:"mvhd",value:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.initBox(8+n.length,"mvhd",new Uint8Array(n))}},{key:"videoTrak",value:function(t){let i=8,n=e.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),r=e.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[n,r].forEach(e=>{i+=e.byteLength}),e.initBox(i,"trak",n,r)}},{key:"audioTrak",value:function(t){let i=8,n=e.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),r=e.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[n,r].forEach(e=>{i+=e.byteLength}),e.initBox(i,"trak",n,r)}},{key:"tkhd",value:function(t){let i=t.id,n=t.duration,r=t.width,a=t.height,o=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,a>>>8&255,255&a,0,0]);return e.initBox(8+o.byteLength,"tkhd",o)}},{key:"edts",value:function(t){let i=new r.Buffer,n=t.duration,a=t.mediaTime;return i.write(e.size(36),e.type("edts")),i.write(e.size(28),e.type("elst")),i.write(new Uint8Array([0,0,0,1,n>>24&255,n>>16&255,n>>8&255,255&n,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,1])),i.buffer}},{key:"mdia",value:function(t){let i=8,n=e.mdhd(t.timescale,t.duration),r=e.hdlr(t.type),a=e.minf(t);return[n,r,a].forEach(e=>{i+=e.byteLength}),e.initBox(i,"mdia",n,r,a)}},{key:"mdhd",value:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments[1],n=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]);return e.initBox(12+n.byteLength,"mdhd",e.extension(0,0),n)}},{key:"hdlr",value:function(t){let i=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(i.splice.apply(i,[8,4].concat([115,111,117,110])),i.splice.apply(i,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),e.initBox(8+i.length,"hdlr",new Uint8Array(i))}},{key:"minf",value:function(t){let i=8,n="video"===t.type?e.vmhd():e.smhd(),r=e.dinf(),a=e.stbl(t);return[n,r,a].forEach(e=>{i+=e.byteLength}),e.initBox(i,"minf",n,r,a)}},{key:"vmhd",value:function(){return e.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}},{key:"smhd",value:function(){return e.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}},{key:"dinf",value:function(){let t=new r.Buffer;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){let i=8,n=e.stsd(t),r=e.stts(),a=e.stsc(),o=e.stsz(),s=e.stco();return[n,r,a,o,s].forEach(e=>{i+=e.byteLength}),e.initBox(i,"stbl",n,r,a,o,s)}},{key:"stsd",value:function(t){let i;return i="audio"===t.type?e.mp4a(t):e.avc1(t),e.initBox(16+i.byteLength,"stsd",e.extension(0,0),new Uint8Array([0,0,0,1]),i)}},{key:"mp4a",value:function(t){let i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),n=e.esds(t.config);return e.initBox(8+i.byteLength+n.byteLength,"mp4a",i,n)}},{key:"esds",value:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0];const i=t.length;let n=new r.Buffer,a=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t).concat([6,1,2]));return n.write(e.size(8+a.byteLength),e.type("esds"),a),n.buffer}},{key:"avc1",value:function(t){let i=new r.Buffer,n=t.width,a=t.height,o=t.parRatio.height,s=t.parRatio.width,u=t.avcc,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),f=new Uint8Array([o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s]);return i.write(e.size(40+l.byteLength+u.byteLength+c.byteLength),e.type("avc1"),l,e.size(8+u.byteLength),e.type("avcC"),u,e.size(20),e.type("btrt"),c,e.size(16),e.type("pasp"),f),i.buffer}},{key:"stts",value:function(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stts",t)}},{key:"stsc",value:function(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stsc",t)}},{key:"stco",value:function(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stco",t)}},{key:"stsz",value:function(){let t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return e.initBox(20,"stsz",t)}},{key:"mvex",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let i=arguments[2],n=new r.Buffer,a=r.Buffer.writeUint32(t);return n.write(e.size(56),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),a,e.trex(i)),n.buffer}},{key:"trex",value:function(t){let i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.initBox(8+i.byteLength,"trex",i)}},{key:"moof",value:function(t){let i=8,n=e.mfhd(),r=e.traf(t);return[n,r].forEach(e=>{i+=e.byteLength}),e.initBox(i,"moof",n,r)}},{key:"mfhd",value:function(){let t=r.Buffer.writeUint32(e.sequence);return e.sequence+=1,e.initBox(16,"mfhd",e.extension(0,0),t)}},{key:"traf",value:function(t){let i=8,n=e.tfhd(t.id),r=e.tfdt(t.time),a=e.sdtp(t),o=e.trun(t,a.byteLength);return[n,r,o,a].forEach(e=>{i+=e.byteLength}),e.initBox(i,"traf",n,r,o,a)}},{key:"tfhd",value:function(t){let i=r.Buffer.writeUint32(t);return e.initBox(16,"tfhd",e.extension(0,0),i)}},{key:"tfdt",value:function(t){return e.initBox(16,"tfdt",e.extension(0,0),r.Buffer.writeUint32(t))}},{key:"trun",value:function(t,i){let n=new r.Buffer,a=r.Buffer.writeUint32(t.samples.length),o=r.Buffer.writeUint32(92+16*t.samples.length+i);return n.write(e.size(20+16*t.samples.length),e.type("trun"),new Uint8Array([0,0,15,1]),a,o),t.samples.forEach(e=>{const t=e.flags;n.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))}),n.buffer}},{key:"sdtp",value:function(t){let i=new r.Buffer;return i.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(e=>{const t=e.flags,n=t.isLeading<<6|t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;i.write(new Uint8Array([n]))}),i.buffer}},{key:"mdat",value:function(t){let i=new r.Buffer,n=8;t.samples.forEach(e=>{n+=e.size}),i.write(e.size(n),e.type("mdat"));let a=new Uint8Array(n),o=0;return a.set(i.buffer,o),o+=8,t.samples.forEach(e=>{e.buffer.forEach(e=>{a.set(e,o),o+=e.byteLength})}),a}}]),e}();a.type=e=>new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]),a.sequence=1,t.default=a},function(e,t,i){"use strict";e.exports={FetchLoader:i(42).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();const r=i(0).EVENTS.LOADER_EVENTS;let a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}return n(e,[{key:"init",value:function(){this.on(r.LADER_START,this.load.bind(this))}},{key:"load",value:function(e,t){let i=this;this.url=e,this._canceled=!1;let n=this.getParams(t);return i.loading=!0,fetch(this.url,n).then((function(e){if(e.ok)return i.status=e.status,i._onFetchResponse(e);i.loading=!1,i.emit(r.LOADER_ERROR,i.TAG,new Error("invalid response."))})).catch((function(e){throw i.loading=!1,i.emit(r.LOADER_ERROR,i.TAG,e),new Error(e.message)}))}},{key:"_onFetchResponse",value:function(e){let t=this,i=this._context.getInstance(this.buffer);this._loaderTaskNo++;let n=this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case 2:e.json().then(e=>{t.loading=!1,t._canceled||t._destroyed||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))});break;case 1:e.text().then(e=>{t.loading=!1,t._canceled||t._destroyed||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))});break;case 3:e.arrayBuffer().then(e=>{t.loading=!1,t._canceled||t._destroyed||(i?(i.push(new Uint8Array(e)),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))});break;case 0:default:return this._onReader(e.body.getReader(),n)}}},{key:"_onReader",value:function(e,t){let i=this._context.getInstance(this.buffer);if(!i&&this._reader||this._destroyed)try{this._reader.cancel()}catch(e){}if(this._reader=e,!1===this.loading)return;let n=this;this._reader&&this._reader.read().then((function(a){if(a.done)return n.loading=!1,n.status=0,void n.emit(r.LOADER_COMPLETE,i);if(!n._canceled&&!n._destroyed)return i.push(a.value),n.emit(r.LOADER_DATALOADED,i),n._onReader(e,t);if(n._reader)try{n._reader.cancel()}catch(e){}})).catch(e=>{n.loading=!1,n.emit(r.LOADER_ERROR,n.TAG,e)})}},{key:"getParams",value:function(e){let t=Object.assign({},e),i=new Headers,n={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let e=this.configs.headers;for(let t in e)e.hasOwnProperty(t)&&i.append(t,e[t])}if("object"==typeof t.headers){let e=t.headers;for(let t in e)e.hasOwnProperty(t)&&i.append(t,e[t])}return!1===t.cors&&(n.mode="same-origin"),t.withCredentials&&(n.credentials="include"),n}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(e){}this._reader=null,this.loading=!1,this._canceled=!0}}},{key:"destroy",value:function(){this._destroyed=!0,this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),e}();t.default=a},function(e,t,i){"use strict";e.exports={M3U8Parser:i(44).default,TsDemuxer:i(45).default,Playlist:i(49).default,FlvDemuxer:i(50).default}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"parse",value:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={duration:0};if(!t||!t.split)return;let r=t.split(/\r|\n/),a=(r=r.filter(e=>e)).shift();if(!a.match("#EXTM3U"))throw new Error('Invalid m3u8 file: not "#EXTM3U"');for(a=r.shift();a;){let t=a.match(/#(.[A-Z|-]*):(.*)/),o=a.match(/#(.[A-Z|-]*)/);if(o&&t&&t.length>2)switch(t[1]){case"EXT-X-VERSION":n.version=parseInt(t[2]);break;case"EXT-X-MEDIA-SEQUENCE":n.sequence=parseInt(t[2]);break;case"EXT-X-TARGETDURATION":n.targetduration=parseFloat(t[2]);break;case"EXTINF":e.parseFrag(t,r,n,i);break;case"EXT-X-KEY":e.parseDecrypt(t[2],n)}if(o&&o.length>1)switch(o[1]){case"EXT-X-DISCONTINUITY":let t=(a=r.shift()).match(/#(.[A-Z|-]*):(.*)/);t.length>2&&"EXTINF"===t[1]&&e.parseFrag(t,r,n,i,!0)}a=r.shift()}return n}},{key:"parseFrag",value:function(e,t,i,n,r){i.frags||(i.frags=[]);let a={start:i.duration,duration:1e3*parseFloat(e[2])};i.duration+=a.duration;let o=t.shift();o.match(/#(.*):(.*)/)&&(o=t.shift()),o.length>0&&"/"===o.charAt(0)&&n.match(/.*\/\/.*\.\w+/g)&&(n=n.match(/.*\/\/.*\.\w+/g)[0]),o.match(/.*:\/\/.*/)?a.url=o:a.url=n+o,a.discontinue=r,i.frags.push(a)}},{key:"parseURL",value:function(e){let t="",i=e.match(/(.*\/).*\.m3u8/);if(i&&i.length>0)for(let e=0;e<i.length;e++)i[e].match(/.*\/$/g)&&i[e].length>t.length&&(t=i[e]);return t}},{key:"parseDecrypt",value:function(e,t){t.encrypt={};let i=e.split(",");for(let e in i){let n=i[e];if(n.match(/METHOD=(.*)/)&&(t.encrypt.method=n.match(/METHOD=(.*)/)[1]),n.match(/URI="(.*)"/)&&(t.encrypt.uri=n.match(/URI="(.*)"/)[1]),n.match(/IV=0x(.*)/)){let e=n.match(/IV=0x(.*)/)[1],i=Math.ceil(e.length/2);t.encrypt.ivb=new Uint8Array(i);for(let n=i-1;n>=0;n--){let i=parseInt(e.substr(2*n,2),16);t.encrypt.ivb[n]=i}t.encrypt.iv=e}}}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(3),a=i(4),o=i(0);const s=o.EVENTS.DEMUX_EVENTS,u={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};let l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}return n(e,[{key:"init",value:function(){this.on(s.DEMUX_START,this.demux.bind(this))}},{key:"demux",value:function(t){if(this.demuxing)return;let i=this.inputBuffer,n={pat:[],pmt:[]},r={};for(;i.length>=188;){for(i.length>=1&&71!==i.array[0][i.offset]&&this.emit(s.DEMUX_ERROR,this.TAG,new Error(`Untrust sync code: ${i.array[0][i.offset]}, try to recover;`),!1);i.length>=1&&71!==i.array[0][i.offset];)i.shift(1);let t=i.shift(188),a=new o.Stream(t.buffer),u={};e.read(a,u,n),u.pes?(r[u.header.pid]||(r[u.header.pid]=[]),r[u.header.pid].push(u.pes),u.pes.ES.buffer=[u.pes.ES.buffer]):r[u.header.pid]&&r[u.header.pid][r[u.header.pid].length-1].ES.buffer.push(u.payload.stream)}let a=t,u=t;for(let t=0;t<Object.keys(r).length;t++){let i=r[Object.keys(r)[t]];for(let n=0;n<i.length;n++)i[n].id=Object.keys(r)[t],i[n].ES.buffer=e.Merge(i[n].ES.buffer),"audio"===i[n].type?(this.pushAudioSample(i[n],a),a={}):"video"===i[n].type&&(this.pushVideoSample(i[n],u),u={})}this._hasAudioMeta&&this.emit(s.DEMUX_COMPLETE,"audio"),this._hasVideoMeta&&this.emit(s.DEMUX_COMPLETE,"video")}},{key:"pushAudioSample",value:function(t,i){let n;this._tracks.audioTrack?n=this._tracks.audioTrack:(this._tracks.audioTrack=new a.AudioTrack,n=this._tracks.audioTrack);let r=new o.AudioTrackMeta({audioSampleRate:t.ES.frequence,sampleRate:t.ES.frequence,channelCount:t.ES.channel,codec:"mp4a.40."+t.ES.audioObjectType,config:t.ES.audioConfig,id:2,sampleRateIndex:t.ES.frequencyIndex});r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale);let u=e.compaireMeta(n.meta,r,!0);this._hasAudioMeta&&u||(n.meta=r,this._hasAudioMeta=!0,this.emit(s.METADATA_PARSED,"audio"));let l=new Uint8Array(t.ES.buffer.buffer.slice(t.ES.buffer.position,t.ES.buffer.length)),c=parseInt(t.pts/90),f=parseInt(t.pts/90),h=new o.AudioTrackSample({dts:c,pts:f,data:l,options:i});n.samples.push(h)}},{key:"pushVideoSample",value:function(t,i){let n,u=r.Nalunit.getNalunits(t.ES.buffer),l=new o.VideoTrackMeta;this._tracks.videoTrack?n=this._tracks.videoTrack:(this._tracks.videoTrack=new a.VideoTrack,n=this._tracks.videoTrack);let c=0,f=!1,h=!1;for(let e=0;e<u.length;e++){let t=u[e];if(t.sps){f=t,n.sps=t.body,l.chromaFormat=f.sps.chroma_format,l.codec="avc1.";for(var d=1;d<4;d++){var p=f.body[d].toString(16);p.length<2&&(p="0"+p),l.codec+=p}l.codecHeight=f.sps.codec_size.height,l.codecWidth=f.sps.codec_size.width,l.frameRate=f.sps.frame_rate,l.id=1,l.level=f.sps.level_string,l.presentHeight=f.sps.present_size.height,l.presentWidth=f.sps.present_size.width,l.profile=f.sps.profile_string,l.refSampleDuration=Math.floor(l.timescale*(f.sps.frame_rate.fps_den/f.sps.frame_rate.fps_num)),l.sarRatio=f.sps.sar_ratio?f.sps.sar_ratio:f.sps.par_ratio}else t.pps?(n.pps=t.body,h=t):c+=4+t.body.byteLength}if(f&&h){l.avcc=r.Nalunit.getAvcc(f.body,h.body);let t=e.compaireMeta(n.meta,l,!0);this._hasVideoMeta&&t||(i?i.meta=Object.assign({},l):i={meta:Object.assign({},l)},n.meta=l,this._hasVideoMeta=!0,this.emit(s.METADATA_PARSED,"video"))}let y=new Uint8Array(c),m=0,v=!1;for(let e=0;e<u.length;e++){let t=u[e],i=t.body.byteLength;t.idr&&(v=!0),t.pps||t.sps||(y.set(new Uint8Array([i>>>24&255,i>>>16&255,i>>>8&255,255&i]),m),m+=4,y.set(t.body,m),m+=i)}let g=new o.VideoTrackSample({dts:parseInt(t.dts/90),pts:parseInt(t.pts/90),cts:(t.pts-t.dts)/90,originDts:t.dts,isKeyframe:v,data:y,options:i});n.samples.push(g)}},{key:"destory",value:function(){this.off(s.DEMUX_START,this.demux),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}},{key:"inputBuffer",get:function(){return this._context.getInstance(this.configs.inputbuffer)}},{key:"_tracks",get:function(){return this._context.getInstance("TRACKS")}}],[{key:"compaireArray",value:function(e,t,i){let n=0,r=0;if("Uint8Array"===i?(n=e.byteLength,r=t.byteLength):"Array"===i&&(n=e.length,r=t.length),n!==r)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}},{key:"compaireMeta",value:function(t,i,n){if(!t||!i)return!1;for(let r=0,a=Object.keys(t).length;r<a;r++){let a=t[Object.keys(t)[r]],o=i[Object.keys(t)[r]];if("object"!=typeof a){if(n&&"duration"!==Object.keys(t)[r]&&"refSampleDuration"!==Object.keys(t)[r]&&"refSampleDurationFixed"!==Object.keys(t)[r]&&a!==o)return!1}else if(void 0!==a.byteLength){if(void 0===o.byteLength)return!1;if(!e.compaireArray(a,o,"Uint8Array"))return!1}else if(void 0!==a.length){if(void 0===o.length)return!1;if(!e.compaireArray(a,o,"Array"))return!1}else if(!e.compaireMeta(a,o))return!1}return!0}},{key:"Merge",value:function(e){let t,i=0,n=0;for(let t=0;t<e.length;t++)i+=e[t].length-e[t].position;t=new Uint8Array(i);for(let i=0;i<e.length;i++){let r=e[i];t.set(new Uint8Array(r.buffer,r.position),n),n+=r.length-r.position}return new o.Stream(t.buffer)}},{key:"read",value:function(t,i,n){e.readHeader(t,i),e.readPayload(t,i,n),"MEDIA"!==i.header.packet||1!==i.header.payload||i.unknownPIDs||(i.pes=e.PES(i))}},{key:"readPayload",value:function(t,i,n){let r=i.header.pid;switch(r){case 0:e.PAT(t,i,n);break;case 1:e.CAT(t,i,n);break;case 2:e.TSDT(t,i,n);break;case 8191:break;default:if(n.pat.some(e=>e.pid===r))e.PMT(t,i,n);else{let a=n.pmt?n.pmt.filter(e=>e.pid===r):[];a.length>0?e.Media(t,i,u[a[0].streamType][0]):i.unknownPIDs=!0}}}},{key:"readHeader",value:function(e,t){let i={};i.sync=e.readUint8();let n=e.readUint16();i.error=n>>>15,i.payload=n>>>14&1,i.priority=n>>>13&1,i.pid=8191&n,n=e.readUint8(),i.scrambling=n>>6&3,i.adaptation=n>>4&3,i.continuity=15&n,i.packet=0===i.pid?"PAT":"MEDIA",t.header=i}},{key:"PAT",value:function(e,t,i){let n={},r=e.readUint8();e.skip(r),r=e.readUint8(),n.tabelID=r,r=e.readUint16(),n.error=r>>>7,n.zero=r>>>6&1,n.sectionLength=4095&r,n.streamID=e.readUint16(),n.current=1&e.readUint8(),n.sectionNumber=e.readUint8(),n.lastSectionNumber=e.readUint8();let a=(n.sectionLength-9)/4,o=[];for(let t=0;t<a;t++){let t=e.readUint16(),i=8191&e.readUint16();o.push({program:t,pid:i,type:0===t?"network":"mapPID"})}o.length>0&&(i.pat=i.pat.concat(o)),n.list=o,n.program=e.readUint16(),n.pid=8191&e.readUint16(),t.payload=n}},{key:"PMT",value:function(e,t,i){let n={};t.header.packet="PMT";let r=e.readUint8();e.skip(r),r=e.readUint8(),n.tableID=r,r=e.readUint16(),n.sectionLength=4095&r,n.program=e.readUint16(),n.current=1&e.readUint8(),n.order=e.readUint8(),n.lastOrder=e.readUint8(),n.PCR_PID=8191&e.readUint16(),n.programLength=4095&e.readUint16();let a=(n.sectionLength-13)/5,o=[];for(let t=0;t<a;t++)o.push({streamType:e.readUint8(),pid:8191&e.readUint16(),es:4095&e.readUint16()});n.list=o,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(o.map(e=>({pid:e.pid,es:e.es,streamType:e.streamType,program:n.program}))),t.payload=n}},{key:"Media",value:function(e,t,i){let n=t.header,r={};if(n.type=i,3===n.adaptation&&(r.adaptationLength=e.readUint8(),r.adaptationLength>0)){let t=e.readUint8();r.discontinue=t>>>7,r.access=t>>>6&1,r.priority=t>>>5&1,r.PCR=t>>>4&1,r.OPCR=t>>>3&1,r.splicePoint=t>>>2&1,r.transportPrivate=t>>>1&1,r.adaptationField=1&t;let i=e.position;if(1===r.PCR&&(r.programClockBase=e.readUint32()<<1,t=e.readUint16(),r.programClockBase|=t>>>15,r.programClockExtension=511&t),1===r.OPCR&&(r.originProgramClockBase=e.readUint32()<<1,t=e.readUint16(),r.originProgramClockBase+=t>>>15,r.originProgramClockExtension=511&t),1===r.splicePoint&&(r.spliceCountdown=e.readUint8()),1===r.transportPrivate){let t=e.readUint8(),i=[];for(let n=0;n<t;n++)i.push(e.readUint8())}if(1===r.adaptationField){let t=e.readUint8(),i=e.readUint8(),n=e.position,a=i>>>6&1,o=i>>>5&1;1===i>>>7&&(i=e.readUint16(),r.ltwValid=i>>>15,r.ltwOffset=61439&i),1===a&&(i=e.readUint24(),r.piecewiseRate=4194303&i),1===o&&(i=e.readInt8(),r.spliceType=i>>>4,r.dtsNextAU1=i>>>1&7,r.marker1=1&i,i=e.readUint16(),r.dtsNextAU2=i>>>1,r.marker2=1&i,i=e.readUint16(),r.dtsNextAU3=i),e.skip(t-1-(e.position-n))}let n=r.adaptationLength-1-(e.position-i);e.skip(n)}r.stream=new o.Stream(e.buffer.slice(e.position)),t.payload=r}},{key:"PES",value:function(t){let i={},n=t.payload.stream;if(1!==n.readUint24())i.ES={},i.ES.buffer=n;else{let t=n.readUint8();t>=224&&t<=239&&(i.type="video"),t>=192&&t<=223&&(i.type="audio");let r=n.readUint16();if(i.packetLength=r,"video"!==i.type&&"audio"!==i.type)throw new Error("format is not supported");{let t=n.readUint8();if(2!==t>>>6)throw new Error("error when parse pes header");t=n.readUint8(),i.ptsDTSFlag=t>>>6,i.escrFlag=t>>>5&1,i.esRateFlag=t>>>4&1,i.dsmFlag=t>>>3&1,i.additionalFlag=t>>>2&1,i.crcFlag=t>>>1&1,i.extensionFlag=1&t,i.pesHeaderLength=n.readUint8();let r=i.pesHeaderLength;if(2===i.ptsDTSFlag){let e=[];t=n.readUint8(),e.push(t>>>1&7),t=n.readUint16(),e.push(t>>>1),t=n.readUint16(),e.push(t>>>1),i.pts=e[0]<<30|e[1]<<15|e[2],r-=5,"video"===i.type&&(i.dts=i.pts)}if(3===i.ptsDTSFlag){let e=[];t=n.readUint8(),e.push(t>>>1&7),t=n.readUint16(),e.push(t>>>1),t=n.readUint16(),e.push(t>>>1),i.pts=e[0]<<30|e[1]<<15|e[2];let a=[];t=n.readUint8(),a.push(t>>>1&7),t=n.readUint16(),a.push(t>>>1),t=n.readUint16(),a.push(t>>>1),i.dts=a[0]<<30|a[1]<<15|a[2],r-=10}if(1===i.escrFlag){let e=[],a=[];t=n.readUint8(),e.push(t>>>3&7),e.push(3&t),t=n.readUint16(),e.push(t>>>13),e.push(3&t),t=n.readUint16(),e.push(t>>>13),a.push(3&t),t=n.readUint8(),a.push(t>>>1),i.escr=300*(e[0]<<30|e[1]<<28|e[2]<<15|e[3]<<13|e[4])+(a[0]<<7|a[1]),r-=6}if(1===i.esRateFlag&&(t=n.readUint24(),i.esRate=t>>>1&4194303,r-=3),1===i.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===i.additionalFlag&&(t=n.readUint8(),i.additionalCopyInfo=127&t,r-=1),1===i.crcFlag&&(i.pesCRC=n.readUint16(),r-=2),1===i.extensionFlag)throw new Error("not support extension");r>0&&n.skip(r),i.ES=e.ES(n,i.type)}}return i}},{key:"ES",value:function(t,i){let n,r={};if("video"===i){if(1!==(n=t.readUint32())&&(t.back(4),1!==(n=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),r.buffer=t}else{if("audio"!==i)throw new Error(`ES ${i} is not supported`);{if((n=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r.id=0==(n>>>3&1)?"MPEG-4":"MPEG-2",r.layer=n>>>1&3,r.absent=1&n,n=t.readUint16(),r.audioObjectType=1+(n>>>14&3),r.profile=r.audioObjectType-1,r.frequencyIndex=n>>>10&15,r.frequence=i[r.frequencyIndex],r.channel=n>>>6&7,r.frameLength=(3&n)<<11|t.readUint16()>>>5,e.getAudioConfig(r),t.skip(1),r.buffer=t}}return r}},{key:"TSDT",value:function(e,t,i){t.payload={}}},{key:"CAT",value:function(e,t,i){let n={};n.tableID=e.readUint8();let r=e.readUint16();n.sectionIndicator=r>>>7,n.sectionLength=4095&r,e.skip(2),r=e.readUint8(),n.version=r>>>3,n.currentNextIndicator=1&r,n.sectionNumber=e.readUint8(),n.lastSectionNumber=e.readUint8();let a=(this.sectionLength-9)/4,o=[];for(let e=0;e<a;e++)o.push({});n.crc32=e.readUint32(),t.payload=n}},{key:"getAudioConfig",value:function(e){let t,i,n=navigator.userAgent.toLowerCase();/firefox/i.test(n)?e.frequencyIndex>=6?(e.audioObjectType=5,t=new Array(4),i=e.frequencyIndex-3):(e.audioObjectType=2,t=new Array(2),i=e.frequencyIndex):-1!==n.indexOf("android")?(e.audioObjectType=2,t=new Array(2),i=e.frequencyIndex):(e.audioObjectType=5,t=new Array(4),e.frequencyIndex>=6?i=e.frequencyIndex-3:(1===e.channel&&(e.audioObjectType=2,t=new Array(2)),i=e.frequencyIndex)),t[0]=e.audioObjectType<<3,t[0]|=(14&e.frequencyIndex)>>1,t[1]=(1&e.frequencyIndex)<<7,t[1]|=e.channel<<3,5===e.audioObjectType&&(t[1]|=(14&i)>>1,t[2]=(1&i)<<7,t[2]|=8,t[3]=0),e.audioConfig=t}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),o=i(47),s=(n=o)&&n.__esModule?n:{default:n};const{REMUX_EVENTS:u,DEMUX_EVENTS:l}=a.EVENTS;let c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this._videoLargeGap=0,this._audioLargeGap=0}return r(e,[{key:"init",value:function(){this.before(u.REMUX_MEDIA,this.doFix.bind(this))}},{key:"reset",value:function(){this.nextAudioDts=null,this.nextVideoDts=null,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.filledAudioSamples=[],this.filledVideoSamples=[]}},{key:"doFix",value:function(){const{isFirstAudioSamples:t,isFirstVideoSamples:i}=this.getFirstSample();this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples);const{changed:n,changedIdx:r}=e.detactChangeStream(this.videoTrack.samples);n&&!t?this.fixChangeStreamVideo(r):this.doFixVideo(i);const{changed:a,changedIdx:o}=e.detactChangeStream(this.audioTrack.samples);a?this.fixChangeStreamAudio(o):this.doFixAudio(t)}},{key:"doFixVideo",value:function(t,i){let{samples:n,meta:r}=this.videoTrack;if(r.frameRate&&!1===r.frameRate.fixed)return;if(!n||!n.length||!this._firstVideoSample)return;const a=n[0],o=n.length;this._videoLargeGap>0&&e.doFixLargeGap(n,this._videoLargeGap),a.dts!==this._firstVideoSample.dts&&(i||e.detectLargeGap(this.nextVideoDts,a))&&(i&&(this.nextVideoDts=i),this._videoLargeGap=this.nextVideoDts-a.dts,e.doFixLargeGap(n,this._videoLargeGap));const s=a.dts;if(t&&this._firstAudioSample){const e=this._firstVideoSample.dts,t=e-this._firstAudioSample.dts;if(t>2*r.refSampleDuration){const i=Math.floor(t/r.refSampleDuration);for(let t=0;t<i;t++){const i=Object.assign({},a);i.dts=e-(t+1)*r.refSampleDuration,i.pts=i.dts+i.cts,n.unshift(i),this.filledVideoSamples.push({dts:i.dts,size:i.data.byteLength})}}}let u;if(this.nextVideoDts){u=s-this.nextVideoDts;const t=Math.abs(u);if(u>2*r.refSampleDuration){const e=Math.floor(u/r.refSampleDuration);for(let t=0;t<e;t++){const e=Object.assign({},n[0]),i=s-(t+1)*r.refSampleDuration;e.dts=i>this.nextVideoDts?i:this.nextVideoDts,e.pts=e.dts+e.cts,this.videoTrack.samples.unshift(e),this.filledVideoSamples.push({dts:e.dts,size:e.data.byteLength})}}else t<=r.refSampleDuration&&t>0?(n[0].dts=this.nextVideoDts,n[0].originDts=n[0].dts,n[0].cts=void 0!==n[0].cts?n[0].cts:n[0].pts-n[0].dts,n[0].pts=n[0].dts+n[0].cts):u<0&&e.doFixLargeGap(n,-1*u)}const l=n[n.length-1].dts,c=n.length>=2?l-n[n.length-2].dts:r.refSampleDuration;this.lastVideoSamplesLen=o,this.nextVideoDts=l+c,this.lastVideoDts=l;for(let e=0,t=n.length;e<t;e++){const t=n[e],i=n[e+1];if(!i)break;const a=i.dts-t.dts;if(a>2*r.refSampleDuration){let o=Math.floor(a/r.refSampleDuration),s=0;for(;s<o;){const a=Object.assign({},i);a.dts=t.dts+(s+1)*r.refSampleDuration,a.pts=a.dts+a.cts,a<i.dts&&(n.splice(e,0,a),this.filledVideoSamples.push({dts:a.dts,size:a.data.byteLength})),s++,e++}}}this.videoTrack.samples=n}},{key:"doFixAudio",value:function(t,i){let{samples:n,meta:r}=this.audioTrack;if(!n||!n.length)return;const a=n.length,o=s.default.getSilentFrame(r.codec,r.channelCount),u=this._firstAudioSample,l=n[0];if(this._audioLargeGap>0&&e.doFixLargeGap(n,this._audioLargeGap),l.dts!==this._firstAudioSample.dts&&(i||e.detectLargeGap(this.nextAudioDts,l))&&(i&&(this.nextAudioDts=i),this._audioLargeGap=this.nextAudioDts-l.dts,e.doFixLargeGap(n,this._audioLargeGap)),this._firstVideoSample&&t){const e=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(u.dts-e>r.refSampleDuration){const t=Math.floor((u.dts-e)/r.refSampleDuration);for(let e=0;e<t;e++){const t={data:o,datasize:o.byteLength,dts:u.dts-(e+1)*r.refSampleDuration,filtered:0};n.unshift(t),this.filledAudioSamples.push({dts:t.dts,size:t.data.byteLength})}}}let c;const f=n[0].dts;if(this.nextAudioDts){c=f-this.nextAudioDts;const t=Math.abs(c);if(t>r.refSampleDuration&&1===a&&1===this.lastAudioSamplesLen&&(r.refSampleDurationFixed=void 0),c>2*r.refSampleDuration)if(1===a&&1===this.lastAudioSamplesLen)r.refSampleDurationFixed=void 0!==r.refSampleDurationFixed?r.refSampleDurationFixed+c:r.refSampleDuration+c;else{const e=Math.floor(c/r.refSampleDuration);for(let t=0;t<e;t++){const e=f-(t+1)*r.refSampleDuration,i=Object.assign({},n[0],{dts:e>this.nextAudioDts?e:this.nextAudioDts});this.filledAudioSamples.push({dts:i.dts,size:i.data.byteLength}),this.audioTrack.samples.unshift(i)}}else t<=r.refSampleDuration&&t>0?(n[0].dts=this.nextAudioDts,n[0].pts=this.nextAudioDts):c<0&&e.doFixLargeGap(n,-1*c)}const h=n[n.length-1].dts,d=n.length>=2?h-n[n.length-2].dts:r.refSampleDuration;this.lastAudioSamplesLen=a,this.nextAudioDts=r.refSampleDurationFixed?h+r.refSampleDurationFixed:h+d,this.lastAudioDts=h;for(let e=0,t=n.length;e<t;e++){const t=n[e],i=n[e+1];if(!i)break;const r=i.dts-t.dts;n[e].duration=r}this.audioTrack.samples=e.sortAudioSamples(n)}},{key:"fixChangeStreamVideo",value:function(e){const{samples:t,meta:i}=this.videoTrack,n=0===e?this.getStreamChangeStart(t[0]):t[e-1].dts,r=t[e].dts;if(Math.abs(n-r)<=2*i.refSampleDuration)return t[e].options?t[e].options.isContinue=!0:t[e].options={isContinue:!0},this.doFixVideo(!1);const a=t.slice(0,e),o=t.slice(e),s=t[0],u=o[0].dts-s.dts,l=s.options&&s.options.start+u?s.options.start:null;this.videoTrack.samples=t.slice(0,e),this.doFixVideo(!1),this.videoTrack.samples=t.slice(e),this.doFixVideo(!1,l),this.videoTrack.samples=a.concat(o)}},{key:"fixChangeStreamAudio",value:function(e){const{samples:t,meta:i}=this.audioTrack,n=0===e?this.getStreamChangeStart(t[0]):t[e-1].dts,r=t[e].dts;if(Math.abs(n-r)<=2*i.refSampleDuration)return t[e].options?t[e].options.isContinue=!0:t[e].options={isContinue:!0},this.doFixAudio(!1);const a=t.slice(0,e),o=t.slice(e),s=t[0],u=o[0].dts-s.dts,l=s.options&&s.options.start+u?s.options.start:null;this.audioTrack.samples=a,this.doFixAudio(!1),this.audioTrack.samples=o,this.doFixAudio(!1,l),this.audioTrack.samples=a.concat(o)}},{key:"getFirstSample",value:function(){let{samples:t}=this.videoTrack,{samples:i}=this.audioTrack,n=!1,r=!1;return!this._firstVideoSample&&t.length&&(this._firstVideoSample=e.findFirstVideoSample(t),n=!0),!this._firstAudioSample&&i.length&&(this._firstAudioSample=e.findFirstAudioSample(i),r=!0),{isFirstVideoSamples:n,isFirstAudioSamples:r}}},{key:"fixRefSampleDuration",value:function(e,t){const i="video"===e.type,n=i?this.allVideoSamplesCount:this.allAudioSamplesCount,r=i?this._firstVideoSample.dts:this._firstAudioSample.dts,a=i?this.filledVideoSamples.length:this.filledAudioSamples.length;if(!e.refSampleDuration||e.refSampleDuration<=0||Number.isNaN(e.refSampleDuration)){if(t.length>=1){const i=t[t.length-1].dts;e.refSampleDuration=Math.floor((i-r)/(n+a-1))}}else if(e.refSampleDuration&&t.length>=5){const i=(t[t.length-1].dts-t[0].dts)/(t.length-1);e.refSampleDuration=Math.floor(Math.abs(e.refSampleDuration-i)<=5?e.refSampleDuration:i)}}},{key:"recordSamplesCount",value:function(){const{audioTrack:e,videoTrack:t}=this;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){const{_firstVideoSample:e,_firstAudioSample:t}=this;this.audioTrack.samples=this.audioTrack.samples.filter(e=>e.dts>=t.dts&&(void 0===this.lastAudioDts||e.dts>this.lastAudioDts)),this.videoTrack.samples=this.videoTrack.samples.filter(t=>t.dts>=e.dts&&(void 0===this.lastVideoDts||t.dts>this.lastVideoDts))}},{key:"getStreamChangeStart",value:function(e){return e.options&&e.options.start?e.options.start-this.dtsBase:1/0}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks?this.tracks.audioTrack:null}},{key:"videoTrack",get:function(){return this.tracks?this.tracks.videoTrack:null}},{key:"dtsBase",get:function(){const e=this._context.getInstance("MP4_REMUXER");return e?e._dtsBase:0}}],[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:e.sort((e,t)=>e.dts-t.dts)}},{key:"findFirstAudioSample",value:function(t){return t&&0!==t.length?e.sortAudioSamples(t)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;const t=e.sort((e,t)=>e.dts-t.dts);for(let e=0,i=t.length;e<i;e++)if(t[e].isKeyframe)return t[e]}},{key:"detectLargeGap",value:function(e,t){if(null===e)return;const i=t.dts||0,n=e-i>=1e3||i-e>=1e3,r=t.options&&t.options.discontinue;return n||r}},{key:"doFixLargeGap",value:function(e,t){for(let i=0,n=e.length;i<n;i++){const n=e[i];n.dts+=t,n.pts&&(n.pts+=t)}}},{key:"detactChangeStream",value:function(e){let t=!1,i=-1;for(let n=0,r=e.length;n<r;n++)if(e[n].options&&e[n].options.meta){t=!0,i=n;break}return{changed:t,changedIdx:i}}}]),e}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}let a=function e(){r(this,e),this.mimetype="",this.init=null,this.data=[]},o=function(){function e(){r(this,e),this.sources={}}return n(e,[{key:"getSource",value:function(e){return this.sources[e]}},{key:"createSource",value:function(e){return this.sources[e]=new a,this.sources[e]}},{key:"clear",value:function(){this.sources={}}},{key:"destroy",value:function(){this.sources={}}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();let r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=t.autoclear||!1}return n(e,[{key:"push",value:function(e,t,i){this._ts[e]||(this._ts[e]={duration:t,downloaded:!1,downloading:!1,start:this.duration,discontinue:!!i},this._list[this.duration]=e,this.duration+=t,this.fragLength+=1)}},{key:"deleteFrag",value:function(e){this._ts[e]&&(this._ts[e].start>this._lastget.time&&(this._lastget={duration:this._ts[e].duration,time:this._ts[e].start,downloaded:!1,downloading:!1,url:e}),delete this._list[this._ts[e].start],delete this._ts[e],this.fragLength-=1)}},{key:"pushM3U8",value:function(e,t){if(!e)throw new Error("No m3u8 data received.");if(this.version=e.version,this.targetduration=e.targetduration,e.encrypt&&!this.encrypt&&(this.encrypt=e.encrypt),!(e.sequence>this.sequence))throw new Error(`Old m3u8 file received, ${e.sequence}`);{this.sequence=e.sequence;let i=[];for(let t=0;t<e.frags.length;t++){let n=e.frags[t];this._ts[n.url]||(i.push(n.url),this.push(n.url,n.duration,n.discontinue))}if(i.length<1)throw new Error("Can not read ts file list.");if(t){let e=this.getTsList();for(let t=0;t<e.length;t++)i.indexOf(e[t])<0&&this.deleteFrag(e[t])}}}},{key:"getTsList",value:function(){return Object.keys(this._ts)}},{key:"downloaded",value:function(e,t){let i=this._ts[e];i&&(i.downloaded=t)}},{key:"downloading",value:function(e,t){let i=this._ts[e];i&&(i.downloading=t)}},{key:"getTsByName",value:function(e){return this._ts[e]}},{key:"getTs",value:function(e){let t,i=Object.keys(this._list);if(void 0===e&&(e=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||e>=this.duration)){i.sort((e,t)=>parseFloat(e)-parseFloat(t));for(let n=0;n<i.length&&e>=parseInt(i[n]);n++){let e=this._list[i[n]];t={url:e,downloaded:this._ts[e].downloaded,downloading:this._ts[e].downloading,time:parseInt(i[n]),duration:parseInt(this._ts[e].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=t}return t}}},{key:"clear",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}},{key:"clearDownloaded",value:function(){for(let e=0,t=Object.keys(this._ts).length;e<t;e++){let t=this._ts[Object.keys(this._ts)[e]];t.downloaded=!1,t.downloading=!1}}},{key:"destroy",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=!1}},{key:"list",get:function(){return this._list}},{key:"baseURL",set:function(e){this.baseURL!==e&&(this.clear(),this._baseURL=e)},get:function(){return this._baseURL}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),o=i(3),s=i(4),u=i(51),l=(n=u)&&n.__esModule?n:{default:n};const c=a.EVENTS.DEMUX_EVENTS;let f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}return r(e,[{key:"init",value:function(){this.on(c.DEMUX_START,this.doParseFlv.bind(this))}},{key:"doParseFlv",value:function(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;let e,t=1e5;do{e=this._parseFlvTag()}while(e&&t-- >0);this.emit(c.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;const e=this.loaderBuffer.shift(13);this.parseFlvHeader(e),this.doParseFlv()}}},{key:"parseFlvHeader",value:function(t){if(e.isFlvFile(t)){this._firstFragmentLoaded=!0;const i=e.getPlayType(t[4]);i.hasVideo&&this.initVideoTrack(),i.hasAudio&&this.initAudioTrack()}else this.emit(c.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}},{key:"initVideoTrack",value:function(){this._trackNum++;let e=new s.VideoTrack;e.meta=new a.VideoTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;let e=new s.AudioTrack;e.meta=new a.AudioTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"_parseFlvTag",value:function(){if(this.loaderBuffer.length<11)return null;let e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}},{key:"_parseFlvTagHeader",value:function(){let e=0,t={},i=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&i)>>>5,t.tagType=31&i,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.emit(c.DEMUX_ERROR,this.TAG,new Error("tagType "+t.tagType),!1),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);let n=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);let r=this.loaderBuffer.shift(1)[0];return r>0&&(n+=16777216*r),t.dts=n,this.loaderBuffer.shift(3),t}},{key:"_processChunk",value:function(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}},{key:"_parseScriptData",value:function(e){let t=this.tracks.audioTrack,i=this.tracks.videoTrack,n=this.loaderBuffer.shift(e.datasize);const r=(new l.default).resolve(n,n.length),a=this._context.onMetaData=r?r.onMetaData:void 0;if(this._context.mediaInfo.duration=a.duration,this._context.mediaInfo.hasVideo=a.hasVideo,this._context.mediaInfo.hsaAudio=a.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(c.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){let e=t.meta;switch(a.audiosamplerate&&(e.sampleRate=a.audiosamplerate),a.audiochannels&&(e.channelCount=a.audiochannels),a.audiosamplerate){case 44100:e.sampleRateIndex=4;break;case 22050:e.sampleRateIndex=7;break;case 11025:e.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){let e=i.meta;if("number"==typeof a.framerate){let t=Math.floor(1e3*a.framerate);if(t>0){let i=t/1e3;e.frameRate||(e.frameRate={}),e.frameRate.fixed=!0,e.frameRate.fps=i,e.frameRate.fps_num=t,e.frameRate.fps_den=1e3}}}}},{key:"_aacSequenceHeaderParser",value:function(e){let t={hasSpecificConfig:!0};t.objectType=e[1]>>>3,t.originObjectType=t.objectType,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2],t.codec=`mp4a.40.${t.objectType}`;let i,n,r=window.navigator.userAgent.toLowerCase(),o=t.sampleRateIndex;return-1!==r.indexOf("firefox")?t.sampleRateIndex>=6?(t.objectType=5,n=new Array(4),i=o-3):(t.objectType=2,n=new Array(2),i=o):-1!==r.indexOf("android")||"safari"===a.sniffer.browser?(t.objectType=2,n=new Array(2),i=o):(t.objectType=5,i=t.sampleRateIndex,n=new Array(4),t.sampleRateIndex>=6?i=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,n=new Array(2),i=t.sampleRateIndex)),n[0]=t.objectType<<3,n[0]|=(15&t.sampleRateIndex)>>>1,n[1]=(15&t.sampleRateIndex)<<7,n[1]|=(15&t.channelCount)<<3,5===t.objectType&&(n[1]|=(15&i)>>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),t.config=n,t}},{key:"_parseAACData",value:function(e){let t=this.tracks.audioTrack;if(!t)return;let i=t.meta;i||(t.meta=new a.AudioTrackMeta,i=t.meta);let n=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);let r=(240&n)>>>4;t.format=r,10!==r&&this.emit(c.DEMUX_ERROR,new Error(`invalid audio format: ${r}`)),10!==r||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(n),i.sampleRateIndex=(12&n)>>>2,i.frameLenth=(2&n)>>>1,i.channelCount=1&n,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));let o=i.audioSampleRate,s=i.sampleRateIndex,u=i.refSampleDuration;delete e.tagType;let l=this._datasizeValidator(e.datasize);if(0===e.data[0]){let t=this._aacSequenceHeaderParser(e.data);o=t.audiosamplerate||i.audioSampleRate,s=t.sampleRateIndex||i.sampleRateIndex,u=Math.floor(1024/o*i.timescale),i.channelCount=t.channelCount,i.sampleRate=o,i.sampleRateIndex=s,i.refSampleDuration=u,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=t.config,i.objectType=t.objectType,i.originObjectType=t.originObjectType;const n=this._context.mediaInfo.audio;n.codec=t.codec,n.channelCount=t.channelCount,n.sampleRate=o,n.sampleRateIndex=t.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(c.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&(this.emit(c.METADATA_PARSED,"audio"),this.emit(c.AUDIO_METADATA_CHANGE)),this._hasAudioSequence=!0,this._metaChange=!0}else this._metaChange&&(e.options={meta:t.meta},this._metaChange=!1),e.data=e.data.slice(1,e.data.length),t.samples.push(e);l||this.emit(c.DEMUX_ERROR,this.TAG,new Error("TAG length error at "+e.datasize),!1)}},{key:"_parseHevcData",value:function(e){let t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;let i=15&t;if(this.tracks.videoTrack.codecID=i,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){const t=this.loaderBuffer.shift(e.datasize-5);if(e.data=t,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.emit(c.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${e.datasize}`),!1);let t={},i=0;for(t.cts=e.cts,t.dts=e.dts;e.data.length>i;){let n=e.data.slice(Number.parseInt(i),4+i);t.size=n[3],t.size+=256*n[2],t.size+=256*n[1]*256,t.size+=256*n[0]*256*256,i+=4,t.data=e.data.slice(Number.parseInt(i),t.size+i),i+=t.size,this.tracks.videoTrack.samples.push(t),this.emit(c.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(c.METADATA_PARSED,"video"):this.emit(c.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${e.datasize}`),!1))}else if(7===i){let t=this.loaderBuffer.shift(e.datasize-5);if(0===t[4]&&0===t[5]&&0===t[6]&&1===t[7]){let e=0;for(let i=0;i<4;i++)e=256*e+t[i];e-=4,(t=t.slice(4,t.length))[3]=e%256,e=(e-t[3])/256,t[2]=e%256,e=(e-t[2])/256,t[1]=e%256,t[0]=(e-t[1])/256}if(e.data=t,0===e.avcPacketType){this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(c.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&(this.emit(c.METADATA_PARSED,"audio"),this.emit(c.VIDEO_METADATA_CHANGE)),this._hasVideoSequence=!0),this._metaChange=!0}else{if(!this._datasizeValidator(e.datasize))return void this.emit(c.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${e.datasize}`),!1);this._metaChange&&(e.options={meta:Object.assign({},this.tracks.videoTrack.meta)},this._metaChange=!1),this.tracks.videoTrack.samples.push(e)}}else this.emit(c.DEMUX_ERROR,this.TAG,new Error(`video codeid is ${i}`),!1),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.emit(c.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${e.datasize}`),!1),this.tracks.videoTrack.samples.push(e),this.emit(c.DEMUX_COMPLETE);delete e.tagType}},{key:"_avcSequenceHeaderParser",value:function(e){let t=this.tracks.videoTrack;if(!t)return;let i=0;t.meta||(t.meta=new a.VideoTrackMeta);let n=t.meta;n.configurationVersion=e[0],n.avcProfileIndication=e[1],n.profileCompatibility=e[2],n.avcLevelIndication=e[3]/10,n.nalUnitLength=1+(3&e[4]);let r=31&e[5];i=6;let s={};for(let t=0;t<r;t++){let t=255*e[i]+e[i+1];i+=2;let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e[i+n];let a="avc1.";for(let e=1;e<4;e++){let t=r[e].toString(16);t.length<2&&(t="0"+t),a+=t}n.codec=a,i+=t,this.tracks.videoTrack.meta.sps=r,s=o.SpsParser.parseSPS(r)}let u=e[i];i++;for(let t=0;t<u;t++){let t=255*e[i]+e[i+1];i+=2;let n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e[i+r];i+=t,this.tracks.videoTrack.meta.pps=n}Object.assign(n,o.SpsParser.toVideoMeta(s));const l=this._context.mediaInfo.video;l.codec=n.codec,l.profile=n.profile,l.level=n.level,l.chromaFormat=n.chromaFormat,l.frameRate=n.frameRate,l.parRatio=n.parRatio,l.width=l.width===n.presentWidth?l.width:n.presentWidth,l.height=l.height===n.presentHeight?l.width:n.presentHeight,n.duration=this._context.mediaInfo.duration*n.timescale,n.avcc=new Uint8Array(e.length),n.avcc.set(e),t.meta=n}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e){let t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}},{key:"loaderBuffer",get:function(){const e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(c.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}}],[{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){const t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),e}();t.default=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(0);const a={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12};let o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=0,this.readOffset=this.offset}return n(e,[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");const i={},n=this.parseValue(e),r=this.parseValue(e,t-n.bodySize);return i[n.data]=r.data,this.resetStatus(),i}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){const t=new DataView(e,this.readOffset).getUint16(0,!r.isLe);let i="";i=t>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,t)):"";let n=t+2;return this.readOffset+=n,{data:i,bodySize:t+2}}},{key:"parseDate",value:function(e,t){const i=new DataView(e,this.readOffset,t);let n=i.getFloat64(0,!r.isLe);return n+=60*i.getInt16(8,!r.isLe)*1e3,this.readOffset+=10,{data:new Date(n),bodySize:10}}},{key:"parseObject",value:function(e,t){const i=this.parseString(e,t),n=this.parseValue(e,t-i.bodySize);return{data:{name:i.data,value:n.data},bodySize:i.bodySize+n.bodySize,isObjEnd:n.isObjEnd}}},{key:"parseLongString",value:function(e){const t=new DataView(e,this.readOffset).getUint32(0,!r.isLe);let i="";return i=t>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,t)):"",this.readOffset+=t+4,{data:i,bodySize:t+4}}},{key:"parseValue",value:function(e,t){let i=new ArrayBuffer;i=e instanceof ArrayBuffer?e:e.buffer;const{NUMBER:n,BOOLEAN:o,STRING:s,OBJECT:u,MIX_ARRAY:l,OBJECT_END:c,STRICT_ARRAY:f,DATE:h,LONE_STRING:d}=a,p=new DataView(i,this.readOffset,t);let y=!1;const m=p.getUint8(0);let v=1;this.readOffset+=1;let g=null;switch(m){case n:g=p.getFloat64(1,!r.isLe),this.readOffset+=8,v+=8;break;case o:g=!!p.getUint8(1),this.readOffset+=1,v+=1;break;case s:{const e=this.parseString(i);g=e.data,v+=e.bodySize;break}case u:{g={};let e=0;for(16777215&p.getUint32(t-4,!r.isLe)&&(e=3);v<t-4;){const n=this.parseObject(i,t-v-e);if(n.isObjectEnd)break;g[n.data.name]=n.data.value,v+=n.bodySize}if(v<=t-3){9===(16777215&p.getUint32(v-1,!r.isLe))&&(this.readOffset+=3,v+=3)}break}case l:{g={},v+=4,this.readOffset+=4;let e=0;for(9==(16777215&p.getUint32(t-4,!r.isLe))&&(e=3);v<t-8;){const n=this.parseObject(i,t-v-e);if(n.isObjectEnd)break;g[n.data.name]=n.data.value,v+=n.bodySize}if(v<=t-3){9===(16777215&p.getUint32(v-1,!r.isLe))&&(v+=3,this.readOffset+=3)}break}case c:g=null,y=!0;break;case f:{g=[];const e=p.getUint32(1,!r.isLe);v+=4,this.readOffset+=4;for(let n=0;n<e;n++){const e=this.parseValue(i,t-v);g.push(e.data),v+=e.bodySize}break}case h:{const e=this.parseDate(i,t-1);g=e.data,v+=e.bodySize;break}case d:{const e=this.parseLongString(i,t-1);g=e.data,v+=e.bodySize;break}default:v=t}return{data:g,bodySize:v,isObjEnd:y}}}]),e}();t.default=o},,,function(e,t,i){i(55),i(56),e.exports=i(57)},function(e,t,i){"use strict";(function(){var e=window.Document.prototype.createElement,t=window.Document.prototype.createElementNS,i=window.Document.prototype.importNode,n=window.Document.prototype.prepend,r=window.Document.prototype.append,a=window.DocumentFragment.prototype.prepend,o=window.DocumentFragment.prototype.append,s=window.Node.prototype.cloneNode,u=window.Node.prototype.appendChild,l=window.Node.prototype.insertBefore,c=window.Node.prototype.removeChild,f=window.Node.prototype.replaceChild,h=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),d=window.Element.prototype.attachShadow,p=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),y=window.Element.prototype.getAttribute,m=window.Element.prototype.setAttribute,v=window.Element.prototype.removeAttribute,g=window.Element.prototype.getAttributeNS,_=window.Element.prototype.setAttributeNS,b=window.Element.prototype.removeAttributeNS,E=window.Element.prototype.insertAdjacentElement,w=window.Element.prototype.insertAdjacentHTML,k=window.Element.prototype.prepend,T=window.Element.prototype.append,A=window.Element.prototype.before,S=window.Element.prototype.after,x=window.Element.prototype.replaceWith,D=window.Element.prototype.remove,O=window.HTMLElement,C=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),R=window.HTMLElement.prototype.insertAdjacentElement,L=window.HTMLElement.prototype.insertAdjacentHTML,M=new Set;function U(e){var t=M.has(e);return e=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(e),!t&&e}"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach((function(e){return M.add(e)}));var P=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);function B(e){var t=e.isConnected;if(void 0!==t)return t;if(P(e))return!0;for(;e&&!(e.__CE_isImportDocument||e instanceof Document);)e=e.parentNode||(window.ShadowRoot&&e instanceof ShadowRoot?e.host:void 0);return!(!e||!(e.__CE_isImportDocument||e instanceof Document))}function I(e){var t=e.children;if(t)return Array.prototype.slice.call(t);for(t=[],e=e.firstChild;e;e=e.nextSibling)e.nodeType===Node.ELEMENT_NODE&&t.push(e);return t}function j(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}function F(e,t,i){e[t]=i}function N(e){var t=document;this.c=e,this.a=t,this.b=void 0,te(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function V(e){e.b&&e.b.disconnect()}function G(){var e=this;this.b=this.a=void 0,this.c=new Promise((function(t){e.b=t,e.a&&t(e.a)}))}function z(e){if(e.a)throw Error("Already resolved.");e.a=void 0,e.b&&e.b(void 0)}function H(e){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=e,this.j=new Map,this.c=function(e){return e()},this.a=!1,this.h=[],this.m=e.f?new N(e):void 0}function X(e,t){if(!U(t))throw new SyntaxError("The element name '"+t+"' is not valid.");if(q(e,t))throw Error("A custom element with name '"+t+"' has already been defined.");if(e.i)throw Error("A custom element is already being defined.")}function W(e,t,i){var n;e.i=!0;try{var r=function(e){var t=a[e];if(void 0!==t&&!(t instanceof Function))throw Error("The '"+e+"' callback must be a function.");return t},a=i.prototype;if(!(a instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var o=r("connectedCallback"),s=r("disconnectedCallback"),u=r("adoptedCallback"),l=(n=r("attributeChangedCallback"))&&i.observedAttributes||[]}catch(e){throw e}finally{e.i=!1}return i={localName:t,constructorFunction:i,connectedCallback:o,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:n,observedAttributes:l,constructionStack:[]},e.g.set(t,i),e.l.set(i.constructorFunction,i),i}function Y(e){if(!1!==e.a){e.a=!1;for(var t=[],i=e.h,n=new Map,r=0;r<i.length;r++)n.set(i[r],[]);for(te(e.b,document,{upgrade:function(i){if(void 0===i.__CE_state){var r=i.localName,a=n.get(r);a?a.push(i):e.g.has(r)&&t.push(i)}}}),r=0;r<t.length;r++)ie(e.b,t[r]);for(r=0;r<i.length;r++){for(var a=i[r],o=n.get(a),s=0;s<o.length;s++)ie(e.b,o[s]);(a=e.j.get(a))&&z(a)}i.length=0}}function q(e,t){var i=e.g.get(t);if(i)return i;if(i=e.f.get(t)){e.f.delete(t);try{return W(e,t,i())}catch(e){re(e)}}}function K(){var e=ue&&ue.noDocumentConstructionObserver,t=ue&&ue.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=t,this.f=!e}function $(e,t,i,n){var r=window.ShadyDOM;if(e.shadyDomFastWalk&&r&&r.inUse){if(t.nodeType===Node.ELEMENT_NODE&&i(t),t.querySelectorAll)for(e=r.nativeMethods.querySelectorAll.call(t,"*"),t=0;t<e.length;t++)i(e[t])}else!function e(t,i,n){for(var r=t;r;){if(r.nodeType===Node.ELEMENT_NODE){var a=r;i(a);var o=a.localName;if("link"===o&&"import"===a.getAttribute("rel")){if(r=a.import,void 0===n&&(n=new Set),r instanceof Node&&!n.has(r))for(n.add(r),r=r.firstChild;r;r=r.nextSibling)e(r,i,n);r=j(t,a);continue}if("template"===o){r=j(t,a);continue}if(a=a.__CE_shadowRoot)for(a=a.firstChild;a;a=a.nextSibling)e(a,i,n)}r=r.firstChild?r.firstChild:j(t,r)}}(t,i,n)}function J(e,t){e.a&&$(e,t,(function(t){return Z(e,t)}))}function Z(e,t){if(e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var i=0;i<e.b.length;i++)e.b[i](t);for(i=0;i<e.c.length;i++)e.c[i](t)}}function Q(e,t){var i=[];for($(e,t,(function(e){return i.push(e)})),t=0;t<i.length;t++){var n=i[t];1===n.__CE_state?e.connectedCallback(n):ie(e,n)}}function ee(e,t){var i=[];for($(e,t,(function(e){return i.push(e)})),t=0;t<i.length;t++){var n=i[t];1===n.__CE_state&&e.disconnectedCallback(n)}}function te(e,t,i){var n=(i=void 0===i?{}:i).s,r=i.upgrade||function(t){return ie(e,t)},a=[];for($(e,t,(function(t){if(e.a&&Z(e,t),"link"===t.localName&&"import"===t.getAttribute("rel")){var i=t.import;i instanceof Node&&(i.__CE_isImportDocument=!0,i.__CE_registry=document.__CE_registry),i&&"complete"===i.readyState?i.__CE_documentLoadHandled=!0:t.addEventListener("load",(function(){var i=t.import;if(!i.__CE_documentLoadHandled){i.__CE_documentLoadHandled=!0;var a=new Set;n&&(n.forEach((function(e){return a.add(e)})),a.delete(i)),te(e,i,{s:a,upgrade:r})}}))}else a.push(t)}),n),t=0;t<a.length;t++)r(a[t])}function ie(e,t){try{var i=t.ownerDocument,n=i.__CE_registry,r=n&&(i.defaultView||i.__CE_isImportDocument)?q(n,t.localName):void 0;if(r&&void 0===t.__CE_state){r.constructionStack.push(t);try{try{if(new r.constructorFunction!==t)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{r.constructionStack.pop()}}catch(e){throw t.__CE_state=2,e}if(t.__CE_state=1,t.__CE_definition=r,r.attributeChangedCallback&&t.hasAttributes()){var a=r.observedAttributes;for(r=0;r<a.length;r++){var o=a[r],s=t.getAttribute(o);null!==s&&e.attributeChangedCallback(t,o,null,s,null)}}B(t)&&e.connectedCallback(t)}}catch(e){re(e)}}function ne(i,n,r,a){var o=n.__CE_registry;if(o&&(null===a||"http://www.w3.org/1999/xhtml"===a)&&(o=q(o,r)))try{var s=new o.constructorFunction;if(void 0===s.__CE_state||void 0===s.__CE_definition)throw Error("Failed to construct '"+r+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==s.namespaceURI)throw Error("Failed to construct '"+r+"': The constructed element's namespace must be the HTML namespace.");if(s.hasAttributes())throw Error("Failed to construct '"+r+"': The constructed element must not have any attributes.");if(null!==s.firstChild)throw Error("Failed to construct '"+r+"': The constructed element must not have any children.");if(null!==s.parentNode)throw Error("Failed to construct '"+r+"': The constructed element must not have a parent node.");if(s.ownerDocument!==n)throw Error("Failed to construct '"+r+"': The constructed element's owner document is incorrect.");if(s.localName!==r)throw Error("Failed to construct '"+r+"': The constructed element's local name is incorrect.");return s}catch(o){return re(o),n=null===a?e.call(n,r):t.call(n,a,r),Object.setPrototypeOf(n,HTMLUnknownElement.prototype),n.__CE_state=2,n.__CE_definition=void 0,Z(i,n),n}return Z(i,n=null===a?e.call(n,r):t.call(n,a,r)),n}function re(e){var t=e.message,i=e.sourceURL||e.fileName||"",n=e.line||e.lineNumber||0,r=e.column||e.columnNumber||0,a=void 0;void 0===ErrorEvent.prototype.initErrorEvent?a=new ErrorEvent("error",{cancelable:!0,message:t,filename:i,lineno:n,colno:r,error:e}):((a=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,t,i,n),a.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===a.error&&Object.defineProperty(a,"error",{configurable:!0,enumerable:!0,get:function(){return e}}),window.dispatchEvent(a),a.defaultPrevented||console.error(e)}N.prototype.f=function(e){var t=this.a.readyState;for("interactive"!==t&&"complete"!==t||V(this),t=0;t<e.length;t++)for(var i=e[t].addedNodes,n=0;n<i.length;n++)te(this.c,i[n])},H.prototype.o=function(e,t){var i=this;if(!(t instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");X(this,e),this.f.set(e,t),this.h.push(e),this.a||(this.a=!0,this.c((function(){return Y(i)})))},H.prototype.define=function(e,t){var i=this;if(!(t instanceof Function))throw new TypeError("Custom element constructors must be functions.");X(this,e),W(this,e,t),this.h.push(e),this.a||(this.a=!0,this.c((function(){return Y(i)})))},H.prototype.upgrade=function(e){te(this.b,e)},H.prototype.get=function(e){if(e=q(this,e))return e.constructorFunction},H.prototype.whenDefined=function(e){if(!U(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var t=this.j.get(e);if(t)return t.c;t=new G,this.j.set(e,t);var i=this.g.has(e)||this.f.has(e);return e=-1===this.h.indexOf(e),i&&e&&z(t),t.c},H.prototype.polyfillWrapFlushCallback=function(e){this.m&&V(this.m);var t=this.c;this.c=function(i){return e((function(){return t(i)}))}},window.CustomElementRegistry=H,H.prototype.define=H.prototype.define,H.prototype.upgrade=H.prototype.upgrade,H.prototype.get=H.prototype.get,H.prototype.whenDefined=H.prototype.whenDefined,H.prototype.polyfillDefineLazy=H.prototype.o,H.prototype.polyfillWrapFlushCallback=H.prototype.polyfillWrapFlushCallback,K.prototype.connectedCallback=function(e){var t=e.__CE_definition;if(t.connectedCallback)try{t.connectedCallback.call(e)}catch(e){re(e)}},K.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;if(t.disconnectedCallback)try{t.disconnectedCallback.call(e)}catch(e){re(e)}},K.prototype.attributeChangedCallback=function(e,t,i,n,r){var a=e.__CE_definition;if(a.attributeChangedCallback&&-1<a.observedAttributes.indexOf(t))try{a.attributeChangedCallback.call(e,t,i,n,r)}catch(e){re(e)}};var ae=new function(){};function oe(e,t,i){function n(t){return function(i){for(var n=[],r=0;r<arguments.length;++r)n[r]=arguments[r];r=[];for(var a=[],o=0;o<n.length;o++){var s=n[o];if(s instanceof Element&&B(s)&&a.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(t.apply(this,n),n=0;n<a.length;n++)ee(e,a[n]);if(B(this))for(n=0;n<r.length;n++)(a=r[n])instanceof Element&&Q(e,a)}}void 0!==i.prepend&&F(t,"prepend",n(i.prepend)),void 0!==i.append&&F(t,"append",n(i.append))}function se(e){function i(t,i){Object.defineProperty(t,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(t){var n=this,r=void 0;if(B(this)&&(r=[],$(e,this,(function(e){e!==n&&r.push(e)}))),i.set.call(this,t),r)for(var a=0;a<r.length;a++){var o=r[a];1===o.__CE_state&&e.disconnectedCallback(o)}return this.ownerDocument.__CE_registry?te(e,this):J(e,this),t}})}function n(t,i){F(t,"insertAdjacentElement",(function(t,n){var r=B(n);return t=i.call(this,t,n),r&&ee(e,n),B(t)&&Q(e,n),t}))}function r(t,i){function n(t,i){for(var n=[];t!==i;t=t.nextSibling)n.push(t);for(i=0;i<n.length;i++)te(e,n[i])}F(t,"insertAdjacentHTML",(function(e,t){if("beforebegin"===(e=e.toLowerCase())){var r=this.previousSibling;i.call(this,e,t),n(r||this.parentNode.firstChild,this)}else if("afterbegin"===e)r=this.firstChild,i.call(this,e,t),n(this.firstChild,r);else if("beforeend"===e)r=this.lastChild,i.call(this,e,t),n(r||this.firstChild,null);else{if("afterend"!==e)throw new SyntaxError("The value provided ("+String(e)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,i.call(this,e,t),n(this.nextSibling,r)}}))}d&&F(Element.prototype,"attachShadow",(function(t){if(t=d.call(this,t),e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var i=0;i<e.b.length;i++)e.b[i](t)}return this.__CE_shadowRoot=t})),p&&p.get?i(Element.prototype,p):C&&C.get?i(HTMLElement.prototype,C):function(e,t){e.a=!0,e.c.push(t)}(e,(function(e){i(e,{enumerable:!0,configurable:!0,get:function(){return s.call(this,!0).innerHTML},set:function(e){var i="template"===this.localName,n=i?this.content:this,r=t.call(document,this.namespaceURI,this.localName);for(r.innerHTML=e;0<n.childNodes.length;)c.call(n,n.childNodes[0]);for(e=i?r.content:r;0<e.childNodes.length;)u.call(n,e.childNodes[0])}})})),F(Element.prototype,"setAttribute",(function(t,i){if(1!==this.__CE_state)return m.call(this,t,i);var n=y.call(this,t);m.call(this,t,i),i=y.call(this,t),e.attributeChangedCallback(this,t,n,i,null)})),F(Element.prototype,"setAttributeNS",(function(t,i,n){if(1!==this.__CE_state)return _.call(this,t,i,n);var r=g.call(this,t,i);_.call(this,t,i,n),n=g.call(this,t,i),e.attributeChangedCallback(this,i,r,n,t)})),F(Element.prototype,"removeAttribute",(function(t){if(1!==this.__CE_state)return v.call(this,t);var i=y.call(this,t);v.call(this,t),null!==i&&e.attributeChangedCallback(this,t,i,null,null)})),F(Element.prototype,"removeAttributeNS",(function(t,i){if(1!==this.__CE_state)return b.call(this,t,i);var n=g.call(this,t,i);b.call(this,t,i);var r=g.call(this,t,i);n!==r&&e.attributeChangedCallback(this,i,n,r,t)})),R?n(HTMLElement.prototype,R):E&&n(Element.prototype,E),L?r(HTMLElement.prototype,L):w&&r(Element.prototype,w),oe(e,Element.prototype,{prepend:k,append:T}),function(e){function t(t){return function(i){for(var n=[],r=0;r<arguments.length;++r)n[r]=arguments[r];r=[];for(var a=[],o=0;o<n.length;o++){var s=n[o];if(s instanceof Element&&B(s)&&a.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(t.apply(this,n),n=0;n<a.length;n++)ee(e,a[n]);if(B(this))for(n=0;n<r.length;n++)(a=r[n])instanceof Element&&Q(e,a)}}var i=Element.prototype;void 0!==A&&F(i,"before",t(A)),void 0!==S&&F(i,"after",t(S)),void 0!==x&&F(i,"replaceWith",(function(t){for(var i=[],n=0;n<arguments.length;++n)i[n]=arguments[n];n=[];for(var r=[],a=0;a<i.length;a++){var o=i[a];if(o instanceof Element&&B(o)&&r.push(o),o instanceof DocumentFragment)for(o=o.firstChild;o;o=o.nextSibling)n.push(o);else n.push(o)}for(a=B(this),x.apply(this,i),i=0;i<r.length;i++)ee(e,r[i]);if(a)for(ee(e,this),i=0;i<n.length;i++)(r=n[i])instanceof Element&&Q(e,r)})),void 0!==D&&F(i,"remove",(function(){var t=B(this);D.call(this),t&&ee(e,this)}))}(e)}var ue=window.customElements;function le(){var t=new K;!function(t){window.HTMLElement=function(){function i(){var i=this.constructor,n=document.__CE_registry.l.get(i);if(!n)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var r=n.constructionStack;if(0===r.length)return r=e.call(document,n.localName),Object.setPrototypeOf(r,i.prototype),r.__CE_state=1,r.__CE_definition=n,Z(t,r),r;var a=r.length-1,o=r[a];if(o===ae)throw Error("Failed to construct '"+n.localName+"': This element was already constructed.");return r[a]=ae,Object.setPrototypeOf(o,i.prototype),Z(t,o),o}return i.prototype=O.prototype,Object.defineProperty(i.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:i}),i}()}(t),function(e){F(Document.prototype,"createElement",(function(t){return ne(e,this,t,null)})),F(Document.prototype,"importNode",(function(t,n){return t=i.call(this,t,!!n),this.__CE_registry?te(e,t):J(e,t),t})),F(Document.prototype,"createElementNS",(function(t,i){return ne(e,this,i,t)})),oe(e,Document.prototype,{prepend:n,append:r})}(t),oe(t,DocumentFragment.prototype,{prepend:a,append:o}),function(e){function t(t,i){Object.defineProperty(t,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(t){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,t);else{var n=void 0;if(this.firstChild){var r=this.childNodes,a=r.length;if(0<a&&B(this)){n=Array(a);for(var o=0;o<a;o++)n[o]=r[o]}}if(i.set.call(this,t),n)for(t=0;t<n.length;t++)ee(e,n[t])}}})}F(Node.prototype,"insertBefore",(function(t,i){if(t instanceof DocumentFragment){var n=I(t);if(t=l.call(this,t,i),B(this))for(i=0;i<n.length;i++)Q(e,n[i]);return t}return n=t instanceof Element&&B(t),i=l.call(this,t,i),n&&ee(e,t),B(this)&&Q(e,t),i})),F(Node.prototype,"appendChild",(function(t){if(t instanceof DocumentFragment){var i=I(t);if(t=u.call(this,t),B(this))for(var n=0;n<i.length;n++)Q(e,i[n]);return t}return i=t instanceof Element&&B(t),n=u.call(this,t),i&&ee(e,t),B(this)&&Q(e,t),n})),F(Node.prototype,"cloneNode",(function(t){return t=s.call(this,!!t),this.ownerDocument.__CE_registry?te(e,t):J(e,t),t})),F(Node.prototype,"removeChild",(function(t){var i=t instanceof Element&&B(t),n=c.call(this,t);return i&&ee(e,t),n})),F(Node.prototype,"replaceChild",(function(t,i){if(t instanceof DocumentFragment){var n=I(t);if(t=f.call(this,t,i),B(this))for(ee(e,i),i=0;i<n.length;i++)Q(e,n[i]);return t}n=t instanceof Element&&B(t);var r=f.call(this,t,i),a=B(this);return a&&ee(e,i),n&&ee(e,t),a&&Q(e,t),r})),h&&h.get?t(Node.prototype,h):function(e,t){e.a=!0,e.b.push(t)}(e,(function(e){t(e,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=this.firstChild;t;t=t.nextSibling)t.nodeType!==Node.COMMENT_NODE&&e.push(t.textContent);return e.join("")},set:function(e){for(;this.firstChild;)c.call(this,this.firstChild);null!=e&&""!==e&&u.call(this,document.createTextNode(e))}})}))}(t),se(t),t=new H(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}ue&&!ue.forcePolyfill&&"function"==typeof ue.define&&"function"==typeof ue.get||le(),window.__CE_installPolyfill=le}).call(self)},function(e,t,i){"use strict";
/**
 * @license
 * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
 */!function(){if(void 0===window.Reflect||void 0===window.customElements||window.customElements.polyfillWrapFlushCallback)return;const e=HTMLElement,t=function(){return Reflect.construct(e,[],this.constructor)};window.HTMLElement=t,HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}()},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},a=u(i(5)),o=i(0),s=u(i(58));function u(e){return e&&e.__esModule?e:{default:e}}const l=o.EVENTS.FlvAllowedEvents;let c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.mediaType||(e.mediaType="mobile-video");var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.video.width=Number.parseInt(e.width||600),i.video.height=Number.parseInt(e.height||337.5),i.video.style.outline="none",i.context=new o.Context(l),i.initEvents(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"start",value:function(){this.initFlv(),this.context.init(),this.flv.seek(0),r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this,this.config.url),this.play()}},{key:"initFlvEvents",value:function(e){const t=this;e.once(o.EVENTS.REMUX_EVENTS.INIT_SEGMENT,()=>{if(a.default.util.addClass(t.root,"xgplayer-is-live"),!a.default.util.findDom(this.root,"xg-live")){const e=a.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");t.controls.appendChild(e)}}),e.once(o.EVENTS.LOADER_EVENTS.LOADER_COMPLETE,()=>{if(!t.paused){const e=setInterval(()=>{const i=t.getBufferedRange()[1];Math.abs(t.currentTime-i)<.5&&(t.emit("ended"),window.clearInterval(e))},200)}}),e.on(o.EVENTS.BROWSER_EVENTS.VISIBILITY_CHANGE,e=>{e&&this.pause()})}},{key:"initEvents",value:function(){this.on("timeupdate",()=>{this.loadData()}),this.on("seeking",()=>{const e=this.currentTime,t=this.getBufferedRange();(e>t[1]||e<t[0])&&this.flv.seek(this.currentTime)})}},{key:"initFlv",value:function(){const e=this.context.registry("FLV_CONTROLLER",s.default)(this);this.initFlvEvents(e),this.flv=e}},{key:"play",value:function(){if(this._hasStart&&this.paused){this._destroy(),this.context=new o.Context(l);const e=this.context.registry("FLV_CONTROLLER",s.default)(this);this.initFlvEvents(e),this.flv=e,this.context.init(),this.loadData(),r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this),r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"play",this).call(this)}else r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"play",this).call(this),this.addLiveFlag()}},{key:"pause",value:function(){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"pause",this).call(this),this.flv&&this.flv.pause()}},{key:"loadData",value:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTime;this.flv&&this.flv.seek(e)}},{key:"destroy",value:function(){this._destroy(),r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"addLiveFlag",value:function(){const e=this;if(a.default.util.addClass(e.root,"xgplayer-is-live"),!a.default.util.findDom(this.root,"xg-live")){const t=a.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");e.controls.appendChild(t)}}},{key:"_destroy",value:function(){this.context.destroy(),this.flv=null,this.context=null}},{key:"src",get:function(){return this.currentSrc},set:function(e){this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",()=>{this.start(e)}),this.once("canplay",()=>{this.play()})),this.once("canplay",()=>{this.currentTime=0})}}]),t}(a.default);e.exports=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(41),o=i(43),s=i(38),u=i(4),l=i(0),c=i(3),f=i(5),h=(n=f)&&n.__esModule?n:{default:n};function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}const p=l.EVENTS.DEMUX_EVENTS,y=l.EVENTS.LOADER_EVENTS,m=(l.EVENTS.BROWSER_EVENTS,"FLVController");let v=function(){function e(){d(this,e)}return r(e,[{key:"warn",value:function(){}}]),e}(),g=function(){function e(t){d(this,e),this.TAG=m,this._player=t,this.video=this._player.video,this.state={initSegmentArrived:!1}}return r(e,[{key:"init",value:function(){this._context.registry("FETCH_LOADER",a.FetchLoader),this._context.registry("LOADER_BUFFER",u.XgBuffer),this._context.registry("PRE_SOURCE_BUFFER",u.PreSource),this._context.registry("FLV_DEMUXER",o.FlvDemuxer),this._context.registry("MP4_REMUXER",s.Mp4Remuxer),this._context.registry("TRACKS",u.Tracks),this._context.registry("COMPATIBILITY",c.Compatibility),this._context.registry("PAGE_VISIBILITY",l.PageVisibility),this._context.registry("LOGGER",v),this.initListeners()}},{key:"initListeners",value:function(){this.on(y.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(y.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(p.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(p.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(p.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(p.DEMUX_ERROR,this._handleDemuxError.bind(this))}},{key:"_handleMediaInfo",value:function(){this._context.mediaInfo||this.emit(p.DEMUX_ERROR,new Error("failed to get mediainfo"))}},{key:"_handleLoaderDataLoaded",value:function(){this.emitTo("FLV_DEMUXER",p.DEMUX_START)}},{key:"_handleMetadataParsed",value:function(e){if("audio"===e){const{audioTrack:e}=this._context.getInstance("TRACKS");e&&e.meta&&this._setMetaToAudio(e.meta)}else{const{videoTrack:e}=this._context.getInstance("TRACKS");e&&e.meta&&this._setMetaToVideo(e.meta)}}},{key:"_handleDemuxComplete",value:function(){if(this._player.video){const{videoTrack:e,audioTrack:t}=this._context.getInstance("TRACKS");this._player.video.onDemuxComplete(e,t)}}},{key:"_handleAppendInitSegment",value:function(){this.state.initSegmentArrived=!0}},{key:"_handleNetworkError",value:function(){this._player.emit("error",new h.default.Errors("network",this._player.config.url))}},{key:"_handleDemuxError",value:function(){this._player.emit("error",new h.default.Errors("parse",this._player.config.url))}},{key:"_setMetaToAudio",value:function(e){this._player.video&&this._player.video.setAudioMeta(e)}},{key:"_setMetaToVideo",value:function(e){this._player.video&&this._player.video.setVideoMeta(e)}},{key:"seek",value:function(){this.state.initSegmentArrived||this.loadData()}},{key:"loadData",value:function(){this.emit(y.LADER_START,this._player.config.url)}},{key:"pause",value:function(){const e=this._context.getInstance("FETCH_LOADER");e&&e.cancel()}}],[{key:"resolveVideoGOP",value:function(e){const{samples:t}=e;if(!t.length)return;let i=null,n=null;e.tempSamples&&e.tempSamples.length&&t.unshift.apply(t,e.tempSamples);for(let e=0,n=t.length;e<n;e++){if(t[e].isKeyframe){i=e;break}}for(let e=t.length-1;e>0;e++){if(t[e].isKeyframe){n=e;break}}0!==i&&t.splice(0,i-1),e.samples=t.slice(0,n);const r=t.slice(n);e.tempSamples?e.tempSamples.push.apply(e.tempSamples,r):e.tempSamples=r}}]),e}();t.default=g}]);