!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],e):"object"==typeof exports?exports["xgplayer-flv"]=e(require("xgplayer")):t["xgplayer-flv"]=e(t.xgplayer)}(window,(function(t){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=50)}([function(t,e,i){"use strict";t.exports={Context:i(14).default,EVENTS:i(7).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,MediaInfo:i(5).default,MediaSample:i(19).default,MediaSegment:i(20).default,MediaSegmentList:i(21).default,AudioTrackMeta:i(8).AudioTrackMeta,VideoTrackMeta:i(8).VideoTrackMeta,AudioTrackSample:i(9).AudioTrackSample,VideoTrackSample:i(9).VideoTrackSample,Mse:i(22).default,Stream:i(10).default,Buffer:i(23).default,MobileVideo:i(26),Crypto:i(35).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}}e.default=s;e.AudioTrack=class extends s{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}};e.VideoTrack=class extends s{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}};e.Tracks=class{constructor(){this.audioTrack=null,this.videoTrack=null}destroy(){this.audioTrack=null,this.videoTrack=null}}},function(t,e,i){"use strict";t.exports={Nalunit:i(11).default,SpsParser:i(12).default,Compatibility:i(44).default}},function(t,e,i){"use strict";t.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(13).XgBuffer,RemuxBuffer:i(13).RemuxBuffer,PreSource:i(46).default}},function(e,i){e.exports=t},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=t=>{for(let e in t)if(t.hasOwnProperty(e)&&null===t[e])return!1;return!0};class r{constructor(){this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}isComplete(){return r.isBaseInfoReady(this)&&r.isVideoReady(this)&&r.isAudioReady(this)}static isBaseInfoReady(t){return s(t)}static isVideoReady(t){return!t.hasVideo||s(t.video)}static isAudioReady(t){return!t.hasAudio||s(t.video)}}e.default=r},function(t,e,i){"use strict";var s,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var d=10;function h(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function l(t,e,i,s){var r,a,n,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),n=a[e]),void 0===n)n=a[e]=i,++t._eventsCount;else if("function"==typeof n?n=a[e]=s?[i,n]:[n,i]:s?n.unshift(i):n.push(i),(r=h(t))>0&&n.length>r&&!n.warned){n.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=n.length,o=d,console&&console.warn&&console.warn(o)}return t}function u(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,t))}function c(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=u.bind(s);return r.listener=i,s.wrapFn=r,r}function f(t,e,i){var s=t._events;if(void 0===s)return[];var r=s[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):m(r,r.length)}function p(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");d=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var n;if(e.length>0&&(n=e[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var d=r[t];if(void 0===d)return!1;if("function"==typeof d)a(d,this,e);else{var h=d.length,l=m(d,h);for(i=0;i<h;++i)a(l[i],this,e)}return!0},o.prototype.addListener=function(t,e){return l(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return l(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,c(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,c(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,s,r,a,n;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){n=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,n||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(s=0;s<a.length;++s)"removeListener"!==(r=a[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},o.prototype.listeners=function(t){return f(this,t,!0)},o.prototype.rawListeners=function(t){return f(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},r={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM"},n={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},d=Object.assign({},s,r,a,n,o),h=[],l=[];for(let t in d)d.hasOwnProperty(t)&&h.push(d[t]);for(let t in d)d.hasOwnProperty(t)&&l.push(d[t]);e.default={ALLEVENTS:d,HLS_EVENTS:o,REMUX_EVENTS:a,DEMUX_EVENTS:r,MSE_EVENTS:n,LOADER_EVENTS:s,FlvAllowedEvents:h,HlsAllowedEvents:l,CRYTO_EVENTS:{START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.AudioTrackMeta=class{constructor(t){const e={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},e,t):e}destroy(){this.init=null}};e.VideoTrackMeta=class{constructor(t){const e={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},e,t):e}destroy(){this.init=null,this.sps=null,this.pps=null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){let e=s.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,data:new Uint8Array}}}e.AudioTrackSample=s;class r{constructor(t){let e=r.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}e.VideoTrackSample=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){if(!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(t){this.dataview.position=t}get position(){return this.dataview.position}back(t){this.position-=t}skip(t){let e=Math.floor(t/4),i=t%4;for(let t=0;t<e;t++)s.readByte(this.dataview,4);i>0&&s.readByte(this.dataview,i)}static readByte(t,e,i){let s;switch(e){case 1:s=i?t.getInt8(t.position):t.getUint8(t.position);break;case 2:s=i?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(i)throw new Error("not supported for readByte 3");s=t.getUint8(t.position)<<16,s|=t.getUint8(t.position+1)<<8,s|=t.getUint8(t.position+2);break;case 4:s=i?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(i)throw new Error("not supported for readBody 8");s=t.getUint32(t.position)<<32,s|=t.getUint32(t.position+4);break;default:s=""}return t.position+=e,s}readUint8(){return s.readByte(this.dataview,1)}readUint16(){return s.readByte(this.dataview,2)}readUint24(){return s.readByte(this.dataview,3)}readUint32(){return s.readByte(this.dataview,4)}readUint64(){return s.readByte(this.dataview,8)}readInt8(){return s.readByte(this.dataview,1,!0)}readInt16(){return s.readByte(this.dataview,2,!0)}readInt32(){return s.readByte(this.dataview,4,!0)}writeUint32(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(12),a=(s=r)&&s.__esModule?s:{default:s};class n{static getNalunits(t){if(t.length-t.position<4)return[];let e=t.dataview,i=t.position;return 1===e.getInt32(i)||0===e.getInt16(i)&&1===e.getInt8(i+2)?n.getAnnexbNals(t):n.getAvccNals(t)}static getAnnexbNals(t){let e=[],i=n.getHeaderPositionAnnexB(t),s=i.pos,r=s;for(;s<t.length-4;){let a=t.buffer.slice(s,s+i.headerLength);i.pos===t.position&&t.skip(i.headerLength),r=(i=n.getHeaderPositionAnnexB(t)).pos;let o={header:a,body:new Uint8Array(t.buffer.slice(s+a.byteLength,r))};n.analyseNal(o),e.push(o),t.skip(r-t.position),s=r}return e}static getAvccNals(t){let e=[];for(;t.position<t.length-4;){let i=t.dataview.getInt32(t.position);if(!(t.length-t.position>=i))break;{let s=t.buffer.slice(t.position,t.position+4);t.skip(4);let r=t.buffer.slice(t.position,t.position+i);t.skip(i);let a={header:s,body:r};n.analyseNal(a),e.push(a)}}return e}static analyseNal(t){switch(31&t.body[0]){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:break;case 7:t.sps=a.default.parseSPS(t.body);break;case 8:t.pps=!0}}static getHeaderPositionAnnexB(t){let e=t.position,i=0;for(;3!==i&&4!==i&&e<t.length-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?i=4:1===t.dataview.getInt8(e+2)?i=3:e++:e++;return e===t.length-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(i=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?i=3:e=t.length)),{pos:e,headerLength:i}}static getAvcc(t,e){let i=new Uint8Array(t.byteLength+e.byteLength+11);i[0]=1,i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=255,i[5]=225;let s=6;return i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),s),s+=2,i.set(t,s),i[s+=t.byteLength]=1,s++,i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),s),s+=2,i.set(e,s),i}}e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(29),a=(s=r)&&s.__esModule?s:{default:s};class n{static _ebsp2rbsp(t){let e=t,i=e.byteLength,s=new Uint8Array(i),r=0;for(let t=0;t<i;t++)t>=2&&3===e[t]&&0===e[t-1]&&0===e[t-2]||(s[r]=e[t],r++);return new Uint8Array(s.buffer,0,r)}static parseSPS(t){let e=n._ebsp2rbsp(t),i=new a.default(e);i.readByte();let s=i.readByte();i.readByte();let r=i.readByte();i.readUEG();let o=n.getProfileString(s),d=n.getLevelString(r),h=1,l=420,u=[0,420,422,444],c=8;if((100===s||110===s||122===s||244===s||44===s||83===s||86===s||118===s||128===s||138===s||144===s)&&(3===(h=i.readUEG())&&i.readBits(1),h<=3&&(l=u[h]),c=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool())){let t=3!==h?8:12;for(let e=0;e<t;e++)i.readBool()&&(e<6?n._skipScalingList(i,16):n._skipScalingList(i,64))}i.readUEG();let f=i.readUEG();if(0===f)i.readUEG();else if(1===f){i.readBits(1),i.readSEG(),i.readSEG();let t=i.readUEG();for(let e=0;e<t;e++)i.readSEG()}i.readUEG(),i.readBits(1);let p=i.readUEG(),m=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);let _=0,y=0,E=0,v=0;i.readBool()&&(_=i.readUEG(),y=i.readUEG(),E=i.readUEG(),v=i.readUEG());let T=1,A=1,b=0,S=!0,w=0,D=0;if(i.readBool()){if(i.readBool()){let t=i.readByte(),e=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],s=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];t>0&&t<16?(T=e[t-1],A=s[t-1]):255===t&&(T=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){let t=i.readBits(32),e=i.readBits(32);S=i.readBool(),b=(w=e)/(D=2*t)}}let R=1;1===T&&1===A||(R=T/A);let x=0,U=0;if(0===h)x=1,U=2-g;else{x=3===h?1:2,U=(1===h?2:1)*(2-g)}let L=16*(p+1),O=16*(m+1)*(2-g);L-=(_+y)*x,O-=(E+v)*U;let M=Math.ceil(L*R);return i.destroy(),i=null,{profile_string:o,level_string:d,bit_depth:c,chroma_format:l,chroma_format_string:n.getChromaFormatString(l),frame_rate:{fixed:S,fps:b,fps_den:D,fps_num:w},par_ratio:{width:T,height:A},codec_size:{width:L,height:O},present_size:{width:M,height:O}}}static _skipScalingList(t,e){let i=8,s=8,r=0;for(let a=0;a<e;a++)0!==s&&(s=(i+(r=t.readSEG())+256)%256),i=0===s?i:s}static getProfileString(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(t){return(t/10).toFixed(1)}static getChromaFormatString(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}static toVideoMeta(t){let e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},e.frameRate=t.frame_rate;let i=e.frameRate.fps_den,s=e.frameRate.fps_num;return e.refSampleDuration=Math.floor(e.timescale*(i/s)),e}}e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.XgBuffer=class{constructor(t){this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}push(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}shift(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,e}let e=new Uint8Array(t),i=0;for(;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){let s=this.array[0].slice(this.offset,this.offset+t);e.set(s,i),this.offset+=t,this.length-=t,t=0;break}{let s=this.array[0].length-this.offset;e.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=s,this.length-=s,t-=s}}return e}clear(){this.array=[],this.length=0,this.offset=0}destroy(){this.clear(),this.historyLen=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(t,e){let i=0,s=this.offset+t;for(;s<this.offset+e+t;)s<this.array[0].length?i=256*i+this.array[0][s]:this.array[1]&&(i=256*i+this.array[1][s-this.array[0].length]),s++;return i}};e.RemuxBuffer=class{constructor(){this.video=[],this.audio=[]}destroy(){this.video=[],this.audio=[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(5),a=(s=r)&&s.__esModule?s:{default:s},n=i(6);const o="__TO__";e.default=class{constructor(t=[]){this._emitter=new n.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new a.default,this.allowedEvents=t,this._hooks={}}getInstance(t){const e=this._instanceMap[t];return e||null}initInstance(t,...e){if(this._clsMap[t]){const i=new this._clsMap[t](...e);return this._instanceMap[t]=i,i.init&&i.init(),i}throw new Error(`${t}未在context中注册`)}init(t){if(!this._inited){for(let e in this._clsMap)this._clsMap.hasOwnProperty(e)&&!this._instanceMap[e]&&this.initInstance(e,t);this._inited=!0}}registry(t,e){const i=this._emitter,s=this._isMessageNameValid.bind(this),r=this;return this._clsMap[t]=class extends e{constructor(...e){super(...e),this.listeners={},this.onceListeners={},this.TAG=t,this._context=r}on(e,r){return s(e),this.listeners[e]?this.listeners[e].push(r):this.listeners[e]=[r],i.on(`${e}${o}${t}`,r),i.on(e,r)}before(t,e){s(t),r._hooks[t]?r._hooks[t].push(e):r._hooks[t]=[e]}once(e,r){return s(e),this.onceListeners[e]?this.onceListeners[e].push(r):this.onceListeners[e]=[r],i.once(`${e}${o}${t}`,r),i.once(e,r)}emit(t,...e){s(t);const a=r._hooks?r._hooks[t]:null;if(a)for(let t=0,e=a.length;t<e;t++){(0,a[t])()}return i.emit(t,...e)}emitTo(t,e,...r){return s(e),i.emit(`${e}${o}${t}`,...r)}off(t,e){return s(t),i.off(t,e)}removeListeners(){const e=Object.prototype.hasOwnProperty.bind(this.listeners);for(let s in this.listeners)if(e(s)){const e=this.listeners[s]||[];for(let r=0;r<e.length;r++){const a=e[r];i.off(s,a),i.off(`${s}${o}${t}`,a)}}for(let s in this.onceListeners)if(e(s)){const e=this.onceListeners[s]||[];for(let r=0;r<e.length;r++){const a=e[r];i.off(s,a),i.off(`${s}${o}${t}`,a)}}}destroy(){if(this.removeListeners(),this.listeners={},delete r._instanceMap[t],super.destroy)return super.destroy()}},(...e)=>this.initInstance(t,...e)}destroyInstances(){Object.keys(this._instanceMap).forEach(t=>{this._instanceMap[t].destroy&&this._instanceMap[t].destroy()})}destroy(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}_isMessageNameValid(t){if(!this.allowedEvents.indexOf(t)<0)throw new Error(`unregistered message name: ${t}`)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}(),r={get device(){let t=r.os;return t.isPc?"pc":t.isTablet?"tablet":"mobile"},get browser(){let t=navigator.userAgent.toLowerCase(),e={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(e).filter(i=>e[i].test(t)))[0]},get os(){let t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),i=/(?:SymbianOS)/.test(t)||e,s=/(?:Android)/.test(t),r=/(?:Firefox)/.test(t),a=/(?:iPad|PlayBook)/.test(t)||s&&!/(?:Mobile)/.test(t)||r&&/(?:Tablet)/.test(t),n=/(?:iPhone)/.test(t)&&!a;return{isTablet:a,isPhone:n,isAndroid:s,isPc:!n&&!s&&!i,isSymbian:i,isWindowsPhone:e,isFireFox:r}},get isLe(){return s}};e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static decode(t){const e=[],i=t;let r=0;const a=t.length;for(;r<a;)if(i[r]<128)e.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(s._checkContinuation(i,r,1)){const t=(31&i[r])<<6|63&i[r+1];if(t>=128){e.push(String.fromCharCode(65535&t)),r+=2;continue}}}else if(i[r]<240){if(s._checkContinuation(i,r,2)){const t=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(t>=2048&&55296!=(63488&t)){e.push(String.fromCharCode(65535&t)),r+=3;continue}}}else if(i[r]<248&&s._checkContinuation(i,r,3)){let t=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(t>65536&&t<1114112){t-=65536,e.push(String.fromCharCode(t>>>10|55296)),e.push(String.fromCharCode(1023&t|56320)),r+=4;continue}}e.push(String.fromCharCode(65533)),++r}return e.join("")}static _checkContinuation(t,e,i){let s=t;if(e+i<s.length){for(;i--;)if(128!=(192&s[++e]))return!1;return!0}return!1}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){let e=s.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;let i=Object.assign({},e,t);Object.entries(i).forEach(([t,e])=>{this[t]=e})}static getDefaultInf(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}addRAP(t){t.isRAP=!0,this.randomAccessPoints.push(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this._type=t,this._list=[],this._lastAppendLocation=-1}get type(){return this._type}get length(){return this._list.length}isEmpty(){return 0===this._list.length}clear(){this._list=[],this._lastAppendLocation=-1}_searchNearestSegmentBefore(t){let e=this._list;if(0===e.length)return-2;let i=e.length-1,s=0,r=0,a=i,n=0;if(t<e[0].originDts)return n=-1;for(;r<=a;){if((s=r+Math.floor((a-r)/2))===i||t>e[s].lastSample.originDts&&t<e[s+1].originDts){n=s;break}e[s].originDts<t?r=s+1:a=s-1}return n}_searchNearestSegmentAfter(t){return this._searchNearestSegmentBefore(t)+1}append(t){let e=this._list,i=this._lastAppendLocation,s=0;-1!==i&&i<e.length&&t.originStartDts>=e[i].lastSample.originDts&&(i===e.length-1||i<e.length-1&&t.originStartDts<e[i+1].originStartDts)?s=i+1:e.length>0&&(s=this._searchNearestSegmentBefore(t.originStartDts)+1),this._lastAppendLocation=s,this._list.splice(s,0,t)}getLastSegmentBefore(t){let e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null}getLastSampleBefore(t){let e=this.getLastSegmentBefore(t);return null!==e?e.lastSample:null}getLastRAPBefore(t){let e=this._searchNearestSegmentBefore(t),i=this._list[e].randomAccessPoints;for(;0===i.length&&e>0;)e--,i=this._list[e].randomAccessPoints;return i.length>0?i[i.length-1]:null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}init(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}onTimeUpdate(){this.emit("TIME_UPDATE",this.container)}onWaiting(){this.emit("WAITING",this.container)}onSourceOpen(){this.addSourceBuffers()}onUpdateEnd(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}addSourceBuffers(){if("open"!==this.mediaSource.readyState)return;let t,e=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");e=e.sources;let s=!1;for(let r=0,a=Object.keys(e).length;r<a;r++){let a=Object.keys(e)[r];if("audio"===a?t=i.audioTrack:"video"===a&&(t=i.videoTrack),t){let i="audio"===a?21:40;t.meta&&t.meta.refSampleDuration&&(i=t.meta.refSampleDuration),e[a].data.length>=this.preloadTime/i&&(s=!0)}}if(s){if(Object.keys(this.sourceBuffers).length>0)return;for(let t=0,i=Object.keys(e).length;t<i;t++){let i=Object.keys(e)[t],s=e[i],r="video"===i?"video/mp4;codecs="+s.mimetype:"audio/mp4;codecs="+s.mimetype,a=this.mediaSource.addSourceBuffer(r);this.sourceBuffers[i]=a,a.addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}doAppend(){let t=this._context.getInstance("PRE_SOURCE_BUFFER");if(t)for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i=Object.keys(this.sourceBuffers)[e],s=this.sourceBuffers[i];if(!s.updating){let e=t.sources[i];if(e&&!e.inited)s.appendBuffer(e.init.buffer.buffer),e.inited=!0;else if(e){let t=e.data.shift();t&&s.appendBuffer(t.buffer.buffer)}}}}endOfStream(){const{readyState:t,activeSourceBuffers:e}=this.mediaSource;if("open"===t&&0===e.length)try{this.mediaSource.endOfStream()}catch(t){}}remove(t,e=0){for(let i=0;i<Object.keys(this.sourceBuffers).length;i++){let s=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];s.updating||s.remove(e,t)}}removeBuffers(){const t=[];for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i,r=this.sourceBuffers[Object.keys(this.sourceBuffers)[e]];r.removeEventListener("updateend",this.onUpdateEnd),r.updating?i=new Promise(t=>{const e=function(){let i=3;const a=()=>{r.updating?i>0?(setTimeout(a,200),i--):t():(s.clearBuffer(r),t())};setTimeout(a,200),r.removeEventListener("updateend",e)};r.addEventListener("updateend",e)}):(s.clearBuffer(r),i=Promise.resolve()),t.push(i)}return Promise.all(t)}destroy(){return this.removeBuffers().then(()=>{for(let t=0;t<Object.keys(this.sourceBuffers).length;t++){let e=this.sourceBuffers[Object.keys(this.sourceBuffers)[t]];this.mediaSource.removeSourceBuffer(e),delete this.sourceBuffers[Object.keys(this.sourceBuffers)[t]]}this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.endOfStream(),window.URL.revokeObjectURL(this.url),this.url=null,this.configs={},this.container=null,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=1})}static clearBuffer(t){const e=t.buffered;let i=.1;for(let t=0,s=e.length;t<s;t++)i=e.end(t);try{t.remove(0,i)}catch(t){}}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(24),a=(s=r)&&s.__esModule?s:{default:s};e.default=class{constructor(t){this.buffer=t||new Uint8Array(0)}write(...t){t.forEach(t=>{this.buffer=(0,a.default)(Uint8Array,this.buffer,t)})}static writeUint32(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t])}static readAsInt(t){let e="";return t.forEach(t=>{e+=function(t){return t.toString(16).padStart(2,"0")}(t)}),parseInt(e,16)}}},function(t,e,i){"use strict";var s,r=i(25),a=(s=r)&&s.__esModule?s:{default:s};t.exports=a.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=0,i=arguments.length,s=Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];var a=!0,n=!1,o=void 0;try{for(var d,h=s[Symbol.iterator]();!(a=(d=h.next()).done);a=!0){var l=d.value;e+=l.length}}catch(t){n=!0,o=t}finally{try{!a&&h.return&&h.return()}finally{if(n)throw o}}var u=new t(e),c=0,f=!0,p=!1,m=void 0;try{for(var g,_=s[Symbol.iterator]();!(f=(g=_.next()).done);f=!0){var y=g.value;u.set(y,c),c+=y.length}}catch(t){p=!0,m=t}finally{try{!f&&_.return&&_.return()}finally{if(p)throw m}}return u}},function(t,e,i){"use strict";var s=n(i(27)),r=n(i(33)),a=i(34);function n(t){return t&&t.__esModule?t:{default:t}}class o{constructor(t){this.aCtx=t.aCtx,this.vCtx=t.vCtx,this.timeoutId=null,this.start=null}doReconcile(){const t=(this.vCtx.currentTime||0)-1e3*(this.aCtx.currentTime||0);this.timeoutId||(t>200?(this.start+=t,this.vCtx.pause(),this.timeoutId=setTimeout(()=>{this.vCtx.play(),this.timeoutId=null},t)):t<-120&&(this.vCtx.currentTime=this.vCtx.currentTime+Math.abs(t)))}destroy(){this.aCtx=null,this.vCtx=null}}class d extends HTMLElement{constructor(t){super();this.vCtx=new s.default,this.aCtx=new r.default(t),this.ticker=new((0,a.getTicker)()),this.historyTime=0,this.reconciler=new o({vCtx:this.vCtx,aCtx:this.aCtx}),this.handleAudioSourceEnd=this.handleAudioSourceEnd.bind(this),this.init()}init(){this.vCtx.oncanplay=()=>{this.appendChild(this.vCtx.canvas),this.dispatchEvent(new Event("canplay"))},this.ticker.start(()=>{this.start||(this.start=Date.now()),this.vCtx._onTimer(Date.now()-this.start)}),this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}handleAudioSourceEnd(){this.reconciler.doReconcile()}_cleanBuffer(){this.vCtx.cleanBuffer()}destroy(){this.reconciler.destroy()}onDemuxComplete(t,e){this.aCtx.decodeAudio(e),this.vCtx.decodeVideo(t)}setAudioMeta(t){this.aCtx.setAudioMetaData(t)}setVideoMeta(t){this.vCtx.setVideoMetaData(t)}get currentTime(){}play(){this.vCtx.play(),this.aCtx.play()}}customElements.define("mobile-video",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(28)),r=d(i(10)),a=d(i(11)),n=d(i(30)),o=d(i(31));function d(t){return t&&t.__esModule?t:{default:t}}e.default=class{constructor(t){this.config=Object.assign({},t),this.canvas=this.config.canvas?this.config.canvas:document.createElement("canvas"),this.source=new o.default({type:"video"}),this.preloadTime=this.config.preloadTime||3,this.oncanplay=void 0,this.onFirstFrame=void 0,this.meta=void 0,this.readyStatus=0,this.paused=!0,this.count=0,this.currentTime=0,this.lastPlayed=0,this._decoderInited=!1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null}pause(){this.paused=!0}initWasmWorker(){let t=this;this.wasmworker=(0,s.default)(32),this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",e=>{switch(e.data.msg){case"DECODER_READY":t._decoderInited=!0;break;case"DECODED":this._onDecoded(e.data)}})}setVideoMetaData(t){if(this.meta=t,!this._decoderInited)return void this.initWasmWorker();this._avccpushed=!0;let e=new Uint8Array(t.sps.byteLength+4);if(e.set([0,0,0,1]),e.set(t.sps,4),this.wasmworker.postMessage({msg:"decode",data:e}),(e=new Uint8Array(t.pps.byteLength+4)).set([0,0,0,1]),e.set(t.pps,4),this.wasmworker.postMessage({msg:"decode",data:e}),!this.yuvCanvas){let e=Object.assign({meta:t,canvas:this.canvas},this.config);this.yuvCanvas=new n.default(e)}this.readyStatus=1}decodeVideo(t){if(!this._decoderInited)return void this.initWasmWorker();this._avccpushed||this.setVideoMetaData(this.meta);let{samples:e}=t,i=e.shift();for(;i;)this._baseDts||(this._baseDts=i.dts),this.source.push(i),i=e.shift();this._preload()}_preload(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){let t=this.source.get();for(t&&(this._lastSampleDts=t.dts,this._analyseNal(t));t&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(t=this.source.get())&&(this._analyseNal(t),this._lastSampleDts=t.dts)}}_analyseNal(t){let e=a.default.getAvccNals(new r.default(t.data.buffer)),i=0;for(let t=0;t<e.length;t++){i+=e[t].body.byteLength+4}let s=0,n=new Uint8Array(i);for(let t=0;t<e.length;t++){let i=e[t];n.set([0,0,0,1],s),s+=4,n.set(new Uint8Array(i.body),s),s+=i.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:n,info:{dts:t.dts,pts:t.pts?t.pts:t.dts+t.cts,key:t.isKeyframe}})}_onDecoded(t){let{dts:e}=t.info;this._decodedFrames[e]=t}play(){this.paused=!1,this._onTimer()}_onTimer(t){if(!this.paused){if(this.meta){this.meta.frameRate&&this.meta.frameRate.fixed&&this.meta.frameRate.fps;let e=Object.keys(this._decodedFrames);if(e.length>0){this.currentTime=t;let i=-1,s=0;for(let t=0;t<e.length&&Number.parseInt(e[t])-this._baseDts<=this.currentTime;t++)i=Number.parseInt(e[t-1]),s=t;let r=this._decodedFrames[i];if(r){this.oncanplay&&this.readyStatus<4&&(this.oncanplay(),this.readyStatus=4),console.log(i),this.yuvCanvas.render(r.buffer,r.width,r.height);for(let t=0;t<s;t++)delete this._decodedFrames[t]}}}this._lastRenderTime=Date.now()}}cleanBuffer(){this.source.remove(0,this.currentTime)}}},function(t,e,i){"use strict";function s(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var s=i(i.s=ENTRY_MODULE);return s.default||s}var r="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+r+").*?\\)";function n(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,s){var o={};o[s]=[];var d=e.toString(),h=d.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!h)return o;for(var l,u=h[1],c=new RegExp("(\\\\n|\\W)"+n(u)+a,"g");l=c.exec(d);)"dll-reference"!==l[3]&&o[s].push(l[3]);for(c=new RegExp("\\("+n(u)+'\\("(dll-reference\\s('+r+'))"\\)\\)'+a,"g");l=c.exec(d);)t[l[2]]||(o[s].push(l[1]),t[l[2]]=i(l[1]).m),o[l[2]]=o[l[2]]||[],o[l[2]].push(l[4]);for(var f,p=Object.keys(o),m=0;m<p.length;m++)for(var g=0;g<o[p[m]].length;g++)f=o[p[m]][g],isNaN(1*f)||(o[p[m]][g]=1*o[p[m]][g]);return o}function d(t){return Object.keys(t).reduce((function(e,i){return e||t[i].length>0}),!1)}t.exports=function(t,e){e=e||{};var r={main:i.m},a=e.all?{main:Object.keys(r.main)}:function(t,e){for(var i={main:[e]},s={main:[]},r={main:{}};d(i);)for(var a=Object.keys(i),n=0;n<a.length;n++){var h=a[n],l=i[h].pop();if(r[h]=r[h]||{},!r[h][l]&&t[h][l]){r[h][l]=!0,s[h]=s[h]||[],s[h].push(l);for(var u=o(t,t[h][l],h),c=Object.keys(u),f=0;f<c.length;f++)i[c[f]]=i[c[f]]||[],i[c[f]]=i[c[f]].concat(u[c[f]])}}return s}(r,t),n="";Object.keys(a).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;a[t][e];)e++;a[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map((function(e){return JSON.stringify(e)+": "+r[t][e].toString()})).join(",")+"});\n"})),n=n+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map((function(t){return JSON.stringify(t)+": "+r.main[t].toString()})).join(",")+"}))(self);";var h=new window.Blob([n],{type:"text/javascript"});if(e.bare)return h;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),u=new window.Worker(l);return u.objectURL=l,u}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}destroy(){this._buffer=null}_fillCurrentWord(){let t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(i.buffer).getUint32(0),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}readBits(t){let e=Math.min(this._currentWordBitsLeft,t),i=this._currentWord>>>32-e;if(t>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=e,this._currentWordBitsLeft>0?this._currentWord<<=e:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(e=t-e)>0&&this._currentWordBitsLeft?i<<e|this.readBits(e):i}readBool(){return 1===this.readBits(1)}readByte(){return this.readBits(8)}_skipLeadingZero(){let t;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}readUEG(){let t=this._skipLeadingZero();return this.readBits(t+1)-1}readSEG(){let t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.configs=Object.assign({},t),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this.chroma=this.meta.chromaFormat,this.height=this.meta.presentHeight,this.width=this.meta.presentWidth,this.canvas.width=1280,this.canvas.height=720,this.canvas.style.width="100%",this.canvas.style.height="100%",this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}_initContextGL(){for(var t=this.canvas,e=null,i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],s=0;!e&&s<i.length;){var r=i[s];try{e=this.contextOptions?t.getContext(r,this.contextOptions):t.getContext(r)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++s}this.contextGL=e}_initProgram(){var t,e,i=this.contextGL;t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),e=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var s=i.createShader(i.VERTEX_SHADER);i.shaderSource(s,t),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+i.getShaderInfoLog(s));var r=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(r,e),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+i.getShaderInfoLog(r));var a=i.createProgram();i.attachShader(a,s),i.attachShader(a,r),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)||console.log("Program failed to compile: "+i.getProgramInfoLog(a)),i.useProgram(a);var n=i.getUniformLocation(a,"YUV2RGB");i.uniformMatrix4fv(n,!1,[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1]),this.shaderProgram=a}_initBuffers(){var t=this.contextGL,e=this.shaderProgram,i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var a=t.getAttribLocation(e,"texturePos");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.texturePosBuffer=r;var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var o=t.getAttribLocation(e,"uTexturePos");t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.uTexturePosBuffer=n;var d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var h=t.getAttribLocation(e,"vTexturePos");t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0),this.vTexturePosBuffer=d}_initTextures(){var t=this.contextGL,e=this.shaderProgram,i=this._initTexture(),s=t.getUniformLocation(e,"ySampler");t.uniform1i(s,0),this.yTextureRef=i;var r=this._initTexture(),a=t.getUniformLocation(e,"uSampler");t.uniform1i(a,1),this.uTextureRef=r;var n=this._initTexture(),o=t.getUniformLocation(e,"vSampler");t.uniform1i(o,2),this.vTextureRef=n}_initTexture(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e}_drawPictureGL(t,e,i){let s=e;var r=e*i,a=r/4;422===this.chroma?a=r/2:444===this.chroma&&(a=r);let n={yData:(t=new Uint8Array(t)).subarray(0,r),uData:t.subarray(r,r+a),vData:t.subarray(r+a,r+a+a)};if(e%4>0){s=e+4-e%4;let t=new Uint8Array(s*i);for(let r=0;r<i;r++)t.set(n.yData.subarray(r*e,(r+1)*e),r*s);n.yData=t}if(e/2%4>0){s=e/2+4-e/2%4;let t=new Uint8Array(s*i/2),r=new Uint8Array(s*i/2);for(let a=0;a<i/2;a++)t.set(n.uData.subarray(a*e/2,(a+1)*e/2),a*s),r.set(n.vData.subarray(a*e/2,(a+1)*e/2),a*s);n.uData=t,n.vData=r}this._drawPictureGL420(n,e,i)}_drawPictureGL420(t,e,i){var s=this.contextGL,r=this.texturePosBuffer,a=this.uTexturePosBuffer,n=this.vTexturePosBuffer,o=this.yTextureRef,d=this.uTextureRef,h=this.vTextureRef,l=t.yData,u=t.uData,c=t.vData,f=e,p=i,m=e/2,g=i/2;422!==this.chroma&&444!==this.chroma||(g=i),444===this.chroma&&(m=e);var _=m,y=g;let E=this.canvas.width/this.width,v=this.canvas.height/this.height,T=0,A=0,b=this.canvas.width,S=this.canvas.height;E<v?(S=this.height*this.canvas.width/this.width,A=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(b=this.width*this.canvas.height/this.height,T=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),s.viewport(T,A,b,S);var w=new Float32Array([1,0,0,0,1,1,0,1]);s.bindBuffer(s.ARRAY_BUFFER,r),s.bufferData(s.ARRAY_BUFFER,w,s.DYNAMIC_DRAW);var D=new Float32Array([1,0,0,0,1,1,0,1]);s.bindBuffer(s.ARRAY_BUFFER,a),s.bufferData(s.ARRAY_BUFFER,D,s.DYNAMIC_DRAW);var R=new Float32Array([1,0,0,0,1,1,0,1]);s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,R,s.DYNAMIC_DRAW),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,o),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,f,p,0,s.LUMINANCE,s.UNSIGNED_BYTE,l),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,d),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,m,g,0,s.LUMINANCE,s.UNSIGNED_BYTE,u),s.activeTexture(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,h),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,_,y,0,s.LUMINANCE,s.UNSIGNED_BYTE,c),s.drawArrays(s.TRIANGLE_STRIP,0,4)}_drawPictureRGB(t){}render(t,e,i){this.contextGL?this._drawPictureGL(t,e,i):this._drawPictureRGB(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.config=Object.assign({},t),this.type=this.config.type,this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}push(t){if("video"===this.type){if(t.isKeyframe){let e={samples:[],start:t.dts,end:t.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=e),this.currentGop=e,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(t),t.dts<this.currentGop.start&&(this.currentGop.start=t.dts),t.dts>this.currentGop.end&&(this.currentGop.end=t.dts))}}get(t){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===t){return this._getNext()}}}_getNext(){if(this._lastGet){let t=this._lastGet.gop,e=t.samples[this._lastGet.index+1];if(e)return this._lastGet.index=this._lastGet.index+1,e;if(!(t=t.nextGop)||t.samples.length<1)return;return e=t.samples[0],this._lastGet={gop:t,index:0},e}{let t=this.buffer[0];if(t.samples.length<1)return;return this._lastGet={gop:t,index:0},t.samples[0]}}remove(t,e){if(this.buffer.length<0)return;let i=0,s=this.buffer[0];for(;s;)s.end<e&&s.start>=t?(delete this.buffer[i],s=this.buffer[i]):(i+=1,s=this.buffer[i])}}},function(t,e,i){"use strict";var s,r=function(t){this.inited=!1,this.self=t,this.meta=this.self.meta,this.infolist={},t.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),t.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};function a(){(s=new r(this)).init()}function n(t){self.importScripts("https://sf6-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder.js"),addOnPostRun(a.bind(self))}r.prototype.toU8Array=function(t,e){return this.self.HEAPU8.subarray(t,t+e)},r.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},r.prototype.broadwayOnPictureDecoded=function(t,e,i,s){let r=Object.assign({},this.infolist[s]),a=3;420===this.meta.chromaFormat?a=1.5:422===this.meta.chromaFormat&&(a=2);let n=this.toU8Array(t,e*i*a);this.infolist[s]=null;let o=new Uint8Array(n.length);o.set(n);let d=o.buffer;this.self.postMessage({msg:"DECODED",width:e,height:i,info:r,buffer:d},[d])},r.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},r.prototype.decode=function(t,e){let i=parseInt((new Date).getTime()),s=i-1e9*Math.floor(i/1e9);this.infolist[s]=e,this.streamBuffer.set(t),Module._broadwayPlayStream(t.length,s)},t.exports=function(t){t.addEventListener("message",(function(e){var i=e.data;if(i.msg)switch(i.msg){case"init":console.log(i),t.meta=i.meta,n();break;case"decode":s.decode(i.data,i.info)}else t.postMessage({msg:"ERROR:invalid message"})}),!1)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(6),a=(s=r)&&s.__esModule?s:{default:s};class n extends a.default{constructor(t){super(),this.config=Object.assign({},t);let e=window.AudioContext||window.webkitAudioContext;this.context=new e,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.meta=void 0,this.samples=[],this.preloadTime=this.config.preloadTime||3,this.duration=0,this._currentBuffer=void 0,this._nextBuffer=void 0,this._lastpts=void 0,this._preDecode=[],this._currentTime=0,this._decoding=!1,this._played=!1}get currentTime(){return this._currentTime}decodeAudio(t){let{samples:e}=t,i=e;t.samples=[],this.setAudioData(i)}setAudioData(t){for(let e=0;e<t.length;e++)t[e].pts=void 0===t[e].pts?t[e].dts:t[e].pts,this._preDecode.push(t[e]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}decodeAAC(){if(this._decoding)return;this._decoding=!0;let t=this._preDecode,e=[],i=this,s=t.shift();for(;s;){let i=n.getAACData(this.meta,s);e.push(i),this._lastpts=s.pts,s=t.shift()}let r=n.combileData(e);try{this.context.decodeAudioData(r.buffer,(function(t){let e=i.context.createBufferSource();e.buffer=t,e.onended=i.onSourceEnded.bind(i),i.samples.push({time:i.duration,duration:t.duration,data:e}),i.duration+=t.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime),i._played&&i.play()),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC()}))}catch(t){console.error(t)}}onSourceEnded(){if(!this._nextBuffer||!this._played)return;let t=this._nextBuffer.data;t.start(),t.connect(this.gainNode),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}play(){if(this._played=!0,!this._currentBuffer)return;let t=this._currentBuffer.data;t.connect(this.gainNode),t.start()}getTimeBuffer(t){let e;for(let i=0;i<this.samples.length;i++){let s=this.samples[i];if(s.time<=t&&s.time+s.duration>t){e=s;break}}return e}setAudioMetaData(t){this.meta=t}static getAACData(t,e){let i=new Uint8Array(e.data.byteLength+7),s=n.getAdts(t,e.data);return i.set(s),i.set(e.data,7),i}static combileData(t){let e=0;for(let i=0,s=t.length;i<s;i++)e+=t[i].byteLength;let i=new Uint8Array(e),s=0;for(let e=0,r=t.length;e<r;e++)i.set(t[e],s),s+=t[e].byteLength;return i}static getAdts(t,e){let i=new Uint8Array(7);i[0]=255,i[1]=240,i[1]=1|i[1],i[2]=192&t.objectType-1<<6,i[2]=i[2]|60&t.sampleRateIndex<<2,i[2]=i[2]|1&t.channelCount>>2,i[3]=192&t.channelCount<<6;let s=e.byteLength+7;return i[3]=i[3]|3&s>>11,i[4]=255&s>>3,i[5]=224&s<<5,i[5]=31|i[5],i[6]=252,i}}e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.options=Object.assign({},t||{},{interval:16}),this.callbacks=[]}start(...t){this.callbacks=t}onTick(){for(let t=0,e=this.callbacks.length;t<e;t++){(0,this.callbacks[t])()}}setInterval(t){return this.options.interval=t,this}}class r extends s{constructor(t){super(t),this.prev=null,this.timerId=null,this._subTimerId=null,this._tickFunc=r.getTickFunc(),this.tick=this.tick.bind(this)}start(...t){super.start(...t),this.tick()}tick(t){this.nextTick(),this.onTick()}nextTick(){const{_tickFunc:t}=this;this.timerId=t(this.tick)}stop(){if(this.timerId){r.getCancelFunc()(this.timerId)}}static getTickFunc(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}static getCancelFunc(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}static isSupported(){return void 0!==r.getTickFunc()}}class a extends s{constructor(t){super(t),this.timeoutId=null}start(...t){super.nextTick(...t),this.timeoutId=window.setInterval(()=>{this.onTick()},this.options.interval||16)}stop(){this.timeoutId&&window.clearInterval(this.timeoutId)}}e.getTicker=()=>r.isSupported()?r:a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(7);const a=((s=r)&&s.__esModule?s:{default:s}).default.CRYTO_EVENTS;e.default=class{constructor(t){this.inputBuffer=t.inputbuffer,this.outputBuffer=t.outputbuffer,this.key=t.key,this.iv=t.iv,this.method=t.method,this.crypto=window.crypto||window.msCrypto}init(){this.on(a.START_DECRYPT,this.decript.bind(this))}decript(){if(this.aeskey)this.decriptData();else{this.crypto.subtle.importKey("raw",this.key.buffer,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(t=>{this.aeskey=t,this.decriptData()})}}decriptData(){let t=this._context.getInstance(this.inputBuffer),e=this._context.getInstance(this.outputBuffer),i=t.shift();i&&this.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv.buffer},this.aeskey,i).then(t=>{e.push(new Uint8Array(t)),this.emit(a.DECRYPTED),this.decriptData(i)})}}},function(t,e,i){"use strict";t.exports={Mp4Remuxer:i(37).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(0),a=i(38),n=(s=a)&&s.__esModule?s:{default:s};const o=r.EVENTS.REMUX_EVENTS;class d{constructor(){this._dtsBase=0,this._isDtsBaseInited=!1,this.isFirstVideo=!0,this.isFirstAudio=!0,this.videoAllDuration=0,this.audioAllDuration=0}init(){this.on(o.REMUX_MEDIA,this.remux.bind(this)),this.on(o.REMUX_METADATA,this.onMetaDataReady.bind(this)),this.on(o.DETECT_CHANGE_STREAM,this.resetDtsBase.bind(this))}destroy(){this._dtsBase=-1,this._dtsBaseInited=!1}reset(){this._dtsBase=0,this._isDtsBaseInited=!1}remux(){const{audioTrack:t,videoTrack:e}=this._context.getInstance("TRACKS");!this._isDtsBaseInited&&this.calcDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)}resetDtsBase(){this._dtsBase=0,this._dtsBaseInited=!1}seek(){}onMetaDataReady(t){let e;if("audio"===t){const{audioTrack:t}=this._context.getInstance("TRACKS");e=t}else{const{videoTrack:t}=this._context.getInstance("TRACKS");e=t}let i=this._context.getInstance("PRE_SOURCE_BUFFER"),s=i.getSource(t);s||(s=i.createSource(t)),s.mimetype=e.meta.codec,s.init=this.remuxInitSegment(t,e.meta),this.emit(o.INIT_SEGMENT,t)}remuxInitSegment(t,e){let i=new r.Buffer,s=n.default.ftyp(),a=n.default.moov({type:t,meta:e});return i.write(s,a),i}calcDtsBase(t,e){if(!t.samples.length&&!e.samples.length)return;let i=1/0,s=1/0;t.samples&&t.samples.length&&(i=t.samples[0].dts),e.samples&&e.samples.length&&(s=e.samples[0].dts),this._dtsBase=Math.min(i,s),this._isDtsBaseInited=!0}_remuxVideo(t){const e=t;if(!t.samples||!t.samples.length)return;let{samples:i}=e,s=-1,a=null;const d=[],h={samples:[]};for(;i.length;){const t=i.shift(),{isKeyframe:e,options:r}=t;if(!this.isFirstAudio&&r&&r.meta){a=this.remuxInitSegment("video",r.meta),r.meta=null,i.unshift(t),r.isContinue||this.resetDtsBase();break}let n,o,l=t.dts-this._dtsBase;-1===s&&(s=l),void 0!==t.pts&&(n=(o=t.pts-this._dtsBase)-l),void 0!==t.cts&&(o=t.cts+l,n=t.cts);let u={buffer:[],size:0};h.samples.push(u),u.buffer.push(t.data),u.size+=t.data.byteLength;let c=0;if(i.length>=1){c=i[0].dts-this._dtsBase-l}else c=d.length>=1?d[d.length-1].duration:this.videoMeta.refSampleDuration;this.videoAllDuration+=c,d.push({dts:l,cts:n,pts:o,data:t.data,size:t.data.byteLength,isKeyframe:e,duration:c,flags:{isLeading:0,dependsOn:e?2:1,isDependedOn:e?1:0,hasRedundancy:0,isNonSync:e?0:1},originDts:l,type:"video"})}let l=new r.Buffer;if(d.length){const t=n.default.moof({id:e.meta.id,time:s,samples:d}),i=n.default.mdat(h);l.write(t,i),this.writeToSource("video",l)}if(a&&(this.writeToSource("video",a),i.length))return e.samples=i,this._remuxVideo(e);this.isFirstVideo=!1,this.emit(o.MEDIA_SEGMENT,"video");const u=d[d.length-1];this._videoNextDts=u.dts+u.duration,e.samples=[],e.length=0}_remuxAudio(t){const{samples:e}=t;let i=-1,s=[],a=null;const d={samples:[]};if(!e||!e.length)return;let h=!1;for(;e.length;){let t=e.shift();const{data:r,options:n}=t;if(!this.isFirstAudio&&n&&n.meta){a=this.remuxInitSegment("audio",n.meta),n.meta=null,e.unshift(t),n.isContinue||this.resetDtsBase();break}let o=t.dts-this._dtsBase;const l=o;h||(i=o,h=!0);let u=0;if(this.audioMeta.refSampleDurationFixed)u=this.audioMeta.refSampleDurationFixed;else if(e.length>=1){u=e[0].dts-this._dtsBase-o}else u=s.length>=1?s[s.length-1].duration:this.audioMeta.refSampleDuration;this.audioAllDuration+=u;const c={dts:o,pts:o,cts:0,size:r.byteLength,duration:t.duration?t.duration:u,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:l,type:"audio"};let f={buffer:[],size:0};f.buffer.push(r),f.size+=r.byteLength,d.samples.push(f),s.push(c)}const l=new r.Buffer;if(s.length){const e=n.default.moof({id:t.meta.id,time:i,samples:s}),r=n.default.mdat(d);l.write(e,r),this.writeToSource("audio",l)}if(a&&(this.writeToSource("audio",a),e.length))return t.samples=e,this._remuxAudio(t);this.isFirstAudio=!1,this.emit(o.MEDIA_SEGMENT,"audio",l);const u=s[s.length-1];this._videoNextDts=u.dts+u.duration,t.samples=[],t.length=0}writeToSource(t,e){let i=this._context.getInstance("PRE_SOURCE_BUFFER"),s=i.getSource(t);s||(s=i.createSource(t)),s.data.push(e)}initSilentAudio(t,e){const i=d.getSilentFrame(this.audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:e,unit:i,size:i.byteLength,originDts:t,type:"video"}}get videoMeta(){return this._context.getInstance("TRACKS").videoTrack.meta}get audioMeta(){return this._context.getInstance("TRACKS").audioTrack.meta}static getSilentFrame(t){return 1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0);class r{static size(t){return s.Buffer.writeUint32(t)}static initBox(t,e,...i){const a=new s.Buffer;return a.write(r.size(t),r.type(e),...i),a.buffer}static extension(t,e){return new Uint8Array([t,e>>16&255,e>>8&255,255&e])}static ftyp(){return r.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}static moov({type:t,meta:e}){let i,s=8,a=r.mvhd(e.duration,e.timescale);i="video"===t?r.videoTrak(e):r.audioTrak(e);let n=r.mvex(e.duration,e.timescale||1e3,e.id);return[a,i,n].forEach(t=>{s+=t.byteLength}),r.initBox(s,"moov",a,i,n)}static mvhd(t,e=1e3){let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r.initBox(8+i.length,"mvhd",new Uint8Array(i))}static videoTrak(t){let e=8,i=r.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),s=r.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[i,s].forEach(t=>{e+=t.byteLength}),r.initBox(e,"trak",i,s)}static audioTrak(t){let e=8,i=r.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),s=r.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[i,s].forEach(t=>{e+=t.byteLength}),r.initBox(e,"trak",i,s)}static tkhd(t){let e=t.id,i=t.duration,s=t.width,a=t.height,n=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>>8&255,255&s,0,0,a>>>8&255,255&a,0,0]);return r.initBox(8+n.byteLength,"tkhd",n)}static edts(t){let e=new s.Buffer,i=t.duration,a=t.mediaTime;return e.write(r.size(36),r.type("edts")),e.write(r.size(28),r.type("elst")),e.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,1])),e.buffer}static mdia(t){let e=8,i=r.mdhd(t.timescale,t.duration),s=r.hdlr(t.type),a=r.minf(t);return[i,s,a].forEach(t=>{e+=t.byteLength}),r.initBox(e,"mdia",i,s,a)}static mdhd(t=1e3,e){let i=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,85,196,0,0]);return r.initBox(12+i.byteLength,"mdhd",r.extension(0,0),i)}static hdlr(t){let e=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(e.splice(8,4,115,111,117,110),e.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),r.initBox(8+e.length,"hdlr",new Uint8Array(e))}static minf(t){let e=8,i="video"===t.type?r.vmhd():r.smhd(),s=r.dinf(),a=r.stbl(t);return[i,s,a].forEach(t=>{e+=t.byteLength}),r.initBox(e,"minf",i,s,a)}static vmhd(){return r.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}static smhd(){return r.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}static dinf(){let t=new s.Buffer;return t.write(r.size(36),r.type("dinf"),r.size(28),r.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}static stbl(t){let e=8,i=r.stsd(t),s=r.stts(),a=r.stsc(),n=r.stsz(),o=r.stco();return[i,s,a,n,o].forEach(t=>{e+=t.byteLength}),r.initBox(e,"stbl",i,s,a,n,o)}static stsd(t){let e;return e="audio"===t.type?r.mp4a(t):r.avc1(t),r.initBox(16+e.byteLength,"stsd",r.extension(0,0),new Uint8Array([0,0,0,1]),e)}static mp4a(t){let e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=r.esds(t.config);return r.initBox(8+e.byteLength+i.byteLength,"mp4a",e,i)}static esds(t=[43,146,8,0]){const e=t.length;let i=new s.Buffer,a=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return i.write(r.size(8+a.byteLength),r.type("esds"),a),i.buffer}static avc1(t){let e=new s.Buffer,i=t.width,a=t.height,n=t.parRatio.height,o=t.parRatio.width,d=t.avcc,h=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),u=new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o]);return e.write(r.size(40+h.byteLength+d.byteLength+l.byteLength),r.type("avc1"),h,r.size(8+d.byteLength),r.type("avcC"),d,r.size(20),r.type("btrt"),l,r.size(16),r.type("pasp"),u),e.buffer}static stts(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return r.initBox(16,"stts",t)}static stsc(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return r.initBox(16,"stsc",t)}static stco(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return r.initBox(16,"stco",t)}static stsz(){let t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return r.initBox(20,"stsz",t)}static mvex(t,e=1e3,i){let a=new s.Buffer,n=s.Buffer.writeUint32(t);return a.write(r.size(56),r.type("mvex"),r.size(16),r.type("mehd"),r.extension(0,0),n,r.trex(i)),a.buffer}static trex(t){let e=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return r.initBox(8+e.byteLength,"trex",e)}static moof(t){let e=8,i=r.mfhd(),s=r.traf(t);return[i,s].forEach(t=>{e+=t.byteLength}),r.initBox(e,"moof",i,s)}static mfhd(){let t=s.Buffer.writeUint32(r.sequence);return r.sequence+=1,r.initBox(16,"mfhd",r.extension(0,0),t)}static traf(t){let e=8,i=r.tfhd(t.id),s=r.tfdt(t.time),a=r.sdtp(t),n=r.trun(t,a.byteLength);return[i,s,n,a].forEach(t=>{e+=t.byteLength}),r.initBox(e,"traf",i,s,n,a)}static tfhd(t){let e=s.Buffer.writeUint32(t);return r.initBox(16,"tfhd",r.extension(0,0),e)}static tfdt(t){return r.initBox(16,"tfdt",r.extension(0,0),s.Buffer.writeUint32(t))}static trun(t,e){let i=new s.Buffer,a=s.Buffer.writeUint32(t.samples.length),n=s.Buffer.writeUint32(92+16*t.samples.length+e);return i.write(r.size(20+16*t.samples.length),r.type("trun"),new Uint8Array([0,0,15,1]),a,n),t.samples.forEach(t=>{const e=t.flags;i.write(new Uint8Array([t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,t.size>>>24&255,t.size>>>16&255,t.size>>>8&255,255&t.size,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.isNonSync,0,0,t.cts>>>24&255,t.cts>>>16&255,t.cts>>>8&255,255&t.cts]))}),i.buffer}static sdtp(t){let e=new s.Buffer;return e.write(r.size(12+t.samples.length),r.type("sdtp"),r.extension(0,0)),t.samples.forEach(t=>{const i=t.flags,s=i.isLeading<<6|i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;e.write(new Uint8Array([s]))}),e.buffer}static mdat(t){let e=new s.Buffer,i=8;t.samples.forEach(t=>{i+=t.size}),e.write(r.size(i),r.type("mdat"));let a=new Uint8Array(i),n=0;return a.set(e.buffer,n),n+=8,t.samples.forEach(t=>{t.buffer.forEach(t=>{a.set(t,n),n+=t.byteLength})}),a}}r.type=t=>new Uint8Array([t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]),r.sequence=1,e.default=r},function(t,e,i){"use strict";t.exports={FetchLoader:i(40).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0).EVENTS.LOADER_EVENTS,r=0,a=1,n=2,o=3;e.default=class{constructor(t){this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}init(){this.on(s.LADER_START,this.load.bind(this))}static get type(){return"loader"}load(t,e){let i=this;this.url=t,this._canceled=!1;let r=this.getParams(e);return i.loading=!0,fetch(this.url,r).then((function(t){if(t.ok)return i.status=t.status,i._onFetchResponse(t);i.loading=!1,i.emit(s.LOADER_ERROR,i.TAG,new Error("invalid response."))})).catch((function(t){throw i.loading=!1,i.emit(s.LOADER_ERROR,i.TAG,t),new Error(t.message)}))}_onFetchResponse(t){let e=this,i=this._context.getInstance(this.buffer);this._loaderTaskNo++;let d=this._loaderTaskNo;if(!0===t.ok)switch(this.readtype){case n:t.json().then(t=>{e.loading=!1,e._canceled||e._destroyed||(i?(i.push(t),e.emit(s.LOADER_COMPLETE,i)):e.emit(s.LOADER_COMPLETE,t))});break;case a:t.text().then(t=>{e.loading=!1,e._canceled||e._destroyed||(i?(i.push(t),e.emit(s.LOADER_COMPLETE,i)):e.emit(s.LOADER_COMPLETE,t))});break;case o:t.arrayBuffer().then(t=>{e.loading=!1,e._canceled||e._destroyed||(i?(i.push(new Uint8Array(t)),e.emit(s.LOADER_COMPLETE,i)):e.emit(s.LOADER_COMPLETE,t))});break;case r:default:return this._onReader(t.body.getReader(),d)}}_onReader(t,e){let i=this._context.getInstance(this.buffer);if(!i&&this._reader||this._destroyed)try{this._reader.cancel()}catch(t){}if(this._reader=t,!1===this.loading)return;let r=this;this._reader&&this._reader.read().then((function(a){if(a.done)return r.loading=!1,r.status=0,void r.emit(s.LOADER_COMPLETE,i);if(!r._canceled&&!r._destroyed)return i.push(a.value),r.emit(s.LOADER_DATALOADED,i),r._onReader(t,e);if(r._reader)try{r._reader.cancel()}catch(t){}})).catch(t=>{r.loading=!1,r.emit(s.LOADER_ERROR,r.TAG,t)})}getParams(t){let e=Object.assign({},t),i=new Headers,s={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let t=this.configs.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}if("object"==typeof e.headers){let t=e.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}return!1===e.cors&&(s.mode="same-origin"),e.withCredentials&&(s.credentials="include"),s}cancel(){if(this._reader){try{this._reader.cancel()}catch(t){}this._reader=null,this.loading=!1,this._canceled=!0}}destroy(){this._destroyed=!0,this.cancel()}}},function(t,e,i){"use strict";t.exports={M3U8Parser:i(42).default,TsDemuxer:i(43).default,Playlist:i(47).default,FlvDemuxer:i(48).default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static parse(t,e=""){let i={duration:0};if(!t||!t.split)return;let r=t.split(/\r|\n/),a=(r=r.filter(t=>t)).shift();if(!a.match("#EXTM3U"))throw new Error('Invalid m3u8 file: not "#EXTM3U"');for(a=r.shift();a;){let t=a.match(/#(.[A-Z|-]*):(.*)/),n=a.match(/#(.[A-Z|-]*)/);if(n&&t&&t.length>2)switch(t[1]){case"EXT-X-VERSION":i.version=parseInt(t[2]);break;case"EXT-X-MEDIA-SEQUENCE":i.sequence=parseInt(t[2]);break;case"EXT-X-TARGETDURATION":i.targetduration=parseFloat(t[2]);break;case"EXTINF":s.parseFrag(t,r,i,e);break;case"EXT-X-KEY":s.parseDecrypt(t[2],i)}if(n&&n.length>1)switch(n[1]){case"EXT-X-DISCONTINUITY":let t=(a=r.shift()).match(/#(.[A-Z|-]*):(.*)/);t.length>2&&"EXTINF"===t[1]&&s.parseFrag(t,r,i,e,!0)}a=r.shift()}return i}static parseFrag(t,e,i,s,r){i.frags||(i.frags=[]);let a={start:i.duration,duration:1e3*parseFloat(t[2])};i.duration+=a.duration;let n=e.shift();n.match(/#(.*):(.*)/)&&(n=e.shift()),n.length>0&&"/"===n.charAt(0)&&s.match(/.*\/\/.*\.\w+/g)&&(s=s.match(/.*\/\/.*\.\w+/g)[0]),n.match(/.*:\/\/.*/)?a.url=n:a.url=s+n,a.discontinue=r,i.frags.push(a)}static parseURL(t){let e="",i=t.match(/(.*\/).*\.m3u8/);if(i&&i.length>0)for(let t=0;t<i.length;t++)i[t].match(/.*\/$/g)&&i[t].length>e.length&&(e=i[t]);return e}static parseDecrypt(t,e){e.encrypt={};let i=t.split(",");for(let t in i){let s=i[t];if(s.match(/METHOD=(.*)/)&&(e.encrypt.method=s.match(/METHOD=(.*)/)[1]),s.match(/URI="(.*)"/)&&(e.encrypt.uri=s.match(/URI="(.*)"/)[1]),s.match(/IV=0x(.*)/)){let t=s.match(/IV=0x(.*)/)[1],i=Math.ceil(t.length/2);e.encrypt.ivb=new Uint8Array(i);for(let s=i-1;s>=0;s--){let i=parseInt(t.substr(2*s,2),16);e.encrypt.ivb[s]=i}e.encrypt.iv=t}}}}e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(2),r=i(3),a=i(0);const n=a.EVENTS.DEMUX_EVENTS,o={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};class d{constructor(t){this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}init(){this.on(n.DEMUX_START,this.demux.bind(this))}demux(t){if(this.demuxing)return;let e=this.inputBuffer,i={pat:[],pmt:[]},s={};for(;e.length>=188;){for(e.length>=1&&71!==e.array[0][e.offset]&&this.emit(n.DEMUX_ERROR,this.TAG,new Error(`Untrust sync code: ${e.array[0][e.offset]}, try to recover;`),!1);e.length>=1&&71!==e.array[0][e.offset];)e.shift(1);let t=e.shift(188),r=new a.Stream(t.buffer),o={};d.read(r,o,i),o.pes?(s[o.header.pid]||(s[o.header.pid]=[]),s[o.header.pid].push(o.pes),o.pes.ES.buffer=[o.pes.ES.buffer]):s[o.header.pid]&&s[o.header.pid][s[o.header.pid].length-1].ES.buffer.push(o.payload.stream)}let r=t,o=t;for(let t=0;t<Object.keys(s).length;t++){let e=s[Object.keys(s)[t]];for(let i=0;i<e.length;i++)e[i].id=Object.keys(s)[t],e[i].ES.buffer=d.Merge(e[i].ES.buffer),"audio"===e[i].type?(this.pushAudioSample(e[i],r),r={}):"video"===e[i].type&&(this.pushVideoSample(e[i],o),o={})}this._hasAudioMeta&&this.emit(n.DEMUX_COMPLETE,"audio"),this._hasVideoMeta&&this.emit(n.DEMUX_COMPLETE,"video")}pushAudioSample(t,e){let i;this._tracks.audioTrack?i=this._tracks.audioTrack:(this._tracks.audioTrack=new r.AudioTrack,i=this._tracks.audioTrack);let s=new a.AudioTrackMeta({audioSampleRate:t.ES.frequence,sampleRate:t.ES.frequence,channelCount:t.ES.channel,codec:"mp4a.40."+t.ES.audioObjectType,config:t.ES.audioConfig,id:2,sampleRateIndex:t.ES.frequencyIndex});s.refSampleDuration=Math.floor(1024/s.audioSampleRate*s.timescale);let o=d.compaireMeta(i.meta,s,!0);this._hasAudioMeta&&o||(i.meta=s,this._hasAudioMeta=!0,this.emit(n.METADATA_PARSED,"audio"));let h=new Uint8Array(t.ES.buffer.buffer.slice(t.ES.buffer.position,t.ES.buffer.length)),l=parseInt(t.pts/90),u=parseInt(t.pts/90),c=new a.AudioTrackSample({dts:l,pts:u,data:h,options:e});i.samples.push(c)}pushVideoSample(t,e){let i,o=s.Nalunit.getNalunits(t.ES.buffer),h=new a.VideoTrackMeta;this._tracks.videoTrack?i=this._tracks.videoTrack:(this._tracks.videoTrack=new r.VideoTrack,i=this._tracks.videoTrack);let l=0,u=!1,c=!1;for(let t=0;t<o.length;t++){let e=o[t];if(e.sps){u=e,i.sps=e.body,h.chromaFormat=u.sps.chroma_format,h.codec="avc1.";for(var f=1;f<4;f++){var p=u.body[f].toString(16);p.length<2&&(p="0"+p),h.codec+=p}h.codecHeight=u.sps.codec_size.height,h.codecWidth=u.sps.codec_size.width,h.frameRate=u.sps.frame_rate,h.id=1,h.level=u.sps.level_string,h.presentHeight=u.sps.present_size.height,h.presentWidth=u.sps.present_size.width,h.profile=u.sps.profile_string,h.refSampleDuration=Math.floor(h.timescale*(u.sps.frame_rate.fps_den/u.sps.frame_rate.fps_num)),h.sarRatio=u.sps.sar_ratio?u.sps.sar_ratio:u.sps.par_ratio}else e.pps?(i.pps=e.body,c=e):l+=4+e.body.byteLength}if(u&&c){h.avcc=s.Nalunit.getAvcc(u.body,c.body);let t=d.compaireMeta(i.meta,h,!0);this._hasVideoMeta&&t||(e?e.meta=Object.assign({},h):e={meta:Object.assign({},h)},i.meta=h,this._hasVideoMeta=!0,this.emit(n.METADATA_PARSED,"video"))}let m=new Uint8Array(l),g=0,_=!1;for(let t=0;t<o.length;t++){let e=o[t],i=e.body.byteLength;e.idr&&(_=!0),e.pps||e.sps||(m.set(new Uint8Array([i>>>24&255,i>>>16&255,i>>>8&255,255&i]),g),g+=4,m.set(e.body,g),g+=i)}let y=new a.VideoTrackSample({dts:parseInt(t.dts/90),pts:parseInt(t.pts/90),cts:(t.pts-t.dts)/90,originDts:t.dts,isKeyframe:_,data:m,options:e});i.samples.push(y)}destory(){this.off(n.DEMUX_START,this.demux),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}static compaireArray(t,e,i){let s=0,r=0;if("Uint8Array"===i?(s=t.byteLength,r=e.byteLength):"Array"===i&&(s=t.length,r=e.length),s!==r)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}static compaireMeta(t,e,i){if(!t||!e)return!1;for(let s=0,r=Object.keys(t).length;s<r;s++){let r=t[Object.keys(t)[s]],a=e[Object.keys(t)[s]];if("object"!=typeof r){if(i&&"duration"!==Object.keys(t)[s]&&"refSampleDuration"!==Object.keys(t)[s]&&"refSampleDurationFixed"!==Object.keys(t)[s]&&r!==a)return!1}else if(void 0!==r.byteLength){if(void 0===a.byteLength)return!1;if(!d.compaireArray(r,a,"Uint8Array"))return!1}else if(void 0!==r.length){if(void 0===a.length)return!1;if(!d.compaireArray(r,a,"Array"))return!1}else if(!d.compaireMeta(r,a))return!1}return!0}static Merge(t){let e,i=0,s=0;for(let e=0;e<t.length;e++)i+=t[e].length-t[e].position;e=new Uint8Array(i);for(let i=0;i<t.length;i++){let r=t[i];e.set(new Uint8Array(r.buffer,r.position),s),s+=r.length-r.position}return new a.Stream(e.buffer)}static read(t,e,i){d.readHeader(t,e),d.readPayload(t,e,i),"MEDIA"!==e.header.packet||1!==e.header.payload||e.unknownPIDs||(e.pes=d.PES(e))}static readPayload(t,e,i){let s=e.header.pid;switch(s){case 0:d.PAT(t,e,i);break;case 1:d.CAT(t,e,i);break;case 2:d.TSDT(t,e,i);break;case 8191:break;default:if(i.pat.some(t=>t.pid===s))d.PMT(t,e,i);else{let r=i.pmt?i.pmt.filter(t=>t.pid===s):[];r.length>0?d.Media(t,e,o[r[0].streamType][0]):e.unknownPIDs=!0}}}static readHeader(t,e){let i={};i.sync=t.readUint8();let s=t.readUint16();i.error=s>>>15,i.payload=s>>>14&1,i.priority=s>>>13&1,i.pid=8191&s,s=t.readUint8(),i.scrambling=s>>6&3,i.adaptation=s>>4&3,i.continuity=15&s,i.packet=0===i.pid?"PAT":"MEDIA",e.header=i}static PAT(t,e,i){let s={},r=t.readUint8();t.skip(r),r=t.readUint8(),s.tabelID=r,r=t.readUint16(),s.error=r>>>7,s.zero=r>>>6&1,s.sectionLength=4095&r,s.streamID=t.readUint16(),s.current=1&t.readUint8(),s.sectionNumber=t.readUint8(),s.lastSectionNumber=t.readUint8();let a=(s.sectionLength-9)/4,n=[];for(let e=0;e<a;e++){let e=t.readUint16(),i=8191&t.readUint16();n.push({program:e,pid:i,type:0===e?"network":"mapPID"})}n.length>0&&(i.pat=i.pat.concat(n)),s.list=n,s.program=t.readUint16(),s.pid=8191&t.readUint16(),e.payload=s}static PMT(t,e,i){let s={};e.header.packet="PMT";let r=t.readUint8();t.skip(r),r=t.readUint8(),s.tableID=r,r=t.readUint16(),s.sectionLength=4095&r,s.program=t.readUint16(),s.current=1&t.readUint8(),s.order=t.readUint8(),s.lastOrder=t.readUint8(),s.PCR_PID=8191&t.readUint16(),s.programLength=4095&t.readUint16();let a=(s.sectionLength-13)/5,n=[];for(let e=0;e<a;e++)n.push({streamType:t.readUint8(),pid:8191&t.readUint16(),es:4095&t.readUint16()});s.list=n,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(n.map(t=>({pid:t.pid,es:t.es,streamType:t.streamType,program:s.program}))),e.payload=s}static Media(t,e,i){let s=e.header,r={};if(s.type=i,3===s.adaptation&&(r.adaptationLength=t.readUint8(),r.adaptationLength>0)){let e=t.readUint8();r.discontinue=e>>>7,r.access=e>>>6&1,r.priority=e>>>5&1,r.PCR=e>>>4&1,r.OPCR=e>>>3&1,r.splicePoint=e>>>2&1,r.transportPrivate=e>>>1&1,r.adaptationField=1&e;let i=t.position;if(1===r.PCR&&(r.programClockBase=t.readUint32()<<1,e=t.readUint16(),r.programClockBase|=e>>>15,r.programClockExtension=511&e),1===r.OPCR&&(r.originProgramClockBase=t.readUint32()<<1,e=t.readUint16(),r.originProgramClockBase+=e>>>15,r.originProgramClockExtension=511&e),1===r.splicePoint&&(r.spliceCountdown=t.readUint8()),1===r.transportPrivate){let e=t.readUint8(),i=[];for(let s=0;s<e;s++)i.push(t.readUint8())}if(1===r.adaptationField){let e=t.readUint8(),i=t.readUint8(),s=t.position,a=i>>>6&1,n=i>>>5&1;1===i>>>7&&(i=t.readUint16(),r.ltwValid=i>>>15,r.ltwOffset=61439&i),1===a&&(i=t.readUint24(),r.piecewiseRate=4194303&i),1===n&&(i=t.readInt8(),r.spliceType=i>>>4,r.dtsNextAU1=i>>>1&7,r.marker1=1&i,i=t.readUint16(),r.dtsNextAU2=i>>>1,r.marker2=1&i,i=t.readUint16(),r.dtsNextAU3=i),t.skip(e-1-(t.position-s))}let s=r.adaptationLength-1-(t.position-i);t.skip(s)}r.stream=new a.Stream(t.buffer.slice(t.position)),e.payload=r}static PES(t){let e={},i=t.payload.stream;if(1!==i.readUint24())e.ES={},e.ES.buffer=i;else{let t=i.readUint8();t>=224&&t<=239&&(e.type="video"),t>=192&&t<=223&&(e.type="audio");let s=i.readUint16();if(e.packetLength=s,"video"!==e.type&&"audio"!==e.type)throw new Error("format is not supported");{let t=i.readUint8();if(2!==t>>>6)throw new Error("error when parse pes header");t=i.readUint8(),e.ptsDTSFlag=t>>>6,e.escrFlag=t>>>5&1,e.esRateFlag=t>>>4&1,e.dsmFlag=t>>>3&1,e.additionalFlag=t>>>2&1,e.crcFlag=t>>>1&1,e.extensionFlag=1&t,e.pesHeaderLength=i.readUint8();let s=e.pesHeaderLength;if(2===e.ptsDTSFlag){let r=[];t=i.readUint8(),r.push(t>>>1&7),t=i.readUint16(),r.push(t>>>1),t=i.readUint16(),r.push(t>>>1),e.pts=r[0]<<30|r[1]<<15|r[2],s-=5,"video"===e.type&&(e.dts=e.pts)}if(3===e.ptsDTSFlag){let r=[];t=i.readUint8(),r.push(t>>>1&7),t=i.readUint16(),r.push(t>>>1),t=i.readUint16(),r.push(t>>>1),e.pts=r[0]<<30|r[1]<<15|r[2];let a=[];t=i.readUint8(),a.push(t>>>1&7),t=i.readUint16(),a.push(t>>>1),t=i.readUint16(),a.push(t>>>1),e.dts=a[0]<<30|a[1]<<15|a[2],s-=10}if(1===e.escrFlag){let r=[],a=[];t=i.readUint8(),r.push(t>>>3&7),r.push(3&t),t=i.readUint16(),r.push(t>>>13),r.push(3&t),t=i.readUint16(),r.push(t>>>13),a.push(3&t),t=i.readUint8(),a.push(t>>>1),e.escr=300*(r[0]<<30|r[1]<<28|r[2]<<15|r[3]<<13|r[4])+(a[0]<<7|a[1]),s-=6}if(1===e.esRateFlag&&(t=i.readUint24(),e.esRate=t>>>1&4194303,s-=3),1===e.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===e.additionalFlag&&(t=i.readUint8(),e.additionalCopyInfo=127&t,s-=1),1===e.crcFlag&&(e.pesCRC=i.readUint16(),s-=2),1===e.extensionFlag)throw new Error("not support extension");s>0&&i.skip(s),e.ES=d.ES(i,e.type)}}return e}static ES(t,e){let i,s={};if("video"===e){if(1!==(i=t.readUint32())&&(t.back(4),1!==(i=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),s.buffer=t}else{if("audio"!==e)throw new Error(`ES ${e} is not supported`);{if((i=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",s.layer=i>>>1&3,s.absent=1&i,i=t.readUint16(),s.audioObjectType=1+(i>>>14&3),s.profile=s.audioObjectType-1,s.frequencyIndex=i>>>10&15,s.frequence=e[s.frequencyIndex],s.channel=i>>>6&7,s.frameLength=(3&i)<<11|t.readUint16()>>>5,d.getAudioConfig(s),t.skip(1),s.buffer=t}}return s}static TSDT(t,e,i){e.payload={}}static CAT(t,e,i){let s={};s.tableID=t.readUint8();let r=t.readUint16();s.sectionIndicator=r>>>7,s.sectionLength=4095&r,t.skip(2),r=t.readUint8(),s.version=r>>>3,s.currentNextIndicator=1&r,s.sectionNumber=t.readUint8(),s.lastSectionNumber=t.readUint8();let a=(this.sectionLength-9)/4,n=[];for(let t=0;t<a;t++)n.push({});s.crc32=t.readUint32(),e.payload=s}static getAudioConfig(t){let e,i,s=navigator.userAgent.toLowerCase();/firefox/i.test(s)?t.frequencyIndex>=6?(t.audioObjectType=5,e=new Array(4),i=t.frequencyIndex-3):(t.audioObjectType=2,e=new Array(2),i=t.frequencyIndex):-1!==s.indexOf("android")?(t.audioObjectType=2,e=new Array(2),i=t.frequencyIndex):(t.audioObjectType=5,e=new Array(4),t.frequencyIndex>=6?i=t.frequencyIndex-3:(1===t.channel&&(t.audioObjectType=2,e=new Array(2)),i=t.frequencyIndex)),e[0]=t.audioObjectType<<3,e[0]|=(14&t.frequencyIndex)>>1,e[1]=(1&t.frequencyIndex)<<7,e[1]|=t.channel<<3,5===t.audioObjectType&&(e[1]|=(14&i)>>1,e[2]=(1&i)<<7,e[2]|=8,e[3]=0),t.audioConfig=e}get inputBuffer(){return this._context.getInstance(this.configs.inputbuffer)}get _tracks(){return this._context.getInstance("TRACKS")}}e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(0),a=i(45),n=(s=a)&&s.__esModule?s:{default:s};const{REMUX_EVENTS:o,DEMUX_EVENTS:d}=r.EVENTS;class h{constructor(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this._videoLargeGap=0,this._audioLargeGap=0}init(){this.before(o.REMUX_MEDIA,this.doFix.bind(this))}reset(){this.nextAudioDts=null,this.nextVideoDts=null,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.filledAudioSamples=[],this.filledVideoSamples=[]}doFix(){const{isFirstAudioSamples:t,isFirstVideoSamples:e}=this.getFirstSample();this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples);const{changed:i,changedIdx:s}=h.detactChangeStream(this.videoTrack.samples);i&&!t?this.fixChangeStreamVideo(s):this.doFixVideo(e);const{changed:r,changedIdx:a}=h.detactChangeStream(this.audioTrack.samples);r?this.fixChangeStreamAudio(a):this.doFixAudio(t)}doFixVideo(t,e){let{samples:i,meta:s}=this.videoTrack;if(s.frameRate&&!1===s.frameRate.fixed)return;if(!i||!i.length||!this._firstVideoSample)return;const r=i[0],a=i.length;this._videoLargeGap>0&&h.doFixLargeGap(i,this._videoLargeGap),r.dts!==this._firstVideoSample.dts&&(e||h.detectLargeGap(this.nextVideoDts,r))&&(e&&(this.nextVideoDts=e),this._videoLargeGap=this.nextVideoDts-r.dts,h.doFixLargeGap(i,this._videoLargeGap));const n=r.dts;if(t&&this._firstAudioSample){const t=this._firstVideoSample.dts,e=t-this._firstAudioSample.dts;if(e>2*s.refSampleDuration){const a=Math.floor(e/s.refSampleDuration);for(let e=0;e<a;e++){const a=Object.assign({},r);a.dts=t-(e+1)*s.refSampleDuration,a.pts=a.dts+a.cts,i.unshift(a),this.filledVideoSamples.push({dts:a.dts,size:a.data.byteLength})}}}let o;if(this.nextVideoDts){o=n-this.nextVideoDts;const t=Math.abs(o);if(o>2*s.refSampleDuration){const t=Math.floor(o/s.refSampleDuration);for(let e=0;e<t;e++){const t=Object.assign({},i[0]),r=n-(e+1)*s.refSampleDuration;t.dts=r>this.nextVideoDts?r:this.nextVideoDts,t.pts=t.dts+t.cts,this.videoTrack.samples.unshift(t),this.filledVideoSamples.push({dts:t.dts,size:t.data.byteLength})}}else t<=s.refSampleDuration&&t>0?(i[0].dts=this.nextVideoDts,i[0].originDts=i[0].dts,i[0].cts=void 0!==i[0].cts?i[0].cts:i[0].pts-i[0].dts,i[0].pts=i[0].dts+i[0].cts):o<0&&h.doFixLargeGap(i,-1*o)}const d=i[i.length-1].dts,l=i.length>=2?d-i[i.length-2].dts:s.refSampleDuration;this.lastVideoSamplesLen=a,this.nextVideoDts=d+l,this.lastVideoDts=d;for(let t=0,e=i.length;t<e;t++){const e=i[t],r=i[t+1];if(!r)break;const a=r.dts-e.dts;if(a>2*s.refSampleDuration){let n=Math.floor(a/s.refSampleDuration),o=0;for(;o<n;){const a=Object.assign({},r);a.dts=e.dts+(o+1)*s.refSampleDuration,a.pts=a.dts+a.cts,a<r.dts&&(i.splice(t,0,a),this.filledVideoSamples.push({dts:a.dts,size:a.data.byteLength})),o++,t++}}}this.videoTrack.samples=i}doFixAudio(t,e){let{samples:i,meta:s}=this.audioTrack;if(!i||!i.length)return;const r=i.length,a=n.default.getSilentFrame(s.codec,s.channelCount),o=this._firstAudioSample,d=i[0];if(this._audioLargeGap>0&&h.doFixLargeGap(i,this._audioLargeGap),d.dts!==this._firstAudioSample.dts&&(e||h.detectLargeGap(this.nextAudioDts,d))&&(e&&(this.nextAudioDts=e),this._audioLargeGap=this.nextAudioDts-d.dts,h.doFixLargeGap(i,this._audioLargeGap)),this._firstVideoSample&&t){const t=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(o.dts-t>s.refSampleDuration){const e=Math.floor((o.dts-t)/s.refSampleDuration);for(let t=0;t<e;t++){const e={data:a,datasize:a.byteLength,dts:o.dts-(t+1)*s.refSampleDuration,filtered:0};i.unshift(e),this.filledAudioSamples.push({dts:e.dts,size:e.data.byteLength})}}}let l;const u=i[0].dts;if(this.nextAudioDts){l=u-this.nextAudioDts;const t=Math.abs(l);if(t>s.refSampleDuration&&1===r&&1===this.lastAudioSamplesLen&&(s.refSampleDurationFixed=void 0),l>2*s.refSampleDuration)if(1===r&&1===this.lastAudioSamplesLen)s.refSampleDurationFixed=void 0!==s.refSampleDurationFixed?s.refSampleDurationFixed+l:s.refSampleDuration+l;else{const t=Math.floor(l/s.refSampleDuration);for(let e=0;e<t;e++){const t=u-(e+1)*s.refSampleDuration,r=Object.assign({},i[0],{dts:t>this.nextAudioDts?t:this.nextAudioDts});this.filledAudioSamples.push({dts:r.dts,size:r.data.byteLength}),this.audioTrack.samples.unshift(r)}}else t<=s.refSampleDuration&&t>0?(i[0].dts=this.nextAudioDts,i[0].pts=this.nextAudioDts):l<0&&h.doFixLargeGap(i,-1*l)}const c=i[i.length-1].dts,f=i.length>=2?c-i[i.length-2].dts:s.refSampleDuration;this.lastAudioSamplesLen=r,this.nextAudioDts=s.refSampleDurationFixed?c+s.refSampleDurationFixed:c+f,this.lastAudioDts=c;for(let t=0,e=i.length;t<e;t++){const e=i[t],s=i[t+1];if(!s)break;const r=s.dts-e.dts;i[t].duration=r}this.audioTrack.samples=h.sortAudioSamples(i)}fixChangeStreamVideo(t){const{samples:e,meta:i}=this.videoTrack,s=0===t?this.getStreamChangeStart(e[0]):e[t-1].dts,r=e[t].dts;if(Math.abs(s-r)<=2*i.refSampleDuration)return e[t].options?e[t].options.isContinue=!0:e[t].options={isContinue:!0},this.doFixVideo(!1);const a=e.slice(0,t),n=e.slice(t),o=e[0],d=n[0].dts-o.dts,h=o.options&&o.options.start+d?o.options.start:null;this.videoTrack.samples=e.slice(0,t),this.doFixVideo(!1),this.videoTrack.samples=e.slice(t),this.doFixVideo(!1,h),this.videoTrack.samples=a.concat(n)}fixChangeStreamAudio(t){const{samples:e,meta:i}=this.audioTrack,s=0===t?this.getStreamChangeStart(e[0]):e[t-1].dts,r=e[t].dts;if(Math.abs(s-r)<=2*i.refSampleDuration)return e[t].options?e[t].options.isContinue=!0:e[t].options={isContinue:!0},this.doFixAudio(!1);const a=e.slice(0,t),n=e.slice(t),o=e[0],d=n[0].dts-o.dts,h=o.options&&o.options.start+d?o.options.start:null;this.audioTrack.samples=a,this.doFixAudio(!1),this.audioTrack.samples=n,this.doFixAudio(!1,h),this.audioTrack.samples=a.concat(n)}getFirstSample(){let{samples:t}=this.videoTrack,{samples:e}=this.audioTrack,i=!1,s=!1;return!this._firstVideoSample&&t.length&&(this._firstVideoSample=h.findFirstVideoSample(t),i=!0),!this._firstAudioSample&&e.length&&(this._firstAudioSample=h.findFirstAudioSample(e),s=!0),{isFirstVideoSamples:i,isFirstAudioSamples:s}}fixRefSampleDuration(t,e){const i="video"===t.type,s=i?this.allVideoSamplesCount:this.allAudioSamplesCount,r=i?this._firstVideoSample.dts:this._firstAudioSample.dts,a=i?this.filledVideoSamples.length:this.filledAudioSamples.length;if(!t.refSampleDuration||t.refSampleDuration<=0||Number.isNaN(t.refSampleDuration)){if(e.length>=1){const i=e[e.length-1].dts;t.refSampleDuration=Math.floor((i-r)/(s+a-1))}}else if(t.refSampleDuration&&e.length>=5){const i=(e[e.length-1].dts-e[0].dts)/(e.length-1);t.refSampleDuration=Math.floor(Math.abs(t.refSampleDuration-i)<=5?t.refSampleDuration:i)}}recordSamplesCount(){const{audioTrack:t,videoTrack:e}=this;this.allAudioSamplesCount+=t.samples.length,this.allVideoSamplesCount+=e.samples.length}removeInvalidSamples(){const{_firstVideoSample:t,_firstAudioSample:e}=this;this.audioTrack.samples=this.audioTrack.samples.filter(t=>t.dts>=e.dts&&(void 0===this.lastAudioDts||t.dts>this.lastAudioDts)),this.videoTrack.samples=this.videoTrack.samples.filter(e=>e.dts>=t.dts&&(void 0===this.lastVideoDts||e.dts>this.lastVideoDts))}getStreamChangeStart(t){return t.options&&t.options.start?t.options.start-this.dtsBase:1/0}static sortAudioSamples(t){return 1===t.length?t:t.sort((t,e)=>t.dts-e.dts)}static findFirstAudioSample(t){return t&&0!==t.length?h.sortAudioSamples(t)[0]:null}static findFirstVideoSample(t){if(!t.length)return null;const e=t.sort((t,e)=>t.dts-e.dts);for(let t=0,i=e.length;t<i;t++)if(e[t].isKeyframe)return e[t]}static detectLargeGap(t,e){if(null===t)return;const i=e.dts||0,s=t-i>=1e3||i-t>=1e3,r=e.options&&e.options.discontinue;return s||r}static doFixLargeGap(t,e){console.log("fix large gap");for(let i=0,s=t.length;i<s;i++){const s=t[i];s.dts+=e,s.pts&&(s.pts+=e)}}static detactChangeStream(t){let e=!1,i=-1;for(let s=0,r=t.length;s<r;s++)if(t[s].options&&t[s].options.meta){e=!0,i=s;break}return{changed:e,changedIdx:i}}get tracks(){return this._context.getInstance("TRACKS")}get audioTrack(){return this.tracks?this.tracks.audioTrack:null}get videoTrack(){return this.tracks?this.tracks.videoTrack:null}get dtsBase(){const t=this._context.getInstance("MP4_REMUXER");return t?t._dtsBase:0}}e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.mimetype="",this.init=null,this.data=[]}}e.default=class{constructor(){this.sources={}}getSource(t){return this.sources[t]}createSource(t){return this.sources[t]=new s,this.sources[t]}clear(){this.sources={}}destroy(){this.sources={}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=t.autoclear||!1}get list(){return this._list}set baseURL(t){this.baseURL!==t&&(this.clear(),this._baseURL=t)}get baseURL(){return this._baseURL}push(t,e,i){this._ts[t]||(this._ts[t]={duration:e,downloaded:!1,downloading:!1,start:this.duration,discontinue:!!i},this._list[this.duration]=t,this.duration+=e,this.fragLength+=1)}deleteFrag(t){this._ts[t]&&(this._ts[t].start>this._lastget.time&&(this._lastget={duration:this._ts[t].duration,time:this._ts[t].start,downloaded:!1,downloading:!1,url:t}),delete this._list[this._ts[t].start],delete this._ts[t],this.fragLength-=1)}pushM3U8(t,e){if(!t)throw new Error("No m3u8 data received.");if(this.version=t.version,this.targetduration=t.targetduration,t.encrypt&&!this.encrypt&&(this.encrypt=t.encrypt),!(t.sequence>this.sequence))throw new Error(`Old m3u8 file received, ${t.sequence}`);{this.sequence=t.sequence;let i=[];for(let e=0;e<t.frags.length;e++){let s=t.frags[e];this._ts[s.url]||(i.push(s.url),this.push(s.url,s.duration,s.discontinue))}if(i.length<1)throw new Error("Can not read ts file list.");if(e){let t=this.getTsList();for(let e=0;e<t.length;e++)i.indexOf(t[e])<0&&this.deleteFrag(t[e])}}}getTsList(){return Object.keys(this._ts)}downloaded(t,e){let i=this._ts[t];i&&(i.downloaded=e)}downloading(t,e){let i=this._ts[t];i&&(i.downloading=e)}getTsByName(t){return this._ts[t]}getTs(t){let e,i=Object.keys(this._list);if(void 0===t&&(t=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||t>=this.duration)){i.sort((t,e)=>parseFloat(t)-parseFloat(e));for(let s=0;s<i.length&&t>=parseInt(i[s]);s++){let t=this._list[i[s]];e={url:t,downloaded:this._ts[t].downloaded,downloading:this._ts[t].downloading,time:parseInt(i[s]),duration:parseInt(this._ts[t].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=e}return e}}clear(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}clearDownloaded(){for(let t=0,e=Object.keys(this._ts).length;t<e;t++){let e=this._ts[Object.keys(this._ts)[t]];e.downloaded=!1,e.downloading=!1}}destroy(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(0),a=i(2),n=i(3),o=i(49),d=(s=o)&&s.__esModule?s:{default:s};const h=r.EVENTS.DEMUX_EVENTS;class l{constructor(){this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}init(){this.on(h.DEMUX_START,this.doParseFlv.bind(this))}static isFlvFile(t){return!(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])}static getPlayType(t){const e={hasVideo:!1,hasAudio:!1};return!0&t&&(e.hasVideo=!0),!0&t&&(e.hasAudio=!0),e}doParseFlv(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;let t,e=1e5;do{t=this._parseFlvTag()}while(t&&e-- >0);this.emit(h.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;const t=this.loaderBuffer.shift(13);this.parseFlvHeader(t),this.doParseFlv()}}parseFlvHeader(t){if(l.isFlvFile(t)){this._firstFragmentLoaded=!0;const e=l.getPlayType(t[4]);e.hasVideo&&this.initVideoTrack(),e.hasAudio&&this.initAudioTrack()}else this.emit(h.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}initVideoTrack(){this._trackNum++;let t=new n.VideoTrack;t.meta=new r.VideoTrackMeta,t.id=t.meta.id=this._trackNum,this.tracks.videoTrack=t}initAudioTrack(){this._trackNum++;let t=new n.AudioTrack;t.meta=new r.AudioTrackMeta,t.id=t.meta.id=this._trackNum,this.tracks.audioTrack=t}_parseFlvTag(){if(this.loaderBuffer.length<11)return null;let t=this._parseFlvTagHeader();return t&&this._processChunk(t),t}_parseFlvTagHeader(){let t=0,e={},i=this.loaderBuffer.toInt(t,1);if(t+=1,e.filtered=(32&i)>>>5,e.tagType=31&i,e.datasize=this.loaderBuffer.toInt(t,3),t+=3,8!==e.tagType&&9!==e.tagType&&11!==e.tagType&&18!==e.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.emit(h.DEMUX_ERROR,this.TAG,new Error("tagType "+e.tagType),!1),null;if(this.loaderBuffer.length<e.datasize+15)return null;this.loaderBuffer.shift(4);let s=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);let r=this.loaderBuffer.shift(1)[0];return r>0&&(s+=16777216*r),e.dts=s,this.loaderBuffer.shift(3),e}_processChunk(t){switch(t.tagType){case 18:this._parseScriptData(t);break;case 8:this._parseAACData(t);break;case 9:this._parseHevcData(t);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}_parseScriptData(t){let e=this.tracks.audioTrack,i=this.tracks.videoTrack,s=this.loaderBuffer.shift(t.datasize);const r=(new d.default).resolve(s,s.length),a=this._context.onMetaData=r?r.onMetaData:void 0;if(this._context.mediaInfo.duration=a.duration,this._context.mediaInfo.hasVideo=a.hasVideo,this._context.mediaInfo.hsaAudio=a.hasAudio,this._datasizeValidator(t.datasize)&&(this.emit(h.MEDIA_INFO),this._hasScript=!0),e&&!e.hasSpecificConfig){let t=e.meta;switch(a.audiosamplerate&&(t.sampleRate=a.audiosamplerate),a.audiochannels&&(t.channelCount=a.audiochannels),a.audiosamplerate){case 44100:t.sampleRateIndex=4;break;case 22050:t.sampleRateIndex=7;break;case 11025:t.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){let t=i.meta;if("number"==typeof a.framerate){let e=Math.floor(1e3*a.framerate);if(e>0){let i=e/1e3;t.frameRate||(t.frameRate={}),t.frameRate.fixed=!0,t.frameRate.fps=i,t.frameRate.fps_num=e,t.frameRate.fps_den=1e3}}}}_aacSequenceHeaderParser(t){let e={hasSpecificConfig:!0};e.objectType=t[1]>>>3,e.sampleRateIndex=(7&t[1])<<1|t[2]>>>7,e.audiosamplerate=this._switchAudioSampleRate(e.sampleRateIndex),e.channelCount=(120&t[2])>>>3,e.frameLength=(4&t[2])>>>2,e.dependsOnCoreCoder=(2&t[2])>>>1,e.extensionFlagIndex=1&t[2],e.codec=`mp4a.40.${e.objectType}`;let i,s,r=window.navigator.userAgent.toLowerCase(),a=e.sampleRateIndex;return-1!==r.indexOf("firefox")?e.sampleRateIndex>=6?(e.objectType=5,s=new Array(4),i=a-3):(e.objectType=2,s=new Array(2),i=a):-1!==r.indexOf("android")?(e.objectType=2,s=new Array(2),i=a):(e.objectType=5,i=e.sampleRateIndex,s=new Array(4),e.sampleRateIndex>=6?i=e.sampleRateIndex-3:1===e.channelCount&&(e.objectType=2,s=new Array(2),i=e.sampleRateIndex)),s[0]=e.objectType<<3,s[0]|=(15&e.sampleRateIndex)>>>1,s[1]=(15&e.sampleRateIndex)<<7,s[1]|=(15&e.channelCount)<<3,5===e.objectType&&(s[1]|=(15&i)>>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),e.config=s,e}_parseAACData(t){let e=this.tracks.audioTrack;if(!e)return;let i=e.meta;i||(e.meta=new r.AudioTrackMeta,i=e.meta);let s=this.loaderBuffer.shift(1)[0];t.data=this.loaderBuffer.shift(t.datasize-1);let a=(240&s)>>>4;e.format=a,10!==a&&this.emit(h.DEMUX_ERROR,new Error(`invalid audio format: ${a}`)),10!==a||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(s),i.sampleRateIndex=(12&s)>>>2,i.frameLenth=(2&s)>>>1,i.channelCount=1&s,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));let n=i.audioSampleRate,o=i.sampleRateIndex,d=i.refSampleDuration;delete t.tagType;let l=this._datasizeValidator(t.datasize);if(0===t.data[0]){let e=this._aacSequenceHeaderParser(t.data);n=e.audiosamplerate||i.audioSampleRate,o=e.sampleRateIndex||i.sampleRateIndex,d=Math.floor(1024/n*i.timescale),i.channelCount=e.channelCount,i.sampleRate=n,i.sampleRateIndex=o,i.refSampleDuration=d,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=e.config,i.objectType=e.objectType;const s=this._context.mediaInfo.audio;s.codec=e.codec,s.channelCount=e.channelCount,s.sampleRate=n,s.sampleRateIndex=e.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(h.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&(this.emit(h.METADATA_PARSED,"audio"),this.emit(h.AUDIO_METADATA_CHANGE)),this._hasAudioSequence=!0,this._metaChange=!0}else this._metaChange&&(t.options={meta:e.meta},this._metaChange=!1),t.data=t.data.slice(1,t.data.length),e.samples.push(t);l||this.emit(h.DEMUX_ERROR,this.TAG,new Error("TAG length error at "+t.datasize),!1)}_parseHevcData(t){let e=this.loaderBuffer.shift(1)[0];t.frameType=(240&e)>>>4,t.isKeyframe=1===t.frameType;let i=15&e;if(this.tracks.videoTrack.codecID=i,t.avcPacketType=this.loaderBuffer.shift(1)[0],t.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){const e=this.loaderBuffer.shift(t.datasize-5);if(t.data=e,0!==Number.parseInt(t.avcPacketType)){this._datasizeValidator(t.datasize)||this.emit(h.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${t.datasize}`),!1);let e={},i=0;for(e.cts=t.cts,e.dts=t.dts;t.data.length>i;){let s=t.data.slice(Number.parseInt(i),4+i);e.size=s[3],e.size+=256*s[2],e.size+=256*s[1]*256,e.size+=256*s[0]*256*256,i+=4,e.data=t.data.slice(Number.parseInt(i),e.size+i),i+=e.size,this.tracks.videoTrack.samples.push(e),this.emit(h.METADATA_PARSED,"video")}}else 0===Number.parseInt(t.avcPacketType)&&(this._datasizeValidator(t.datasize)?this.emit(h.METADATA_PARSED,"video"):this.emit(h.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${t.datasize}`),!1))}else if(7===i){let e=this.loaderBuffer.shift(t.datasize-5);if(0===e[4]&&0===e[5]&&0===e[6]&&1===e[7]){let t=0;for(let i=0;i<4;i++)t=256*t+e[i];t-=4,(e=e.slice(4,e.length))[3]=t%256,t=(t-e[3])/256,e[2]=t%256,t=(t-e[2])/256,e[1]=t%256,e[0]=(t-e[1])/256}if(t.data=e,0===t.avcPacketType){this._avcSequenceHeaderParser(t.data),this._datasizeValidator(t.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(h.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&(this.emit(h.METADATA_PARSED,"audio"),this.emit(h.VIDEO_METADATA_CHANGE)),this._hasVideoSequence=!0),this._metaChange=!0}else{if(!this._datasizeValidator(t.datasize))return void this.emit(h.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${t.datasize}`),!1);this._metaChange&&(t.options={meta:Object.assign({},this.tracks.videoTrack.meta)},this._metaChange=!1),this.tracks.videoTrack.samples.push(t)}}else this.emit(h.DEMUX_ERROR,this.TAG,new Error(`video codeid is ${i}`),!1),t.data=this.loaderBuffer.shift(t.datasize-1),this._datasizeValidator(t.datasize)||this.emit(h.DEMUX_ERROR,this.TAG,new Error(`invalid video tag datasize: ${t.datasize}`),!1),this.tracks.videoTrack.samples.push(t),this.emit(h.DEMUX_COMPLETE);delete t.tagType}_avcSequenceHeaderParser(t){let e=this.tracks.videoTrack;if(!e)return;let i=0;e.meta||(e.meta=new r.VideoTrackMeta);let s=e.meta;s.configurationVersion=t[0],s.avcProfileIndication=t[1],s.profileCompatibility=t[2],s.avcLevelIndication=t[3]/10,s.nalUnitLength=1+(3&t[4]);let n=31&t[5];i=6;let o={};for(let e=0;e<n;e++){let e=255*t[i]+t[i+1];i+=2;let r=new Uint8Array(e);for(let s=0;s<e;s++)r[s]=t[i+s];let n="avc1.";for(let t=1;t<4;t++){let e=r[t].toString(16);e.length<2&&(e="0"+e),n+=e}s.codec=n,i+=e,this.tracks.videoTrack.meta.sps=r,o=a.SpsParser.parseSPS(r)}let d=t[i];i++;for(let e=0;e<d;e++){let e=255*t[i]+t[i+1];i+=2;let s=new Uint8Array(e);for(let r=0;r<e;r++)s[r]=t[i+r];i+=e,this.tracks.videoTrack.meta.pps=s}Object.assign(s,a.SpsParser.toVideoMeta(o));const h=this._context.mediaInfo.video;h.codec=s.codec,h.profile=s.profile,h.level=s.level,h.chromaFormat=s.chromaFormat,h.frameRate=s.frameRate,h.parRatio=s.parRatio,h.width=h.width===s.presentWidth?h.width:s.presentWidth,h.height=h.height===s.presentHeight?h.width:s.presentHeight,s.duration=this._context.mediaInfo.duration*s.timescale,s.avcc=new Uint8Array(t.length),s.avcc.set(t),e.meta=s}_switchAudioSampleRate(t){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][t]}_switchAudioSamplingFrequency(t){return[5500,11025,22050,44100,48e3][(12&t)>>>2]}_switchAudioChannel(t){return[1,2][1&t]}_datasizeValidator(t){let e=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),e===t+11}get loaderBuffer(){const t=this._context.getInstance("LOADER_BUFFER");if(t)return t;this.emit(h.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}get tracks(){return this._context.getInstance("TRACKS")}get logger(){return this._context.getInstance("LOGGER")}}e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0);const r={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12};e.default=class{constructor(){this.offset=0,this.readOffset=this.offset}resolve(t,e){if(e<3)throw new Error("not enough data for metainfo");const i={},s=this.parseValue(t),r=this.parseValue(t,e-s.bodySize);return i[s.data]=r.data,this.resetStatus(),i}resetStatus(){this.offset=0,this.readOffset=this.offset}parseString(t){const e=new DataView(t,this.readOffset).getUint16(0,!s.isLe);let i="";i=e>0?s.UTF8.decode(new Uint8Array(t,this.readOffset+2,e)):"";let r=e+2;return this.readOffset+=r,{data:i,bodySize:e+2}}parseDate(t,e){const i=new DataView(t,this.readOffset,e);let r=i.getFloat64(0,!s.isLe);return r+=60*i.getInt16(8,!s.isLe)*1e3,this.readOffset+=10,{data:new Date(r),bodySize:10}}parseObject(t,e){const i=this.parseString(t,e),s=this.parseValue(t,e-i.bodySize);return{data:{name:i.data,value:s.data},bodySize:i.bodySize+s.bodySize,isObjEnd:s.isObjEnd}}parseLongString(t){const e=new DataView(t,this.readOffset).getUint32(0,!s.isLe);let i="";return i=e>0?s.UTF8.decode(new Uint8Array(t,this.readOffset+2,e)):"",this.readOffset+=e+4,{data:i,bodySize:e+4}}parseValue(t,e){let i=new ArrayBuffer;i=t instanceof ArrayBuffer?t:t.buffer;const{NUMBER:a,BOOLEAN:n,STRING:o,OBJECT:d,MIX_ARRAY:h,OBJECT_END:l,STRICT_ARRAY:u,DATE:c,LONE_STRING:f}=r,p=new DataView(i,this.readOffset,e);let m=!1;const g=p.getUint8(0);let _=1;this.readOffset+=1;let y=null;switch(g){case a:y=p.getFloat64(1,!s.isLe),this.readOffset+=8,_+=8;break;case n:y=!!p.getUint8(1),this.readOffset+=1,_+=1;break;case o:{const t=this.parseString(i);y=t.data,_+=t.bodySize;break}case d:{y={};let t=0;for(16777215&p.getUint32(e-4,!s.isLe)&&(t=3);_<e-4;){const s=this.parseObject(i,e-_-t);if(s.isObjectEnd)break;y[s.data.name]=s.data.value,_+=s.bodySize}if(_<=e-3){9===(16777215&p.getUint32(_-1,!s.isLe))&&(this.readOffset+=3,_+=3)}break}case h:{y={},_+=4,this.readOffset+=4;let t=0;for(9==(16777215&p.getUint32(e-4,!s.isLe))&&(t=3);_<e-8;){const s=this.parseObject(i,e-_-t);if(s.isObjectEnd)break;y[s.data.name]=s.data.value,_+=s.bodySize}if(_<=e-3){9===(16777215&p.getUint32(_-1,!s.isLe))&&(_+=3,this.readOffset+=3)}break}case l:y=null,m=!0;break;case u:{y=[];const t=p.getUint32(1,!s.isLe);_+=4,this.readOffset+=4;for(let s=0;s<t;s++){const t=this.parseValue(i,e-_);y.push(t.data),_+=t.bodySize}break}case c:{const t=this.parseDate(i,e-1);y=t.data,_+=t.bodySize;break}case f:{const t=this.parseLongString(i,e-1);y=t.data,_+=t.bodySize;break}default:_=e}return{data:y,bodySize:_,isObjEnd:m}}}},function(t,e,i){t.exports=i(51)},function(t,e,i){"use strict";var s=n(i(4)),r=i(0),a=n(i(52));function n(t){return t&&t.__esModule?t:{default:t}}const o=r.EVENTS.FlvAllowedEvents;class d extends s.default{constructor(t){super(t),this.context=new r.Context(o),this.initEvents(),this.loaderCompleteTimer=null}start(){this.initFlv(),this.context.init(),super.start(this.flv.mse.url)}initFlvEvents(t){const e=this;t.once(r.EVENTS.REMUX_EVENTS.INIT_SEGMENT,()=>{if(s.default.util.addClass(e.root,"xgplayer-is-live"),!s.default.util.findDom(this.root,"xg-live")){const t=s.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");e.controls.appendChild(t)}}),t.once(r.EVENTS.LOADER_EVENTS.LOADER_COMPLETE,()=>{e.paused||(this.loaderCompleteTimer=setInterval(()=>{const t=e.getBufferedRange()[1];Math.abs(e.currentTime-t)<.5&&(e.emit("ended"),window.clearInterval(this.loaderCompleteTimer))},200))})}initEvents(){this.on("timeupdate",()=>{this.loadData()}),this.on("seeking",()=>{const t=this.currentTime,e=this.getBufferedRange();(t>e[1]||t<e[0])&&this.flv.seek(this.currentTime)})}initFlv(){const t=this.context.registry("FLV_CONTROLLER",a.default)(this);this.initFlvEvents(t),this.flv=t}play(){this._hasStart?this._destroy().then(()=>{this.context=new r.Context(o);const t=this.context.registry("FLV_CONTROLLER",a.default)(this);this.initFlvEvents(t),this.flv=t,this.context.init(),super.start(t.mse.url),super.play()}):super.play()}pause(){super.pause(),this.flv&&this.flv.pause()}loadData(t=this.currentTime){this.flv&&this.flv.seek(t)}destroy(){this._destroy().then(()=>{super.destroy()})}_destroy(){return this.flv.mse.destroy().then(()=>{this.context.destroy(),this.flv=null,this.context=null,this.loaderCompleteTimer&&window.clearInterval(this.loaderCompleteTimer)})}get src(){return this.currentSrc}set src(t){this.player.config.url=t,this.paused?this.start(t):(this.pause(),this.once("pause",()=>{this.start(t)}),this.once("canplay",()=>{this.play()})),this.once("canplay",()=>{this.currentTime=0})}}t.exports=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i(36)),r=i(39),a=i(41),n=i(3),o=i(0),d=i(2),h=l(i(4));function l(t){return t&&t.__esModule?t:{default:t}}const u=o.EVENTS.REMUX_EVENTS,c=o.EVENTS.DEMUX_EVENTS,f=o.EVENTS.LOADER_EVENTS,p=o.EVENTS.MSE_EVENTS,m="FLVController";class g{warn(){}}const _="FLV_ERROR";e.default=class{constructor(t){this.TAG=m,this._player=t,this.state={initSegmentArrived:!1},this.bufferClearTimer=null}init(){this._context.registry("FETCH_LOADER",r.FetchLoader),this._context.registry("LOADER_BUFFER",n.XgBuffer),this._context.registry("FLV_DEMUXER",a.FlvDemuxer),this._context.registry("TRACKS",n.Tracks),this._context.registry("MP4_REMUXER",s.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",n.PreSource),!1!==this._player.config.compatibility&&this._context.registry("COMPATIBILITY",d.Compatibility),this._context.registry("LOGGER",g),this.mse=this._context.registry("MSE",o.Mse)({container:this._player.video}),this._handleTimeUpdate=this._handleTimeUpdate.bind(this),this.initListeners()}initListeners(){this.on(f.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(f.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(c.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(c.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(c.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(c.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(u.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(u.MEDIA_SEGMENT,this._handleMediaSegment.bind(this)),this.on(p.SOURCE_UPDATE_END,this._handleSourceUpdateEnd.bind(this)),this._player.on("timeupdate",this._handleTimeUpdate)}_handleMediaInfo(){this._context.mediaInfo||this.emit(c.DEMUX_ERROR,new Error("failed to get mediainfo"))}_handleLoaderDataLoaded(){this.emitTo("FLV_DEMUXER",c.DEMUX_START)}_handleMetadataParsed(t){this.emit(u.REMUX_METADATA,t)}_handleDemuxComplete(){this.emit(u.REMUX_MEDIA)}_handleAppendInitSegment(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}_handleMediaSegment(){this.mse.addSourceBuffers(),this.mse.doAppend()}_handleSourceUpdateEnd(){const t=this._player.currentTime,e=this._player.video,i=this._player.config.preloadTime||5,{length:s}=e.buffered;if(0===s)return;const r=e.buffered.end(s-1);r-t>2*i&&(this._player.currentTime=r-i),this.mse.doAppend()}_handleTimeUpdate(){const t=this._player.currentTime;let e=this._player.video.buffered;if(!e||!e.length)return;const i=e.start(e.length-1);if(t-i>10){if(this.bufferClearTimer)return;this.mse.remove(t-1,i),this.bufferClearTimer=setTimeout(()=>{this.bufferClearTimer=null},5e3)}}_handleNetworkError(t,e){this._player.emit("error",new h.default.Errors("network",this._player.config.url)),this._onError(f.LOADER_ERROR,t,e,!0)}_handleDemuxError(t,e,i){void 0===i&&(i=!1),this._player.emit("error",new h.default.Errors("parse",this._player.config.url)),this._onError(f.LOADER_ERROR,t,e,i)}_onError(t,e,i,s){let r={errorType:t,errorDetails:`[${e}]: ${i.message}`,errorFatal:s||!1};this._player.emit(_,r)}seek(){this.state.initSegmentArrived||this.loadData()}loadData(){this.emit(f.LADER_START,this._player.config.url)}pause(){const t=this._context.getInstance("FETCH_LOADER");t&&t.cancel()}destroy(){this._player.off("timeupdate",this._handleTimeUpdate),this._player=null,this.mse=null}}}])}));