!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],t):(e=e||self,e.FlvLiveMobilePlayer=t(e.Player))}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(){}function i(){i.init.call(this)}function r(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function a(e,t,n){if(t)e.call(n);else for(var i=e.length,r=v(e,i),a=0;a<i;++a)r[a].call(n)}function o(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,a=v(e,r),o=0;o<r;++o)a[o].call(n,i)}function s(e,t,n,i,r){if(t)e.call(n,i,r);else for(var a=e.length,o=v(e,a),s=0;s<a;++s)o[s].call(n,i,r)}function u(e,t,n,i,r,a){if(t)e.call(n,i,r,a);else for(var o=e.length,s=v(e,o),u=0;u<o;++u)s[u].call(n,i,r,a)}function c(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,a=v(e,r),o=0;o<r;++o)a[o].apply(n,i)}function l(e,t,i,a){var o,s,u;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if(s=e._events,s?(s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),u=s[t]):(s=e._events=new n,e._eventsCount=0),u){if("function"==typeof u?u=s[t]=a?[i,u]:[u,i]:a?u.unshift(i):u.push(i),!u.warned&&(o=r(e))&&o>0&&u.length>o){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=u.length,h(c)}}else u=s[t]=i,++e._eventsCount;return e}function h(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function f(e,t,n){function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}var r=!1;return i.listener=n,i}function d(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function p(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}function v(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function y(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":ge(t))&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":ge(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Fe(t))&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Fe(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Tt(t))&&"function"!=typeof t?e:t}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Tt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){return function(n){var i=this;if(!t)return new It(e);if(It&&!n){var r=G(`${t}`.replace(/^function.+?{/,"").slice(0,-1));return this[St]=new It(r),Pt.revokeObjectURL(r),this[St]}var a={postMessage:e=>{i.onmessage&&setTimeout(()=>i.onmessage({data:e,target:a}))}};t.call(a),this.postMessage=(e=>{setTimeout(()=>a.onmessage({data:e,target:i}))}),this.isThisThread=!0}}function G(e){try{return Pt.createObjectURL(new Blob([e],{type:xt}))}catch(n){var t=new Lt;return t.append(e),Pt.createObjectURL(t.getBlob(type))}}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Yt(t))&&"function"!=typeof t?e:t}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Yt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":$t(t))&&"function"!=typeof t?e:t}function $(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":$t(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}e=e&&e.hasOwnProperty("default")?e.default:e;var ne={VISIBILITY_CHANGE:"VISIBILITY_CHANGE"},ie={SEEK:"SEEK"},re={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},ae={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",SEI_PARSED:"SEI_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},oe={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",DETECT_CHANGE_STREAM_DISCONTINUE:"DETECT_CHANGE_STREAM_DISCONTINUE",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT"},se={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},ue={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},ce={START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"},le=Object.assign({},re,ae,oe,se,ue,ie,ne),he=[],fe=[];for(var de in le)le.hasOwnProperty(de)&&he.push(le[de]);for(var pe in le)le.hasOwnProperty(pe)&&fe.push(le[pe]);var ve={ALLEVENTS:le,HLS_EVENTS:ue,REMUX_EVENTS:oe,DEMUX_EVENTS:ae,MSE_EVENTS:se,LOADER_EVENTS:re,FlvAllowedEvents:he,HlsAllowedEvents:fe,CRYTO_EVENTS:ce,PLAYER_EVENTS:ie,BROWSER_EVENTS:ne},ye=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),me=function(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0},_e=function(){function e(){t(this,e),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return ye(e,[{key:"isComplete",value:function(){return e.isBaseInfoReady(this)&&e.isVideoReady(this)&&e.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(e){return me(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||me(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||me(e.video)}}]),e}();n.prototype=Object.create(null),i.EventEmitter=i,i.usingDomains=!1,i.prototype.domain=void 0,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.init=function(){this.domain=null,i.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return r(this)},i.prototype.emit=function(e){var t,n,i,r,l,h,f,d="error"===e;if(h=this._events)d=d&&null==h.error;else if(!d)return!1;if(f=this.domain,d){if(t=arguments[1],!f){if(t instanceof Error)throw t;var p=new Error('Uncaught, unspecified "error" event. ('+t+")");throw p.context=t,p}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=f,t.domainThrown=!1,f.emit("error",t),!1}if(!(n=h[e]))return!1;var v="function"==typeof n;switch(i=arguments.length){case 1:a(n,v,this);break;case 2:o(n,v,this,arguments[1]);break;case 3:s(n,v,this,arguments[1],arguments[2]);break;case 4:u(n,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),l=1;l<i;l++)r[l-1]=arguments[l];c(n,v,this,r)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var i,r,a,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===t||i.listener&&i.listener===t)0==--this._eventsCount?this._events=new n:(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(a=-1,o=i.length;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){s=i[o].listener,a=o;break}if(a<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new n,this;delete r[e]}else p(i,a);r.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new n,this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=new n:delete i[e]),this;if(0===arguments.length){for(var r,a=Object.keys(i),o=0;o<a.length;++o)"removeListener"!==(r=a[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new n,this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},i.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:y(t):[]},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(i)},Ee=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),we=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];g(this,e),this._emitter=new i,this._emitter.off||(this._emitter.off=this._emitter.removeListener),this.mediaInfo=new _e,this._instanceMap={},this._clsMap={},this._inited=!1,this.allowedEvents=t,this._hooks={}}return Ee(e,[{key:"getInstance",value:function(e){var t=this._instanceMap[e];return t||null}},{key:"initInstance",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=n[0],a=n[1],o=n[2],s=n[3];if(this._clsMap[e]){var u=new this._clsMap[e](r,a,o,s);return this._instanceMap[e]=u,u.init&&u.init(),u}throw new Error(e+"未在context中注册")}},{key:"init",value:function(e){if(!this._inited){for(var t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(e,t){var n=this,i=this._emitter,r=this._isMessageNameValid.bind(this),a=this,o=function(t){function n(t,i,r){g(this,n);var o=m(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,i,r));return o.listeners={},o.onceListeners={},o.TAG=e,o._context=a,o}return _(n,t),Ee(n,[{key:"on",value:function(t,n){return r(t),this.listeners[t]?this.listeners[t].push(n):this.listeners[t]=[n],i.on(t+"__TO__"+e,n),i.on(t,n)}},{key:"before",value:function(e,t){r(e),a._hooks[e]?a._hooks[e].push(t):a._hooks[e]=[t]}},{key:"once",value:function(t,n){return r(t),this.onceListeners[t]?this.onceListeners[t].push(n):this.onceListeners[t]=[n],i.once(t+"__TO__"+e,n),i.once(t,n)}},{key:"emit",value:function(e){r(e);var t=a._hooks?a._hooks[e]:null;if(t)for(var n=0,o=t.length;n<o;n++)(0,t[n])();for(var s=arguments.length,u=Array(s>1?s-1:0),c=1;c<s;c++)u[c-1]=arguments[c];return i.emit.apply(i,[e].concat(u))}},{key:"emitTo",value:function(e,t){r(t);for(var n=arguments.length,a=Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];return i.emit.apply(i,[t+"__TO__"+e].concat(a))}},{key:"off",value:function(e,t){return r(e),i.off(e,t)}},{key:"removeListeners",value:function(){var t=Object.prototype.hasOwnProperty.bind(this.listeners);for(var n in this.listeners)if(t(n))for(var r=this.listeners[n]||[],a=0;a<r.length;a++){var o=r[a];i.off(n,o),i.off(n+"__TO__"+e,o)}for(var s in this.onceListeners)if(t(s))for(var u=this.onceListeners[s]||[],c=0;c<u.length;c++){var l=u[c];i.off(s,l),i.off(s+"__TO__"+e,l)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete a._instanceMap[e],be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this))return be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(t);return this._clsMap[e]=o,function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return n.initInstance.apply(n,[e].concat(i))}}},{key:"seek",value:function(e){this._emitter.emit(ve.PLAYER_EVENTS.SEEK,e)}},{key:"destroyInstances",value:function(){var e=this;Object.keys(this._instanceMap).forEach(function(t){e._instanceMap[t].destroy&&e._instanceMap[t].destroy()})}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}},{key:"_isMessageNameValid",value:function(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error("unregistered message name: "+e)}}]),e}(),Te=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ke=function(){function e(t){b(this,e);var n={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},n,t):n}return Te(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),Ae=function(){function e(t){b(this,e);var n={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},n,t):n}return Te(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}(),Ce=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Re=function(){function e(t){E(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return Ce(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(n.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),n=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),t=e-t,t>0&&this._currentWordBitsLeft?n<<t|this.readBits(t):n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),De=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Oe=function(){function e(){w(this,e)}return De(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,a=0;a<n;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(i[r]=t[a],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new Re(n);i.readByte();var r=i.readByte();i.readByte();var a=i.readByte();i.readUEG();var o=e.getProfileString(r),s=e.getLevelString(a),u=1,c=420,l=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(c=l[u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)i.readBool()&&(d<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();for(var v=i.readUEG(),y=0;y<v;y++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),_=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var b=0,E=0,w=0,T=0;i.readBool()&&(b=i.readUEG(),E=i.readUEG(),w=i.readUEG(),T=i.readUEG());var k=1,A=1,C=0,R=!0,D=0,O=0;if(i.readBool()){if(i.readBool()){var S=i.readByte(),x=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],L=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];S>0&&S<16?(k=x[S-1],A=L[S-1]):255===S&&(k=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var P=i.readBits(32),I=i.readBits(32);R=i.readBool(),C=(D=I)/(O=2*P)}}var M=1;1===k&&1===A||(M=k/A);var B=0,N=0;0===u?(B=1,N=2-g):(B=3===u?1:2,N=(1===u?2:1)*(2-g));var U=16*(m+1),F=16*(_+1)*(2-g);U-=(b+E)*B,F-=(w+T)*N;var j=Math.ceil(U*M);return i.destroy(),i=null,{profile_string:o,level_string:s,bit_depth:h,chroma_format:c,chroma_format_string:e.getChromaFormatString(c),frame_rate:{fixed:R,fps:C,fps_den:O,fps_num:D},par_ratio:{width:k,height:A},codec_size:{width:U,height:F},present_size:{width:j,height:F}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=(n+e.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var n=t.frameRate.fps_den,i=t.frameRate.fps_num;return t.refSampleDuration=Math.floor(t.timescale*(n/i)),t}}]),e}(),Se=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),xe=function(){function e(){T(this,e)}return Se(e,null,[{key:"EBSP2RBSP",value:function(e){return e.filter(function(t,n){return n<2||!(0===e[n-2]&&0===e[n-1]&&3===t)})}},{key:"EBSP2SODB",value:function(e){var t=e[e.byteLength-1];return t&&128===t?e.slice(0,e.byteLength-1):e}}]),e}(),Le=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Pe=function(e){for(var t="",n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return t},Ie=function(){function e(){k(this,e)}return Le(e,null,[{key:"_resolveNalu",value:function(e){return e.length>=1?xe.EBSP2SODB(xe.EBSP2RBSP(e.slice(1))):null}},{key:"parse",value:function(t){var n=e._resolveNalu(t),i=e.switchPayloadType(n),r=i.payloadType,a=i.offset,o=n.slice(a);switch(r){case 5:return e.user_data_unregistered(o);default:return{}}}},{key:"switchPayloadType",value:function(e){for(var t=new DataView(e.buffer),n=0,i=0;255===t.getUint8(i);)i++,n+=255;return n+=t.getUint8(i++),{payloadType:n,offset:i}}},{key:"getPayloadLength",value:function(e){for(var t=new DataView(e.buffer),n=0,i=0;255===t.getUint8(i);)i++,n+=255;return n+=t.getUint8(i++),{payloadLength:n,offset:i}}},{key:"user_data_unregistered",value:function(t){var n=e.getPayloadLength(t),i=n.payloadLength,r=n.offset;if(i<16)return{uuid:"",content:null};var a=t.slice(r);return{uuid:Pe(a.slice(0,16)),content:Pe(a.slice(16,i))}}}]),e}(),Me=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Be=function(){function e(){A(this,e)}return Me(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var n=t.dataview,i=t.position;return 1===n.getInt32(i)||0===n.getInt16(i)&&1===n.getInt8(i+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var n=[],i=e.getHeaderPositionAnnexB(t),r=i.pos,a=r;r<t.length-4;){var o=t.buffer.slice(r,r+i.headerLength);i.pos===t.position&&t.skip(i.headerLength),a=(i=e.getHeaderPositionAnnexB(t)).pos;var s={header:o,body:new Uint8Array(t.buffer.slice(r+o.byteLength,a))};e.analyseNal(s),s.type<=9&&0!==s.type&&n.push(s),t.skip(a-t.position),r=a}return n}},{key:"getAvccNals",value:function(t){for(var n=[];t.position<t.length-4;){var i=t.dataview.getInt32(t.dataview.position);if(!(t.length-t.position>=i))break;var r=t.buffer.slice(t.position,t.position+4);t.skip(4);var a=new Uint8Array(t.buffer.slice(t.position,t.position+i));t.skip(i);var o={header:r,body:a};e.analyseNal(o),o.type<=9&&0!==o.type&&n.push(o)}return n}},{key:"analyseNal",value:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=Ie.parse(e.body);break;case 7:e.sps=Oe.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,n=0;3!==n&&4!==n&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?n=4:1===e.dataview.getInt8(t+2)?n=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(n=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?n=3:t=e.length)),{pos:t,headerLength:n}}},{key:"getAvcc",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength+11);n[0]=1,n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=255,n[5]=225;var i=6;return n.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),i),i+=2,n.set(e,i),i+=e.byteLength,n[i]=1,i++,n.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),i),i+=2,n.set(t,i),n}}]),e}(),Ne=Oe,Ue=Be,Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ge=function(){function e(){D(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return je(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"distroy",value:function(){this.reset(),this.id=-1}}]),e}(),Ve=function(e){function t(){D(this,t);var e=C(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.TAG="AudioTrack",e.type="audio",e}return R(t,e),t}(Ge),He=function(e){function t(){D(this,t);var e=C(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.TAG="VideoTrack",e.type="video",e.dropped=0,e}return R(t,e),je(t,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),t}(Ge),ze=(function(){function e(){D(this,e),this.audioTrack=null,this.videoTrack=null}je(e,[{key:"destroy",value:function(){this.audioTrack=null,this.videoTrack=null}}])}(),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),Xe=ve.BROWSER_EVENTS,We=void 0,Ye=void 0;void 0!==document.hidden?(We="hidden",Ye="visibilitychange"):void 0!==document.msHidden?(We="msHidden",Ye="msvisibilitychange"):void 0!==document.webkitHidden&&(We="webkitHidden",Ye="webkitvisibilitychange");var qe=function(){function e(){O(this,e),this.callbacks={onShow:[],onHidden:[]},this.handleVisibilityChange=this.handleVisibilityChange.bind(this),this.init()}return ze(e,[{key:"init",value:function(){document.addEventListener(Ye,this.handleVisibilityChange,!1)}},{key:"handleVisibilityChange",value:function(){this.emit(Xe.VISIBILITY_CHANGE,document[We])}},{key:"destroy",value:function(){document.removeEventListener(Ye,this.handleVisibilityChange)}}]),e}(),Ke=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),Je={get device(){var e=Je.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter(function(n){return t[n].test(e)}))[0]},get os(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,i=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||i&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isAndroid:i,isPc:!o&&!i&&!n,isSymbian:n,isWindowsPhone:t,isFireFox:r}},get isLe(){return Ke}},Ze=qe,$e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qe=function(){function e(){S(this,e)}return $e(e,null,[{key:"decode",value:function(t){for(var n=[],i=t,r=0,a=t.length;r<a;)if(i[r]<128)n.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(e._checkContinuation(i,r,1)){var o=(31&i[r])<<6|63&i[r+1];if(o>=128){n.push(String.fromCharCode(65535&o)),r+=2;continue}}}else if(i[r]<240){if(e._checkContinuation(i,r,2)){var s=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(s>=2048&&55296!=(63488&s)){n.push(String.fromCharCode(65535&s)),r+=3;continue}}}else if(i[r]<248&&e._checkContinuation(i,r,3)){var u=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(u>65536&&u<1114112){u-=65536,n.push(String.fromCharCode(u>>>10|55296)),n.push(String.fromCharCode(1023&u|56320)),r+=4;continue}}n.push(String.fromCharCode(65533)),++r}return n.join("")}},{key:"_checkContinuation",value:function(e,t,n){var i=e;if(t+n<i.length){for(;n--;)if(128!=(192&i[++t]))return!1;return!0}return!1}}]),e}(),et=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),tt=Je.isLe,nt={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12},it=function(){function e(){x(this,e),this.offset=0,this.readOffset=this.offset}return et(e,[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");var n={},i=this.parseValue(e),r=this.parseValue(e,t-i.bodySize);return n[i.data]=r.data,this.resetStatus(),n}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t=new DataView(e,this.readOffset).getUint16(0,!tt),n="";n=t>0?Qe.decode(new Uint8Array(e,this.readOffset+2,t)):"";var i=t+2;return this.readOffset+=i,{data:n,bodySize:t+2}}},{key:"parseDate",value:function(e,t){var n=new DataView(e,this.readOffset,t),i=n.getFloat64(0,!tt);return i+=60*n.getInt16(8,!tt)*1e3,this.readOffset+=10,{data:new Date(i),bodySize:10}}},{key:"parseObject",value:function(e,t){var n=this.parseString(e,t),i=this.parseValue(e,t-n.bodySize);return{data:{name:n.data,value:i.data},bodySize:n.bodySize+i.bodySize,isObjEnd:i.isObjEnd}}},{key:"parseLongString",value:function(e){var t=new DataView(e,this.readOffset).getUint32(0,!tt),n="";return n=t>0?Qe.decode(new Uint8Array(e,this.readOffset+2,t)):"",this.readOffset+=t+4,{data:n,bodySize:t+4}}},{key:"parseValue",value:function(e,t){var n=new ArrayBuffer;n=e instanceof ArrayBuffer?e:e.buffer;var i=nt.NUMBER,r=nt.BOOLEAN,a=nt.STRING,o=nt.OBJECT,s=nt.MIX_ARRAY,u=nt.OBJECT_END,c=nt.STRICT_ARRAY,l=nt.DATE,h=nt.LONE_STRING,f=new DataView(n,this.readOffset,t),d=!1,p=f.getUint8(0),v=1;this.readOffset+=1;var y=null;switch(p){case i:y=f.getFloat64(1,!tt),this.readOffset+=8,v+=8;break;case r:y=!!f.getUint8(1),this.readOffset+=1,v+=1;break;case a:var m=this.parseString(n);y=m.data,v+=m.bodySize;break;case o:y={};var _=0;for(16777215&f.getUint32(t-4,!tt)&&(_=3);v<t-4;){var g=this.parseObject(n,t-v-_);if(g.isObjectEnd)break;y[g.data.name]=g.data.value,v+=g.bodySize}v<=t-3&&9===(16777215&f.getUint32(v-1,!tt))&&(this.readOffset+=3,v+=3);break;case s:y={},v+=4,this.readOffset+=4;var b=0;for(9==(16777215&f.getUint32(t-4,!tt))&&(b=3);v<t-8;){var E=this.parseObject(n,t-v-b);if(E.isObjectEnd)break;y[E.data.name]=E.data.value,v+=E.bodySize}v<=t-3&&9===(16777215&f.getUint32(v-1,!tt))&&(v+=3,this.readOffset+=3);break;case u:y=null,d=!0;break;case c:y=[];var w=f.getUint32(1,!tt);v+=4,this.readOffset+=4;for(var T=0;T<w;T++){var k=this.parseValue(n,t-v);y.push(k.data),v+=k.bodySize}break;case l:var A=this.parseDate(n,t-1);y=A.data,v+=A.bodySize;break;case h:var C=this.parseLongString(n,t-1);y=C.data,v+=C.bodySize;break;default:v=t}return{data:y,bodySize:v,isObjEnd:d}}}]),e}(),rt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),at=function(){function e(t){if(L(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return rt(e,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(t){for(var n=Math.floor(t/4),i=t%4,r=0;r<n;r++)e.readByte(this.dataview,4);i>0&&e.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,n){var i=void 0;switch(t){case 1:i=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw new Error("not supported for readByte 3");i=e.getUint8(e.position)<<16,i|=e.getUint8(e.position+1)<<8,i|=e.getUint8(e.position+2);break;case 4:i=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw new Error("not supported for readBody 8");i=e.getUint32(e.position)<<32,i|=e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}]),e}(),ot=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),st=ve.DEMUX_EVENTS,ut=function(){function e(){P(this,e),this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}return ot(e,[{key:"init",value:function(){this.on(st.DEMUX_START,this.doParseFlv.bind(this))}},{key:"doParseFlv",value:function(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;var e=void 0,t=1e4;do{e=this._parseFlvTag()}while(e&&t-- >0);this.emit(st.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;var n=this.loaderBuffer.shift(13);this.parseFlvHeader(n),this.doParseFlv()}}},{key:"parseFlvHeader",value:function(t){e.isFlvFile(t)?(this._firstFragmentLoaded=!0,this.initVideoTrack(),this.initAudioTrack()):(this.emit(st.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv()),this.doParseFlv()}},{key:"initVideoTrack",value:function(){this._trackNum++;var e=new He;e.meta=new Ae,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;var e=new Ve;e.meta=new ke,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"_parseFlvTag",value:function(){if(this.loaderBuffer.length<11)return null;var e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}},{key:"_parseFlvTagHeader",value:function(){var e=0,t={},n=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&n)>>>5,t.tagType=31&n,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.emit(st.DEMUX_ERROR,this.TAG,new Error("tagType "+t.tagType),!1),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);var i=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);var r=this.loaderBuffer.shift(1)[0];return r>0&&(i+=16777216*r),t.dts=i,this.loaderBuffer.shift(3),t}},{key:"_processChunk",value:function(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}},{key:"_parseScriptData",value:function(e){var t=this.tracks.audioTrack,n=this.tracks.videoTrack,i=this.loaderBuffer.shift(e.datasize),r=(new it).resolve(i,i.length),a=this._context.onMetaData=r?r.onMetaData:void 0;if(this._context.mediaInfo.duration=a.duration,this._context.mediaInfo.hasVideo=a.hasVideo,this._context.mediaInfo.hsaAudio=a.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(st.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){var o=t.meta;switch(a.audiosamplerate&&(o.sampleRate=a.audiosamplerate),a.audiochannels&&(o.channelCount=a.audiochannels),a.audiosamplerate){case 44100:o.sampleRateIndex=4;break;case 22050:o.sampleRateIndex=7;break;case 11025:o.sampleRateIndex=10}}if(n&&!n.hasSpecificConfig){var s=n.meta;if("number"==typeof a.framerate){var u=Math.floor(1e3*a.framerate);if(u>0){var c=u/1e3;s.frameRate||(s.frameRate={}),s.frameRate.fixed=!0,s.frameRate.fps=c,s.frameRate.fps_num=u,s.frameRate.fps_den=1e3}}}}},{key:"_aacSequenceHeaderParser",value:function(e){var t={};t.hasSpecificConfig=!0,t.objectType=e[1]>>>3,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2];var n=window.navigator.userAgent.toLowerCase(),i=void 0,r=void 0,a=t.sampleRateIndex;return-1!==n.indexOf("firefox")?t.sampleRateIndex>=6?(t.objectType=5,r=new Array(4),i=a-3):(t.objectType=2,r=new Array(2),i=a):-1!==n.indexOf("android")||-1!==n.indexOf("safari")?(t.objectType=2,r=new Array(2),i=a):(t.objectType=5,i=t.sampleRateIndex,r=new Array(4),t.sampleRateIndex>=6?i=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,r=new Array(2),i=t.sampleRateIndex)),t.codec="mp4a.40."+t.objectType,r[0]=t.objectType<<3,r[0]|=(15&t.sampleRateIndex)>>>1,r[1]=(15&t.sampleRateIndex)<<7,r[1]|=(15&t.channelCount)<<3,5===t.objectType&&(r[1]|=(15&i)>>>1,r[2]=(1&i)<<7,r[2]|=8,r[3]=0),t.config=r,t}},{key:"_parseAACData",value:function(e){var t=this.tracks.audioTrack;if(t){var n=t.meta;n||(t.meta=new ke,n=t.meta);var i=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);var r=(240&i)>>>4;t.format=r,10!==r&&this.emit(st.DEMUX_ERROR,new Error("invalid audio format: "+r)),10!==r||this._hasAudioSequence||(n.sampleRate=this._switchAudioSamplingFrequency(i),n.sampleRateIndex=(12&i)>>>2,n.frameLenth=(2&i)>>>1,n.channelCount=1&i,n.refSampleDuration=Math.floor(1024/n.audioSampleRate*n.timescale));var a=n.audioSampleRate,o=n.sampleRateIndex,s=n.refSampleDuration;delete e.tagType;var u=this._datasizeValidator(e.datasize);if(0===e.data[0]){var c=this._aacSequenceHeaderParser(e.data);a=c.audiosamplerate||n.audioSampleRate,o=c.sampleRateIndex||n.sampleRateIndex,s=Math.floor(1024/a*n.timescale),n.channelCount=c.channelCount,n.sampleRate=a,n.sampleRateIndex=o,n.refSampleDuration=s,n.duration=this._context.mediaInfo.duration*n.timescale,n.config=c.config,n.objectType=c.objectType;var l=this._context.mediaInfo.audio;l.codec=c.codec,l.channelCount=c.channelCount,l.sampleRate=a,l.sampleRateIndex=c.audioSampleRateIndex,this._hasAudioSequence?this.emit(st.AUDIO_METADATA_CHANGE):this.emit(st.METADATA_PARSED,"audio"),this._hasAudioSequence=!0,this._metaChange=!0}else this._metaChange&&(e.options={meta:t.meta},this._metaChange=!1),e.data=e.data.slice(1,e.data.length),t.samples.push(e);u||this.emit(st.DEMUX_ERROR,this.TAG,new Error("TAG length error at "+e.datasize),!1)}}},{key:"_parseHevcData",value:function(e){var t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;var n=15&t;if(this.tracks.videoTrack.codecID=n,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===n){var i=this.loaderBuffer.shift(e.datasize-5);if(e.data=i,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.emit(st.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1);var r={},a=0;for(r.cts=e.cts,r.dts=e.dts;e.data.length>a;){var o=e.data.slice(Number.parseInt(a),4+a);r.size=o[3],r.size+=256*o[2],r.size+=256*o[1]*256,r.size+=256*o[0]*256*256,a+=4,r.data=e.data.slice(Number.parseInt(a),r.size+a),a+=r.size,this.tracks.videoTrack.samples.push(r),this.emit(st.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(st.METADATA_PARSED,"video"):this.emit(st.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1))}else if(7===n){var s=this.loaderBuffer.shift(e.datasize-5);if(0===s[4]&&0===s[5]&&0===s[6]&&1===s[7]){for(var u=0,c=0;c<4;c++)u=256*u+s[c];u-=4,(s=s.slice(4,s.length))[3]=u%256,u=(u-s[3])/256,s[2]=u%256,u=(u-s[2])/256,s[1]=u%256,s[0]=(u-s[1])/256}if(e.data=s,0===e.avcPacketType)this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasVideoSequence?this.emit(st.VIDEO_METADATA_CHANGE):this.emit(st.METADATA_PARSED,"video"),this._hasVideoSequence=!0),this._metaChange=!0;else{if(!this._datasizeValidator(e.datasize))return void this.emit(st.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1);for(var l=Ue.getAvccNals(new at(e.data.buffer)),h=0;h<l.length;h++){var f=l[h];Ue.analyseNal(f),f.sei&&this.emit(st.SEI_PARSED,f.sei)}this._metaChange&&(e.options={meta:Object.assign({},this.tracks.videoTrack.meta)},this._metaChange=!1),this.tracks.videoTrack.samples.push(e)}}else this.emit(st.DEMUX_ERROR,this.TAG,new Error("video codeid is "+n),!1),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.emit(st.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1),this.tracks.videoTrack.samples.push(e),this.emit(st.DEMUX_COMPLETE);delete e.tagType}},{key:"_avcSequenceHeaderParser",value:function(e){var t=this.tracks.videoTrack;if(t){var n=0;t.meta||(t.meta=new Ae);var i=t.meta;i.configurationVersion=e[0],i.avcProfileIndication=e[1],i.profileCompatibility=e[2],i.avcLevelIndication=e[3]/10,i.nalUnitLength=1+(3&e[4]);var r=31&e[5];n=6;for(var a={},o=0;o<r;o++){var s=255*e[n]+e[n+1];n+=2;for(var u=new Uint8Array(s),c=0;c<s;c++)u[c]=e[n+c];for(var l="avc1.",h=1;h<4;h++){var f=u[h].toString(16);f.length<2&&(f="0"+f),l+=f}i.codec=l,n+=s,this.tracks.videoTrack.meta.sps=u,a=Ne.parseSPS(u)}var d=e[n];n++;for(var p=0;p<d;p++){var v=255*e[n]+e[n+1];n+=2;for(var y=new Uint8Array(v),m=0;m<v;m++)y[m]=e[n+m];n+=v,this.tracks.videoTrack.meta.pps=y}Object.assign(i,Ne.toVideoMeta(a));var _=this._context.mediaInfo.video;_.codec=i.codec,_.profile=i.profile,_.level=i.level,_.chromaFormat=i.chromaFormat,_.frameRate=i.frameRate,_.parRatio=i.parRatio,_.width=_.width===i.presentWidth?_.width:i.presentWidth,_.height=_.height===i.presentHeight?_.width:i.presentHeight,i.duration=this._context.mediaInfo.duration*i.timescale,i.avcc=new Uint8Array(e.length),i.avcc.set(e),t.meta=i}}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e){var t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}},{key:"loaderBuffer",get:function(){var e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(st.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}}],[{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),e}(),ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt="function"==typeof Symbol&&"symbol"===ct(Symbol.iterator)?function(e){return void 0===e?"undefined":ct(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":ct(e)},ht=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ft=ve.LOADER_EVENTS,dt=function(){function e(t){I(this,e),this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}return ht(e,[{key:"init",value:function(){this.on(ft.LADER_START,this.load.bind(this))}},{key:"load",value:function(e,t){var n=this;this.url=e,this._canceled=!1;var i=this.getParams(t);return this.loading=!0,fetch(this.url,i).then(function(e){if(e.ok)return n.status=e.status,Promise.resolve().then(function(){n._onFetchResponse(e)}),Promise.resolve(e);n.loading=!1,n.emit(ft.LOADER_ERROR,n.TAG,new Error(e.status+" ("+e.statusText+")"))}).catch(function(e){throw n.loading=!1,n.emit(ft.LOADER_ERROR,n.TAG,e),e})}},{key:"_onFetchResponse",value:function(e){var t=this,n=this._context.getInstance(this.buffer),i=++this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case 2:e.json().then(function(e){t.loading=!1,t._canceled||t._destroyed||(n?(n.push(e),t.emit(ft.LOADER_COMPLETE,n)):t.emit(ft.LOADER_COMPLETE,e))});break;case 1:e.text().then(function(e){t.loading=!1,t._canceled||t._destroyed||(n?(n.push(e),t.emit(ft.LOADER_COMPLETE,n)):t.emit(ft.LOADER_COMPLETE,e))});break;case 3:e.arrayBuffer().then(function(e){t.loading=!1,t._canceled||t._destroyed||(n?(n.push(new Uint8Array(e)),t.emit(ft.LOADER_COMPLETE,n)):t.emit(ft.LOADER_COMPLETE,e))});break;case 0:default:return this._onReader(e.body.getReader(),i)}}},{key:"_onReader",value:function(e,t){var n=this,i=this._context.getInstance(this.buffer);if(!i&&this._reader||this._destroyed)try{this._reader.cancel()}catch(e){}this._reader=e,!1!==this.loading&&this._reader&&this._reader.read().then(function(r){if(!n._canceled&&!n._destroyed)return r.done?(n.loading=!1,n.status=0,void Promise.resolve().then(function(){n.emit(ft.LOADER_COMPLETE,i)})):(i.push(r.value),Promise.resolve().then(function(){n.emit(ft.LOADER_DATALOADED,i)}),n._onReader(e,t));if(n._reader)try{n._reader.cancel()}catch(e){}}).catch(function(e){throw n.loading=!1,n.emit(ft.LOADER_ERROR,n.TAG,e),e})}},{key:"getParams",value:function(e){var t=Object.assign({},e),n=new Headers,i={method:"GET",headers:n,mode:"cors",cache:"default"};if("object"===lt(this.configs.headers)){var r=this.configs.headers;for(var a in r)r.hasOwnProperty(a)&&n.append(a,r[a])}if("object"===lt(t.headers)){var o=t.headers;for(var s in o)o.hasOwnProperty(s)&&n.append(s,o[s])}return!1===t.cors&&(i.mode="same-origin"),t.withCredentials&&(i.credentials="include"),i}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(e){}this._reader=null,this.loading=!1}this._canceled=!0}},{key:"destroy",value:function(){this._destroyed=!0,this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),e}(),pt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),vt=function(){function e(t){M(this,e),this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}return pt(e,[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){var t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){var n=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,n}for(var i=new Uint8Array(e),r=0;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){var a=this.array[0].slice(this.offset,this.offset+e);i.set(a,r),this.offset+=e,this.length-=e,e=0;break}var o=this.array[0].length-this.offset;i.set(this.array[0].slice(this.offset,this.array[0].length),r),this.array.shift(),this.offset=0,r+=o,this.length-=o,e-=o}return i}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){for(var n=0,i=this.offset+e;i<this.offset+t+e;)i<this.array[0].length?n=256*n+this.array[0][i]:this.array[1]&&(n=256*n+this.array[1][i-this.array[0].length]),i++;return n}}]),e}(),yt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),mt=ve.DEMUX_EVENTS,_t=ve.LOADER_EVENTS,gt=ve.BROWSER_EVENTS,bt="FLVController",Et=function(){function e(){B(this,e)}return yt(e,[{key:"warn",value:function(){}}]),e}(),wt=function(){function t(e){B(this,t),this.TAG=bt,this._player=e,this.state={initSegmentArrived:!1,randomAccessPoints:[]},this.bufferClearTimer=null}return yt(t,[{key:"init",value:function(){this.initComponents(),this.initListeners()}},{key:"initComponents",value:function(){this._context.registry("FETCH_LOADER",dt),this._context.registry("LOADER_BUFFER",vt),this._context.registry("FLV_DEMUXER",ut),this._context.registry("TRACKS",Ge),this._context.registry("LOGGER",Et),this._context.registry("PAGE_VISIBILITY",Ze)}},{key:"initListeners",value:function(){this.on(_t.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(_t.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(mt.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(mt.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(mt.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(mt.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(mt.SEI_PARSED,this._handleSEIParsed.bind(this)),this.on(gt.VISIBILITY_CHANGE,this._handleVisibilityChange.bind(this))}},{key:"_handleMediaInfo",value:function(){this._context.mediaInfo||this.emit(mt.DEMUX_ERROR,new Error("failed to get mediainfo"))}},{key:"_handleLoaderDataLoaded",value:function(){this.emitTo("FLV_DEMUXER",mt.DEMUX_START)}},{key:"_handleSEIParsed",value:function(e){this._player.emit("SEI_PARSED",e)}},{key:"_handleDemuxComplete",value:function(){if(this._player.video){var e=this._context.getInstance("TRACKS"),t=e.videoTrack,n=e.audioTrack;this._player.video.onDemuxComplete(t,n)}}},{key:"_handleVisibilityChange",value:function(e){e||this._player.paused||this._player.pause()}},{key:"_handleMetadataParsed",value:function(e){if("audio"===e){var t=this._context.getInstance("TRACKS").audioTrack;t&&t.meta&&this._setMetaToAudio(t.meta)}else{var n=this._context.getInstance("TRACKS").videoTrack;n&&n.meta&&this._setMetaToVideo(n.meta)}}},{key:"_setMetaToAudio",value:function(e){this._player.video&&this._player.video.setAudioMeta(e)}},{key:"_setMetaToVideo",value:function(e){this._player.video&&this._player.video.setVideoMeta(e)}},{key:"_handleAppendInitSegment",value:function(){this.state.initSegmentArrived=!0}},{key:"_handleNetworkError",value:function(t,n){this._player.emit("error",new e.Errors("network",this._player.config.url)),this._onError(_t.LOADER_ERROR,t,n,!0)}},{key:"_handleDemuxError",value:function(t,n,i){void 0===i&&(i=!1),this._player.emit("error",new e.Errors("parse",this._player.config.url)),this._onError(mt.DEMUX_ERROR,t,n,i)}},{key:"_handleAddRAP",value:function(e){this.state.randomAccessPoints&&this.state.randomAccessPoints.push(e)}},{key:"_onError",value:function(e,t,n,i){var r={errorType:e,errorDetails:"["+t+"]: "+n.message,errorFatal:i||!1};this._player.emit("FLV_ERROR",r)}},{key:"seek",value:function(){this.state.initSegmentArrived||this.loadData()}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._player.config.url;this.emit(_t.LADER_START,e)}},{key:"pause",value:function(){var e=this._context.getInstance("FETCH_LOADER");e&&e.cancel()}},{key:"destroy",value:function(){this._player=null,this.state.randomAccessPoints=[]}}]),t}();(function(){function e(e){var t=de.has(e);return e=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(e),!t&&e}function t(e){var t=e.isConnected;if(void 0!==t)return t;if(pe(e))return!0;for(;e&&!(e.__CE_isImportDocument||e instanceof Document);)e=e.parentNode||(window.ShadowRoot&&e instanceof ShadowRoot?e.host:void 0);return!(!e||!(e.__CE_isImportDocument||e instanceof Document))}function n(e){var t=e.children;if(t)return Array.prototype.slice.call(t);for(t=[],e=e.firstChild;e;e=e.nextSibling)e.nodeType===Node.ELEMENT_NODE&&t.push(e);return t}function i(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}function r(e,t,n){for(var a=e;a;){if(a.nodeType===Node.ELEMENT_NODE){var o=a;t(o);var s=o.localName;if("link"===s&&"import"===o.getAttribute("rel")){if(a=o.import,void 0===n&&(n=new Set),a instanceof Node&&!n.has(a))for(n.add(a),a=a.firstChild;a;a=a.nextSibling)r(a,t,n);a=i(e,o);continue}if("template"===s){a=i(e,o);continue}if(o=o.__CE_shadowRoot)for(o=o.firstChild;o;o=o.nextSibling)r(o,t,n)}a=a.firstChild?a.firstChild:i(e,a)}}function a(e,t,n){e[t]=n}function o(e){var t=document;this.c=e,this.a=t,this.b=void 0,T(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function s(e){e.b&&e.b.disconnect()}function u(){var e=this;this.b=this.a=void 0,this.c=new Promise(function(t){e.b=t,e.a&&t(e.a)})}function c(e){if(e.a)throw Error("Already resolved.");e.a=void 0,e.b&&e.b(void 0)}function l(e){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=e,this.j=new Map,this.c=function(e){return e()},this.a=!1,this.h=[],this.m=e.f?new o(e):void 0}function h(t,n){if(!e(n))throw new SyntaxError("The element name '"+n+"' is not valid.");if(p(t,n))throw Error("A custom element with name '"+n+"' has already been defined.");if(t.i)throw Error("A custom element is already being defined.")}function f(e,t,n){e.i=!0;var i;try{var r=function(e){var t=a[e];if(void 0!==t&&!(t instanceof Function))throw Error("The '"+e+"' callback must be a function.");return t},a=n.prototype;if(!(a instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var o=r("connectedCallback"),s=r("disconnectedCallback"),u=r("adoptedCallback"),c=(i=r("attributeChangedCallback"))&&n.observedAttributes||[]}catch(e){throw e}finally{e.i=!1}return n={localName:t,constructorFunction:n,connectedCallback:o,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:i,observedAttributes:c,constructionStack:[]},e.g.set(t,n),e.l.set(n.constructorFunction,n),n}function d(e){if(!1!==e.a){e.a=!1;for(var t=[],n=e.h,i=new Map,r=0;r<n.length;r++)i.set(n[r],[]);for(T(e.b,document,{upgrade:function(n){if(void 0===n.__CE_state){var r=n.localName,a=i.get(r);a?a.push(n):e.g.has(r)&&t.push(n)}}}),r=0;r<t.length;r++)k(e.b,t[r]);for(r=0;r<n.length;r++){for(var a=n[r],o=i.get(a),s=0;s<o.length;s++)k(e.b,o[s]);(a=e.j.get(a))&&c(a)}n.length=0}}function p(e,t){var n=e.g.get(t);if(n)return n;if(n=e.f.get(t)){e.f.delete(t);try{return f(e,t,n())}catch(e){C(e)}}}function v(){var e=ye&&ye.noDocumentConstructionObserver,t=ye&&ye.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=t,this.f=!e}function y(e,t,n,i){var a=window.ShadyDOM;if(e.shadyDomFastWalk&&a&&a.inUse){if(t.nodeType===Node.ELEMENT_NODE&&n(t),t.querySelectorAll)for(e=a.nativeMethods.querySelectorAll.call(t,"*"),t=0;t<e.length;t++)n(e[t])}else r(t,n,i)}function m(e,t){e.a=!0,e.b.push(t)}function _(e,t){e.a=!0,e.c.push(t)}function g(e,t){e.a&&y(e,t,function(t){return b(e,t)})}function b(e,t){if(e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var n=0;n<e.b.length;n++)e.b[n](t);for(n=0;n<e.c.length;n++)e.c[n](t)}}function E(e,t){var n=[];for(y(e,t,function(e){return n.push(e)}),t=0;t<n.length;t++){var i=n[t];1===i.__CE_state?e.connectedCallback(i):k(e,i)}}function w(e,t){var n=[];for(y(e,t,function(e){return n.push(e)}),t=0;t<n.length;t++){var i=n[t];1===i.__CE_state&&e.disconnectedCallback(i)}}function T(e,t,n){var i=(n=void 0===n?{}:n).s,r=n.upgrade||function(t){return k(e,t)},a=[];for(y(e,t,function(t){if(e.a&&b(e,t),"link"===t.localName&&"import"===t.getAttribute("rel")){var n=t.import;n instanceof Node&&(n.__CE_isImportDocument=!0,n.__CE_registry=document.__CE_registry),n&&"complete"===n.readyState?n.__CE_documentLoadHandled=!0:t.addEventListener("load",function(){var n=t.import;if(!n.__CE_documentLoadHandled){n.__CE_documentLoadHandled=!0;var a=new Set;i&&(i.forEach(function(e){return a.add(e)}),a.delete(n)),T(e,n,{s:a,upgrade:r})}})}else a.push(t)},i),t=0;t<a.length;t++)r(a[t])}function k(e,n){try{var i=n.ownerDocument,r=i.__CE_registry,a=r&&(i.defaultView||i.__CE_isImportDocument)?p(r,n.localName):void 0;if(a&&void 0===n.__CE_state){a.constructionStack.push(n);try{try{if(new a.constructorFunction!==n)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{a.constructionStack.pop()}}catch(e){throw n.__CE_state=2,e}if(n.__CE_state=1,n.__CE_definition=a,a.attributeChangedCallback&&n.hasAttributes()){var o=a.observedAttributes;for(a=0;a<o.length;a++){var s=o[a],u=n.getAttribute(s);null!==u&&e.attributeChangedCallback(n,s,null,u,null)}}t(n)&&e.connectedCallback(n)}}catch(e){C(e)}}function A(e,t,n,i){var r=t.__CE_registry;if(r&&(null===i||"http://www.w3.org/1999/xhtml"===i)&&(r=p(r,n)))try{var a=new r.constructorFunction;if(void 0===a.__CE_state||void 0===a.__CE_definition)throw Error("Failed to construct '"+n+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==a.namespaceURI)throw Error("Failed to construct '"+n+"': The constructed element's namespace must be the HTML namespace.");if(a.hasAttributes())throw Error("Failed to construct '"+n+"': The constructed element must not have any attributes.");if(null!==a.firstChild)throw Error("Failed to construct '"+n+"': The constructed element must not have any children.");if(null!==a.parentNode)throw Error("Failed to construct '"+n+"': The constructed element must not have a parent node.");if(a.ownerDocument!==t)throw Error("Failed to construct '"+n+"': The constructed element's owner document is incorrect.");if(a.localName!==n)throw Error("Failed to construct '"+n+"': The constructed element's local name is incorrect.");return a}catch(r){return C(r),t=null===i?I.call(t,n):M.call(t,i,n),Object.setPrototypeOf(t,HTMLUnknownElement.prototype),t.__CE_state=2,t.__CE_definition=void 0,b(e,t),t}return t=null===i?I.call(t,n):M.call(t,i,n),b(e,t),t}function C(e){var t=e.message,n=e.sourceURL||e.fileName||"",i=e.line||e.lineNumber||0,r=e.column||e.columnNumber||0,a=void 0;void 0===ErrorEvent.prototype.initErrorEvent?a=new ErrorEvent("error",{cancelable:!0,message:t,filename:n,lineno:i,colno:r,error:e}):((a=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,t,n,i),a.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===a.error&&Object.defineProperty(a,"error",{configurable:!0,enumerable:!0,get:function(){return e}}),window.dispatchEvent(a),a.defaultPrevented||console.error(e)}function R(e){window.HTMLElement=function(){function t(){var t=this.constructor,n=document.__CE_registry.l.get(t);if(!n)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var i=n.constructionStack;if(0===i.length)return i=I.call(document,n.localName),Object.setPrototypeOf(i,t.prototype),i.__CE_state=1,i.__CE_definition=n,b(e,i),i;var r=i.length-1,a=i[r];if(a===ve)throw Error("Failed to construct '"+n.localName+"': This element was already constructed.");return i[r]=ve,Object.setPrototypeOf(a,t.prototype),b(e,a),a}return t.prototype=ce.prototype,Object.defineProperty(t.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:t}),t}()}function D(e,n,i){function r(n){return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];a=[];for(var o=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&t(u)&&o.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)a.push(u);else a.push(u)}for(n.apply(this,r),r=0;r<o.length;r++)w(e,o[r]);if(t(this))for(r=0;r<a.length;r++)(o=a[r])instanceof Element&&E(e,o)}}void 0!==i.prepend&&a(n,"prepend",r(i.prepend)),void 0!==i.append&&a(n,"append",r(i.append))}function O(e){a(Document.prototype,"createElement",function(t){return A(e,this,t,null)}),a(Document.prototype,"importNode",function(t,n){return t=B.call(this,t,!!n),this.__CE_registry?T(e,t):g(e,t),t}),a(Document.prototype,"createElementNS",function(t,n){return A(e,this,n,t)}),D(e,Document.prototype,{prepend:N,append:U})}function S(e){function i(n,i){Object.defineProperty(n,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,n);else{var r=void 0;if(this.firstChild){var a=this.childNodes,o=a.length;if(0<o&&t(this)){r=Array(o);for(var s=0;s<o;s++)r[s]=a[s]}}if(i.set.call(this,n),r)for(n=0;n<r.length;n++)w(e,r[n])}}})}a(Node.prototype,"insertBefore",function(i,r){if(i instanceof DocumentFragment){var a=n(i);if(i=H.call(this,i,r),t(this))for(r=0;r<a.length;r++)E(e,a[r]);return i}return a=i instanceof Element&&t(i),r=H.call(this,i,r),a&&w(e,i),t(this)&&E(e,i),r}),a(Node.prototype,"appendChild",function(i){if(i instanceof DocumentFragment){var r=n(i);if(i=V.call(this,i),t(this))for(var a=0;a<r.length;a++)E(e,r[a]);return i}return r=i instanceof Element&&t(i),a=V.call(this,i),r&&w(e,i),t(this)&&E(e,i),a}),a(Node.prototype,"cloneNode",function(t){return t=G.call(this,!!t),this.ownerDocument.__CE_registry?T(e,t):g(e,t),t}),a(Node.prototype,"removeChild",function(n){var i=n instanceof Element&&t(n),r=z.call(this,n);return i&&w(e,n),r}),a(Node.prototype,"replaceChild",function(i,r){if(i instanceof DocumentFragment){var a=n(i);if(i=X.call(this,i,r),t(this))for(w(e,r),r=0;r<a.length;r++)E(e,a[r]);return i}a=i instanceof Element&&t(i);var o=X.call(this,i,r),s=t(this);return s&&w(e,r),a&&w(e,i),s&&E(e,i),o}),W&&W.get?i(Node.prototype,W):m(e,function(e){i(e,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=this.firstChild;t;t=t.nextSibling)t.nodeType!==Node.COMMENT_NODE&&e.push(t.textContent);return e.join("")},set:function(e){for(;this.firstChild;)z.call(this,this.firstChild);null!=e&&""!==e&&V.call(this,document.createTextNode(e))}})})}function x(e){function n(n){return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];a=[];for(var o=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&t(u)&&o.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)a.push(u);else a.push(u)}for(n.apply(this,r),r=0;r<o.length;r++)w(e,o[r]);if(t(this))for(r=0;r<a.length;r++)(o=a[r])instanceof Element&&E(e,o)}}var i=Element.prototype;void 0!==ae&&a(i,"before",n(ae)),void 0!==oe&&a(i,"after",n(oe)),void 0!==se&&a(i,"replaceWith",function(n){for(var i=[],r=0;r<arguments.length;++r)i[r]=arguments[r];r=[];for(var a=[],o=0;o<i.length;o++){var s=i[o];if(s instanceof Element&&t(s)&&a.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(o=t(this),se.apply(this,i),i=0;i<a.length;i++)w(e,a[i]);if(o)for(w(e,this),i=0;i<r.length;i++)(a=r[i])instanceof Element&&E(e,a)}),void 0!==ue&&a(i,"remove",function(){var n=t(this);ue.call(this),n&&w(e,this)})}function L(e){function n(n,i){Object.defineProperty(n,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){var r=this,a=void 0;if(t(this)&&(a=[],y(e,this,function(e){e!==r&&a.push(e)})),i.set.call(this,n),a)for(var o=0;o<a.length;o++){var s=a[o];1===s.__CE_state&&e.disconnectedCallback(s)}return this.ownerDocument.__CE_registry?T(e,this):g(e,this),n}})}function i(n,i){a(n,"insertAdjacentElement",function(n,r){var a=t(r);return n=i.call(this,n,r),a&&w(e,r),t(n)&&E(e,r),n})}function r(t,n){function i(t,n){for(var i=[];t!==n;t=t.nextSibling)i.push(t);for(n=0;n<i.length;n++)T(e,i[n])}a(t,"insertAdjacentHTML",function(e,t){if("beforebegin"===(e=e.toLowerCase())){var r=this.previousSibling;n.call(this,e,t),i(r||this.parentNode.firstChild,this)}else if("afterbegin"===e)r=this.firstChild,n.call(this,e,t),i(this.firstChild,r);else if("beforeend"===e)r=this.lastChild,n.call(this,e,t),i(r||this.firstChild,null);else{if("afterend"!==e)throw new SyntaxError("The value provided ("+String(e)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,n.call(this,e,t),i(this.nextSibling,r)}})}Y&&a(Element.prototype,"attachShadow",function(t){if(t=Y.call(this,t),e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var n=0;n<e.b.length;n++)e.b[n](t)}return this.__CE_shadowRoot=t}),q&&q.get?n(Element.prototype,q):le&&le.get?n(HTMLElement.prototype,le):_(e,function(e){n(e,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(e){var t="template"===this.localName,n=t?this.content:this,i=M.call(document,this.namespaceURI,this.localName);for(i.innerHTML=e;0<n.childNodes.length;)z.call(n,n.childNodes[0]);for(e=t?i.content:i;0<e.childNodes.length;)V.call(n,e.childNodes[0])}})}),a(Element.prototype,"setAttribute",function(t,n){if(1!==this.__CE_state)return J.call(this,t,n);var i=K.call(this,t);J.call(this,t,n),n=K.call(this,t),e.attributeChangedCallback(this,t,i,n,null)}),a(Element.prototype,"setAttributeNS",function(t,n,i){if(1!==this.__CE_state)return Q.call(this,t,n,i);var r=$.call(this,t,n);Q.call(this,t,n,i),i=$.call(this,t,n),e.attributeChangedCallback(this,n,r,i,t)}),a(Element.prototype,"removeAttribute",function(t){if(1!==this.__CE_state)return Z.call(this,t);var n=K.call(this,t);Z.call(this,t),null!==n&&e.attributeChangedCallback(this,t,n,null,null)}),a(Element.prototype,"removeAttributeNS",function(t,n){if(1!==this.__CE_state)return ee.call(this,t,n);var i=$.call(this,t,n);ee.call(this,t,n);var r=$.call(this,t,n);i!==r&&e.attributeChangedCallback(this,n,i,r,t)}),he?i(HTMLElement.prototype,he):te&&i(Element.prototype,te),fe?r(HTMLElement.prototype,fe):ne&&r(Element.prototype,ne),D(e,Element.prototype,{prepend:ie,append:re}),x(e)}function P(){var e=new v;R(e),O(e),D(e,DocumentFragment.prototype,{prepend:F,append:j}),S(e),L(e),e=new l(e),document.__CE_registry=e,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:e})}var I=window.Document.prototype.createElement,M=window.Document.prototype.createElementNS,B=window.Document.prototype.importNode,N=window.Document.prototype.prepend,U=window.Document.prototype.append,F=window.DocumentFragment.prototype.prepend,j=window.DocumentFragment.prototype.append,G=window.Node.prototype.cloneNode,V=window.Node.prototype.appendChild,H=window.Node.prototype.insertBefore,z=window.Node.prototype.removeChild,X=window.Node.prototype.replaceChild,W=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),Y=window.Element.prototype.attachShadow,q=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),K=window.Element.prototype.getAttribute,J=window.Element.prototype.setAttribute,Z=window.Element.prototype.removeAttribute,$=window.Element.prototype.getAttributeNS,Q=window.Element.prototype.setAttributeNS,ee=window.Element.prototype.removeAttributeNS,te=window.Element.prototype.insertAdjacentElement,ne=window.Element.prototype.insertAdjacentHTML,ie=window.Element.prototype.prepend,re=window.Element.prototype.append,ae=window.Element.prototype.before,oe=window.Element.prototype.after,se=window.Element.prototype.replaceWith,ue=window.Element.prototype.remove,ce=window.HTMLElement,le=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),he=window.HTMLElement.prototype.insertAdjacentElement,fe=window.HTMLElement.prototype.insertAdjacentHTML,de=new Set;"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach(function(e){return de.add(e)});var pe=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);o.prototype.f=function(e){var t=this.a.readyState;for("interactive"!==t&&"complete"!==t||s(this),t=0;t<e.length;t++)for(var n=e[t].addedNodes,i=0;i<n.length;i++)T(this.c,n[i])},l.prototype.o=function(e,t){var n=this;if(!(t instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");h(this,e),this.f.set(e,t),this.h.push(e),this.a||(this.a=!0,this.c(function(){return d(n)}))},l.prototype.define=function(e,t){var n=this;if(!(t instanceof Function))throw new TypeError("Custom element constructors must be functions.");h(this,e),f(this,e,t),this.h.push(e),this.a||(this.a=!0,this.c(function(){return d(n)}))},l.prototype.upgrade=function(e){T(this.b,e)},l.prototype.get=function(e){if(e=p(this,e))return e.constructorFunction},l.prototype.whenDefined=function(t){if(!e(t))return Promise.reject(new SyntaxError("'"+t+"' is not a valid custom element name."));var n=this.j.get(t);if(n)return n.c;n=new u,this.j.set(t,n);var i=this.g.has(t)||this.f.has(t);return t=-1===this.h.indexOf(t),i&&t&&c(n),n.c},l.prototype.polyfillWrapFlushCallback=function(e){this.m&&s(this.m);var t=this.c;this.c=function(n){return e(function(){return t(n)})}},window.CustomElementRegistry=l,l.prototype.define=l.prototype.define,l.prototype.upgrade=l.prototype.upgrade,l.prototype.get=l.prototype.get,l.prototype.whenDefined=l.prototype.whenDefined,l.prototype.polyfillDefineLazy=l.prototype.o,l.prototype.polyfillWrapFlushCallback=l.prototype.polyfillWrapFlushCallback,v.prototype.connectedCallback=function(e){var t=e.__CE_definition;if(t.connectedCallback)try{t.connectedCallback.call(e)}catch(e){C(e)}},v.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;if(t.disconnectedCallback)try{t.disconnectedCallback.call(e)}catch(e){C(e)}},v.prototype.attributeChangedCallback=function(e,t,n,i,r){var a=e.__CE_definition;if(a.attributeChangedCallback&&-1<a.observedAttributes.indexOf(t))try{a.attributeChangedCallback.call(e,t,n,i,r)}catch(e){C(e)}};var ve=new function(){},ye=window.customElements;ye&&!ye.forcePolyfill&&"function"==typeof ye.define&&"function"==typeof ye.get||P(),window.__CE_installPolyfill=P}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var e=HTMLElement,t={HTMLElement:function(){return Reflect.construct(e,[],this.constructor)}};window.HTMLElement=t.HTMLElement,HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}}();var Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(i)},At=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ct=function(){function e(t){F(this,e),this.options=Object.assign({},t||{},{interval:16}),this.callbacks=[]}return At(e,[{key:"start",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.callbacks=t}},{key:"onTick",value:function(){for(var e=0,t=this.callbacks.length;e<t;e++)(0,this.callbacks[e])()}},{key:"setInterval",value:function(e){return this.options.interval=e,this}}]),e}(),Rt=function(e){function t(e){F(this,t);var n=N(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.prev=null,n.timerId=null,n._subTimerId=null,n._tickFunc=t.getTickFunc(),n.tick=n.tick.bind(n),n}return U(t,e),At(t,[{key:"start",value:function(){for(var e,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];(e=kt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this)).call.apply(e,[this].concat(i)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var e=this._tickFunc;this.timerId=e(this.tick)}},{key:"stop",value:function(){this.timerId&&t.getCancelFunc()(this.timerId)}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==t.getTickFunc()}}]),t}(Ct),Dt=function(e){function t(e){F(this,t);var n=N(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.timeoutId=null,n}return U(t,e),At(t,[{key:"start",value:function(){for(var e,n=this,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];(e=kt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"nextTick",this)).call.apply(e,[this].concat(r)),this.timeoutId=window.setInterval(function(){n.onTick()},this.options.interval||16)}},{key:"stop",value:function(){this.timeoutId&&window.clearInterval(this.timeoutId)}}]),t}(Ct),Ot=function(){return Rt.isSupported()?Rt:Dt},St="undefined"==typeof Symbol?"__target":Symbol(),xt="application/javascript",Lt=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Pt=window.URL||window.webkitURL,It=window.Worker;if(It){var Mt,Bt=G("self.onmessage = function () {}"),Nt=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");(Mt=new It(Bt)).postMessage(Nt,[Nt.buffer])}catch(e){It=null}finally{Pt.revokeObjectURL(Bt),Mt&&Mt.terminate()}}var Ut=new j("./worker.js",function(e,t){function n(){(o=new a(this)).init()}function i(e){r.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder.js"),addOnPostRun(n.bind(r))}var r=this,a=function(e){this.inited=!1,this.self=e,this.meta=this.self.meta,this.infolist={},e.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),e.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};a.prototype.toU8Array=function(e,t){return this.self.HEAPU8.subarray(e,e+t)},a.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},a.prototype.broadwayOnPictureDecoded=function(e,t,n,i,r,a){var o=Object.assign({},this.infolist[a]),s=n,u=n/2;444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=n);var c=this.toU8Array(e,i*s+r*u*2);this.infolist[a]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;this.self.postMessage({msg:"DECODED",width:t,height:n,yLinesize:i,uvLinesize:r,info:o,buffer:h},[h])},a.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},a.prototype.decode=function(e,t){var n=parseInt((new Date).getTime()),i=n-1e9*Math.floor(n/1e9);this.infolist[i]=t,this.streamBuffer.set(e),Module._broadwayPlayStream(e.length,i)},a.prototype.destroy=function(){Module._broadwayExit()};var o;r.addEventListener("message",function(e){var t=e.data;if(t.msg)switch(t.msg){case"init":console.log(t),r.meta=t.meta,i();break;case"decode":o.decode(t.data,t.info);break;case"destory":o.destroy()}else r.postMessage({msg:"ERROR:invalid message"})},!1)}),Ft=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),jt=function(){function e(t){V(this,e),this.configs=Object.assign({},t),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this.chroma=this.meta.chromaFormat,this.height=this.meta.presentHeight,this.width=this.meta.presentWidth,this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return Ft(e,[{key:"_initContextGL",value:function(){for(var e=this.canvas,t=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!t&&i<n.length;){var r=n[i];try{t=this.contextOptions?e.getContext(r,this.contextOptions):e.getContext(r)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++i}this.contextGL=t}},{key:"_initProgram",value:function(){var e,t,n=this.contextGL;e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),t=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var i=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1],r=n.createShader(n.VERTEX_SHADER);n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+n.getShaderInfoLog(r));var a=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(a,t),n.compileShader(a),n.getShaderParameter(a,n.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+n.getShaderInfoLog(a));var o=n.createProgram();n.attachShader(o,r),n.attachShader(o,a),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)||console.log("Program failed to compile: "+n.getProgramInfoLog(o)),n.useProgram(o);var s=n.getUniformLocation(o,"YUV2RGB");n.uniformMatrix4fv(s,!1,i),this.shaderProgram=o}},{key:"_initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.texturePosBuffer=r;var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=o;var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var c=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram,n=this._initTexture(),i=e.getUniformLocation(t,"ySampler");e.uniform1i(i,0),this.yTextureRef=n;var r=this._initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=r;var o=this._initTexture(),s=e.getUniformLocation(t,"vSampler");e.uniform1i(s,2),this.vTextureRef=o}},{key:"_initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"_drawPictureGL",value:function(e,t,n,i,r){var a=i*n,o=r*n/2;444!==this.chroma&&422!==this.chroma||(o*=2);var s={yData:(e=new Uint8Array(e)).subarray(0,a),uData:e.subarray(a,a+o),vData:e.subarray(a+o,a+o+o)};this._drawPictureGL420(s,t,n,i,r)}},{key:"_drawPictureGL420",value:function(e,t,n,i,r){var a=this.contextGL,o=this.texturePosBuffer,s=this.uTexturePosBuffer,u=this.vTexturePosBuffer,c=this.yTextureRef,l=this.uTextureRef,h=this.vTextureRef,f=e.yData,d=e.uData,p=e.vData,v=i,y=n,m=t/2,_=n/2;422!==this.chroma&&444!==this.chroma||(_=n);var g=r,b=_,E=this.canvas.width/this.width,w=this.canvas.height/this.height,T=0,k=0,A=this.canvas.width,C=this.canvas.height;E<w?(C=this.height*this.canvas.width/this.width,k=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(A=this.width*this.canvas.height/this.height,T=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),a.viewport(T,k,A,C);var R=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,R,a.DYNAMIC_DRAW);var D=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,D,a.DYNAMIC_DRAW);var O=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,u),a.bufferData(a.ARRAY_BUFFER,O,a.DYNAMIC_DRAW),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,v,y,0,a.LUMINANCE,a.UNSIGNED_BYTE,f),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,m,_,0,a.LUMINANCE,a.UNSIGNED_BYTE,d),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,g,b,0,a.LUMINANCE,a.UNSIGNED_BYTE,p),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},{key:"_drawPictureRGB",value:function(e){}},{key:"render",value:function(e,t,n,i,r){this.contextGL?this._drawPictureGL(e,t,n,i,r):this._drawPictureRGB(e)}}]),e}(),Gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Vt=function(){function e(t){H(this,e),this.config=Object.assign({},t),this.type=this.config.type,this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}return Gt(e,[{key:"push",value:function(e){if("video"===this.type){if(e.isKeyframe){var t={samples:[],start:e.dts,end:e.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=t),this.currentGop=t,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(e),e.dts<this.currentGop.start&&(this.currentGop.start=e.dts),e.dts>this.currentGop.end&&(this.currentGop.end=e.dts))}}},{key:"get",value:function(e){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===e)return this._getNext()}}},{key:"_getNext",value:function(){if(this._lastGet){var e=this._lastGet.gop,t=e.samples[this._lastGet.index+1];if(t)return this._lastGet.index=this._lastGet.index+1,t;if(!(e=e.nextGop)||e.samples.length<1)return;return t=e.samples[0],this._lastGet={gop:e,index:0},t}var n=this.buffer[0];if(!(n.samples.length<1))return this._lastGet={gop:n,index:0},n.samples[0]}},{key:"remove",value:function(e,t){if(!(this.buffer.length<0))for(var n=0,i=this.buffer[0];i;)i.end<t&&i.start>=e?(this.buffer.splice(n,1),i=this.buffer[n]):(n+=1,i=this.buffer[n])}}]),e}(),Ht=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),zt=function(){function e(t){z(this,e),this.ranges=t||[]}return Ht(e,[{key:"start",value:function(e){return this.ranges[e]?this.ranges[e].start:0}},{key:"end",value:function(e){return this.ranges[e]?this.ranges[e].end:0}},{key:"add",value:function(e){this.ranges.push(e)}},{key:"length",get:function(){return this.ranges.length}}]),e}(),Xt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Wt=function(){function e(t){X(this,e),this.config=Object.assign({},t),this.canvas=this.config.canvas?this.config.canvas:document.createElement("canvas"),this.source=new Vt({type:"video"}),this.preloadTime=this.config.preloadTime||3,this.oncanplay=void 0,this.onFirstFrame=void 0,this.meta=void 0,this.readyStatus=0,this.paused=!0,this.count=0,this.currentTime=0,this.lastPlayed=0,this._decoderInited=!1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null,this.canvas.style.maxWidth="100%",this.canvas.style.maxHeight="100%",this.canvas.style.top=0,this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.margin="auto",this.canvas.style.position="absolute"}return Xt(e,[{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){var e=this,t=this;this.wasmworker=new Ut,this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",function(n){switch(n.data.msg){case"DECODER_READY":t._decoderInited=!0;break;case"DECODED":e._onDecoded(n.data)}})}},{key:"setVideoMetaData",value:function(e){if(this.meta=e,!this._decoderInited)return void this.initWasmWorker();this._avccpushed=!0;var t=new Uint8Array(e.sps.byteLength+4);if(t.set([0,0,0,1]),t.set(e.sps,4),this.wasmworker.postMessage({msg:"decode",data:t}),(t=new Uint8Array(e.pps.byteLength+4)).set([0,0,0,1]),t.set(e.pps,4),this.wasmworker.postMessage({msg:"decode",data:t}),!this.yuvCanvas){var n=Object.assign({meta:e,canvas:this.canvas},this.config);this.yuvCanvas=new jt(n)}this.readyStatus=1}},{key:"decodeVideo",value:function(e){if(this._decoderInited){this._avccpushed||this.setVideoMetaData(this.meta);for(var t=e.samples,n=t.shift();n;)this._baseDts||(this._baseDts=n.dts),this.source.push(n),n=t.shift();this._preload()}}},{key:"_preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){var e=this.source.get();for(e&&(this._lastSampleDts=e.dts,this._analyseNal(e));e&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(e=this.source.get())&&(this._analyseNal(e),this._lastSampleDts=e.dts)}}},{key:"_analyseNal",value:function(e){for(var t=Ue.getAvccNals(new at(e.data.buffer)),n=0,i=0;i<t.length;i++)n+=t[i].body.byteLength+4;for(var r=0,a=new Uint8Array(n),o=0;o<t.length;o++){var s=t[o];a.set([0,0,0,1],r),r+=4,a.set(new Uint8Array(s.body),r),r+=s.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:a,info:{dts:e.dts,pts:e.pts?e.pts:e.dts+e.cts,key:e.isKeyframe}})}},{key:"_onDecoded",value:function(e){var t=e.info.dts;this._decodedFrames[t]=e,Object.keys(this._decodedFrames).length>10&&(this.playFinish&&this.playFinish(),this.oncanplay&&this.oncanplay())}},{key:"play",value:function(){var e=this;return this.paused=!1,new Promise(function(t){e.playFinish=t}).then(function(){e.playFinish=null})}},{key:"_onTimer",value:function(e){if(!this.paused){if(this.meta){this.meta.frameRate&&this.meta.frameRate.fixed&&this.meta.frameRate.fps;var t=Object.keys(this._decodedFrames);if(t.length>0){this.currentTime=e;for(var n=-1,i=0;i<t.length&&Number.parseInt(t[i])-this._baseDts<=this.currentTime;i++)n=Number.parseInt(t[i-1]);var r=this._decodedFrames[n];r&&this.yuvCanvas.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize);for(var a=0;a<t.length;a++)Number.parseInt(t[a])<n&&delete this._decodedFrames[t[a]]}}this._lastRenderTime=Date.now()}}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1)}},{key:"destroy",value:function(){this.wasmworker.postMessage({msg:"destroy"}),this.wasmworker=null,this.canvas=null,this.source=null,this._decoderInited=!1}},{key:"buffered",get:function(){for(var e=[],t={start:null,end:null},n=0;n<this.source.buffer.length;n++){var i=this.source.buffer[n],r=i.start,a=i.end;t.start||(t.start=r),t.end||(t.end=a),r-t.end>1e3?(t.start=t.start/1e3,t.end=t.end/1e3,t={start:r,end:a}):t.end=a}return null!==t.start&&null!==t.end&&(t.start=t.start/1e3,t.end=t.end/1e3,e.push(t)),new zt(e)}}]),e}(),Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Kt=function(e){function t(e){W(this,t);var n=Y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.config=Object.assign({},e);var i=window.AudioContext||window.webkitAudioContext;return n.context=new i,n.gainNode=n.context.createGain(),n.gainNode.connect(n.context.destination),n.meta=void 0,n.samples=[],n.preloadTime=n.config.preloadTime||3,n.duration=0,n._currentBuffer=void 0,n._nextBuffer=void 0,n._lastpts=void 0,n._preDecode=[],n._currentTime=0,n._decoding=!1,n._volume=n.config.volume||.6,n._played=!1,n.playFinish=null,n.waitNextID=null,n}return q(t,e),qt(t,[{key:"decodeAudio",value:function(e){var t=e.samples,n=e.meta,i=t;e.samples=[],n&&this.setAudioData(i)}},{key:"setAudioData",value:function(e){for(var t=0;t<e.length;t++)e[t].pts=void 0===e[t].pts?e[t].dts:e[t].pts,this._preDecode.push(e[t]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(!this._decoding){this._decoding=!0;for(var e=this._preDecode,n=[],i=this,r=e.shift();r;){var a=t.getAACData(this.meta,r);n.push(a),this._lastpts=r.pts,r=e.shift()}var o=t.combileData(n);try{this.context.decodeAudioData(o.buffer,function(e){var t=i.context.createBufferSource();t.buffer=e,i.samples.push({time:i.duration,duration:e.duration,data:t}),i.duration+=e.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime)),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC(),i.playFinish&&i.playFinish()},function(e){console.error(e)})}catch(e){console.error(e)}}}},{key:"onSourceEnded",value:function(){var e=this;if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(function(){e.onSourceEnded()},200));var t=this._nextBuffer.data;t.start(),t.connect(this.gainNode);var n=this;setTimeout(function(){n.onSourceEnded.call(e)},1e3*t.buffer.duration-10),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}},{key:"play",value:function(){var e=this;if(!this.playFinish){this._played=!0,"suspended"===this.context.state&&this.context.resume();var t=this,n=function(){var n=e._currentBuffer.data;n.connect(e.gainNode),n.start(),setTimeout(function(){t.onSourceEnded.call(e)},1e3*n.buffer.duration-10)};return this._currentBuffer?(n(),Promise.resolve()):new Promise(function(t){e.playFinish=t}).then(function(){e.playFinish=null,n()})}}},{key:"pause",value:function(){var e=this.context;"running"===e.state&&e.suspend()}},{key:"getTimeBuffer",value:function(e){for(var t=void 0,n=0;n<this.samples.length;n++){var i=this.samples[n];if(i.time<=e&&i.time+i.duration>e){t=i;break}}return t}},{key:"setAudioMetaData",value:function(e){this.meta=e}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this.context.close()}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(e){this.gainNode.gain.value=e?0:this._volume}},{key:"volume",get:function(){return this._volume},set:function(e){return e<0?(this._volume=0,void(this.gainNode.gain.value=0)):e>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=e,void(this.gainNode.gain.value=e))}}],[{key:"getAACData",value:function(e,n){var i=new Uint8Array(n.data.byteLength+7),r=t.getAdts(e,n.data);return i.set(r),i.set(n.data,7),i}},{key:"combileData",value:function(e){for(var t=0,n=0,i=e.length;n<i;n++)t+=e[n].byteLength;for(var r=new Uint8Array(t),a=0,o=0,s=e.length;o<s;o++)r.set(e[o],a),a+=e[o].byteLength;return r}},{key:"getAdts",value:function(e,t){var n=new Uint8Array(7);n[0]=255,n[1]=240,n[1]=1|n[1],n[2]=192&e.objectType-1<<6,n[2]=n[2]|60&e.sampleRateIndex<<2,n[2]=n[2]|1&e.channelCount>>2,n[3]=192&e.channelCount<<6;var i=t.byteLength+7;return n[3]=n[3]|3&i>>11,n[4]=255&i>>3,n[5]=224&i<<5,n[5]=31|n[5],n[6]=252,n}}]),t}(i),Jt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Zt=function(){function e(t){K(this,e),this.aCtx=t.aCtx,this.vCtx=t.vCtx,this.video=t.video,this.timeoutId=null,this.start=null}return Jt(e,[{key:"doReconcile",value:function(){var e=this,t=(this.vCtx.currentTime||0)-1e3*(this.aCtx.currentTime||0);this.timeoutId||(t>200?(this.video.start+=t,this.vCtx.pause(),this.timeoutId=setTimeout(function(){e.vCtx.play(),e.timeoutId=null},t)):t<-120&&(this.video.start+=t))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null}}]),e}(),$t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),en=function(e){function t(){J(this,t);var e=Z(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._canvas=document.createElement("canvas"),e.handleAudioSourceEnd=e.handleAudioSourceEnd.bind(e),e.played=!1,e.pendingPlayTask=null,e._paused=!0,e.videoMetaInited=!1,e.audioMetaInited=!1,e.init(),e}return $(t,e),Qt(t,null,[{key:"resolveVideoGOP",value:function(e){var t=e.samples;if(t.length){var n=null,i=null;e.tempSamples&&e.tempSamples.length&&t.unshift.apply(t,e.tempSamples);for(var r=0,a=t.length;r<a;r++)if(t[r].isKeyframe){n=r;break}for(var o=t.length-1;o>0;o++)if(t[o].isKeyframe){i=o;break}0!==n&&t.splice(0,n-1),e.samples=t.slice(0,i);var s=t.slice(i);e.tempSamples?e.tempSamples.push.apply(e.tempSamples,s):e.tempSamples=s}}}]),Qt(t,[{key:"init",value:function(){var e=this;this.vCtx=new Wt(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}})),this.aCtx=new Kt({}),this.ticker=new(Ot()),this.reconciler=new Zt({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.dispatchEvent(new Event("waiting")),this.vCtx.oncanplay=function(){e.played||e.appendChild(e._canvas),e.dispatchEvent(new Event("canplay"))},this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"destroy",value:function(){this.videoMetaInited=!1,this.audioMetaInited=!1,this.aCtx.destroy(),this.vCtx.destroy(),this.ticker.stop(),this.start=null,this.reconciler.destroy(),this.aCtx=null,this.vCtx=null,this.ticker=null}},{key:"onDemuxComplete",value:function(e,t){this.aCtx.decodeAudio(t),this.vCtx.decodeVideo(e)}},{key:"setAudioMeta",value:function(e){this.audioMetaInited&&(this.aCtx.destroy(),this.aCtx=new Kt({})),this.aCtx.setAudioMetaData(e),this.audioMetaInited=!0}},{key:"setVideoMeta",value:function(e){this.videoMetaInited&&(this.vCtx.destroy(),this.vCtx=new Wt(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}}))),this.vCtx.setVideoMetaData(e),this.videoMetaInited=!0}},{key:"play",value:function(){var e=this;this.pendingPlayTask||(this.played&&(this.destroy(),this.init()),this.pendingPlayTask=Promise.all([this.vCtx.play(),this.aCtx.play().then(function(){e.aCtx.muted=!0})]).then(function(){e.aCtx.muted=!1,e.ticker.start(function(){e.start||(e.start=Date.now()),e._currentTime=Date.now()-e.start,e.vCtx._onTimer(e._currentTime)}),e.pendingPlayTask=null,e.played=!0,e.dispatchEvent(new Event("playing")),e.dispatchEvent(new Event("play")),e._paused=!1}))}},{key:"pause",value:function(){this._paused=!0,this.aCtx.pause(),this.vCtx.pause(),this.dispatchEvent(new Event("pause"))}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){this.style.display="inline-block";var t="number"==typeof e?e+"px":e;this.setAttribute("width",t),this.style.width=t,this._canvas.width=e}},{key:"height",get:function(){return this.getAttribute("height")},set:function(e){this.style.display="inline-block";var t="number"==typeof e?e+"px":e;this.setAttribute("height",t),this.style.height=t,this._canvas.height=e}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(e){this.setAttribute("src",e)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(e){this.setAttribute("playbackrate",e),this.aCtx.playbackRate=e,this.vCtx.playbackRate=e,this.dispatchEvent(new Event("ratechange"))}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"volume",get:function(){return this.aCtx.volume},set:function(e){this.setAttribute("volume",e),this.aCtx.volume=e}},{key:"muted",get:function(){var e="true"===this.getAttribute("muted");return void 0!==e?e:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(e){this.setAttribute("muted",e),this.aCtx.muted=!!e}},{key:"error",get:function(){return this.vCtx.error||this.aCtx.error}},{key:"buffered",get:function(){return this.vCtx.buffered}}]),t}(HTMLElement);customElements.define("mobile-video",en);var tn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),nn=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(i)},rn=ve.FlvAllowedEvents;return function(t){function n(e){Q(this,n),e.mediaType||(e.mediaType="mobile-video");var t=ee(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.video.width=Number.parseInt(e.width||600),t.video.height=Number.parseInt(e.height||337.5),t.video.style.outline="none",t.context=new we(rn),t.initEvents(),t}return te(n,t),tn(n,[{key:"start",value:function(){this.initFlv(),this.context.init(),this.flv.seek(0),nn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"start",this).call(this,this.config.url),this.play()}},{key:"initFlvEvents",value:function(e){var t=this;e.once(ve.LOADER_EVENTS.LOADER_COMPLETE,function(){if(!t.paused)var e=setInterval(function(){var n=t.getBufferedRange()[1];Math.abs(t.currentTime-n)<.5&&(t.emit("ended"),window.clearInterval(e))},200)})}},{key:"initEvents",value:function(){var e=this;this.on("timeupdate",function(){e.loadData()}),this.on("seeking",function(){var t=e.currentTime,n=e.getBufferedRange();(t>n[1]||t<n[0])&&e.flv.seek(e.currentTime)})}},{key:"initFlv",value:function(){var e=this.context.registry("FLV_CONTROLLER",wt)(this);this.initFlvEvents(e),this.flv=e}},{key:"play",value:function(){if(this._hasStart&&this.paused){this._destroy(),this.context=new we(rn);var e=this.context.registry("FLV_CONTROLLER",wt)(this);this.initFlvEvents(e),this.flv=e,this.context.init(),this.loadData(),nn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"start",this).call(this),nn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"play",this).call(this)}else nn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"play",this).call(this),this.addLiveFlag()}},{key:"pause",value:function(){nn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"pause",this).call(this),this.flv&&this.flv.pause()}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTime;this.flv&&this.flv.seek(e)}},{key:"destroy",value:function(){this._destroy(),nn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}},{key:"addLiveFlag",value:function(){var t=this;if(e.util.addClass(t.root,"xgplayer-is-live"),!e.util.findDom(this.root,"xg-live")){var n=e.util.createDom("xg-live","正在直播",{},"xgplayer-live");t.controls.appendChild(n)}}},{key:"_destroy",value:function(){this.context.destroy(),this.flv=null,this.context=null}},{key:"src",get:function(){return this.currentSrc},set:function(e){var t=this;this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",function(){t.start(e)}),this.once("canplay",function(){t.play()})),this.once("canplay",function(){t.currentTime=0})}}]),n}(e)});
//# sourceMappingURL=index.min.js.map
