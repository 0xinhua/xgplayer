!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],t):(e=e||self,e.FlvLiveMobilePlayer=t(e.Player))}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){}function i(){i.init.call(this)}function n(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function o(e,t,r){if(t)e.call(r);else for(var i=e.length,n=v(e,i),o=0;o<i;++o)n[o].call(r)}function a(e,t,r,i){if(t)e.call(r,i);else for(var n=e.length,o=v(e,n),a=0;a<n;++a)o[a].call(r,i)}function s(e,t,r,i,n){if(t)e.call(r,i,n);else for(var o=e.length,a=v(e,o),s=0;s<o;++s)a[s].call(r,i,n)}function u(e,t,r,i,n,o){if(t)e.call(r,i,n,o);else for(var a=e.length,s=v(e,a),u=0;u<a;++u)s[u].call(r,i,n,o)}function c(e,t,r,i){if(t)e.apply(r,i);else for(var n=e.length,o=v(e,n),a=0;a<n;++a)o[a].apply(r,i)}function l(e,t,i,o){var a,s,u;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if(s=e._events,s?(s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),u=s[t]):(s=e._events=new r,e._eventsCount=0),u){if("function"==typeof u?u=s[t]=o?[i,u]:[u,i]:o?u.unshift(i):u.push(i),!u.warned&&(a=n(e))&&a>0&&u.length>a){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=u.length,h(c)}}else u=s[t]=i,++e._eventsCount;return e}function h(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function f(e,t,r){function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}var n=!1;return i.listener=r,i}function d(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function p(e,t){for(var r=t,i=r+1,n=e.length;i<n;r+=1,i+=1)e[r]=e[i];e.pop()}function v(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function y(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":ze(t))&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":ze(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":ct(t))&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":ct(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":jt(t))&&"function"!=typeof t?e:t}function B(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":jt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){return function(r){var i=this;if(!t)return new Zt(e);if(Zt&&!r){var n=j(`${t}`.replace(/^function.+?{/,"").slice(0,-1));return this[Yt]=new Zt(n),Jt.revokeObjectURL(n),this[Yt]}var o={postMessage:e=>{i.onmessage&&setTimeout(()=>i.onmessage({data:e,target:o}))}};t.call(o),this.postMessage=(e=>{setTimeout(()=>o.onmessage({data:e,target:i}))}),this.isThisThread=!0}}function j(e){try{return Jt.createObjectURL(new Blob([e],{type:qt}))}catch(r){var t=new Kt;return t.append(e),Jt.createObjectURL(t.getBlob(type))}}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function he(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Or(t))&&"function"!=typeof t?e:t}function be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Or(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":Ir(t))&&"function"!=typeof t?e:t}function Te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":Ir(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}e=e&&e.hasOwnProperty("default")?e.default:e;var Re={SEEK:"SEEK"},Ce={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},Oe={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",SEI_PARSED:"SEI_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},Se={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",DETECT_CHANGE_STREAM_DISCONTINUE:"DETECT_CHANGE_STREAM_DISCONTINUE",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT"},De={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},Pe={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},Le={START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"},Ie=Object.assign({},Ce,Oe,Se,De,Pe,Re),Ne=[],Ue=[];for(var Be in Ie)Ie.hasOwnProperty(Be)&&Ne.push(Ie[Be]);for(var Me in Ie)Ie.hasOwnProperty(Me)&&Ue.push(Ie[Me]);var Fe={ALLEVENTS:Ie,HLS_EVENTS:Pe,REMUX_EVENTS:Se,DEMUX_EVENTS:Oe,MSE_EVENTS:De,LOADER_EVENTS:Ce,FlvAllowedEvents:Ne,HlsAllowedEvents:Ue,CRYTO_EVENTS:Le,PLAYER_EVENTS:Re},je=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Ge=function(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0},Xe=function(){function e(){t(this,e),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return je(e,[{key:"isComplete",value:function(){return e.isBaseInfoReady(this)&&e.isVideoReady(this)&&e.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(e){return Ge(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||Ge(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||Ge(e.video)}}]),e}();r.prototype=Object.create(null),i.EventEmitter=i,i.usingDomains=!1,i.prototype.domain=void 0,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.init=function(){this.domain=null,i.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return n(this)},i.prototype.emit=function(e){var t,r,i,n,l,h,f,d="error"===e;if(h=this._events)d=d&&null==h.error;else if(!d)return!1;if(f=this.domain,d){if(t=arguments[1],!f){if(t instanceof Error)throw t;var p=new Error('Uncaught, unspecified "error" event. ('+t+")");throw p.context=t,p}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=f,t.domainThrown=!1,f.emit("error",t),!1}if(!(r=h[e]))return!1;var v="function"==typeof r;switch(i=arguments.length){case 1:o(r,v,this);break;case 2:a(r,v,this,arguments[1]);break;case 3:s(r,v,this,arguments[1],arguments[2]);break;case 4:u(r,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),l=1;l<i;l++)n[l-1]=arguments[l];c(r,v,this,n)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var i,n,o,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[e]))return this;if(i===t||i.listener&&i.listener===t)0==--this._eventsCount?this._events=new r:(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(o=-1,a=i.length;a-- >0;)if(i[a]===t||i[a].listener&&i[a].listener===t){s=i[a].listener,o=a;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new r,this;delete n[e]}else p(i,o);n.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new r,this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=new r:delete i[e]),this;if(0===arguments.length){for(var n,o=Object.keys(i),a=0;a<o.length;++a)"removeListener"!==(n=o[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new r,this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},i.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:y(t):[]},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,i)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(i)},Ve=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),We=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];b(this,e),this._emitter=new i,this._emitter.off||(this._emitter.off=this._emitter.removeListener),this.mediaInfo=new Xe,this._instanceMap={},this._clsMap={},this._inited=!1,this.allowedEvents=t,this._hooks={}}return Ve(e,[{key:"getInstance",value:function(e){var t=this._instanceMap[e];return t||null}},{key:"initInstance",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var n=r[0],o=r[1],a=r[2],s=r[3];if(this._clsMap[e]){var u=new this._clsMap[e](n,o,a,s);return this._instanceMap[e]=u,u.init&&u.init(),u}throw new Error(e+"未在context中注册")}},{key:"init",value:function(e){if(!this._inited){for(var t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(e,t){var r=this,i=this._emitter,n=this._isMessageNameValid.bind(this),o=this,a=function(t){function r(t,i,n){b(this,r);var a=m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,i,n));return a.listeners={},a.onceListeners={},a.TAG=e,a._context=o,a}return g(r,t),Ve(r,[{key:"on",value:function(t,r){return n(t),this.listeners[t]?this.listeners[t].push(r):this.listeners[t]=[r],i.on(t+"__TO__"+e,r),i.on(t,r)}},{key:"before",value:function(e,t){n(e),o._hooks[e]?o._hooks[e].push(t):o._hooks[e]=[t]}},{key:"once",value:function(t,r){return n(t),this.onceListeners[t]?this.onceListeners[t].push(r):this.onceListeners[t]=[r],i.once(t+"__TO__"+e,r),i.once(t,r)}},{key:"emit",value:function(e){n(e);var t=o._hooks?o._hooks[e]:null;if(t)for(var r=0,a=t.length;r<a;r++)(0,t[r])();for(var s=arguments.length,u=Array(s>1?s-1:0),c=1;c<s;c++)u[c-1]=arguments[c];return i.emit.apply(i,[e].concat(u))}},{key:"emitTo",value:function(e,t){n(t);for(var r=arguments.length,o=Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return i.emit.apply(i,[t+"__TO__"+e].concat(o))}},{key:"off",value:function(e,t){return n(e),i.off(e,t)}},{key:"removeListeners",value:function(){var t=Object.prototype.hasOwnProperty.bind(this.listeners);for(var r in this.listeners)if(t(r))for(var n=this.listeners[r]||[],o=0;o<n.length;o++){var a=n[o];i.off(r,a),i.off(r+"__TO__"+e,a)}for(var s in this.onceListeners)if(t(s))for(var u=this.onceListeners[s]||[],c=0;c<u.length;c++){var l=u[c];i.off(s,l),i.off(s+"__TO__"+e,l)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete o._instanceMap[e],He(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this))return He(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}}]),r}(t);return this._clsMap[e]=a,function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return r.initInstance.apply(r,[e].concat(i))}}},{key:"seek",value:function(e){this._emitter.emit(Fe.PLAYER_EVENTS.SEEK,e)}},{key:"destroyInstances",value:function(){var e=this;Object.keys(this._instanceMap).forEach(function(t){e._instanceMap[t].destroy&&e._instanceMap[t].destroy()})}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}},{key:"_isMessageNameValid",value:function(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error("unregistered message name: "+e)}}]),e}(),Ye=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),qe=function(){function e(t){_(this,e);var r={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},r,t):r}return Ye(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),Ke=function(){function e(t){_(this,e);var r={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},r,t):r}return Ye(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}(),Je=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Ze=function(){function e(t){E(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return Je(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(r.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),r=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),t=e-t,t>0&&this._currentWordBitsLeft?r<<t|this.readBits(t):r}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),$e=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Qe=function(){function e(){w(this,e)}return $e(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),n=0,o=0;o<r;o++)o>=2&&3===t[o]&&0===t[o-1]&&0===t[o-2]||(i[n]=t[o],n++);return new Uint8Array(i.buffer,0,n)}},{key:"parseSPS",value:function(t){var r=e._ebsp2rbsp(t),i=new Ze(r);i.readByte();var n=i.readByte();i.readByte();var o=i.readByte();i.readUEG();var a=e.getProfileString(n),s=e.getLevelString(o),u=1,c=420,l=[0,420,422,444],h=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(c=l[u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)i.readBool()&&(d<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();for(var v=i.readUEG(),y=0;y<v;y++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),g=i.readUEG(),b=i.readBits(1);0===b&&i.readBits(1),i.readBits(1);var _=0,E=0,w=0,T=0;i.readBool()&&(_=i.readUEG(),E=i.readUEG(),w=i.readUEG(),T=i.readUEG());var x=1,A=1,k=0,R=!0,C=0,O=0;if(i.readBool()){if(i.readBool()){var S=i.readByte(),D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];S>0&&S<16?(x=D[S-1],A=P[S-1]):255===S&&(x=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var L=i.readBits(32),I=i.readBits(32);R=i.readBool(),k=(C=I)/(O=2*L)}}var N=1;1===x&&1===A||(N=x/A);var U=0,B=0;0===u?(U=1,B=2-b):(U=3===u?1:2,B=(1===u?2:1)*(2-b));var M=16*(m+1),F=16*(g+1)*(2-b);M-=(_+E)*U,F-=(w+T)*B;var j=Math.ceil(M*N);return i.destroy(),i=null,{profile_string:a,level_string:s,bit_depth:h,chroma_format:c,chroma_format_string:e.getChromaFormatString(c),frame_rate:{fixed:R,fps:k,fps_den:O,fps_num:C},par_ratio:{width:x,height:A},codec_size:{width:M,height:F},present_size:{width:j,height:F}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,i=8,n=0;n<t;n++)0!==i&&(i=(r+e.readSEG()+256)%256),r=0===i?r:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var r=t.frameRate.fps_den,i=t.frameRate.fps_num;return t.refSampleDuration=Math.floor(t.timescale*(r/i)),t}}]),e}(),et=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),tt=function(){function e(){T(this,e)}return et(e,null,[{key:"EBSP2RBSP",value:function(e){return e.filter(function(t,r){return r<2||!(0===e[r-2]&&0===e[r-1]&&3===t)})}},{key:"EBSP2SODB",value:function(e){var t=e[e.byteLength-1];return t&&128===t?e.slice(0,e.byteLength-1):e}}]),e}(),rt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),it=function(e){for(var t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return t},nt=function(){function e(){x(this,e)}return rt(e,null,[{key:"_resolveNalu",value:function(e){return e.length>=1?tt.EBSP2SODB(tt.EBSP2RBSP(e.slice(1))):null}},{key:"parse",value:function(t){var r=e._resolveNalu(t),i=e.switchPayloadType(r),n=i.payloadType,o=i.offset,a=r.slice(o);switch(n){case 5:return e.user_data_unregistered(a);default:return{}}}},{key:"switchPayloadType",value:function(e){for(var t=new DataView(e.buffer),r=0,i=0;255===t.getUint8(i);)i++,r+=255;return r+=t.getUint8(i++),{payloadType:r,offset:i}}},{key:"getPayloadLength",value:function(e){for(var t=new DataView(e.buffer),r=0,i=0;255===t.getUint8(i);)i++,r+=255;return r+=t.getUint8(i++),{payloadLength:r,offset:i}}},{key:"user_data_unregistered",value:function(t){var r=e.getPayloadLength(t),i=r.payloadLength,n=r.offset;if(i<16)return{uuid:"",content:null};var o=t.slice(n);return{uuid:it(o.slice(0,16)),content:it(o.slice(16,i))}}}]),e}(),ot=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),at=function(){function e(){A(this,e)}return ot(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var r=t.dataview,i=t.position;return 1===r.getInt32(i)||0===r.getInt16(i)&&1===r.getInt8(i+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var r=[],i=e.getHeaderPositionAnnexB(t),n=i.pos,o=n;n<t.length-4;){var a=t.buffer.slice(n,n+i.headerLength);i.pos===t.position&&t.skip(i.headerLength),o=(i=e.getHeaderPositionAnnexB(t)).pos;var s={header:a,body:new Uint8Array(t.buffer.slice(n+a.byteLength,o))};e.analyseNal(s),s.type<=9&&0!==s.type&&r.push(s),t.skip(o-t.position),n=o}return r}},{key:"getAvccNals",value:function(t){for(var r=[];t.position<t.length-4;){var i=t.dataview.getInt32(t.dataview.position);if(!(t.length-t.position>=i))break;var n=t.buffer.slice(t.position,t.position+4);t.skip(4);var o=new Uint8Array(t.buffer.slice(t.position,t.position+i));t.skip(i);var a={header:n,body:o};e.analyseNal(a),a.type<=9&&0!==a.type&&r.push(a)}return r}},{key:"analyseNal",value:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=nt.parse(e.body);break;case 7:e.sps=Qe.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,r=0;3!==r&&4!==r&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?r=4:1===e.dataview.getInt8(t+2)?r=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(r=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?r=3:t=e.length)),{pos:t,headerLength:r}}},{key:"getAvcc",value:function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength+11);r[0]=1,r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=255,r[5]=225;var i=6;return r.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),i),i+=2,r.set(e,i),i+=e.byteLength,r[i]=1,i++,r.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),i),i+=2,r.set(t,i),r}}]),e}(),st=Qe,ut=at,ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),ht=function(){function e(){C(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return lt(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"distroy",value:function(){this.reset(),this.id=-1}}]),e}(),ft=function(e){function t(){C(this,t);var e=k(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.TAG="AudioTrack",e.type="audio",e}return R(t,e),t}(ht),dt=function(e){function t(){C(this,t);var e=k(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.TAG="VideoTrack",e.type="video",e.dropped=0,e}return R(t,e),lt(t,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),t}(ht),pt=(function(){function e(){C(this,e),this.audioTrack=null,this.videoTrack=null}lt(e,[{key:"destroy",value:function(){this.audioTrack=null,this.videoTrack=null}}])}(),function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()),vt={get device(){var e=vt.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter(function(r){return t[r].test(e)}))[0]},get os(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,i=/(?:Android)/.test(e),n=/(?:Firefox)/.test(e),o=/(?:iPad|PlayBook)/.test(e)||i&&!/(?:Mobile)/.test(e)||n&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!o;return{isTablet:o,isPhone:a,isAndroid:i,isPc:!a&&!i&&!r,isSymbian:r,isWindowsPhone:t,isFireFox:n}},get isLe(){return pt}},yt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),mt=function(){function e(){O(this,e)}return yt(e,null,[{key:"decode",value:function(t){for(var r=[],i=t,n=0,o=t.length;n<o;)if(i[n]<128)r.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(e._checkContinuation(i,n,1)){var a=(31&i[n])<<6|63&i[n+1];if(a>=128){r.push(String.fromCharCode(65535&a)),n+=2;continue}}}else if(i[n]<240){if(e._checkContinuation(i,n,2)){var s=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2];if(s>=2048&&55296!=(63488&s)){r.push(String.fromCharCode(65535&s)),n+=3;continue}}}else if(i[n]<248&&e._checkContinuation(i,n,3)){var u=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3];if(u>65536&&u<1114112){u-=65536,r.push(String.fromCharCode(u>>>10|55296)),r.push(String.fromCharCode(1023&u|56320)),n+=4;continue}}r.push(String.fromCharCode(65533)),++n}return r.join("")}},{key:"_checkContinuation",value:function(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1}}]),e}(),gt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),bt=vt.isLe,_t={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12},Et=function(){function e(){S(this,e),this.offset=0,this.readOffset=this.offset}return gt(e,[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");var r={},i=this.parseValue(e),n=this.parseValue(e,t-i.bodySize);return r[i.data]=n.data,this.resetStatus(),r}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t=new DataView(e,this.readOffset).getUint16(0,!bt),r="";r=t>0?mt.decode(new Uint8Array(e,this.readOffset+2,t)):"";var i=t+2;return this.readOffset+=i,{data:r,bodySize:t+2}}},{key:"parseDate",value:function(e,t){var r=new DataView(e,this.readOffset,t),i=r.getFloat64(0,!bt);return i+=60*r.getInt16(8,!bt)*1e3,this.readOffset+=10,{data:new Date(i),bodySize:10}}},{key:"parseObject",value:function(e,t){var r=this.parseString(e,t),i=this.parseValue(e,t-r.bodySize);return{data:{name:r.data,value:i.data},bodySize:r.bodySize+i.bodySize,isObjEnd:i.isObjEnd}}},{key:"parseLongString",value:function(e){var t=new DataView(e,this.readOffset).getUint32(0,!bt),r="";return r=t>0?mt.decode(new Uint8Array(e,this.readOffset+2,t)):"",this.readOffset+=t+4,{data:r,bodySize:t+4}}},{key:"parseValue",value:function(e,t){var r=new ArrayBuffer;r=e instanceof ArrayBuffer?e:e.buffer;var i=_t.NUMBER,n=_t.BOOLEAN,o=_t.STRING,a=_t.OBJECT,s=_t.MIX_ARRAY,u=_t.OBJECT_END,c=_t.STRICT_ARRAY,l=_t.DATE,h=_t.LONE_STRING,f=new DataView(r,this.readOffset,t),d=!1,p=f.getUint8(0),v=1;this.readOffset+=1;var y=null;switch(p){case i:y=f.getFloat64(1,!bt),this.readOffset+=8,v+=8;break;case n:y=!!f.getUint8(1),this.readOffset+=1,v+=1;break;case o:var m=this.parseString(r);y=m.data,v+=m.bodySize;break;case a:y={};var g=0;for(16777215&f.getUint32(t-4,!bt)&&(g=3);v<t-4;){var b=this.parseObject(r,t-v-g);if(b.isObjectEnd)break;y[b.data.name]=b.data.value,v+=b.bodySize}v<=t-3&&9===(16777215&f.getUint32(v-1,!bt))&&(this.readOffset+=3,v+=3);break;case s:y={},v+=4,this.readOffset+=4;var _=0;for(9==(16777215&f.getUint32(t-4,!bt))&&(_=3);v<t-8;){var E=this.parseObject(r,t-v-_);if(E.isObjectEnd)break;y[E.data.name]=E.data.value,v+=E.bodySize}v<=t-3&&9===(16777215&f.getUint32(v-1,!bt))&&(v+=3,this.readOffset+=3);break;case u:y=null,d=!0;break;case c:y=[];var w=f.getUint32(1,!bt);v+=4,this.readOffset+=4;for(var T=0;T<w;T++){var x=this.parseValue(r,t-v);y.push(x.data),v+=x.bodySize}break;case l:var A=this.parseDate(r,t-1);y=A.data,v+=A.bodySize;break;case h:var k=this.parseLongString(r,t-1);y=k.data,v+=k.bodySize;break;default:v=t}return{data:y,bodySize:v,isObjEnd:d}}}]),e}(),wt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Tt=function(){function e(t){if(D(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return wt(e,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),i=t%4,n=0;n<r;n++)e.readByte(this.dataview,4);i>0&&e.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,r){var i=void 0;switch(t){case 1:i=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");i=e.getUint8(e.position)<<16,i|=e.getUint8(e.position+1)<<8,i|=e.getUint8(e.position+2);break;case 4:i=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Error("not supported for readBody 8");i=e.getUint32(e.position)<<32,i|=e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}]),e}(),xt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),At=Fe.DEMUX_EVENTS,kt=function(){function e(){P(this,e),this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}return xt(e,[{key:"init",value:function(){this.on(At.DEMUX_START,this.doParseFlv.bind(this))}},{key:"doParseFlv",value:function(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;var e=void 0,t=1e4;do{e=this._parseFlvTag()}while(e&&t-- >0);this.emit(At.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;var r=this.loaderBuffer.shift(13);this.parseFlvHeader(r),this.doParseFlv()}}},{key:"parseFlvHeader",value:function(t){e.isFlvFile(t)?(this._firstFragmentLoaded=!0,this.initVideoTrack(),this.initAudioTrack()):(this.emit(At.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv()),this.doParseFlv()}},{key:"initVideoTrack",value:function(){this._trackNum++;var e=new dt;e.meta=new Ke,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;var e=new ft;e.meta=new qe,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"_parseFlvTag",value:function(){if(this.loaderBuffer.length<11)return null;var e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}},{key:"_parseFlvTagHeader",value:function(){var e=0,t={},r=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&r)>>>5,t.tagType=31&r,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.emit(At.DEMUX_ERROR,this.TAG,new Error("tagType "+t.tagType),!1),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);var i=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);var n=this.loaderBuffer.shift(1)[0];return n>0&&(i+=16777216*n),t.dts=i,this.loaderBuffer.shift(3),t}},{key:"_processChunk",value:function(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}},{key:"_parseScriptData",value:function(e){var t=this.tracks.audioTrack,r=this.tracks.videoTrack,i=this.loaderBuffer.shift(e.datasize),n=(new Et).resolve(i,i.length),o=this._context.onMetaData=n?n.onMetaData:void 0;if(this._context.mediaInfo.duration=o.duration,this._context.mediaInfo.hasVideo=o.hasVideo,this._context.mediaInfo.hsaAudio=o.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(At.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){var a=t.meta;switch(o.audiosamplerate&&(a.sampleRate=o.audiosamplerate),o.audiochannels&&(a.channelCount=o.audiochannels),o.audiosamplerate){case 44100:a.sampleRateIndex=4;break;case 22050:a.sampleRateIndex=7;break;case 11025:a.sampleRateIndex=10}}if(r&&!r.hasSpecificConfig){var s=r.meta;if("number"==typeof o.framerate){var u=Math.floor(1e3*o.framerate);if(u>0){var c=u/1e3;s.frameRate||(s.frameRate={}),s.frameRate.fixed=!0,s.frameRate.fps=c,s.frameRate.fps_num=u,s.frameRate.fps_den=1e3}}}}},{key:"_aacSequenceHeaderParser",value:function(e){var t={};t.hasSpecificConfig=!0,t.objectType=e[1]>>>3,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2],t.codec="mp4a.40."+t.objectType;var r=window.navigator.userAgent.toLowerCase(),i=void 0,n=void 0,o=t.sampleRateIndex;return-1!==r.indexOf("firefox")?t.sampleRateIndex>=6?(t.objectType=5,n=new Array(4),i=o-3):(t.objectType=2,n=new Array(2),i=o):-1!==r.indexOf("android")?(t.objectType=2,n=new Array(2),i=o):(t.objectType=5,i=t.sampleRateIndex,n=new Array(4),t.sampleRateIndex>=6?i=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,n=new Array(2),i=t.sampleRateIndex)),n[0]=t.objectType<<3,n[0]|=(15&t.sampleRateIndex)>>>1,n[1]=(15&t.sampleRateIndex)<<7,n[1]|=(15&t.channelCount)<<3,5===t.objectType&&(n[1]|=(15&i)>>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),t.config=n,t}},{key:"_parseAACData",value:function(e){var t=this.tracks.audioTrack;if(t){var r=t.meta;r||(t.meta=new qe,r=t.meta);var i=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);var n=(240&i)>>>4;t.format=n,10!==n&&this.emit(At.DEMUX_ERROR,new Error("invalid audio format: "+n)),10!==n||this._hasAudioSequence||(r.sampleRate=this._switchAudioSamplingFrequency(i),r.sampleRateIndex=(12&i)>>>2,r.frameLenth=(2&i)>>>1,r.channelCount=1&i,r.refSampleDuration=Math.floor(1024/r.audioSampleRate*r.timescale));var o=r.audioSampleRate,a=r.sampleRateIndex,s=r.refSampleDuration;delete e.tagType;var u=this._datasizeValidator(e.datasize);if(0===e.data[0]){var c=this._aacSequenceHeaderParser(e.data);o=c.audiosamplerate||r.audioSampleRate,a=c.sampleRateIndex||r.sampleRateIndex,s=Math.floor(1024/o*r.timescale),r.channelCount=c.channelCount,r.sampleRate=o,r.sampleRateIndex=a,r.refSampleDuration=s,r.duration=this._context.mediaInfo.duration*r.timescale,r.config=c.config;var l=this._context.mediaInfo.audio;l.codec=c.codec,l.channelCount=c.channelCount,l.sampleRate=o,l.sampleRateIndex=c.audioSampleRateIndex,this._hasAudioSequence?this.emit(At.AUDIO_METADATA_CHANGE):this.emit(At.METADATA_PARSED,"audio"),this._hasAudioSequence=!0,this._metaChange=!0}else this._metaChange&&(e.options={meta:t.meta},this._metaChange=!1),e.data=e.data.slice(1,e.data.length),t.samples.push(e);u||this.emit(At.DEMUX_ERROR,this.TAG,new Error("TAG length error at "+e.datasize),!1)}}},{key:"_parseHevcData",value:function(e){var t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;var r=15&t;if(this.tracks.videoTrack.codecID=r,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===r){var i=this.loaderBuffer.shift(e.datasize-5);if(e.data=i,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.emit(At.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1);var n={},o=0;for(n.cts=e.cts,n.dts=e.dts;e.data.length>o;){var a=e.data.slice(Number.parseInt(o),4+o);n.size=a[3],n.size+=256*a[2],n.size+=256*a[1]*256,n.size+=256*a[0]*256*256,o+=4,n.data=e.data.slice(Number.parseInt(o),n.size+o),o+=n.size,this.tracks.videoTrack.samples.push(n),this.emit(At.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(At.METADATA_PARSED,"video"):this.emit(At.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1))}else if(7===r){var s=this.loaderBuffer.shift(e.datasize-5);if(0===s[4]&&0===s[5]&&0===s[6]&&1===s[7]){for(var u=0,c=0;c<4;c++)u=256*u+s[c];u-=4,(s=s.slice(4,s.length))[3]=u%256,u=(u-s[3])/256,s[2]=u%256,u=(u-s[2])/256,s[1]=u%256,s[0]=(u-s[1])/256}if(e.data=s,0===e.avcPacketType)this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasVideoSequence?this.emit(At.VIDEO_METADATA_CHANGE):this.emit(At.METADATA_PARSED,"video"),this._hasVideoSequence=!0),this._metaChange=!0;else{if(!this._datasizeValidator(e.datasize))return void this.emit(At.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1);for(var l=ut.getAvccNals(new Tt(e.data.buffer)),h=0;h<l.length;h++){var f=l[h];ut.analyseNal(f),f.sei&&this.emit(At.SEI_PARSED,f.sei)}this._metaChange&&(e.options={meta:Object.assign({},this.tracks.videoTrack.meta)},this._metaChange=!1),this.tracks.videoTrack.samples.push(e)}}else this.emit(At.DEMUX_ERROR,this.TAG,new Error("video codeid is "+r),!1),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.emit(At.DEMUX_ERROR,this.TAG,new Error("invalid video tag datasize: "+e.datasize),!1),this.tracks.videoTrack.samples.push(e),this.emit(At.DEMUX_COMPLETE);delete e.tagType}},{key:"_avcSequenceHeaderParser",value:function(e){var t=this.tracks.videoTrack;if(t){var r=0;t.meta||(t.meta=new Ke);var i=t.meta;i.configurationVersion=e[0],i.avcProfileIndication=e[1],i.profileCompatibility=e[2],i.avcLevelIndication=e[3]/10,i.nalUnitLength=1+(3&e[4]);var n=31&e[5];r=6;for(var o={},a=0;a<n;a++){var s=255*e[r]+e[r+1];r+=2;for(var u=new Uint8Array(s),c=0;c<s;c++)u[c]=e[r+c];for(var l="avc1.",h=1;h<4;h++){var f=u[h].toString(16);f.length<2&&(f="0"+f),l+=f}i.codec=l,r+=s,this.tracks.videoTrack.meta.sps=u,o=st.parseSPS(u)}var d=e[r];r++;for(var p=0;p<d;p++){var v=255*e[r]+e[r+1];r+=2;for(var y=new Uint8Array(v),m=0;m<v;m++)y[m]=e[r+m];r+=v,this.tracks.videoTrack.meta.pps=y}Object.assign(i,st.toVideoMeta(o));var g=this._context.mediaInfo.video;g.codec=i.codec,g.profile=i.profile,g.level=i.level,g.chromaFormat=i.chromaFormat,g.frameRate=i.frameRate,g.parRatio=i.parRatio,g.width=g.width===i.presentWidth?g.width:i.presentWidth,g.height=g.height===i.presentHeight?g.width:i.presentHeight,i.duration=this._context.mediaInfo.duration*i.timescale,i.avcc=new Uint8Array(e.length),i.avcc.set(e),t.meta=i}}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e){var t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}},{key:"loaderBuffer",get:function(){var e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(At.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}}],[{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),e}(),Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct="function"==typeof Symbol&&"symbol"===Rt(Symbol.iterator)?function(e){return void 0===e?"undefined":Rt(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":Rt(e)},Ot=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),St=Fe.LOADER_EVENTS,Dt=function(){function e(t){L(this,e),this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}return Ot(e,[{key:"init",value:function(){this.on(St.LADER_START,this.load.bind(this))}},{key:"load",value:function(e,t){var r=this;this.url=e,this._canceled=!1;var i=this.getParams(t);return this.loading=!0,fetch(this.url,i).then(function(e){if(e.ok)return r.status=e.status,Promise.resolve().then(function(){r._onFetchResponse(e)}),Promise.resolve(e);r.loading=!1,r.emit(St.LOADER_ERROR,r.TAG,new Error(e.status+" ("+e.statusText+")"))}).catch(function(e){throw r.loading=!1,r.emit(St.LOADER_ERROR,r.TAG,e),e})}},{key:"_onFetchResponse",value:function(e){var t=this,r=this._context.getInstance(this.buffer),i=++this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case 2:e.json().then(function(e){t.loading=!1,t._canceled||t._destroyed||(r?(r.push(e),t.emit(St.LOADER_COMPLETE,r)):t.emit(St.LOADER_COMPLETE,e))});break;case 1:e.text().then(function(e){t.loading=!1,t._canceled||t._destroyed||(r?(r.push(e),t.emit(St.LOADER_COMPLETE,r)):t.emit(St.LOADER_COMPLETE,e))});break;case 3:e.arrayBuffer().then(function(e){t.loading=!1,t._canceled||t._destroyed||(r?(r.push(new Uint8Array(e)),t.emit(St.LOADER_COMPLETE,r)):t.emit(St.LOADER_COMPLETE,e))});break;case 0:default:return this._onReader(e.body.getReader(),i)}}},{key:"_onReader",value:function(e,t){var r=this,i=this._context.getInstance(this.buffer);if(!i&&this._reader||this._destroyed)try{this._reader.cancel()}catch(e){}this._reader=e,!1!==this.loading&&this._reader&&this._reader.read().then(function(n){if(!r._canceled&&!r._destroyed)return n.done?(r.loading=!1,r.status=0,void Promise.resolve().then(function(){r.emit(St.LOADER_COMPLETE,i)})):(i.push(n.value),Promise.resolve().then(function(){r.emit(St.LOADER_DATALOADED,i)}),r._onReader(e,t));if(r._reader)try{r._reader.cancel()}catch(e){}}).catch(function(e){throw r.loading=!1,r.emit(St.LOADER_ERROR,r.TAG,e),e})}},{key:"getParams",value:function(e){var t=Object.assign({},e),r=new Headers,i={method:"GET",headers:r,mode:"cors",cache:"default"};if("object"===Ct(this.configs.headers)){var n=this.configs.headers;for(var o in n)n.hasOwnProperty(o)&&r.append(o,n[o])}if("object"===Ct(t.headers)){var a=t.headers;for(var s in a)a.hasOwnProperty(s)&&r.append(s,a[s])}return!1===t.cors&&(i.mode="same-origin"),t.withCredentials&&(i.credentials="include"),i}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(e){}this._reader=null,this.loading=!1}this._canceled=!0}},{key:"destroy",value:function(){this._destroyed=!0,this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),e}(),Pt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Lt=function(){function e(t){I(this,e),this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}return Pt(e,[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){var t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){var r=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,r}for(var i=new Uint8Array(e),n=0;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){var o=this.array[0].slice(this.offset,this.offset+e);i.set(o,n),this.offset+=e,this.length-=e,e=0;break}var a=this.array[0].length-this.offset;i.set(this.array[0].slice(this.offset,this.array[0].length),n),this.array.shift(),this.offset=0,n+=a,this.length-=a,e-=a}return i}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){for(var r=0,i=this.offset+e;i<this.offset+t+e;)i<this.array[0].length?r=256*r+this.array[0][i]:this.array[1]&&(r=256*r+this.array[1][i-this.array[0].length]),i++;return r}}]),e}(),It=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Nt=Fe.DEMUX_EVENTS,Ut=Fe.LOADER_EVENTS,Bt="FLVController",Mt=function(){function e(){N(this,e)}return It(e,[{key:"warn",value:function(){}}]),e}(),Ft=function(){function t(e){N(this,t),this.TAG=Bt,this._player=e,this.state={initSegmentArrived:!1,randomAccessPoints:[]},this.bufferClearTimer=null}return It(t,[{key:"init",value:function(){this.initComponents(),this.initListeners()}},{key:"initComponents",value:function(){this._context.registry("FETCH_LOADER",Dt),this._context.registry("LOADER_BUFFER",Lt),this._context.registry("FLV_DEMUXER",kt),this._context.registry("TRACKS",ht),this._context.registry("LOGGER",Mt)}},{key:"initListeners",value:function(){this.on(Ut.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(Ut.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(Nt.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(Nt.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(Nt.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(Nt.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(Nt.SEI_PARSED,this._handleSEIParsed.bind(this))}},{key:"_handleMediaInfo",value:function(){this._context.mediaInfo||this.emit(Nt.DEMUX_ERROR,new Error("failed to get mediainfo"))}},{key:"_handleLoaderDataLoaded",value:function(){this.emitTo("FLV_DEMUXER",Nt.DEMUX_START)}},{key:"_handleSEIParsed",value:function(e){this._player.emit("SEI_PARSED",e)}},{key:"_handleDemuxComplete",value:function(){if(this._player.video){var e=this._context.getInstance("TRACKS"),t=e.videoTrack,r=e.audioTrack;this._player.video.onDemuxComplete(t,r)}}},{key:"_handleMetadataParsed",value:function(e){if("audio"===e){var t=this._context.getInstance("TRACKS").audioTrack;t&&t.meta&&this._setMetaToAudio(t.meta)}else{var r=this._context.getInstance("TRACKS").videoTrack;r&&r.meta&&this._setMetaToVideo(r.meta)}}},{key:"_setMetaToAudio",value:function(e){this._player.video&&this._player.video.setAudioMeta(e)}},{key:"_setMetaToVideo",value:function(e){this._player.video&&this._player.video.setVideoMeta(e)}},{key:"_handleAppendInitSegment",value:function(){this.state.initSegmentArrived=!0}},{key:"_handleNetworkError",value:function(t,r){this._player.emit("error",new e.Errors("network",this._player.config.url)),this._onError(Ut.LOADER_ERROR,t,r,!0)}},{key:"_handleDemuxError",value:function(t,r,i){void 0===i&&(i=!1),this._player.emit("error",new e.Errors("parse",this._player.config.url)),this._onError(Nt.DEMUX_ERROR,t,r,i)}},{key:"_handleAddRAP",value:function(e){this.state.randomAccessPoints&&this.state.randomAccessPoints.push(e)}},{key:"_onError",value:function(e,t,r,i){var n={errorType:e,errorDetails:"["+t+"]: "+r.message,errorFatal:i||!1};this._player.emit("FLV_ERROR",n)}},{key:"seek",value:function(){this.state.initSegmentArrived||this.loadData()}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._player.config.url;this.emit(Ut.LADER_START,e)}},{key:"pause",value:function(){var e=this._context.getInstance("FETCH_LOADER");e&&e.cancel()}},{key:"destroy",value:function(){this._player=null,this.state.randomAccessPoints=[]}}]),t}();(function(){function e(e){var t=de.has(e);return e=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(e),!t&&e}function t(e){var t=e.isConnected;if(void 0!==t)return t;if(pe(e))return!0;for(;e&&!(e.__CE_isImportDocument||e instanceof Document);)e=e.parentNode||(window.ShadowRoot&&e instanceof ShadowRoot?e.host:void 0);return!(!e||!(e.__CE_isImportDocument||e instanceof Document))}function r(e){var t=e.children;if(t)return Array.prototype.slice.call(t);for(t=[],e=e.firstChild;e;e=e.nextSibling)e.nodeType===Node.ELEMENT_NODE&&t.push(e);return t}function i(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}function n(e,t,r){for(var o=e;o;){if(o.nodeType===Node.ELEMENT_NODE){var a=o;t(a);var s=a.localName;if("link"===s&&"import"===a.getAttribute("rel")){if(o=a.import,void 0===r&&(r=new Set),o instanceof Node&&!r.has(o))for(r.add(o),o=o.firstChild;o;o=o.nextSibling)n(o,t,r);o=i(e,a);continue}if("template"===s){o=i(e,a);continue}if(a=a.__CE_shadowRoot)for(a=a.firstChild;a;a=a.nextSibling)n(a,t,r)}o=o.firstChild?o.firstChild:i(e,o)}}function o(e,t,r){e[t]=r}function a(e){var t=document;this.c=e,this.a=t,this.b=void 0,T(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function s(e){e.b&&e.b.disconnect()}function u(){var e=this;this.b=this.a=void 0,this.c=new Promise(function(t){e.b=t,e.a&&t(e.a)})}function c(e){if(e.a)throw Error("Already resolved.");e.a=void 0,e.b&&e.b(void 0)}function l(e){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=e,this.j=new Map,this.c=function(e){return e()},this.a=!1,this.h=[],this.m=e.f?new a(e):void 0}function h(t,r){if(!e(r))throw new SyntaxError("The element name '"+r+"' is not valid.");if(p(t,r))throw Error("A custom element with name '"+r+"' has already been defined.");if(t.i)throw Error("A custom element is already being defined.")}function f(e,t,r){e.i=!0;var i;try{var n=function(e){var t=o[e];if(void 0!==t&&!(t instanceof Function))throw Error("The '"+e+"' callback must be a function.");return t},o=r.prototype;if(!(o instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var a=n("connectedCallback"),s=n("disconnectedCallback"),u=n("adoptedCallback"),c=(i=n("attributeChangedCallback"))&&r.observedAttributes||[]}catch(e){throw e}finally{e.i=!1}return r={localName:t,constructorFunction:r,connectedCallback:a,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:i,observedAttributes:c,constructionStack:[]},e.g.set(t,r),e.l.set(r.constructorFunction,r),r}function d(e){if(!1!==e.a){e.a=!1;for(var t=[],r=e.h,i=new Map,n=0;n<r.length;n++)i.set(r[n],[]);for(T(e.b,document,{upgrade:function(r){if(void 0===r.__CE_state){var n=r.localName,o=i.get(n);o?o.push(r):e.g.has(n)&&t.push(r)}}}),n=0;n<t.length;n++)x(e.b,t[n]);for(n=0;n<r.length;n++){for(var o=r[n],a=i.get(o),s=0;s<a.length;s++)x(e.b,a[s]);(o=e.j.get(o))&&c(o)}r.length=0}}function p(e,t){var r=e.g.get(t);if(r)return r;if(r=e.f.get(t)){e.f.delete(t);try{return f(e,t,r())}catch(e){k(e)}}}function v(){var e=ye&&ye.noDocumentConstructionObserver,t=ye&&ye.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=t,this.f=!e}function y(e,t,r,i){var o=window.ShadyDOM;if(e.shadyDomFastWalk&&o&&o.inUse){if(t.nodeType===Node.ELEMENT_NODE&&r(t),t.querySelectorAll)for(e=o.nativeMethods.querySelectorAll.call(t,"*"),t=0;t<e.length;t++)r(e[t])}else n(t,r,i)}function m(e,t){e.a=!0,e.b.push(t)}function g(e,t){e.a=!0,e.c.push(t)}function b(e,t){e.a&&y(e,t,function(t){return _(e,t)})}function _(e,t){if(e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var r=0;r<e.b.length;r++)e.b[r](t);for(r=0;r<e.c.length;r++)e.c[r](t)}}function E(e,t){var r=[];for(y(e,t,function(e){return r.push(e)}),t=0;t<r.length;t++){var i=r[t];1===i.__CE_state?e.connectedCallback(i):x(e,i)}}function w(e,t){var r=[];for(y(e,t,function(e){return r.push(e)}),t=0;t<r.length;t++){var i=r[t];1===i.__CE_state&&e.disconnectedCallback(i)}}function T(e,t,r){var i=(r=void 0===r?{}:r).s,n=r.upgrade||function(t){return x(e,t)},o=[];for(y(e,t,function(t){if(e.a&&_(e,t),"link"===t.localName&&"import"===t.getAttribute("rel")){var r=t.import;r instanceof Node&&(r.__CE_isImportDocument=!0,r.__CE_registry=document.__CE_registry),r&&"complete"===r.readyState?r.__CE_documentLoadHandled=!0:t.addEventListener("load",function(){var r=t.import;if(!r.__CE_documentLoadHandled){r.__CE_documentLoadHandled=!0;var o=new Set;i&&(i.forEach(function(e){return o.add(e)}),o.delete(r)),T(e,r,{s:o,upgrade:n})}})}else o.push(t)},i),t=0;t<o.length;t++)n(o[t])}function x(e,r){try{var i=r.ownerDocument,n=i.__CE_registry,o=n&&(i.defaultView||i.__CE_isImportDocument)?p(n,r.localName):void 0;if(o&&void 0===r.__CE_state){o.constructionStack.push(r);try{try{if(new o.constructorFunction!==r)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{o.constructionStack.pop()}}catch(e){throw r.__CE_state=2,e}if(r.__CE_state=1,r.__CE_definition=o,o.attributeChangedCallback&&r.hasAttributes()){var a=o.observedAttributes;for(o=0;o<a.length;o++){var s=a[o],u=r.getAttribute(s);null!==u&&e.attributeChangedCallback(r,s,null,u,null)}}t(r)&&e.connectedCallback(r)}}catch(e){k(e)}}function A(e,t,r,i){var n=t.__CE_registry;if(n&&(null===i||"http://www.w3.org/1999/xhtml"===i)&&(n=p(n,r)))try{var o=new n.constructorFunction;if(void 0===o.__CE_state||void 0===o.__CE_definition)throw Error("Failed to construct '"+r+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==o.namespaceURI)throw Error("Failed to construct '"+r+"': The constructed element's namespace must be the HTML namespace.");if(o.hasAttributes())throw Error("Failed to construct '"+r+"': The constructed element must not have any attributes.");if(null!==o.firstChild)throw Error("Failed to construct '"+r+"': The constructed element must not have any children.");if(null!==o.parentNode)throw Error("Failed to construct '"+r+"': The constructed element must not have a parent node.");if(o.ownerDocument!==t)throw Error("Failed to construct '"+r+"': The constructed element's owner document is incorrect.");if(o.localName!==r)throw Error("Failed to construct '"+r+"': The constructed element's local name is incorrect.");return o}catch(n){return k(n),t=null===i?I.call(t,r):N.call(t,i,r),Object.setPrototypeOf(t,HTMLUnknownElement.prototype),t.__CE_state=2,t.__CE_definition=void 0,_(e,t),t}return t=null===i?I.call(t,r):N.call(t,i,r),_(e,t),t}function k(e){var t=e.message,r=e.sourceURL||e.fileName||"",i=e.line||e.lineNumber||0,n=e.column||e.columnNumber||0,o=void 0;void 0===ErrorEvent.prototype.initErrorEvent?o=new ErrorEvent("error",{cancelable:!0,message:t,filename:r,lineno:i,colno:n,error:e}):((o=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,t,r,i),o.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===o.error&&Object.defineProperty(o,"error",{configurable:!0,enumerable:!0,get:function(){return e}}),window.dispatchEvent(o),o.defaultPrevented||console.error(e)}function R(e){window.HTMLElement=function(){function t(){var t=this.constructor,r=document.__CE_registry.l.get(t);if(!r)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var i=r.constructionStack;if(0===i.length)return i=I.call(document,r.localName),Object.setPrototypeOf(i,t.prototype),i.__CE_state=1,i.__CE_definition=r,_(e,i),i;var n=i.length-1,o=i[n];if(o===ve)throw Error("Failed to construct '"+r.localName+"': This element was already constructed.");return i[n]=ve,Object.setPrototypeOf(o,t.prototype),_(e,o),o}return t.prototype=ce.prototype,Object.defineProperty(t.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:t}),t}()}function C(e,r,i){function n(r){return function(i){for(var n=[],o=0;o<arguments.length;++o)n[o]=arguments[o];o=[];for(var a=[],s=0;s<n.length;s++){var u=n[s];if(u instanceof Element&&t(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(r.apply(this,n),n=0;n<a.length;n++)w(e,a[n]);if(t(this))for(n=0;n<o.length;n++)(a=o[n])instanceof Element&&E(e,a)}}void 0!==i.prepend&&o(r,"prepend",n(i.prepend)),void 0!==i.append&&o(r,"append",n(i.append))}function O(e){o(Document.prototype,"createElement",function(t){return A(e,this,t,null)}),o(Document.prototype,"importNode",function(t,r){return t=U.call(this,t,!!r),this.__CE_registry?T(e,t):b(e,t),t}),o(Document.prototype,"createElementNS",function(t,r){return A(e,this,r,t)}),C(e,Document.prototype,{prepend:B,append:M})}function S(e){function i(r,i){Object.defineProperty(r,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(r){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,r);else{var n=void 0;if(this.firstChild){var o=this.childNodes,a=o.length;if(0<a&&t(this)){n=Array(a);for(var s=0;s<a;s++)n[s]=o[s]}}if(i.set.call(this,r),n)for(r=0;r<n.length;r++)w(e,n[r])}}})}o(Node.prototype,"insertBefore",function(i,n){if(i instanceof DocumentFragment){var o=r(i);if(i=z.call(this,i,n),t(this))for(n=0;n<o.length;n++)E(e,o[n]);return i}return o=i instanceof Element&&t(i),n=z.call(this,i,n),o&&w(e,i),t(this)&&E(e,i),n}),o(Node.prototype,"appendChild",function(i){if(i instanceof DocumentFragment){var n=r(i);if(i=X.call(this,i),t(this))for(var o=0;o<n.length;o++)E(e,n[o]);return i}return n=i instanceof Element&&t(i),o=X.call(this,i),n&&w(e,i),t(this)&&E(e,i),o}),o(Node.prototype,"cloneNode",function(t){return t=G.call(this,!!t),this.ownerDocument.__CE_registry?T(e,t):b(e,t),t}),o(Node.prototype,"removeChild",function(r){var i=r instanceof Element&&t(r),n=H.call(this,r);return i&&w(e,r),n}),o(Node.prototype,"replaceChild",function(i,n){if(i instanceof DocumentFragment){var o=r(i);if(i=V.call(this,i,n),t(this))for(w(e,n),n=0;n<o.length;n++)E(e,o[n]);return i}o=i instanceof Element&&t(i);var a=V.call(this,i,n),s=t(this);return s&&w(e,n),o&&w(e,i),s&&E(e,i),a}),W&&W.get?i(Node.prototype,W):m(e,function(e){i(e,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=this.firstChild;t;t=t.nextSibling)t.nodeType!==Node.COMMENT_NODE&&e.push(t.textContent);return e.join("")},set:function(e){for(;this.firstChild;)H.call(this,this.firstChild);null!=e&&""!==e&&X.call(this,document.createTextNode(e))}})})}function D(e){function r(r){return function(i){for(var n=[],o=0;o<arguments.length;++o)n[o]=arguments[o];o=[];for(var a=[],s=0;s<n.length;s++){var u=n[s];if(u instanceof Element&&t(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(r.apply(this,n),n=0;n<a.length;n++)w(e,a[n]);if(t(this))for(n=0;n<o.length;n++)(a=o[n])instanceof Element&&E(e,a)}}var i=Element.prototype;void 0!==oe&&o(i,"before",r(oe)),void 0!==ae&&o(i,"after",r(ae)),void 0!==se&&o(i,"replaceWith",function(r){for(var i=[],n=0;n<arguments.length;++n)i[n]=arguments[n];n=[];for(var o=[],a=0;a<i.length;a++){var s=i[a];if(s instanceof Element&&t(s)&&o.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)n.push(s);else n.push(s)}for(a=t(this),se.apply(this,i),i=0;i<o.length;i++)w(e,o[i]);if(a)for(w(e,this),i=0;i<n.length;i++)(o=n[i])instanceof Element&&E(e,o)}),void 0!==ue&&o(i,"remove",function(){var r=t(this);ue.call(this),r&&w(e,this)})}function P(e){function r(r,i){Object.defineProperty(r,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(r){var n=this,o=void 0;if(t(this)&&(o=[],y(e,this,function(e){e!==n&&o.push(e)})),i.set.call(this,r),o)for(var a=0;a<o.length;a++){var s=o[a];1===s.__CE_state&&e.disconnectedCallback(s)}return this.ownerDocument.__CE_registry?T(e,this):b(e,this),r}})}function i(r,i){o(r,"insertAdjacentElement",function(r,n){var o=t(n);return r=i.call(this,r,n),o&&w(e,n),t(r)&&E(e,n),r})}function n(t,r){function i(t,r){for(var i=[];t!==r;t=t.nextSibling)i.push(t);for(r=0;r<i.length;r++)T(e,i[r])}o(t,"insertAdjacentHTML",function(e,t){if("beforebegin"===(e=e.toLowerCase())){var n=this.previousSibling;r.call(this,e,t),i(n||this.parentNode.firstChild,this)}else if("afterbegin"===e)n=this.firstChild,r.call(this,e,t),i(this.firstChild,n);else if("beforeend"===e)n=this.lastChild,r.call(this,e,t),i(n||this.firstChild,null);else{if("afterend"!==e)throw new SyntaxError("The value provided ("+String(e)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");n=this.nextSibling,r.call(this,e,t),i(this.nextSibling,n)}})}Y&&o(Element.prototype,"attachShadow",function(t){if(t=Y.call(this,t),e.a&&!t.__CE_patched){t.__CE_patched=!0;for(var r=0;r<e.b.length;r++)e.b[r](t)}return this.__CE_shadowRoot=t}),q&&q.get?r(Element.prototype,q):le&&le.get?r(HTMLElement.prototype,le):g(e,function(e){r(e,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(e){var t="template"===this.localName,r=t?this.content:this,i=N.call(document,this.namespaceURI,this.localName);for(i.innerHTML=e;0<r.childNodes.length;)H.call(r,r.childNodes[0]);for(e=t?i.content:i;0<e.childNodes.length;)X.call(r,e.childNodes[0])}})}),o(Element.prototype,"setAttribute",function(t,r){if(1!==this.__CE_state)return J.call(this,t,r);var i=K.call(this,t);J.call(this,t,r),r=K.call(this,t),e.attributeChangedCallback(this,t,i,r,null)}),o(Element.prototype,"setAttributeNS",function(t,r,i){if(1!==this.__CE_state)return Q.call(this,t,r,i);var n=$.call(this,t,r);Q.call(this,t,r,i),i=$.call(this,t,r),e.attributeChangedCallback(this,r,n,i,t)}),o(Element.prototype,"removeAttribute",function(t){if(1!==this.__CE_state)return Z.call(this,t);var r=K.call(this,t);Z.call(this,t),null!==r&&e.attributeChangedCallback(this,t,r,null,null)}),o(Element.prototype,"removeAttributeNS",function(t,r){if(1!==this.__CE_state)return ee.call(this,t,r);var i=$.call(this,t,r);ee.call(this,t,r);var n=$.call(this,t,r);i!==n&&e.attributeChangedCallback(this,r,i,n,t)}),he?i(HTMLElement.prototype,he):te&&i(Element.prototype,te),fe?n(HTMLElement.prototype,fe):re&&n(Element.prototype,re),C(e,Element.prototype,{prepend:ie,append:ne}),D(e)}function L(){var e=new v;R(e),O(e),C(e,DocumentFragment.prototype,{prepend:F,append:j}),S(e),P(e),e=new l(e),document.__CE_registry=e,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:e})}var I=window.Document.prototype.createElement,N=window.Document.prototype.createElementNS,U=window.Document.prototype.importNode,B=window.Document.prototype.prepend,M=window.Document.prototype.append,F=window.DocumentFragment.prototype.prepend,j=window.DocumentFragment.prototype.append,G=window.Node.prototype.cloneNode,X=window.Node.prototype.appendChild,z=window.Node.prototype.insertBefore,H=window.Node.prototype.removeChild,V=window.Node.prototype.replaceChild,W=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),Y=window.Element.prototype.attachShadow,q=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),K=window.Element.prototype.getAttribute,J=window.Element.prototype.setAttribute,Z=window.Element.prototype.removeAttribute,$=window.Element.prototype.getAttributeNS,Q=window.Element.prototype.setAttributeNS,ee=window.Element.prototype.removeAttributeNS,te=window.Element.prototype.insertAdjacentElement,re=window.Element.prototype.insertAdjacentHTML,ie=window.Element.prototype.prepend,ne=window.Element.prototype.append,oe=window.Element.prototype.before,ae=window.Element.prototype.after,se=window.Element.prototype.replaceWith,ue=window.Element.prototype.remove,ce=window.HTMLElement,le=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),he=window.HTMLElement.prototype.insertAdjacentElement,fe=window.HTMLElement.prototype.insertAdjacentHTML,de=new Set;"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach(function(e){return de.add(e)});var pe=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);a.prototype.f=function(e){var t=this.a.readyState;for("interactive"!==t&&"complete"!==t||s(this),t=0;t<e.length;t++)for(var r=e[t].addedNodes,i=0;i<r.length;i++)T(this.c,r[i])},l.prototype.o=function(e,t){var r=this;if(!(t instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");h(this,e),this.f.set(e,t),this.h.push(e),this.a||(this.a=!0,this.c(function(){return d(r)}))},l.prototype.define=function(e,t){var r=this;if(!(t instanceof Function))throw new TypeError("Custom element constructors must be functions.");h(this,e),f(this,e,t),this.h.push(e),this.a||(this.a=!0,this.c(function(){return d(r)}))},l.prototype.upgrade=function(e){T(this.b,e)},l.prototype.get=function(e){if(e=p(this,e))return e.constructorFunction},l.prototype.whenDefined=function(t){if(!e(t))return Promise.reject(new SyntaxError("'"+t+"' is not a valid custom element name."));var r=this.j.get(t);if(r)return r.c;r=new u,this.j.set(t,r);var i=this.g.has(t)||this.f.has(t);return t=-1===this.h.indexOf(t),i&&t&&c(r),r.c},l.prototype.polyfillWrapFlushCallback=function(e){this.m&&s(this.m);var t=this.c;this.c=function(r){return e(function(){return t(r)})}},window.CustomElementRegistry=l,l.prototype.define=l.prototype.define,l.prototype.upgrade=l.prototype.upgrade,l.prototype.get=l.prototype.get,l.prototype.whenDefined=l.prototype.whenDefined,l.prototype.polyfillDefineLazy=l.prototype.o,l.prototype.polyfillWrapFlushCallback=l.prototype.polyfillWrapFlushCallback,v.prototype.connectedCallback=function(e){var t=e.__CE_definition;if(t.connectedCallback)try{t.connectedCallback.call(e)}catch(e){k(e)}},v.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;if(t.disconnectedCallback)try{t.disconnectedCallback.call(e)}catch(e){k(e)}},v.prototype.attributeChangedCallback=function(e,t,r,i,n){var o=e.__CE_definition;if(o.attributeChangedCallback&&-1<o.observedAttributes.indexOf(t))try{o.attributeChangedCallback.call(e,t,r,i,n)}catch(e){k(e)}};var ve=new function(){},ye=window.customElements;ye&&!ye.forcePolyfill&&"function"==typeof ye.define&&"function"==typeof ye.get||L(),window.__CE_installPolyfill=L}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var e=HTMLElement,t={HTMLElement:function(){return Reflect.construct(e,[],this.constructor)}};window.HTMLElement=t.HTMLElement,HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}}();var jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gt=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,i)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(i)},Xt=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),zt=function(){function e(t){M(this,e),this.options=Object.assign({},t||{},{interval:16}),this.callbacks=[]}return Xt(e,[{key:"start",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.callbacks=t}},{key:"onTick",value:function(){for(var e=0,t=this.callbacks.length;e<t;e++)(0,this.callbacks[e])()}},{key:"setInterval",value:function(e){return this.options.interval=e,this}}]),e}(),Ht=function(e){function t(e){M(this,t);var r=U(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.prev=null,r.timerId=null,r._subTimerId=null,r._tickFunc=t.getTickFunc(),r.tick=r.tick.bind(r),r}return B(t,e),Xt(t,[{key:"start",value:function(){for(var e,r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];(e=Gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this)).call.apply(e,[this].concat(i)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var e=this._tickFunc;this.timerId=e(this.tick)}},{key:"stop",value:function(){this.timerId&&t.getCancelFunc()(this.timerId)}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==t.getTickFunc()}}]),t}(zt),Vt=function(e){function t(e){M(this,t);var r=U(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.timeoutId=null,r}return B(t,e),Xt(t,[{key:"start",value:function(){for(var e,r=this,i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];(e=Gt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"nextTick",this)).call.apply(e,[this].concat(n)),this.timeoutId=window.setInterval(function(){r.onTick()},this.options.interval||16)}},{key:"stop",value:function(){this.timeoutId&&window.clearInterval(this.timeoutId)}}]),t}(zt),Wt=function(){return Ht.isSupported()?Ht:Vt},Yt="undefined"==typeof Symbol?"__target":Symbol(),qt="application/javascript",Kt=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Jt=window.URL||window.webkitURL,Zt=window.Worker;if(Zt){var $t,Qt=j("self.onmessage = function () {}"),er=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");($t=new Zt(Qt)).postMessage(er,[er.buffer])}catch(e){Zt=null}finally{Jt.revokeObjectURL(Qt),$t&&$t.terminate()}}var tr=new F("./worker.js",function(e,t){function r(){(a=new o(this)).init()}function i(e){n.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder.js"),addOnPostRun(r.bind(n))}var n=this,o=function(e){this.inited=!1,this.self=e,this.meta=this.self.meta,this.infolist={},e.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),e.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};o.prototype.toU8Array=function(e,t){return this.self.HEAPU8.subarray(e,e+t)},o.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},o.prototype.broadwayOnPictureDecoded=function(e,t,r,i,n,o){var a=Object.assign({},this.infolist[o]),s=r,u=r/2;444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=r);var c=this.toU8Array(e,i*s+n*u*2);this.infolist[o]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;this.self.postMessage({msg:"DECODED",width:t,height:r,yLinesize:i,uvLinesize:n,info:a,buffer:h},[h])},o.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},o.prototype.decode=function(e,t){var r=parseInt((new Date).getTime()),i=r-1e9*Math.floor(r/1e9);this.infolist[i]=t,this.streamBuffer.set(e),Module._broadwayPlayStream(e.length,i)},o.prototype.destroy=function(){Module._broadwayExit()};var a;n.addEventListener("message",function(e){var t=e.data;if(t.msg)switch(t.msg){case"init":console.log(t),n.meta=t.meta,i();break;case"decode":a.decode(t.data,t.info);break;case"destory":a.destroy()}else n.postMessage({msg:"ERROR:invalid message"})},!1)}),rr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),ir=function(){function e(){G(this,e)}return rr(e,null,[{key:"createTexture",value:function(e,t,r,i,n){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r instanceof Uint8Array?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,r):r instanceof HTMLVideoElement?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r):r instanceof HTMLImageElement?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r):r instanceof ImageData&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.bindTexture(e.TEXTURE_2D,null),o}},{key:"createBuffer",value:function(e,t){var r=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),r}},{key:"createShader",value:function(e,t,r){var i=e.createShader(t);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));return i}},{key:"createProgram",value:function(t,r,i){var n=t.createProgram(),o=e.createShader(t,t.VERTEX_SHADER,r),a=e.createShader(t,t.FRAGMENT_SHADER,i);if(t.attachShader(n,o),t.attachShader(n,a),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(n));for(var s={program:n},u=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES),c=0;c<u;c++){var l=t.getActiveAttrib(n,c);s[l.name]=t.getAttribLocation(n,l.name)}for(var h=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),f=0;f<h;f++){var d=t.getActiveUniform(n,f);s[d.name]=t.getUniformLocation(n,d.name)}return s}},{key:"bindAttribute",value:function(e,t,r,i){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,i,e.FLOAT,!1,0,0)}}]),e}(),nr=function e(){X(this,e),this.inputTextures=[]},or=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),ar=function(e){function t(e){z(this,t);var r=H(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform highp float opacity;","uniform sampler2D sampler;","uniform highp float flipx;","uniform highp float flipy;","void main(void) {","  float cordx = textureCoord.x;","  if(flipx > 0.5) {","     cordx = 1.0 - textureCoord.x;","  }","  float cordy = 1.0 - textureCoord.y;","  if(flipy > 0.5) {","    cordy = textureCoord.y;","  }","  vec4 color = texture2D(sampler,vec2(cordx, cordy));","  gl_FragColor = vec4(color[0],color[1],color[2],opacity);","}"].join("\n"),r.opacity=void 0===e.opacity?1:e.opacity,r.flip=e.flip,r}return V(t,e),or(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2);var i=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));ir.bindAttribute(t,i,this.pw.texturePos,2),ir.createTexture(t,t.LINEAR),t.uniform1i(this.pw.sampler,0),t.uniform1f(this.pw.opacity,this.opacity);var n=0,o=0;"x"!==this.flip&&"xy"!==this.flip||(n=1),"y"!==this.flip&&"xy"!==this.flip||(o=1),t.uniform1f(this.pw.flipx,n),t.uniform1f(this.pw.flipy,o)}},{key:"setFlip",value:function(e){var t=0,r=0;this.flip=e,"x"!==this.flip&&"xy"!==this.flip||(t=1),"y"!==this.flip&&"xy"!==this.flip||(r=1),this.gl.uniform1f(this.pw.flipx,t),this.gl.uniform1f(this.pw.flipy,r)}},{key:"render",value:function(e,t,r){var i=this.gl,n=this.program;i.useProgram(n),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}]),t}(nr),sr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),ur=function(e){function t(e){W(this,t);var r=Y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 yuv2rgb;","void main(void) {","  float cx = 1.0 / outerSize.x;","  float odd = floor(mod(textureCoord.x * outerSize.x, 2.0));","  float x = textureCoord.x + 0.5 * cx - odd * cx;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  float ydata = odd < 0.5?color[0]:color[2];","  float udata = color[1];","  float vdata = color[3];","  gl_FragColor = vec4(ydata, udata, vdata, 1) * yuv2rgb;","}"].join("\n"),r}return q(t,e),sr(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),ir.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i);var n=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];t.uniformMatrix4fv(this.pw.yuv2rgb,!1,n)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,n=this.program,o=this.inputTextures[0];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(n),i.viewport(0,0,this.canvas.width,this.canvas.height),i.uniform2fv(this.pw.outerSize,[t,r]),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t/2,r,0,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),cr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),lr=function(e){function t(e){K(this,t);var r=J(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","void main(void) {","  vec4 color = texture2D(sampler, textureCoord);","  gl_FragColor = vec4(color[2],color[1],color[0],color[3]);","}"].join("\n"),r}return Z(t,e),cr(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),ir.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,n=this.program,o=this.inputTextures[0];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(n),i.viewport(0,0,this.canvas.width,this.canvas.height),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),hr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),fr=function(e){function t(e){$(this,t);var r=Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 YUV2RGB;","void main(void) {","  float my = floor(mod(textureCoord.y * outerSize.y, 4.0));","  float cy = 1.0 / outerSize.y;","  float mx = floor(mod(outerSize.x, 4.0));","  float cx = 1.0 / outerSize.x;","  float width =  outerSize.x + mx;","  float x = textureCoord.x + (mx * cx * textureCoord.y * outerSize.y);","  x = cx * mod(x * outerSize.x, width);","  float bdata, gdata, rdata;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  rdata = color[0];","  gdata = color[1];","  bdata = color[2];","  gl_FragColor = vec4(bdata, gdata, rdata, 1);","}"].join("\n"),r}return ee(t,e),hr(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),ir.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,n=this.program,o=this.inputTextures[0];this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(n),i.viewport(0,0,this.canvas.width,this.canvas.height);var a=i.getUniformLocation(n,"outerSize");i.uniform2fv(a,[t,r]),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o);var s=t-t%4;return i.texImage2D(i.TEXTURE_2D,0,i.RGB,s,r,0,i.RGB,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),dr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),pr=function(e){function t(e){te(this,t);var r=re(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 yTexturePos;","attribute vec2 uvTexturePos;","varying vec2 yTextureCoord;","varying vec2 uvTextureCoord;","void main()","{","  gl_Position = vertexPos;","  yTextureCoord = yTexturePos;","  uvTextureCoord = uvTexturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 yTextureCoord;","varying highp vec2 uvTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uvSampler;","uniform mat4 yuv2rgb;","void main(void) {","  vec4 colory = texture2D(ySampler, yTextureCoord);","  vec4 coloruv = texture2D(uvSampler, vec2(yTextureCoord.x / 2.0, yTextureCoord.y));","  gl_FragColor = vec4(colory[0], coloruv[0], coloruv[1], 1) * yuv2rgb;","}"].join("\n"),r}return ie(t,e),dr(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2);var i=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));ir.bindAttribute(t,i,this.pw.yTexturePos,2);var n=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));ir.bindAttribute(t,n,this.pw.uvTexturePos,2);var o=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.ySampler,0),this.inputTextures.push(o);var a=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.uvSampler,1),this.inputTextures.push(a);var s=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];t.uniformMatrix4fv(this.pw.yuv2rgb,!1,s)}},{key:"render",value:function(e,t,r){var i=e[0],n=e[1],o=this.gl,a=this.program,s=this.inputTextures[0],u=this.inputTextures[1];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(o,o.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(o,o.LINEAR,new Uint8Array(t*r*4),t,r)),o.bindFramebuffer(o.FRAMEBUFFER,this.rend.fb),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.outputTexuture,0),o.useProgram(a),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,s),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,t,r,0,o.LUMINANCE,o.UNSIGNED_BYTE,i),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,u),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t/2,r/4,0,o.RGBA,o.UNSIGNED_BYTE,n),o.drawArrays(o.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),vr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),yr=function(e){function t(e,r){ne(this,t);var i=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.vShader=["attribute vec4 vertexPos;","attribute vec2 yTexturePos;","attribute vec2 uTexturePos;","attribute vec2 vTexturePos;","varying vec2 yTextureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  yTextureCoord = yTexturePos;","  uTextureCoord = uTexturePos;","  vTextureCoord = vTexturePos;","}"].join("\n"),i.fShader=["precision highp float;","varying highp vec2 yTextureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 yuv2rgb;","void main(void) {","  highp float y = texture2D(ySampler,  yTextureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * yuv2rgb;","}"].join("\n"),i}return ae(t,e),vr(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2);var i=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));ir.bindAttribute(t,i,this.pw.yTexturePos,2);var n=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));ir.bindAttribute(t,n,this.pw.uTexturePos,2);var o=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1]));ir.bindAttribute(t,o,this.pw.vTexturePos,2);var a=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.ySampler,0),this.inputTextures.push(a);var s=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.uSampler,1),this.inputTextures.push(s);var u=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.vSampler,2),this.inputTextures.push(u);var c=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];t.uniformMatrix4fv(this.pw.yuv2rgb,!1,c)}},{key:"render",value:function(e,t,r){var i=e[0],n=e[1],o=e[2],a=this.gl,s=this.program,u=this.inputTextures[0],c=this.inputTextures[1],l=this.inputTextures[2];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(a,a.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(a,a.LINEAR,new Uint8Array(t*r*4),t,r)),a.bindFramebuffer(a.FRAMEBUFFER,this.rend.fb),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.outputTexuture,0),a.useProgram(s),a.viewport(0,0,this.canvas.width,this.canvas.height),a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,u),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,t,r,0,a.LUMINANCE,a.UNSIGNED_BYTE,i),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,t/2,r/2,0,a.LUMINANCE,a.UNSIGNED_BYTE,n),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,t/2,r/2,0,a.LUMINANCE,a.UNSIGNED_BYTE,o),a.drawArrays(a.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),mr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),gr=function(e){function t(e){se(this,t);var r=ue(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","void main(void) {","  vec4 color = texture2D(sampler, textureCoord);","  gl_FragColor = vec4(color[0],color[1],color[2],color[3]);","}"].join("\n"),r}return ce(t,e),mr(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),ir.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e instanceof ImageData?e.data:e[0];var i=this.gl,n=this.program,o=this.inputTextures[0];return this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(n),i.viewport(0,0,this.canvas.width,this.canvas.height),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),br=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_r=function(e){function t(e){le(this,t);var r=he(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 YUV2RGB;","void main(void) {","  float my = floor(mod(textureCoord.y * outerSize.y, 4.0));","  float cy = 1.0 / outerSize.y;","  float mx = floor(mod(outerSize.x, 4.0));","  float cx = 1.0 / outerSize.x;","  float width =  outerSize.x + mx;","  float x = textureCoord.x + (mx * cx * textureCoord.y * outerSize.y);","  x = cx * mod(x * outerSize.x, width);","  float bdata, gdata, rdata;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  rdata = color[0];","  gdata = color[1];","  bdata = color[2];","  gl_FragColor = vec4(rdata, gdata, bdata, 1);","}"].join("\n"),r}return fe(t,e),br(t,[{key:"init",value:function(e){this.rend=e,this.canvas=e.canvas;var t=this.gl=e.gl;this.pw=ir.createProgram(t,this.vShader,this.fShader),this.program=this.pw.program,t.useProgram(this.program);var r=ir.createBuffer(t,new Float32Array([1,1,-1,1,1,-1,-1,-1]));ir.bindAttribute(t,r,this.pw.vertexPos,2),this.texturePosBuffer=ir.createBuffer(t,new Float32Array([1,0,0,0,1,1,0,1])),ir.bindAttribute(t,this.texturePosBuffer,this.pw.texturePos,2);var i=ir.createTexture(t,t.LINEAR);t.uniform1i(this.pw.sampler,0),this.inputTextures.push(i)}},{key:"render",value:function(e,t,r){e=e[0];var i=this.gl,n=this.program,o=this.inputTextures[0];this.width===t&&this.height===r||(this.width=t,this.height=r,this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),this.outputTexuture||(this.outputTexuture=ir.createTexture(i,i.LINEAR,new Uint8Array(t*r*4),t,r)),i.bindFramebuffer(i.FRAMEBUFFER,this.rend.fb),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.outputTexuture,0),i.useProgram(n),i.viewport(0,0,this.canvas.width,this.canvas.height);var a=i.getUniformLocation(n,"outerSize");i.uniform2fv(a,[t,r]),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o);var s=t-t%4;return i.texImage2D(i.TEXTURE_2D,0,i.RGB,s,r,0,i.RGB,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:t,height:r}}}]),t}(nr),Er=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),wr=function(){function e(t){if(de(this,e),this.canvas=t.canvas,t.video?(this.video=t.video,t.flip="y"):t.image?this.image=t.image:this._initFmt(t),this.filters=[],this.basicFilter=new ar({opacity:void 0!==t.opacity?t.opacity:1,flip:t.flip||void 0}),t.filters)for(var r=0;r<t.filters.length;r++)this.filters.push(t.filters[r]);this._init()}return Er(e,[{key:"_initFmt",value:function(e){switch(e.format){case"YUY2":this.fmt=new ur(this);break;case"RGBA":this.fmt=new gr(this);break;case"RGB":this.fmt=new _r(this);break;case"RGB32":this.fmt=new lr(this);break;case"RGB24":this.fmt=new fr(this);break;case"NV12":this.fmt=new pr(this);break;case"YUV420":this.fmt=new yr(this)}}},{key:"_initImage",value:function(){}},{key:"_init",value:function(){if(this._initContextGL(),!this.gl)throw new Error("fail to init gl");var e=this.gl;if(this.fb=e.createFramebuffer(),this.fmt)this.fmt.init(this);else if(this.video){var t=this.video.videoWidth,r=this.video.videoHeight,i=new Uint8Array(t*r*4);this.videoTexture=ir.createTexture(e,e.LINEAR,i,t,r)}this.basicFilter.init(this);for(var n=0;n<this.filters.length;n++)this.filters[n].init(this)}},{key:"_initContextGL",value:function(){for(var e=this.canvas,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!t&&i<r.length;){var n=r[i];try{t=e.getContext(n)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++i}this.gl=t}},{key:"_drawPicture",value:function(e,t,r){var i=this.fmt.render(e,t,r),n=i.texture,o=i.width,a=i.height;this._applyFilters(n,o,a)}},{key:"_drawVideo",value:function(){var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.videoTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.video),this._applyFilters(this.videoTexture,this.video.videoWidth,this.video.videoHeight)}},{key:"_applyFilters",value:function(e,t,r){for(var i=this.gl,n=0;n<this.filters.length;n++){var o=this.filters[n].render(e,t,r);e=o.texture,t=o.width,r=o.height}i.bindFramebuffer(i.FRAMEBUFFER,null),this.width===t&&this.height===r||(this.width=this.canvas.width=t,this.height=this.canvas.height=r),this.basicFilter.render(e,t,r)}},{key:"render",value:function(e,t,r){this.fmt?(this.width===t&&this.height===r||(this.width=this.canvas.width=t,this.height=this.canvas.height=r),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this._drawPicture(e,t,r)):this.video&&(this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this._drawVideo())}}]),e}(),Tr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),xr=function(){function e(t){pe(this,e),this.config=Object.assign({},t),this.type=this.config.type,this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}return Tr(e,[{key:"push",value:function(e){if("video"===this.type){if(e.isKeyframe){var t={samples:[],start:e.dts,end:e.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=t),this.currentGop=t,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(e),e.dts<this.currentGop.start&&(this.currentGop.start=e.dts),e.dts>this.currentGop.end&&(this.currentGop.end=e.dts))}}},{key:"get",value:function(e){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===e)return this._getNext()}}},{key:"_getNext",value:function(){if(this._lastGet){var e=this._lastGet.gop,t=e.samples[this._lastGet.index+1];if(t)return this._lastGet.index=this._lastGet.index+1,t;if(!(e=e.nextGop)||e.samples.length<1)return;return t=e.samples[0],this._lastGet={gop:e,index:0},t}var r=this.buffer[0];if(!(r.samples.length<1))return this._lastGet={gop:r,index:0},r.samples[0]}},{key:"remove",value:function(e,t){if(!(this.buffer.length<0))for(var r=0,i=this.buffer[0];i;)i.end<t&&i.start>=e?(this.buffer.splice(r,1),i=this.buffer[r]):(r+=1,i=this.buffer[r])}}]),e}(),Ar=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),kr=function(){function e(t){ve(this,e),this.ranges=t||[]}return Ar(e,[{key:"start",value:function(e){return this.ranges[e]?this.ranges[e].start:0}},{key:"end",value:function(e){return this.ranges[e]?this.ranges[e].end:0}},{key:"add",value:function(e){this.ranges.push(e)}},{key:"length",get:function(){return this.ranges.length}}]),e}(),Rr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Cr=function(){function e(t){ye(this,e),this.config=Object.assign({},t),this.canvas=this.config.canvas?this.config.canvas:document.createElement("canvas"),this.source=new xr({type:"video"}),this.preloadTime=this.config.preloadTime||3,this.oncanplay=void 0,this.onFirstFrame=void 0,this.meta=void 0,this.readyStatus=0,this.paused=!0,this.count=0,this.currentTime=0,this.lastPlayed=0,this._decoderInited=!1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null,this.canvas.style.maxWidth="100%",this.canvas.style.maxHeight="100%",this.canvas.style.top=0,this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.margin="auto",this.canvas.style.position="absolute"}return Rr(e,[{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){var e=this,t=this;this.wasmworker=new tr,this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",function(r){switch(r.data.msg){case"DECODER_READY":t._decoderInited=!0;break;case"DECODED":e._onDecoded(r.data)}})}},{key:"setVideoMetaData",value:function(e){if(this.meta=e,!this._decoderInited)return void this.initWasmWorker();this._avccpushed=!0;var t=new Uint8Array(e.sps.byteLength+4);if(t.set([0,0,0,1]),t.set(e.sps,4),this.wasmworker.postMessage({msg:"decode",data:t}),(t=new Uint8Array(e.pps.byteLength+4)).set([0,0,0,1]),t.set(e.pps,4),this.wasmworker.postMessage({msg:"decode",data:t}),!this.yuvCanvas){var r="YUV420";422===e.chromaFormat&&(r="YUV422P");var i=Object.assign({format:r,canvas:this.canvas},this.config);this.yuvCanvas=new wr(i)}this.readyStatus=1}},{key:"decodeVideo",value:function(e){if(this._decoderInited){this._avccpushed||this.setVideoMetaData(this.meta);for(var t=e.samples,r=t.shift();r;)this._baseDts||(this._baseDts=r.dts),this.source.push(r),r=t.shift();this._preload()}}},{key:"_preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){var e=this.source.get();for(e&&(this._lastSampleDts=e.dts,this._analyseNal(e));e&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(e=this.source.get())&&(this._analyseNal(e),this._lastSampleDts=e.dts)}}},{key:"_analyseNal",value:function(e){for(var t=ut.getAvccNals(new Tt(e.data.buffer)),r=0,i=0;i<t.length;i++)r+=t[i].body.byteLength+4;for(var n=0,o=new Uint8Array(r),a=0;a<t.length;a++){var s=t[a];o.set([0,0,0,1],n),n+=4,o.set(new Uint8Array(s.body),n),n+=s.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:o,info:{dts:e.dts,pts:e.pts?e.pts:e.dts+e.cts,key:e.isKeyframe}})}},{key:"_onDecoded",value:function(e){var t=e.info.dts;this._decodedFrames[t]=e,Object.keys(this._decodedFrames).length>10&&(this.playFinish&&this.playFinish(),this.oncanplay&&this.oncanplay())}},{key:"play",value:function(){var e=this;return this.paused=!1,new Promise(function(t){e.playFinish=t}).then(function(){e.playFinish=null})}},{key:"_onTimer",value:function(e){if(!this.paused){if(this.meta){this.meta.frameRate&&this.meta.frameRate.fixed&&this.meta.frameRate.fps;var t=Object.keys(this._decodedFrames);if(t.length>0){this.currentTime=e;for(var r=-1,i=0;i<t.length&&Number.parseInt(t[i])-this._baseDts<=this.currentTime;i++)r=Number.parseInt(t[i-1]);var n=this._decodedFrames[r];if(n){var o=[];if(420===this.meta.chromaFormat){var a=n.buffer.slice(0,n.yLinesize*n.height),s=n.buffer.slice(n.yLinesize*n.height,n.yLinesize*n.height*1.25),u=n.buffer.slice(n.yLinesize*n.height*1.25,n.yLinesize*n.height*1.5);o=[new Uint8Array(a),new Uint8Array(s),new Uint8Array(u)]}this.yuvCanvas.render(o,n.yLinesize,n.height)}for(var c=0;c<t.length;c++)Number.parseInt(t[c])<r&&delete this._decodedFrames[t[c]]}}this._lastRenderTime=Date.now()}}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1)}},{key:"destroy",value:function(){this.wasmworker.postMessage({msg:"destroy"}),this.wasmworker=null,this.canvas=null,this.source=null,this._decoderInited=!1}},{key:"buffered",get:function(){for(var e=[],t={start:null,end:null},r=0;r<this.source.buffer.length;r++){var i=this.source.buffer[r],n=i.start,o=i.end;t.start||(t.start=n),t.end||(t.end=o),n-t.end>1e3?(t.start=t.start/1e3,t.end=t.end/1e3,t={start:n,end:o}):t.end=o}return null!==t.start&&null!==t.end&&(t.start=t.start/1e3,t.end=t.end/1e3,e.push(t)),new kr(e)}}]),e}(),Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Dr=function(e){function t(e){me(this,t);var r=ge(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.config=Object.assign({},e);var i=window.AudioContext||window.webkitAudioContext;return r.context=new i,r.gainNode=r.context.createGain(),r.gainNode.connect(r.context.destination),r.meta=void 0,r.samples=[],r.preloadTime=r.config.preloadTime||3,r.duration=0,r._currentBuffer=void 0,r._nextBuffer=void 0,r._lastpts=void 0,r._preDecode=[],r._currentTime=0,r._decoding=!1,r._volume=r.config.volume||.6,r._played=!1,r.playFinish=null,r.waitNextID=null,r}return be(t,e),Sr(t,[{key:"decodeAudio",value:function(e){var t=e.samples,r=e.meta,i=t;e.samples=[],r&&this.setAudioData(i)}},{key:"setAudioData",value:function(e){for(var t=0;t<e.length;t++)e[t].pts=void 0===e[t].pts?e[t].dts:e[t].pts,this._preDecode.push(e[t]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(!this._decoding){this._decoding=!0;for(var e=this._preDecode,r=[],i=this,n=e.shift();n;){var o=t.getAACData(this.meta,n);r.push(o),this._lastpts=n.pts,n=e.shift()}var a=t.combileData(r);try{this.context.decodeAudioData(a.buffer,function(e){var t=i.context.createBufferSource();t.buffer=e,i.samples.push({time:i.duration,duration:e.duration,data:t}),i.duration+=e.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime)),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC(),i.playFinish&&i.playFinish()},function(e){console.error(e)})}catch(e){console.error(e)}}}},{key:"onSourceEnded",value:function(){var e=this;if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(function(){e.onSourceEnded()},200));var t=this._nextBuffer.data;t.start(),t.connect(this.gainNode);var r=this;setTimeout(function(){r.onSourceEnded.call(e)},1e3*t.buffer.duration-10),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}},{key:"play",value:function(){var e=this;if(!this.playFinish){this._played=!0,"suspended"===this.context.state&&this.context.resume();var t=this,r=function(){var r=e._currentBuffer.data;r.connect(e.gainNode),r.start(),setTimeout(function(){t.onSourceEnded.call(e)},1e3*r.buffer.duration-10)};return this._currentBuffer?(r(),Promise.resolve()):new Promise(function(t){e.playFinish=t}).then(function(){e.playFinish=null,r()})}}},{key:"pause",value:function(){var e=this.context;"running"===e.state&&e.suspend()}},{key:"getTimeBuffer",value:function(e){for(var t=void 0,r=0;r<this.samples.length;r++){var i=this.samples[r];if(i.time<=e&&i.time+i.duration>e){t=i;break}}return t}},{key:"setAudioMetaData",value:function(e){this.meta=e}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this.context.close()}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(e){this.gainNode.gain.value=e?0:this._volume}},{key:"volume",get:function(){return this._volume},set:function(e){return e<0?(this._volume=0,void(this.gainNode.gain.value=0)):e>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=e,void(this.gainNode.gain.value=e))}}],[{key:"getAACData",value:function(e,r){var i=new Uint8Array(r.data.byteLength+7),n=t.getAdts(e,r.data);return i.set(n),i.set(r.data,7),i}},{key:"combileData",value:function(e){for(var t=0,r=0,i=e.length;r<i;r++)t+=e[r].byteLength;for(var n=new Uint8Array(t),o=0,a=0,s=e.length;a<s;a++)n.set(e[a],o),o+=e[a].byteLength;return n}},{key:"getAdts",value:function(e,t){var r=new Uint8Array(7);r[0]=255,r[1]=240,r[1]=1|r[1],r[2]=192&e.objectType-1<<6,r[2]=r[2]|60&e.sampleRateIndex<<2,r[2]=r[2]|1&e.channelCount>>2,r[3]=192&e.channelCount<<6;var i=t.byteLength+7;return r[3]=r[3]|3&i>>11,r[4]=255&i>>3,r[5]=224&i<<5,r[5]=31|r[5],r[6]=252,r}}]),t}(i),Pr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Lr=function(){function e(t){_e(this,e),this.aCtx=t.aCtx,this.vCtx=t.vCtx,this.video=t.video,this.timeoutId=null,this.start=null}return Pr(e,[{key:"doReconcile",value:function(){var e=this,t=(this.vCtx.currentTime||0)-1e3*(this.aCtx.currentTime||0);this.timeoutId||(t>200?(this.video.start+=t,this.vCtx.pause(),this.timeoutId=setTimeout(function(){e.vCtx.play(),e.timeoutId=null},t)):t<-120&&(this.video.start+=t))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null}}]),e}(),Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nr=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Ur=function(e){function t(){Ee(this,t);var e=we(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._canvas=document.createElement("canvas"),e.handleAudioSourceEnd=e.handleAudioSourceEnd.bind(e),e.played=!1,e.pendingPlayTask=null,e._paused=!0,e.videoMetaInited=!1,e.audioMetaInited=!1,e.init(),e}return Te(t,e),Nr(t,null,[{key:"resolveVideoGOP",value:function(e){var t=e.samples;if(t.length){var r=null,i=null;e.tempSamples&&e.tempSamples.length&&t.unshift.apply(t,e.tempSamples);for(var n=0,o=t.length;n<o;n++)if(t[n].isKeyframe){r=n;break}for(var a=t.length-1;a>0;a++)if(t[a].isKeyframe){i=a;break}0!==r&&t.splice(0,r-1),e.samples=t.slice(0,i);var s=t.slice(i);e.tempSamples?e.tempSamples.push.apply(e.tempSamples,s):e.tempSamples=s}}}]),Nr(t,[{key:"init",value:function(){var e=this;this.vCtx=new Cr(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}})),this.aCtx=new Dr({}),this.ticker=new(Wt()),this.reconciler=new Lr({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.dispatchEvent(new Event("waiting")),this.vCtx.oncanplay=function(){e.played||e.appendChild(e._canvas),e.dispatchEvent(new Event("canplay"))},this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"destroy",value:function(){this.videoMetaInited=!1,this.audioMetaInited=!1,this.aCtx.destroy(),this.vCtx.destroy(),this.ticker.stop(),this.start=null,this.reconciler.destroy(),this.aCtx=null,this.vCtx=null,this.ticker=null}},{key:"onDemuxComplete",value:function(e,t){this.aCtx.decodeAudio(t),this.vCtx.decodeVideo(e)}},{key:"setAudioMeta",value:function(e){this.audioMetaInited&&(this.aCtx.destroy(),this.aCtx=new Dr({})),this.aCtx.setAudioMetaData(e),this.audioMetaInited=!0}},{key:"setVideoMeta",value:function(e){this.videoMetaInited&&(this.vCtx.destroy(),this.vCtx=new Cr(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}}))),this.vCtx.setVideoMetaData(e),this.videoMetaInited=!0}},{key:"play",value:function(){var e=this;this.pendingPlayTask||(this.played&&(this.destroy(),this.init()),this.pendingPlayTask=Promise.all([this.vCtx.play(),this.aCtx.play().then(function(){e.aCtx.muted=!0})]).then(function(){e.aCtx.muted=!1,e.ticker.start(function(){e.start||(e.start=Date.now()),e._currentTime=Date.now()-e.start,e.vCtx._onTimer(e._currentTime)}),e.pendingPlayTask=null,e.played=!0,e.dispatchEvent(new Event("playing")),e.dispatchEvent(new Event("play")),e._paused=!1}))}},{key:"pause",value:function(){this._paused=!0,this.aCtx.pause(),this.vCtx.pause(),this.dispatchEvent(new Event("pause"))}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){this.style.display="inline-block";var t="number"==typeof e?e+"px":e;this.setAttribute("width",t),this.style.width=t,this._canvas.width=e}},{key:"height",get:function(){return this.getAttribute("height")},set:function(e){this.style.display="inline-block";var t="number"==typeof e?e+"px":e;this.setAttribute("height",t),this.style.height=t,this._canvas.height=e}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(e){this.setAttribute("src",e)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(e){this.setAttribute("playbackrate",e),this.aCtx.playbackRate=e,this.vCtx.playbackRate=e,this.dispatchEvent(new Event("ratechange"))}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"volume",get:function(){return this.aCtx.volume},set:function(e){this.setAttribute("volume",e),this.aCtx.volume=e}},{key:"muted",get:function(){var e="true"===this.getAttribute("muted");return void 0!==e?e:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(e){this.setAttribute("muted",e),this.aCtx.muted=!!e}},{key:"error",get:function(){return this.vCtx.error||this.aCtx.error}},{key:"buffered",get:function(){return this.vCtx.buffered}}]),t}(HTMLElement);customElements.define("mobile-video",Ur);var Br=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Mr=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,i)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(i)},Fr=Fe.FlvAllowedEvents;return function(t){function r(e){xe(this,r),e.mediaType||(e.mediaType="mobile-video");var t=Ae(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.video.width=Number.parseInt(e.width||600),t.video.height=Number.parseInt(e.height||337.5),t.video.style.outline="none",t.context=new We(Fr),t.initEvents(),t}return ke(r,t),Br(r,[{key:"start",value:function(){this.initFlv(),this.context.init(),this.flv.seek(0),Mr(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"start",this).call(this,this.config.url),this.play()}},{key:"initFlvEvents",value:function(e){var t=this;e.once(Fe.LOADER_EVENTS.LOADER_COMPLETE,function(){if(!t.paused)var e=setInterval(function(){var r=t.getBufferedRange()[1];Math.abs(t.currentTime-r)<.5&&(t.emit("ended"),window.clearInterval(e))},200)})}},{key:"initEvents",value:function(){var e=this;this.on("timeupdate",function(){e.loadData()}),this.on("seeking",function(){var t=e.currentTime,r=e.getBufferedRange();(t>r[1]||t<r[0])&&e.flv.seek(e.currentTime)})}},{key:"initFlv",value:function(){var e=this.context.registry("FLV_CONTROLLER",Ft)(this);this.initFlvEvents(e),this.flv=e}},{key:"play",value:function(){if(this._hasStart&&this.paused){this._destroy(),this.context=new We(Fr);var e=this.context.registry("FLV_CONTROLLER",Ft)(this);this.initFlvEvents(e),this.flv=e,this.context.init(),this.loadData(),Mr(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"start",this).call(this),Mr(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"play",this).call(this)}else Mr(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"play",this).call(this),this.addLiveFlag()}},{key:"pause",value:function(){Mr(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"pause",this).call(this),this.flv&&this.flv.pause()}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTime;this.flv&&this.flv.seek(e)}},{key:"destroy",value:function(){this._destroy(),Mr(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"addLiveFlag",value:function(){var t=this;if(e.util.addClass(t.root,"xgplayer-is-live"),!e.util.findDom(this.root,"xg-live")){var r=e.util.createDom("xg-live","正在直播",{},"xgplayer-live");t.controls.appendChild(r)}}},{key:"_destroy",value:function(){this.context.destroy(),this.flv=null,this.context=null}},{key:"src",get:function(){return this.currentSrc},set:function(e){var t=this;this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",function(){t.start(e)}),this.once("canplay",function(){t.play()})),this.once("canplay",function(){t.currentTime=0})}}]),r}(e)});
//# sourceMappingURL=index.min.js.map
