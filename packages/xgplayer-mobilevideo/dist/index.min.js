!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){return function(r){var n=this;if(!e)return new bt(t);if(bt&&!r){var o=i(`${e}`.replace(/^function.+?{/,"").slice(0,-1));return this[vt]=new bt(o),gt.revokeObjectURL(o),this[vt]}var a={postMessage:t=>{n.onmessage&&setTimeout(()=>n.onmessage({data:t,target:a}))}};e.call(a),this.postMessage=(t=>{setTimeout(()=>a.onmessage({data:t,target:n}))}),this.isThisThread=!0}}function i(t){try{return gt.createObjectURL(new Blob([t],{type:yt}))}catch(r){var e=new mt;return e.append(t),gt.createObjectURL(e.getBlob(type))}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function A(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function S(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function U(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function O(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(){}function H(){H.init.call(this)}function X(t){return void 0===t._maxListeners?H.defaultMaxListeners:t._maxListeners}function W(t,e,r){if(e)t.call(r);else for(var n=t.length,i=tt(t,n),o=0;o<n;++o)i[o].call(r)}function z(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,o=tt(t,i),a=0;a<i;++a)o[a].call(r,n)}function Y(t,e,r,n,i){if(e)t.call(r,n,i);else for(var o=t.length,a=tt(t,o),s=0;s<o;++s)a[s].call(r,n,i)}function V(t,e,r,n,i,o){if(e)t.call(r,n,i,o);else for(var a=t.length,s=tt(t,a),u=0;u<a;++u)s[u].call(r,n,i,o)}function K(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,o=tt(t,i),a=0;a<i;++a)o[a].apply(r,n)}function q(t,e,r,n){var i,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if(o=t._events,o?(o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),a=o[e]):(o=t._events=new G,t._eventsCount=0),a){if("function"==typeof a?a=o[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(i=X(t))&&i>0&&a.length>i){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,Z(s)}}else a=o[e]=r,++t._eventsCount;return t}function Z(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function $(t,e,r){function n(){t.removeListener(e,n),i||(i=!0,r.apply(t,arguments))}var i=!1;return n.listener=r,n}function J(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function Q(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}function tt(t,e){for(var r=new Array(e);e--;)r[e]=t[e];return r}function et(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function it(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ut(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(function(){function t(t){var e=dt.has(t);return t=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t),!e&&t}function e(t){var e=t.isConnected;if(void 0!==e)return e;if(pt(t))return!0;for(;t&&!(t.__CE_isImportDocument||t instanceof Document);)t=t.parentNode||(window.ShadowRoot&&t instanceof ShadowRoot?t.host:void 0);return!(!t||!(t.__CE_isImportDocument||t instanceof Document))}function r(t){var e=t.children;if(e)return Array.prototype.slice.call(e);for(e=[],t=t.firstChild;t;t=t.nextSibling)t.nodeType===Node.ELEMENT_NODE&&e.push(t);return e}function n(t,e){for(;e&&e!==t&&!e.nextSibling;)e=e.parentNode;return e&&e!==t?e.nextSibling:null}function i(t,e,r){for(var o=t;o;){if(o.nodeType===Node.ELEMENT_NODE){var a=o;e(a);var s=a.localName;if("link"===s&&"import"===a.getAttribute("rel")){if(o=a.import,void 0===r&&(r=new Set),o instanceof Node&&!r.has(o))for(r.add(o),o=o.firstChild;o;o=o.nextSibling)i(o,e,r);o=n(t,a);continue}if("template"===s){o=n(t,a);continue}if(a=a.__CE_shadowRoot)for(a=a.firstChild;a;a=a.nextSibling)i(a,e,r)}o=o.firstChild?o.firstChild:n(t,o)}}function o(t,e,r){t[e]=r}function a(t){var e=document;this.c=t,this.a=e,this.b=void 0,x(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function s(t){t.b&&t.b.disconnect()}function u(){var t=this;this.b=this.a=void 0,this.c=new Promise(function(e){t.b=e,t.a&&e(t.a)})}function c(t){if(t.a)throw Error("Already resolved.");t.a=void 0,t.b&&t.b(void 0)}function l(t){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=t,this.j=new Map,this.c=function(t){return t()},this.a=!1,this.h=[],this.m=t.f?new a(t):void 0}function h(e,r){if(!t(r))throw new SyntaxError("The element name '"+r+"' is not valid.");if(p(e,r))throw Error("A custom element with name '"+r+"' has already been defined.");if(e.i)throw Error("A custom element is already being defined.")}function f(t,e,r){t.i=!0;var n;try{var i=function(t){var e=o[t];if(void 0!==e&&!(e instanceof Function))throw Error("The '"+t+"' callback must be a function.");return e},o=r.prototype;if(!(o instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var a=i("connectedCallback"),s=i("disconnectedCallback"),u=i("adoptedCallback"),c=(n=i("attributeChangedCallback"))&&r.observedAttributes||[]}catch(t){throw t}finally{t.i=!1}return r={localName:e,constructorFunction:r,connectedCallback:a,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:n,observedAttributes:c,constructionStack:[]},t.g.set(e,r),t.l.set(r.constructorFunction,r),r}function d(t){if(!1!==t.a){t.a=!1;for(var e=[],r=t.h,n=new Map,i=0;i<r.length;i++)n.set(r[i],[]);for(x(t.b,document,{upgrade:function(r){if(void 0===r.__CE_state){var i=r.localName,o=n.get(i);o?o.push(r):t.g.has(i)&&e.push(r)}}}),i=0;i<e.length;i++)T(t.b,e[i]);for(i=0;i<r.length;i++){for(var o=r[i],a=n.get(o),s=0;s<a.length;s++)T(t.b,a[s]);(o=t.j.get(o))&&c(o)}r.length=0}}function p(t,e){var r=t.g.get(e);if(r)return r;if(r=t.f.get(e)){t.f.delete(e);try{return f(t,e,r())}catch(t){k(t)}}}function v(){var t=yt&&yt.noDocumentConstructionObserver,e=yt&&yt.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=e,this.f=!t}function y(t,e,r,n){var o=window.ShadyDOM;if(t.shadyDomFastWalk&&o&&o.inUse){if(e.nodeType===Node.ELEMENT_NODE&&r(e),e.querySelectorAll)for(t=o.nativeMethods.querySelectorAll.call(e,"*"),e=0;e<t.length;e++)r(t[e])}else i(e,r,n)}function m(t,e){t.a=!0,t.b.push(e)}function g(t,e){t.a=!0,t.c.push(e)}function b(t,e){t.a&&y(t,e,function(e){return w(t,e)})}function w(t,e){if(t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var r=0;r<t.b.length;r++)t.b[r](e);for(r=0;r<t.c.length;r++)t.c[r](e)}}function _(t,e){var r=[];for(y(t,e,function(t){return r.push(t)}),e=0;e<r.length;e++){var n=r[e];1===n.__CE_state?t.connectedCallback(n):T(t,n)}}function E(t,e){var r=[];for(y(t,e,function(t){return r.push(t)}),e=0;e<r.length;e++){var n=r[e];1===n.__CE_state&&t.disconnectedCallback(n)}}function x(t,e,r){var n=(r=void 0===r?{}:r).s,i=r.upgrade||function(e){return T(t,e)},o=[];for(y(t,e,function(e){if(t.a&&w(t,e),"link"===e.localName&&"import"===e.getAttribute("rel")){var r=e.import;r instanceof Node&&(r.__CE_isImportDocument=!0,r.__CE_registry=document.__CE_registry),r&&"complete"===r.readyState?r.__CE_documentLoadHandled=!0:e.addEventListener("load",function(){var r=e.import;if(!r.__CE_documentLoadHandled){r.__CE_documentLoadHandled=!0;var o=new Set;n&&(n.forEach(function(t){return o.add(t)}),o.delete(r)),x(t,r,{s:o,upgrade:i})}})}else o.push(e)},n),e=0;e<o.length;e++)i(o[e])}function T(t,r){try{var n=r.ownerDocument,i=n.__CE_registry,o=i&&(n.defaultView||n.__CE_isImportDocument)?p(i,r.localName):void 0;if(o&&void 0===r.__CE_state){o.constructionStack.push(r);try{try{if(new o.constructorFunction!==r)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{o.constructionStack.pop()}}catch(t){throw r.__CE_state=2,t}if(r.__CE_state=1,r.__CE_definition=o,o.attributeChangedCallback&&r.hasAttributes()){var a=o.observedAttributes;for(o=0;o<a.length;o++){var s=a[o],u=r.getAttribute(s);null!==u&&t.attributeChangedCallback(r,s,null,u,null)}}e(r)&&t.connectedCallback(r)}}catch(t){k(t)}}function C(t,e,r,n){var i=e.__CE_registry;if(i&&(null===n||"http://www.w3.org/1999/xhtml"===n)&&(i=p(i,r)))try{var o=new i.constructorFunction;if(void 0===o.__CE_state||void 0===o.__CE_definition)throw Error("Failed to construct '"+r+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==o.namespaceURI)throw Error("Failed to construct '"+r+"': The constructed element's namespace must be the HTML namespace.");if(o.hasAttributes())throw Error("Failed to construct '"+r+"': The constructed element must not have any attributes.");if(null!==o.firstChild)throw Error("Failed to construct '"+r+"': The constructed element must not have any children.");if(null!==o.parentNode)throw Error("Failed to construct '"+r+"': The constructed element must not have a parent node.");if(o.ownerDocument!==e)throw Error("Failed to construct '"+r+"': The constructed element's owner document is incorrect.");if(o.localName!==r)throw Error("Failed to construct '"+r+"': The constructed element's local name is incorrect.");return o}catch(i){return k(i),e=null===n?L.call(e,r):N.call(e,n,r),Object.setPrototypeOf(e,HTMLUnknownElement.prototype),e.__CE_state=2,e.__CE_definition=void 0,w(t,e),e}return e=null===n?L.call(e,r):N.call(e,n,r),w(t,e),e}function k(t){var e=t.message,r=t.sourceURL||t.fileName||"",n=t.line||t.lineNumber||0,i=t.column||t.columnNumber||0,o=void 0;void 0===ErrorEvent.prototype.initErrorEvent?o=new ErrorEvent("error",{cancelable:!0,message:e,filename:r,lineno:n,colno:i,error:t}):((o=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,e,r,n),o.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===o.error&&Object.defineProperty(o,"error",{configurable:!0,enumerable:!0,get:function(){return t}}),window.dispatchEvent(o),o.defaultPrevented||console.error(t)}function A(t){window.HTMLElement=function(){function e(){var e=this.constructor,r=document.__CE_registry.l.get(e);if(!r)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var n=r.constructionStack;if(0===n.length)return n=L.call(document,r.localName),Object.setPrototypeOf(n,e.prototype),n.__CE_state=1,n.__CE_definition=r,w(t,n),n;var i=n.length-1,o=n[i];if(o===vt)throw Error("Failed to construct '"+r.localName+"': This element was already constructed.");return n[i]=vt,Object.setPrototypeOf(o,e.prototype),w(t,o),o}return e.prototype=ct.prototype,Object.defineProperty(e.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:e}),e}()}function P(t,r,n){function i(r){return function(n){for(var i=[],o=0;o<arguments.length;++o)i[o]=arguments[o];o=[];for(var a=[],s=0;s<i.length;s++){var u=i[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(r.apply(this,i),i=0;i<a.length;i++)E(t,a[i]);if(e(this))for(i=0;i<o.length;i++)(a=o[i])instanceof Element&&_(t,a)}}void 0!==n.prepend&&o(r,"prepend",i(n.prepend)),void 0!==n.append&&o(r,"append",i(n.append))}function R(t){o(Document.prototype,"createElement",function(e){return C(t,this,e,null)}),o(Document.prototype,"importNode",function(e,r){return e=O.call(this,e,!!r),this.__CE_registry?x(t,e):b(t,e),e}),o(Document.prototype,"createElementNS",function(e,r){return C(t,this,r,e)}),P(t,Document.prototype,{prepend:I,append:F})}function S(t){function n(r,n){Object.defineProperty(r,"textContent",{enumerable:n.enumerable,configurable:!0,get:n.get,set:function(r){if(this.nodeType===Node.TEXT_NODE)n.set.call(this,r);else{var i=void 0;if(this.firstChild){var o=this.childNodes,a=o.length;if(0<a&&e(this)){i=Array(a);for(var s=0;s<a;s++)i[s]=o[s]}}if(n.set.call(this,r),i)for(r=0;r<i.length;r++)E(t,i[r])}}})}o(Node.prototype,"insertBefore",function(n,i){if(n instanceof DocumentFragment){var o=r(n);if(n=X.call(this,n,i),e(this))for(i=0;i<o.length;i++)_(t,o[i]);return n}return o=n instanceof Element&&e(n),i=X.call(this,n,i),o&&E(t,n),e(this)&&_(t,n),i}),o(Node.prototype,"appendChild",function(n){if(n instanceof DocumentFragment){var i=r(n);if(n=H.call(this,n),e(this))for(var o=0;o<i.length;o++)_(t,i[o]);return n}return i=n instanceof Element&&e(n),o=H.call(this,n),i&&E(t,n),e(this)&&_(t,n),o}),o(Node.prototype,"cloneNode",function(e){return e=G.call(this,!!e),this.ownerDocument.__CE_registry?x(t,e):b(t,e),e}),o(Node.prototype,"removeChild",function(r){var n=r instanceof Element&&e(r),i=W.call(this,r);return n&&E(t,r),i}),o(Node.prototype,"replaceChild",function(n,i){if(n instanceof DocumentFragment){var o=r(n);if(n=z.call(this,n,i),e(this))for(E(t,i),i=0;i<o.length;i++)_(t,o[i]);return n}o=n instanceof Element&&e(n);var a=z.call(this,n,i),s=e(this);return s&&E(t,i),o&&E(t,n),s&&_(t,n),a}),Y&&Y.get?n(Node.prototype,Y):m(t,function(t){n(t,{enumerable:!0,configurable:!0,get:function(){for(var t=[],e=this.firstChild;e;e=e.nextSibling)e.nodeType!==Node.COMMENT_NODE&&t.push(e.textContent);return t.join("")},set:function(t){for(;this.firstChild;)W.call(this,this.firstChild);null!=t&&""!==t&&H.call(this,document.createTextNode(t))}})})}function D(t){function r(r){return function(n){for(var i=[],o=0;o<arguments.length;++o)i[o]=arguments[o];o=[];for(var a=[],s=0;s<i.length;s++){var u=i[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(r.apply(this,i),i=0;i<a.length;i++)E(t,a[i]);if(e(this))for(i=0;i<o.length;i++)(a=o[i])instanceof Element&&_(t,a)}}var n=Element.prototype;void 0!==ot&&o(n,"before",r(ot)),void 0!==at&&o(n,"after",r(at)),void 0!==st&&o(n,"replaceWith",function(r){for(var n=[],i=0;i<arguments.length;++i)n[i]=arguments[i];i=[];for(var o=[],a=0;a<n.length;a++){var s=n[a];if(s instanceof Element&&e(s)&&o.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)i.push(s);else i.push(s)}for(a=e(this),st.apply(this,n),n=0;n<o.length;n++)E(t,o[n]);if(a)for(E(t,this),n=0;n<i.length;n++)(o=i[n])instanceof Element&&_(t,o)}),void 0!==ut&&o(n,"remove",function(){var r=e(this);ut.call(this),r&&E(t,this)})}function B(t){function r(r,n){Object.defineProperty(r,"innerHTML",{enumerable:n.enumerable,configurable:!0,get:n.get,set:function(r){var i=this,o=void 0;if(e(this)&&(o=[],y(t,this,function(t){t!==i&&o.push(t)})),n.set.call(this,r),o)for(var a=0;a<o.length;a++){var s=o[a];1===s.__CE_state&&t.disconnectedCallback(s)}return this.ownerDocument.__CE_registry?x(t,this):b(t,this),r}})}function n(r,n){o(r,"insertAdjacentElement",function(r,i){var o=e(i);return r=n.call(this,r,i),o&&E(t,i),e(r)&&_(t,i),r})}function i(e,r){function n(e,r){for(var n=[];e!==r;e=e.nextSibling)n.push(e);for(r=0;r<n.length;r++)x(t,n[r])}o(e,"insertAdjacentHTML",function(t,e){if("beforebegin"===(t=t.toLowerCase())){var i=this.previousSibling;r.call(this,t,e),n(i||this.parentNode.firstChild,this)}else if("afterbegin"===t)i=this.firstChild,r.call(this,t,e),n(this.firstChild,i);else if("beforeend"===t)i=this.lastChild,r.call(this,t,e),n(i||this.firstChild,null);else{if("afterend"!==t)throw new SyntaxError("The value provided ("+String(t)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");i=this.nextSibling,r.call(this,t,e),n(this.nextSibling,i)}})}V&&o(Element.prototype,"attachShadow",function(e){if(e=V.call(this,e),t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var r=0;r<t.b.length;r++)t.b[r](e)}return this.__CE_shadowRoot=e}),K&&K.get?r(Element.prototype,K):lt&&lt.get?r(HTMLElement.prototype,lt):g(t,function(t){r(t,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(t){var e="template"===this.localName,r=e?this.content:this,n=N.call(document,this.namespaceURI,this.localName);for(n.innerHTML=t;0<r.childNodes.length;)W.call(r,r.childNodes[0]);for(t=e?n.content:n;0<t.childNodes.length;)H.call(r,t.childNodes[0])}})}),o(Element.prototype,"setAttribute",function(e,r){if(1!==this.__CE_state)return Z.call(this,e,r);var n=q.call(this,e);Z.call(this,e,r),r=q.call(this,e),t.attributeChangedCallback(this,e,n,r,null)}),o(Element.prototype,"setAttributeNS",function(e,r,n){if(1!==this.__CE_state)return Q.call(this,e,r,n);var i=J.call(this,e,r);Q.call(this,e,r,n),n=J.call(this,e,r),t.attributeChangedCallback(this,r,i,n,e)}),o(Element.prototype,"removeAttribute",function(e){if(1!==this.__CE_state)return $.call(this,e);var r=q.call(this,e);$.call(this,e),null!==r&&t.attributeChangedCallback(this,e,r,null,null)}),o(Element.prototype,"removeAttributeNS",function(e,r){if(1!==this.__CE_state)return tt.call(this,e,r);var n=J.call(this,e,r);tt.call(this,e,r);var i=J.call(this,e,r);n!==i&&t.attributeChangedCallback(this,r,n,i,e)}),ht?n(HTMLElement.prototype,ht):et&&n(Element.prototype,et),ft?i(HTMLElement.prototype,ft):rt&&i(Element.prototype,rt),P(t,Element.prototype,{prepend:nt,append:it}),D(t)}function U(){var t=new v;A(t),R(t),P(t,DocumentFragment.prototype,{prepend:j,append:M}),S(t),B(t),t=new l(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}var L=window.Document.prototype.createElement,N=window.Document.prototype.createElementNS,O=window.Document.prototype.importNode,I=window.Document.prototype.prepend,F=window.Document.prototype.append,j=window.DocumentFragment.prototype.prepend,M=window.DocumentFragment.prototype.append,G=window.Node.prototype.cloneNode,H=window.Node.prototype.appendChild,X=window.Node.prototype.insertBefore,W=window.Node.prototype.removeChild,z=window.Node.prototype.replaceChild,Y=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),V=window.Element.prototype.attachShadow,K=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),q=window.Element.prototype.getAttribute,Z=window.Element.prototype.setAttribute,$=window.Element.prototype.removeAttribute,J=window.Element.prototype.getAttributeNS,Q=window.Element.prototype.setAttributeNS,tt=window.Element.prototype.removeAttributeNS,et=window.Element.prototype.insertAdjacentElement,rt=window.Element.prototype.insertAdjacentHTML,nt=window.Element.prototype.prepend,it=window.Element.prototype.append,ot=window.Element.prototype.before,at=window.Element.prototype.after,st=window.Element.prototype.replaceWith,ut=window.Element.prototype.remove,ct=window.HTMLElement,lt=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),ht=window.HTMLElement.prototype.insertAdjacentElement,ft=window.HTMLElement.prototype.insertAdjacentHTML,dt=new Set;"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach(function(t){return dt.add(t)});var pt=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);a.prototype.f=function(t){var e=this.a.readyState;for("interactive"!==e&&"complete"!==e||s(this),e=0;e<t.length;e++)for(var r=t[e].addedNodes,n=0;n<r.length;n++)x(this.c,r[n])},l.prototype.o=function(t,e){var r=this;if(!(e instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");h(this,t),this.f.set(t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return d(r)}))},l.prototype.define=function(t,e){var r=this;if(!(e instanceof Function))throw new TypeError("Custom element constructors must be functions.");h(this,t),f(this,t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return d(r)}))},l.prototype.upgrade=function(t){x(this.b,t)},l.prototype.get=function(t){if(t=p(this,t))return t.constructorFunction},l.prototype.whenDefined=function(e){if(!t(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var r=this.j.get(e);if(r)return r.c;r=new u,this.j.set(e,r);var n=this.g.has(e)||this.f.has(e);return e=-1===this.h.indexOf(e),n&&e&&c(r),r.c},l.prototype.polyfillWrapFlushCallback=function(t){this.m&&s(this.m);var e=this.c;this.c=function(r){return t(function(){return e(r)})}},window.CustomElementRegistry=l,l.prototype.define=l.prototype.define,l.prototype.upgrade=l.prototype.upgrade,l.prototype.get=l.prototype.get,l.prototype.whenDefined=l.prototype.whenDefined,l.prototype.polyfillDefineLazy=l.prototype.o,l.prototype.polyfillWrapFlushCallback=l.prototype.polyfillWrapFlushCallback,v.prototype.connectedCallback=function(t){var e=t.__CE_definition;if(e.connectedCallback)try{e.connectedCallback.call(t)}catch(t){k(t)}},v.prototype.disconnectedCallback=function(t){var e=t.__CE_definition;if(e.disconnectedCallback)try{e.disconnectedCallback.call(t)}catch(t){k(t)}},v.prototype.attributeChangedCallback=function(t,e,r,n,i){var o=t.__CE_definition;if(o.attributeChangedCallback&&-1<o.observedAttributes.indexOf(e))try{o.attributeChangedCallback.call(t,e,r,n,i)}catch(t){k(t)}};var vt=new function(){},yt=window.customElements;yt&&!yt.forcePolyfill&&"function"==typeof yt.define&&"function"==typeof yt.get||U(),window.__CE_installPolyfill=U}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var t=HTMLElement,e={HTMLElement:function(){return Reflect.construct(t,[],this.constructor)}};window.HTMLElement=e.HTMLElement,HTMLElement.prototype=t.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,t)}}();var ct=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},lt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),ht=function(){function t(e){r(this,t),this.options=Object.assign({},e||{},{interval:16}),this.callbacks=[]}return lt(t,[{key:"start",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];this.callbacks=e}},{key:"onTick",value:function(){for(var t=0,e=this.callbacks.length;t<e;t++)(0,this.callbacks[t])()}},{key:"setInterval",value:function(t){return this.options.interval=t,this}}]),t}(),ft=function(n){function i(e){r(this,i);var n=t(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return n.prev=null,n.timerId=null,n._subTimerId=null,n._tickFunc=i.getTickFunc(),n.tick=n.tick.bind(n),n}return e(i,n),lt(i,[{key:"start",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];(t=ct(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"start",this)).call.apply(t,[this].concat(r)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var t=this._tickFunc;this.timerId=t(this.tick)}},{key:"stop",value:function(){this.timerId&&i.getCancelFunc()(this.timerId)}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==i.getTickFunc()}}]),i}(ht),dt=function(n){function i(e){r(this,i);var n=t(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return n.timeoutId=null,n}return e(i,n),lt(i,[{key:"start",value:function(){for(var t,e=this,r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];(t=ct(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"nextTick",this)).call.apply(t,[this].concat(n)),this.timeoutId=window.setInterval(function(){e.onTick()},this.options.interval||16)}},{key:"stop",value:function(){this.timeoutId&&window.clearInterval(this.timeoutId)}}]),i}(ht),pt=function(){return ft.isSupported()?ft:dt},vt="undefined"==typeof Symbol?"__target":Symbol(),yt="application/javascript",mt=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,gt=window.URL||window.webkitURL,bt=window.Worker;if(bt){var wt,_t=i("self.onmessage = function () {}"),Et=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");(wt=new bt(_t)).postMessage(Et,[Et.buffer])}catch(t){bt=null}finally{gt.revokeObjectURL(_t),wt&&wt.terminate()}}var xt=new n("./worker.js",function(t,e){function r(){(a=new o(this)).init()}function n(t){i.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder.js"),addOnPostRun(r.bind(i))}var i=this,o=function(t){this.inited=!1,this.self=t,this.meta=this.self.meta,this.infolist={},t.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),t.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};o.prototype.toU8Array=function(t,e){return this.self.HEAPU8.subarray(t,t+e)},o.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},o.prototype.broadwayOnPictureDecoded=function(t,e,r,n,i,o){var a=Object.assign({},this.infolist[o]),s=r,u=r/2;444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=r);var c=this.toU8Array(t,n*s+i*u*2);this.infolist[o]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;this.self.postMessage({msg:"DECODED",width:e,height:r,yLinesize:n,uvLinesize:i,info:a,buffer:h},[h])},o.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},o.prototype.decode=function(t,e){var r=parseInt((new Date).getTime()),n=r-1e9*Math.floor(r/1e9);this.infolist[n]=e,this.streamBuffer.set(t),Module._broadwayPlayStream(t.length,n)},o.prototype.destroy=function(){Module._broadwayExit()};var a;i.addEventListener("message",function(t){var e=t.data;if(e.msg)switch(e.msg){case"init":console.log(e),i.meta=e.meta,n();break;case"decode":a.decode(e.data,e.info);break;case"destory":a.destroy()}else i.postMessage({msg:"ERROR:invalid message"})},!1)}),Tt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Ct=function(){function t(e){if(o(this,t),!(e instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0}return Tt(t,[{key:"back",value:function(t){this.position-=t}},{key:"skip",value:function(e){for(var r=Math.floor(e/4),n=e%4,i=0;i<r;i++)t.readByte(this.dataview,4);n>0&&t.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return t.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return t.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return t.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return t.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return t.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return t.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return t.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return t.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(t){this.dataview.position=t},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(t,e,r){var n=void 0;switch(e){case 1:n=r?t.getInt8(t.position):t.getUint8(t.position);break;case 2:n=r?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=t.getUint8(t.position)<<16,n|=t.getUint8(t.position+1)<<8,n|=t.getUint8(t.position+2);break;case 4:n=r?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(r)throw new Error("not supported for readBody 8");n=t.getUint32(t.position)<<32,n|=t.getUint32(t.position+4);break;default:n=""}return t.position+=e,n}}]),t}(),kt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),At=function(){function t(e){a(this,t),this.TAG="Golomb",this._buffer=e,this._bufferIndex=0,this._totalBytes=e.byteLength,this._totalBits=8*e.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return kt(t,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),r=new Uint8Array(4);r.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(r.buffer).getUint32(0),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}},{key:"readBits",value:function(t){var e=Math.min(this._currentWordBitsLeft,t),r=this._currentWord>>>32-e;if(t>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=e,this._currentWordBitsLeft>0?this._currentWord<<=e:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),e=t-e,e>0&&this._currentWordBitsLeft?r<<e|this.readBits(e):r}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var t=void 0;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}},{key:"readUEG",value:function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}]),t}(),Pt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Rt=function(){function t(){s(this,t)}return Pt(t,null,[{key:"_ebsp2rbsp",value:function(t){for(var e=t,r=e.byteLength,n=new Uint8Array(r),i=0,o=0;o<r;o++)o>=2&&3===e[o]&&0===e[o-1]&&0===e[o-2]||(n[i]=e[o],i++);return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(e){var r=t._ebsp2rbsp(e),n=new At(r);n.readByte();var i=n.readByte();n.readByte();var o=n.readByte();n.readUEG();var a=t.getProfileString(i),s=t.getLevelString(o),u=1,c=420,l=[0,420,422,444],h=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(3===(u=n.readUEG())&&n.readBits(1),u<=3&&(c=l[u]),h=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)n.readBool()&&(d<6?t._skipScalingList(n,16):t._skipScalingList(n,64));n.readUEG();var p=n.readUEG();if(0===p)n.readUEG();else if(1===p){n.readBits(1),n.readSEG(),n.readSEG();for(var v=n.readUEG(),y=0;y<v;y++)n.readSEG()}n.readUEG(),n.readBits(1);var m=n.readUEG(),g=n.readUEG(),b=n.readBits(1);0===b&&n.readBits(1),n.readBits(1);var w=0,_=0,E=0,x=0;n.readBool()&&(w=n.readUEG(),_=n.readUEG(),E=n.readUEG(),x=n.readUEG());var T=1,C=1,k=0,A=!0,P=0,R=0;if(n.readBool()){if(n.readBool()){var S=n.readByte(),D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],B=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];S>0&&S<16?(T=D[S-1],C=B[S-1]):255===S&&(T=n.readByte()<<8|n.readByte(),C=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var U=n.readBits(32),L=n.readBits(32);A=n.readBool(),k=(P=L)/(R=2*U)}}var N=1;1===T&&1===C||(N=T/C);var O=0,I=0;0===u?(O=1,I=2-b):(O=3===u?1:2,I=(1===u?2:1)*(2-b));var F=16*(m+1),j=16*(g+1)*(2-b);F-=(w+_)*O,j-=(E+x)*I;var M=Math.ceil(F*N);return n.destroy(),n=null,{profile_string:a,level_string:s,bit_depth:h,chroma_format:c,chroma_format_string:t.getChromaFormatString(c),frame_rate:{fixed:A,fps:k,fps_den:R,fps_num:P},par_ratio:{width:T,height:C},codec_size:{width:F,height:j},present_size:{width:M,height:j}}}},{key:"_skipScalingList",value:function(t,e){for(var r=8,n=8,i=0;i<e;i++)0!==n&&(n=(r+t.readSEG()+256)%256),r=0===n?r:n}},{key:"getProfileString",value:function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(t){var e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},e.frameRate=t.frame_rate;var r=e.frameRate.fps_den,n=e.frameRate.fps_num;return e.refSampleDuration=Math.floor(e.timescale*(r/n)),e}}]),t}(),St=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Dt=function(){function t(){u(this,t)}return St(t,null,[{key:"EBSP2RBSP",value:function(t){return t.filter(function(e,r){return r<2||!(0===t[r-2]&&0===t[r-1]&&3===e)})}},{key:"EBSP2SODB",value:function(t){var e=t[t.byteLength-1];return e&&128===e?t.slice(0,t.byteLength-1):t}}]),t}(),Bt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Ut=function(t){for(var e="",r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return e},Lt=function(){function t(){c(this,t)}return Bt(t,null,[{key:"_resolveNalu",value:function(t){return t.length>=1?Dt.EBSP2SODB(Dt.EBSP2RBSP(t.slice(1))):null}},{key:"parse",value:function(e){var r=t._resolveNalu(e),n=t.switchPayloadType(r),i=n.payloadType,o=n.offset,a=r.slice(o);switch(i){case 5:return t.user_data_unregistered(a);default:return{}}}},{key:"switchPayloadType",value:function(t){for(var e=new DataView(t.buffer),r=0,n=0;255===e.getUint8(n);)n++,r+=255;return r+=e.getUint8(n++),{payloadType:r,offset:n}}},{key:"getPayloadLength",value:function(t){for(var e=new DataView(t.buffer),r=0,n=0;255===e.getUint8(n);)n++,r+=255;return r+=e.getUint8(n++),{payloadLength:r,offset:n}}},{key:"user_data_unregistered",value:function(e){var r=t.getPayloadLength(e),n=r.payloadLength,i=r.offset;if(n<16)return{uuid:"",content:null};var o=e.slice(i);return{uuid:Ut(o.slice(0,16)),content:Ut(o.slice(16,n))}}}]),t}(),Nt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Ot=function(){function t(){l(this,t)}return Nt(t,null,[{key:"getNalunits",value:function(e){if(e.length-e.position<4)return[];var r=e.dataview,n=e.position;return 1===r.getInt32(n)||0===r.getInt16(n)&&1===r.getInt8(n+2)?t.getAnnexbNals(e):t.getAvccNals(e)}},{key:"getAnnexbNals",value:function(e){for(var r=[],n=t.getHeaderPositionAnnexB(e),i=n.pos,o=i;i<e.length-4;){var a=e.buffer.slice(i,i+n.headerLength);n.pos===e.position&&e.skip(n.headerLength),o=(n=t.getHeaderPositionAnnexB(e)).pos;var s={header:a,body:new Uint8Array(e.buffer.slice(i+a.byteLength,o))};t.analyseNal(s),s.type<=9&&0!==s.type&&r.push(s),e.skip(o-e.position),i=o}return r}},{key:"getAvccNals",value:function(e){for(var r=[];e.position<e.length-4;){var n=e.dataview.getInt32(e.dataview.position);if(!(e.length-e.position>=n))break;var i=e.buffer.slice(e.position,e.position+4);e.skip(4);var o=new Uint8Array(e.buffer.slice(e.position,e.position+n));e.skip(n);var a={header:i,body:o};t.analyseNal(a),a.type<=9&&0!==a.type&&r.push(a)}return r}},{key:"analyseNal",value:function(t){var e=31&t.body[0];switch(t.type=e,e){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:t.sei=Lt.parse(t.body);break;case 7:t.sps=Rt.parseSPS(t.body);break;case 8:t.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(t){for(var e=t.position,r=0;3!==r&&4!==r&&e<t.length-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?r=4:1===t.dataview.getInt8(e+2)?r=3:e++:e++;return e===t.length-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(r=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?r=3:e=t.length)),{pos:e,headerLength:r}}},{key:"getAvcc",value:function(t,e){var r=new Uint8Array(t.byteLength+e.byteLength+11);r[0]=1,r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=255,r[5]=225;var n=6;return r.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),n),n+=2,r.set(t,n),n+=t.byteLength,r[n]=1,n++,r.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),n),n+=2,r.set(e,n),r}}]),t}(),It=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Ft=function(){function t(){h(this,t)}return It(t,null,[{key:"createTexture",value:function(t,e,r,n,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof Uint8Array?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,r):r instanceof HTMLVideoElement?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r):r instanceof HTMLImageElement?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r):r instanceof ImageData&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.bindTexture(t.TEXTURE_2D,null),o}},{key:"createBuffer",value:function(t,e){var r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),r}},{key:"createShader",value:function(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));return n}},{key:"createProgram",value:function(e,r,n){var i=e.createProgram(),o=t.createShader(e,e.VERTEX_SHADER,r),a=t.createShader(e,e.FRAGMENT_SHADER,n);if(e.attachShader(i,o),e.attachShader(i,a),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(i));for(var s={program:i},u=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES),c=0;c<u;c++){var l=e.getActiveAttrib(i,c);s[l.name]=e.getAttribLocation(i,l.name)}for(var h=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),f=0;f<h;f++){var d=e.getActiveUniform(i,f);s[d.name]=e.getUniformLocation(i,d.name)}return s}},{key:"bindAttribute",value:function(t,e,r,n){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,n,t.FLOAT,!1,0,0)}}]),t}(),jt=function t(){f(this,t),this.inputTextures=[]},Mt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Gt=function(t){function e(t){d(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform highp float opacity;","uniform sampler2D sampler;","uniform highp float flipx;","uniform highp float flipy;","void main(void) {","  float cordx = textureCoord.x;","  if(flipx > 0.5) {","     cordx = 1.0 - textureCoord.x;","  }","  float cordy = 1.0 - textureCoord.y;","  if(flipy > 0.5) {","    cordy = textureCoord.y;","  }","  vec4 color = texture2D(sampler,vec2(cordx, cordy));","  gl_FragColor = vec4(color[0],color[1],color[2],opacity);","}"].join("\n"),r.opacity=void 0===t.opacity?1:t.opacity,r.flip=t.flip,r}return v(e,t),Mt(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2);var n=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1]));Ft.bindAttribute(e,n,this.pw.texturePos,2),Ft.createTexture(e,e.LINEAR),e.uniform1i(this.pw.sampler,0),e.uniform1f(this.pw.opacity,this.opacity);var i=0,o=0;"x"!==this.flip&&"xy"!==this.flip||(i=1),"y"!==this.flip&&"xy"!==this.flip||(o=1),e.uniform1f(this.pw.flipx,i),e.uniform1f(this.pw.flipy,o)}},{key:"setFlip",value:function(t){var e=0,r=0;this.flip=t,"x"!==this.flip&&"xy"!==this.flip||(e=1),"y"!==this.flip&&"xy"!==this.flip||(r=1),this.gl.uniform1f(this.pw.flipx,e),this.gl.uniform1f(this.pw.flipy,r)}},{key:"render",value:function(t,e,r){var n=this.gl,i=this.program;n.useProgram(i),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}]),e}(jt),Ht=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Xt=function(t){function e(t){y(this,e);var r=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 yuv2rgb;","void main(void) {","  float cx = 1.0 / outerSize.x;","  float odd = floor(mod(textureCoord.x * outerSize.x, 2.0));","  float x = textureCoord.x + 0.5 * cx - odd * cx;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  float ydata = odd < 0.5?color[0]:color[2];","  float udata = color[1];","  float vdata = color[3];","  gl_FragColor = vec4(ydata, udata, vdata, 1) * yuv2rgb;","}"].join("\n"),r}return g(e,t),Ht(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2),this.texturePosBuffer=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1])),Ft.bindAttribute(e,this.texturePosBuffer,this.pw.texturePos,2);var n=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.sampler,0),this.inputTextures.push(n);var i=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];e.uniformMatrix4fv(this.pw.yuv2rgb,!1,i)}},{key:"render",value:function(t,e,r){t=t[0];var n=this.gl,i=this.program,o=this.inputTextures[0];return this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),n.bindFramebuffer(n.FRAMEBUFFER,this.rend.fb),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.outputTexuture,0),n.useProgram(i),n.viewport(0,0,this.canvas.width,this.canvas.height),n.uniform2fv(this.pw.outerSize,[e,r]),n.pixelStorei(n.UNPACK_ALIGNMENT,1),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e/2,r,0,n.RGBA,n.UNSIGNED_BYTE,t),n.drawArrays(n.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),Wt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),zt=function(t){function e(t){b(this,e);var r=w(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","void main(void) {","  vec4 color = texture2D(sampler, textureCoord);","  gl_FragColor = vec4(color[2],color[1],color[0],color[3]);","}"].join("\n"),r}return _(e,t),Wt(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2),this.texturePosBuffer=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1])),Ft.bindAttribute(e,this.texturePosBuffer,this.pw.texturePos,2);var n=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.sampler,0),this.inputTextures.push(n)}},{key:"render",value:function(t,e,r){t=t[0];var n=this.gl,i=this.program,o=this.inputTextures[0];return this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),n.bindFramebuffer(n.FRAMEBUFFER,this.rend.fb),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.outputTexuture,0),n.useProgram(i),n.viewport(0,0,this.canvas.width,this.canvas.height),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,r,0,n.RGBA,n.UNSIGNED_BYTE,t),n.drawArrays(n.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),Yt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Vt=function(t){function e(t){E(this,e);var r=x(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 YUV2RGB;","void main(void) {","  float my = floor(mod(textureCoord.y * outerSize.y, 4.0));","  float cy = 1.0 / outerSize.y;","  float mx = floor(mod(outerSize.x, 4.0));","  float cx = 1.0 / outerSize.x;","  float width =  outerSize.x + mx;","  float x = textureCoord.x + (mx * cx * textureCoord.y * outerSize.y);","  x = cx * mod(x * outerSize.x, width);","  float bdata, gdata, rdata;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  rdata = color[0];","  gdata = color[1];","  bdata = color[2];","  gl_FragColor = vec4(bdata, gdata, rdata, 1);","}"].join("\n"),r}return T(e,t),Yt(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2),this.texturePosBuffer=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1])),Ft.bindAttribute(e,this.texturePosBuffer,this.pw.texturePos,2);var n=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.sampler,0),this.inputTextures.push(n)}},{key:"render",value:function(t,e,r){t=t[0];var n=this.gl,i=this.program,o=this.inputTextures[0];this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),n.bindFramebuffer(n.FRAMEBUFFER,this.rend.fb),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.outputTexuture,0),n.useProgram(i),n.viewport(0,0,this.canvas.width,this.canvas.height);var a=n.getUniformLocation(i,"outerSize");n.uniform2fv(a,[e,r]),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o);var s=e-e%4;return n.texImage2D(n.TEXTURE_2D,0,n.RGB,s,r,0,n.RGB,n.UNSIGNED_BYTE,t),n.drawArrays(n.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),Kt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),qt=function(t){function e(t){C(this,e);var r=k(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 yTexturePos;","attribute vec2 uvTexturePos;","varying vec2 yTextureCoord;","varying vec2 uvTextureCoord;","void main()","{","  gl_Position = vertexPos;","  yTextureCoord = yTexturePos;","  uvTextureCoord = uvTexturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 yTextureCoord;","varying highp vec2 uvTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uvSampler;","uniform mat4 yuv2rgb;","void main(void) {","  vec4 colory = texture2D(ySampler, yTextureCoord);","  vec4 coloruv = texture2D(uvSampler, vec2(yTextureCoord.x / 2.0, yTextureCoord.y));","  gl_FragColor = vec4(colory[0], coloruv[0], coloruv[1], 1) * yuv2rgb;","}"].join("\n"),r}return A(e,t),Kt(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2);var n=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1]));Ft.bindAttribute(e,n,this.pw.yTexturePos,2);var i=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1]));Ft.bindAttribute(e,i,this.pw.uvTexturePos,2);var o=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.ySampler,0),this.inputTextures.push(o);var a=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.uvSampler,1),this.inputTextures.push(a);var s=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];e.uniformMatrix4fv(this.pw.yuv2rgb,!1,s)}},{key:"render",value:function(t,e,r){var n=t[0],i=t[1],o=this.gl,a=this.program,s=this.inputTextures[0],u=this.inputTextures[1];return this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(o,o.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(o,o.LINEAR,new Uint8Array(e*r*4),e,r)),o.bindFramebuffer(o.FRAMEBUFFER,this.rend.fb),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.outputTexuture,0),o.useProgram(a),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,s),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,e,r,0,o.LUMINANCE,o.UNSIGNED_BYTE,n),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,u),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e/2,r/4,0,o.RGBA,o.UNSIGNED_BYTE,i),o.drawArrays(o.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),Zt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),$t=function(t){function e(t,r){P(this,e);var n=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.vShader=["attribute vec4 vertexPos;","attribute vec2 yTexturePos;","attribute vec2 uTexturePos;","attribute vec2 vTexturePos;","varying vec2 yTextureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  yTextureCoord = yTexturePos;","  uTextureCoord = uTexturePos;","  vTextureCoord = vTexturePos;","}"].join("\n"),n.fShader=["precision highp float;","varying highp vec2 yTextureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 yuv2rgb;","void main(void) {","  highp float y = texture2D(ySampler,  yTextureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * yuv2rgb;","}"].join("\n"),n}return S(e,t),Zt(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2);var n=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1]));Ft.bindAttribute(e,n,this.pw.yTexturePos,2);var i=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1]));Ft.bindAttribute(e,i,this.pw.uTexturePos,2);var o=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1]));Ft.bindAttribute(e,o,this.pw.vTexturePos,2);var a=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.ySampler,0),this.inputTextures.push(a);var s=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.uSampler,1),this.inputTextures.push(s);var u=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.vSampler,2),this.inputTextures.push(u);var c=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];e.uniformMatrix4fv(this.pw.yuv2rgb,!1,c)}},{key:"render",value:function(t,e,r){var n=t[0],i=t[1],o=t[2],a=this.gl,s=this.program,u=this.inputTextures[0],c=this.inputTextures[1],l=this.inputTextures[2];return this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(a,a.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(a,a.LINEAR,new Uint8Array(e*r*4),e,r)),a.bindFramebuffer(a.FRAMEBUFFER,this.rend.fb),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.outputTexuture,0),a.useProgram(s),a.viewport(0,0,this.canvas.width,this.canvas.height),a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,u),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,e,r,0,a.LUMINANCE,a.UNSIGNED_BYTE,n),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,e/2,r/2,0,a.LUMINANCE,a.UNSIGNED_BYTE,i),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,e/2,r/2,0,a.LUMINANCE,a.UNSIGNED_BYTE,o),a.drawArrays(a.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),Jt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Qt=function(t){function e(t){D(this,e);var r=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","void main(void) {","  vec4 color = texture2D(sampler, textureCoord);","  gl_FragColor = vec4(color[0],color[1],color[2],color[3]);","}"].join("\n"),r}return U(e,t),Jt(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2),this.texturePosBuffer=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1])),Ft.bindAttribute(e,this.texturePosBuffer,this.pw.texturePos,2);var n=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.sampler,0),this.inputTextures.push(n)}},{key:"render",value:function(t,e,r){t=t instanceof ImageData?t.data:t[0];var n=this.gl,i=this.program,o=this.inputTextures[0];return this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),n.bindFramebuffer(n.FRAMEBUFFER,this.rend.fb),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.outputTexuture,0),n.useProgram(i),n.viewport(0,0,this.canvas.width,this.canvas.height),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,r,0,n.RGBA,n.UNSIGNED_BYTE,t),n.drawArrays(n.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),te=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),ee=function(t){function e(t){L(this,e);var r=N(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.vShader=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos;","}"].join("\n"),r.fShader=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform vec2 outerSize;","uniform mat4 YUV2RGB;","void main(void) {","  float my = floor(mod(textureCoord.y * outerSize.y, 4.0));","  float cy = 1.0 / outerSize.y;","  float mx = floor(mod(outerSize.x, 4.0));","  float cx = 1.0 / outerSize.x;","  float width =  outerSize.x + mx;","  float x = textureCoord.x + (mx * cx * textureCoord.y * outerSize.y);","  x = cx * mod(x * outerSize.x, width);","  float bdata, gdata, rdata;","  vec4 color = texture2D(sampler, vec2(x, textureCoord.y));","  rdata = color[0];","  gdata = color[1];","  bdata = color[2];","  gl_FragColor = vec4(rdata, gdata, bdata, 1);","}"].join("\n"),r}return O(e,t),te(e,[{key:"init",value:function(t){this.rend=t,this.canvas=t.canvas;var e=this.gl=t.gl;this.pw=Ft.createProgram(e,this.vShader,this.fShader),this.program=this.pw.program,e.useProgram(this.program);var r=Ft.createBuffer(e,new Float32Array([1,1,-1,1,1,-1,-1,-1]));Ft.bindAttribute(e,r,this.pw.vertexPos,2),this.texturePosBuffer=Ft.createBuffer(e,new Float32Array([1,0,0,0,1,1,0,1])),Ft.bindAttribute(e,this.texturePosBuffer,this.pw.texturePos,2);var n=Ft.createTexture(e,e.LINEAR);e.uniform1i(this.pw.sampler,0),this.inputTextures.push(n)}},{key:"render",value:function(t,e,r){t=t[0];var n=this.gl,i=this.program,o=this.inputTextures[0];this.width===e&&this.height===r||(this.width=e,this.height=r,this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),this.outputTexuture||(this.outputTexuture=Ft.createTexture(n,n.LINEAR,new Uint8Array(e*r*4),e,r)),n.bindFramebuffer(n.FRAMEBUFFER,this.rend.fb),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.outputTexuture,0),n.useProgram(i),n.viewport(0,0,this.canvas.width,this.canvas.height);var a=n.getUniformLocation(i,"outerSize");n.uniform2fv(a,[e,r]),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o);var s=e-e%4;return n.texImage2D(n.TEXTURE_2D,0,n.RGB,s,r,0,n.RGB,n.UNSIGNED_BYTE,t),n.drawArrays(n.TRIANGLE_STRIP,0,4),{texture:this.outputTexuture,width:e,height:r}}}]),e}(jt),re=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),ne=function(){function t(e){if(I(this,t),this.canvas=e.canvas,e.video?(this.video=e.video,e.flip="y"):e.image?this.image=e.image:this._initFmt(e),this.filters=[],this.basicFilter=new Gt({opacity:void 0!==e.opacity?e.opacity:1,flip:e.flip||void 0}),e.filters)for(var r=0;r<e.filters.length;r++)this.filters.push(e.filters[r]);this._init()}return re(t,[{key:"_initFmt",value:function(t){switch(t.format){case"YUY2":this.fmt=new Xt(this);break;case"RGBA":this.fmt=new Qt(this);break;case"RGB":this.fmt=new ee(this);break;case"RGB32":this.fmt=new zt(this);break;case"RGB24":this.fmt=new Vt(this);break;case"NV12":this.fmt=new qt(this);break;case"YUV420":this.fmt=new $t(this)}}},{key:"_initImage",value:function(){}},{key:"_init",value:function(){if(this._initContextGL(),!this.gl)throw new Error("fail to init gl");var t=this.gl;if(this.fb=t.createFramebuffer(),this.fmt)this.fmt.init(this);else if(this.video){var e=this.video.videoWidth,r=this.video.videoHeight,n=new Uint8Array(e*r*4);this.videoTexture=Ft.createTexture(t,t.LINEAR,n,e,r)}this.basicFilter.init(this);for(var i=0;i<this.filters.length;i++)this.filters[i].init(this)}},{key:"_initContextGL",value:function(){for(var t=this.canvas,e=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!e&&n<r.length;){var i=r[n];try{e=t.getContext(i)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++n}this.gl=e}},{key:"_drawPicture",value:function(t,e,r){var n=this.fmt.render(t,e,r),i=n.texture,o=n.width,a=n.height;this._applyFilters(i,o,a)}},{key:"_drawVideo",value:function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,this.videoTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.video),this._applyFilters(this.videoTexture,this.video.videoWidth,this.video.videoHeight)}},{key:"_applyFilters",value:function(t,e,r){for(var n=this.gl,i=0;i<this.filters.length;i++){var o=this.filters[i].render(t,e,r);t=o.texture,e=o.width,r=o.height}n.bindFramebuffer(n.FRAMEBUFFER,null),this.width===e&&this.height===r||(this.width=this.canvas.width=e,this.height=this.canvas.height=r),this.basicFilter.render(t,e,r)}},{key:"render",value:function(t,e,r){this.fmt?(this.width===e&&this.height===r||(this.width=this.canvas.width=e,this.height=this.canvas.height=r),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this._drawPicture(t,e,r)):this.video&&(this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this._drawVideo())}}]),t}(),ie=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),oe=function(){function t(e){F(this,t),this.config=Object.assign({},e),this.type=this.config.type,this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}return ie(t,[{key:"push",value:function(t){if("video"===this.type){if(t.isKeyframe){var e={samples:[],start:t.dts,end:t.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=e),this.currentGop=e,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(t),t.dts<this.currentGop.start&&(this.currentGop.start=t.dts),t.dts>this.currentGop.end&&(this.currentGop.end=t.dts))}}},{key:"get",value:function(t){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===t)return this._getNext()}}},{key:"_getNext",value:function(){if(this._lastGet){var t=this._lastGet.gop,e=t.samples[this._lastGet.index+1];if(e)return this._lastGet.index=this._lastGet.index+1,e;if(!(t=t.nextGop)||t.samples.length<1)return;return e=t.samples[0],this._lastGet={gop:t,index:0},e}var r=this.buffer[0];if(!(r.samples.length<1))return this._lastGet={gop:r,index:0},r.samples[0]}},{key:"remove",value:function(t,e){if(!(this.buffer.length<0))for(var r=0,n=this.buffer[0];n;)n.end<e&&n.start>=t?(this.buffer.splice(r,1),n=this.buffer[r]):(r+=1,n=this.buffer[r])}}]),t}(),ae=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),se=function(){function t(e){j(this,t),this.ranges=e||[]}return ae(t,[{key:"start",value:function(t){return this.ranges[t]?this.ranges[t].start:0}},{key:"end",value:function(t){return this.ranges[t]?this.ranges[t].end:0}},{key:"add",value:function(t){this.ranges.push(t)}},{key:"length",get:function(){return this.ranges.length}}]),t}(),ue=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),ce=function(){function t(e){M(this,t),this.config=Object.assign({},e),this.canvas=this.config.canvas?this.config.canvas:document.createElement("canvas"),this.source=new oe({type:"video"}),this.preloadTime=this.config.preloadTime||3,this.oncanplay=void 0,this.onFirstFrame=void 0,this.meta=void 0,this.readyStatus=0,this.paused=!0,this.count=0,this.currentTime=0,this.lastPlayed=0,this._decoderInited=!1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null,this.canvas.style.maxWidth="100%",this.canvas.style.maxHeight="100%",this.canvas.style.top=0,this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.margin="auto",this.canvas.style.position="absolute"}return ue(t,[{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){var t=this,e=this;this.wasmworker=new xt,this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",function(r){switch(r.data.msg){case"DECODER_READY":e._decoderInited=!0;break;case"DECODED":t._onDecoded(r.data)}})}},{key:"setVideoMetaData",value:function(t){if(this.meta=t,!this._decoderInited)return void this.initWasmWorker();this._avccpushed=!0;var e=new Uint8Array(t.sps.byteLength+4);if(e.set([0,0,0,1]),e.set(t.sps,4),this.wasmworker.postMessage({msg:"decode",data:e}),(e=new Uint8Array(t.pps.byteLength+4)).set([0,0,0,1]),e.set(t.pps,4),this.wasmworker.postMessage({msg:"decode",data:e}),!this.yuvCanvas){var r="YUV420";422===t.chromaFormat&&(r="YUV422P");var n=Object.assign({format:r,canvas:this.canvas},this.config);this.yuvCanvas=new ne(n)}this.readyStatus=1}},{key:"decodeVideo",value:function(t){if(this._decoderInited){this._avccpushed||this.setVideoMetaData(this.meta);for(var e=t.samples,r=e.shift();r;)this._baseDts||(this._baseDts=r.dts),this.source.push(r),r=e.shift();this._preload()}}},{key:"_preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){var t=this.source.get();for(t&&(this._lastSampleDts=t.dts,this._analyseNal(t));t&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(t=this.source.get())&&(this._analyseNal(t),this._lastSampleDts=t.dts)}}},{key:"_analyseNal",value:function(t){for(var e=Ot.getAvccNals(new Ct(t.data.buffer)),r=0,n=0;n<e.length;n++)r+=e[n].body.byteLength+4;for(var i=0,o=new Uint8Array(r),a=0;a<e.length;a++){var s=e[a];o.set([0,0,0,1],i),i+=4,o.set(new Uint8Array(s.body),i),i+=s.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:o,info:{dts:t.dts,pts:t.pts?t.pts:t.dts+t.cts,key:t.isKeyframe}})}},{key:"_onDecoded",value:function(t){var e=t.info.dts;this._decodedFrames[e]=t,Object.keys(this._decodedFrames).length>10&&(this.playFinish&&this.playFinish(),this.oncanplay&&this.oncanplay())}},{key:"play",value:function(){var t=this;return this.paused=!1,new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null})}},{key:"_onTimer",value:function(t){if(!this.paused){if(this.meta){this.meta.frameRate&&this.meta.frameRate.fixed&&this.meta.frameRate.fps;var e=Object.keys(this._decodedFrames);if(e.length>0){this.currentTime=t;for(var r=-1,n=0;n<e.length&&Number.parseInt(e[n])-this._baseDts<=this.currentTime;n++)r=Number.parseInt(e[n-1]);var i=this._decodedFrames[r];if(i){var o=[];if(420===this.meta.chromaFormat){var a=i.buffer.slice(0,i.yLinesize*i.height),s=i.buffer.slice(i.yLinesize*i.height,i.yLinesize*i.height*1.25),u=i.buffer.slice(i.yLinesize*i.height*1.25,i.yLinesize*i.height*1.5);o=[new Uint8Array(a),new Uint8Array(s),new Uint8Array(u)]}this.yuvCanvas.render(o,i.yLinesize,i.height)}for(var c=0;c<e.length;c++)Number.parseInt(e[c])<r&&delete this._decodedFrames[e[c]]}}this._lastRenderTime=Date.now()}}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1)}},{key:"destroy",value:function(){this.wasmworker.postMessage({msg:"destroy"}),this.wasmworker=null,this.canvas=null,this.source=null,this._decoderInited=!1}},{key:"buffered",get:function(){for(var t=[],e={start:null,end:null},r=0;r<this.source.buffer.length;r++){var n=this.source.buffer[r],i=n.start,o=n.end;e.start||(e.start=i),e.end||(e.end=o),i-e.end>1e3?(e.start=e.start/1e3,e.end=e.end/1e3,e={start:i,end:o}):e.end=o}return null!==e.start&&null!==e.end&&(e.start=e.start/1e3,e.end=e.end/1e3,t.push(e)),new se(t)}}]),t}();G.prototype=Object.create(null),H.EventEmitter=H,H.usingDomains=!1,H.prototype.domain=void 0,H.prototype._events=void 0,H.prototype._maxListeners=void 0,H.defaultMaxListeners=10,H.init=function(){this.domain=null,H.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new G,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},H.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},H.prototype.getMaxListeners=function(){return X(this)},H.prototype.emit=function(t){var e,r,n,i,o,a,s,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(e=arguments[1],!s){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=s,e.domainThrown=!1,s.emit("error",e),!1}if(!(r=a[t]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:W(r,l,this);break;case 2:z(r,l,this,arguments[1]);break;case 3:Y(r,l,this,arguments[1],arguments[2]);break;case 4:V(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];K(r,l,this,i)}return!0},H.prototype.addListener=function(t,e){return q(this,t,e,!1)},H.prototype.on=H.prototype.addListener,H.prototype.prependListener=function(t,e){return q(this,t,e,!0)},H.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,$(this,t,e)),this},H.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,$(this,t,e)),this},H.prototype.removeListener=function(t,e){var r,n,i,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new G:(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length;o-- >0;)if(r[o]===e||r[o].listener&&r[o].listener===e){a=r[o].listener,i=o;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new G,this;delete n[t]}else Q(r,i);n.removeListener&&this.emit("removeListener",t,a||e)}return this},H.prototype.removeAllListeners=function(t){var e,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new G,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new G:delete r[t]),this;if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new G,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},H.prototype.listeners=function(t){var e,r=this._events;return r&&(e=r[t])?"function"==typeof e?[e.listener||e]:et(e):[]},H.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):J.call(t,e)},H.prototype.listenerCount=J,H.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var le=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),he=function(t){function e(t){rt(this,e);var r=nt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));r.config=Object.assign({},t);var n=window.AudioContext||window.webkitAudioContext;return r.context=new n,r.gainNode=r.context.createGain(),r.gainNode.connect(r.context.destination),r.meta=void 0,r.samples=[],r.preloadTime=r.config.preloadTime||3,r.duration=0,r._currentBuffer=void 0,r._nextBuffer=void 0,r._lastpts=void 0,r._preDecode=[],r._currentTime=0,r._decoding=!1,r._volume=r.config.volume||.6,r._played=!1,r.playFinish=null,r.waitNextID=null,r}return it(e,t),le(e,[{key:"decodeAudio",value:function(t){var e=t.samples,r=t.meta,n=e;t.samples=[],r&&this.setAudioData(n)}},{key:"setAudioData",value:function(t){for(var e=0;e<t.length;e++)t[e].pts=void 0===t[e].pts?t[e].dts:t[e].pts,this._preDecode.push(t[e]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(!this._decoding){this._decoding=!0;for(var t=this._preDecode,r=[],n=this,i=t.shift();i;){var o=e.getAACData(this.meta,i);r.push(o),this._lastpts=i.pts,i=t.shift()}var a=e.combileData(r);try{this.context.decodeAudioData(a.buffer,function(t){var e=n.context.createBufferSource();e.buffer=t,n.samples.push({time:n.duration,duration:t.duration,data:e}),n.duration+=t.duration,n._currentBuffer||(n._currentBuffer=n.getTimeBuffer(n.currentTime)),!n._nextBuffer&&n._currentBuffer&&(n._nextBuffer=n.getTimeBuffer(n.currentTime+n._currentBuffer.duration)),n._decoding=!1,(n._preDecode.length>0&&n._preDecode[n._preDecode.length-1].pts-n._lastpts)/1e3>=n.preloadTime&&n.decodeAAC(),n.playFinish&&n.playFinish()},function(t){console.error(t)})}catch(t){console.error(t)}}}},{key:"onSourceEnded",value:function(){var t=this;if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(function(){t.onSourceEnded()},200));var e=this._nextBuffer.data;e.start(),e.connect(this.gainNode);var r=this;setTimeout(function(){r.onSourceEnded.call(t)},1e3*e.buffer.duration-10),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}},{key:"play",value:function(){var t=this;if(!this.playFinish){this._played=!0,"suspended"===this.context.state&&this.context.resume();var e=this,r=function(){var r=t._currentBuffer.data;r.connect(t.gainNode),r.start(),setTimeout(function(){e.onSourceEnded.call(t)},1e3*r.buffer.duration-10)};return this._currentBuffer?(r(),Promise.resolve()):new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null,r()})}}},{key:"pause",value:function(){var t=this.context;"running"===t.state&&t.suspend()}},{key:"getTimeBuffer",value:function(t){for(var e=void 0,r=0;r<this.samples.length;r++){var n=this.samples[r];if(n.time<=t&&n.time+n.duration>t){e=n;break}}return e}},{key:"setAudioMetaData",value:function(t){this.meta=t}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this.context.close()}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(t){this.gainNode.gain.value=t?0:this._volume}},{key:"volume",get:function(){return this._volume},set:function(t){return t<0?(this._volume=0,void(this.gainNode.gain.value=0)):t>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=t,void(this.gainNode.gain.value=t))}}],[{key:"getAACData",value:function(t,r){var n=new Uint8Array(r.data.byteLength+7),i=e.getAdts(t,r.data);return n.set(i),n.set(r.data,7),n}},{key:"combileData",value:function(t){for(var e=0,r=0,n=t.length;r<n;r++)e+=t[r].byteLength;for(var i=new Uint8Array(e),o=0,a=0,s=t.length;a<s;a++)i.set(t[a],o),o+=t[a].byteLength;return i}},{key:"getAdts",value:function(t,e){var r=new Uint8Array(7);r[0]=255,r[1]=240,r[1]=1|r[1],r[2]=192&t.objectType-1<<6,r[2]=r[2]|60&t.sampleRateIndex<<2,r[2]=r[2]|1&t.channelCount>>2,r[3]=192&t.channelCount<<6;var n=e.byteLength+7;return r[3]=r[3]|3&n>>11,r[4]=255&n>>3,r[5]=224&n<<5,r[5]=31|r[5],r[6]=252,r}}]),e}(H),fe=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),de=function(){function t(e){ot(this,t),this.aCtx=e.aCtx,this.vCtx=e.vCtx,this.video=e.video,this.timeoutId=null,this.start=null}return fe(t,[{key:"doReconcile",value:function(){var t=this,e=(this.vCtx.currentTime||0)-1e3*(this.aCtx.currentTime||0);this.timeoutId||(e>200?(this.video.start+=e,this.vCtx.pause(),this.timeoutId=setTimeout(function(){t.vCtx.play(),t.timeoutId=null},e)):e<-120&&(this.video.start+=e))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null}}]),t}(),pe=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),ve=function(t){function e(){at(this,e);var t=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._canvas=document.createElement("canvas"),t.handleAudioSourceEnd=t.handleAudioSourceEnd.bind(t),t.played=!1,t.pendingPlayTask=null,t._paused=!0,t.videoMetaInited=!1,t.audioMetaInited=!1,t.init(),t}return ut(e,t),pe(e,null,[{key:"resolveVideoGOP",value:function(t){var e=t.samples;if(e.length){var r=null,n=null;t.tempSamples&&t.tempSamples.length&&e.unshift.apply(e,t.tempSamples);for(var i=0,o=e.length;i<o;i++)if(e[i].isKeyframe){r=i;break}for(var a=e.length-1;a>0;a++)if(e[a].isKeyframe){n=a;break}0!==r&&e.splice(0,r-1),t.samples=e.slice(0,n);var s=e.slice(n);t.tempSamples?t.tempSamples.push.apply(t.tempSamples,s):t.tempSamples=s}}}]),pe(e,[{key:"init",value:function(){var t=this;this.vCtx=new ce(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}})),this.aCtx=new he({}),this.ticker=new(pt()),this.reconciler=new de({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.dispatchEvent(new Event("waiting")),this.vCtx.oncanplay=function(){t.played||t.appendChild(t._canvas),t.dispatchEvent(new Event("canplay"))},this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"destroy",value:function(){this.videoMetaInited=!1,this.audioMetaInited=!1,this.aCtx.destroy(),this.vCtx.destroy(),this.ticker.stop(),this.start=null,this.reconciler.destroy(),this.aCtx=null,this.vCtx=null,this.ticker=null}},{key:"onDemuxComplete",value:function(t,e){this.aCtx.decodeAudio(e),this.vCtx.decodeVideo(t)}},{key:"setAudioMeta",value:function(t){this.audioMetaInited&&(this.aCtx.destroy(),this.aCtx=new he({})),this.aCtx.setAudioMetaData(t),this.audioMetaInited=!0}},{key:"setVideoMeta",value:function(t){this.videoMetaInited&&(this.vCtx.destroy(),this.vCtx=new ce(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}}))),this.vCtx.setVideoMetaData(t),this.videoMetaInited=!0}},{key:"play",value:function(){var t=this;this.pendingPlayTask||(this.played&&(this.destroy(),this.init()),this.pendingPlayTask=Promise.all([this.vCtx.play(),this.aCtx.play().then(function(){t.aCtx.muted=!0})]).then(function(){t.aCtx.muted=!1,t.ticker.start(function(){t.start||(t.start=Date.now()),t._currentTime=Date.now()-t.start,t.vCtx._onTimer(t._currentTime)}),t.pendingPlayTask=null,t.played=!0,t.dispatchEvent(new Event("playing")),t.dispatchEvent(new Event("play")),t._paused=!1}))}},{key:"pause",value:function(){this._paused=!0,this.aCtx.pause(),this.vCtx.pause(),this.dispatchEvent(new Event("pause"))}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("width",e),this.style.width=e,this._canvas.width=t}},{key:"height",get:function(){return this.getAttribute("height")},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("height",e),this.style.height=e,this._canvas.height=t}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(t){this.setAttribute("src",t)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(t){this.setAttribute("playbackrate",t),this.aCtx.playbackRate=t,this.vCtx.playbackRate=t,this.dispatchEvent(new Event("ratechange"))}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&this.getAttribute("autoplay")},set:function(t){this.setAttribute("autoplay",t)}},{key:"volume",get:function(){return this.aCtx.volume},set:function(t){this.setAttribute("volume",t),this.aCtx.volume=t}},{key:"muted",get:function(){var t="true"===this.getAttribute("muted");return void 0!==t?t:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(t){this.setAttribute("muted",t),this.aCtx.muted=!!t}},{key:"error",get:function(){return this.vCtx.error||this.aCtx.error}},{key:"buffered",get:function(){return this.vCtx.buffered}}]),e}(HTMLElement);customElements.define("mobile-video",ve)});
//# sourceMappingURL=index.min.js.map
