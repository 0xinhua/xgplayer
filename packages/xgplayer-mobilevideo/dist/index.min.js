!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return function(n){var i=this;if(!e)return new z(t);if(z&&!n){var o=r(`${e}`.replace(/^function.+?{/,"").slice(0,-1));return this[H]=new z(o),X.revokeObjectURL(o),this[H]}var a={postMessage:t=>{i.onmessage&&setTimeout(()=>i.onmessage({data:t,target:a}))}};e.call(a),this.postMessage=(t=>{setTimeout(()=>a.onmessage({data:t,target:i}))}),this.isThisThread=!0}}function r(t){try{return X.createObjectURL(new Blob([t],{type:Y}))}catch(n){var e=new V;return e.append(t),X.createObjectURL(e.getBlob(type))}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(){}function y(){y.init.call(this)}function m(t){return void 0===t._maxListeners?y.defaultMaxListeners:t._maxListeners}function g(t,e,n){if(e)t.call(n);else for(var i=t.length,r=D(t,i),o=0;o<i;++o)r[o].call(n)}function b(t,e,n,i){if(e)t.call(n,i);else for(var r=t.length,o=D(t,r),a=0;a<r;++a)o[a].call(n,i)}function w(t,e,n,i,r){if(e)t.call(n,i,r);else for(var o=t.length,a=D(t,o),s=0;s<o;++s)a[s].call(n,i,r)}function _(t,e,n,i,r,o){if(e)t.call(n,i,r,o);else for(var a=t.length,s=D(t,a),u=0;u<a;++u)s[u].call(n,i,r,o)}function E(t,e,n,i){if(e)t.apply(n,i);else for(var r=t.length,o=D(t,r),a=0;a<r;++a)o[a].apply(n,i)}function k(t,e,n,i){var r,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(o=t._events,o?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]):(o=t._events=new v,t._eventsCount=0),a){if("function"==typeof a?a=o[e]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(r=m(t))&&r>0&&a.length>r){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,C(s)}}else a=o[e]=n,++t._eventsCount;return t}function C(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function T(t,e,n){function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}var r=!1;return i.listener=n,i}function x(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function A(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}function D(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function L(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function O(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(function(){function t(t){var e=dt.has(t);return t=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t),!e&&t}function e(t){var e=t.isConnected;if(void 0!==e)return e;if(pt(t))return!0;for(;t&&!(t.__CE_isImportDocument||t instanceof Document);)t=t.parentNode||(window.ShadowRoot&&t instanceof ShadowRoot?t.host:void 0);return!(!t||!(t.__CE_isImportDocument||t instanceof Document))}function n(t){var e=t.children;if(e)return Array.prototype.slice.call(e);for(e=[],t=t.firstChild;t;t=t.nextSibling)t.nodeType===Node.ELEMENT_NODE&&e.push(t);return e}function i(t,e){for(;e&&e!==t&&!e.nextSibling;)e=e.parentNode;return e&&e!==t?e.nextSibling:null}function r(t,e,n){for(var o=t;o;){if(o.nodeType===Node.ELEMENT_NODE){var a=o;e(a);var s=a.localName;if("link"===s&&"import"===a.getAttribute("rel")){if(o=a.import,void 0===n&&(n=new Set),o instanceof Node&&!n.has(o))for(n.add(o),o=o.firstChild;o;o=o.nextSibling)r(o,e,n);o=i(t,a);continue}if("template"===s){o=i(t,a);continue}if(a=a.__CE_shadowRoot)for(a=a.firstChild;a;a=a.nextSibling)r(a,e,n)}o=o.firstChild?o.firstChild:i(t,o)}}function o(t,e,n){t[e]=n}function a(t){var e=document;this.c=t,this.a=e,this.b=void 0,k(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function s(t){t.b&&t.b.disconnect()}function u(){var t=this;this.b=this.a=void 0,this.c=new Promise(function(e){t.b=e,t.a&&e(t.a)})}function c(t){if(t.a)throw Error("Already resolved.");t.a=void 0,t.b&&t.b(void 0)}function l(t){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=t,this.j=new Map,this.c=function(t){return t()},this.a=!1,this.h=[],this.m=t.f?new a(t):void 0}function h(e,n){if(!t(n))throw new SyntaxError("The element name '"+n+"' is not valid.");if(p(e,n))throw Error("A custom element with name '"+n+"' has already been defined.");if(e.i)throw Error("A custom element is already being defined.")}function f(t,e,n){t.i=!0;var i;try{var r=function(t){var e=o[t];if(void 0!==e&&!(e instanceof Function))throw Error("The '"+t+"' callback must be a function.");return e},o=n.prototype;if(!(o instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var a=r("connectedCallback"),s=r("disconnectedCallback"),u=r("adoptedCallback"),c=(i=r("attributeChangedCallback"))&&n.observedAttributes||[]}catch(t){throw t}finally{t.i=!1}return n={localName:e,constructorFunction:n,connectedCallback:a,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:i,observedAttributes:c,constructionStack:[]},t.g.set(e,n),t.l.set(n.constructorFunction,n),n}function d(t){if(!1!==t.a){t.a=!1;for(var e=[],n=t.h,i=new Map,r=0;r<n.length;r++)i.set(n[r],[]);for(k(t.b,document,{upgrade:function(n){if(void 0===n.__CE_state){var r=n.localName,o=i.get(r);o?o.push(n):t.g.has(r)&&e.push(n)}}}),r=0;r<e.length;r++)C(t.b,e[r]);for(r=0;r<n.length;r++){for(var o=n[r],a=i.get(o),s=0;s<a.length;s++)C(t.b,a[s]);(o=t.j.get(o))&&c(o)}n.length=0}}function p(t,e){var n=t.g.get(e);if(n)return n;if(n=t.f.get(e)){t.f.delete(e);try{return f(t,e,n())}catch(t){x(t)}}}function v(){var t=yt&&yt.noDocumentConstructionObserver,e=yt&&yt.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=e,this.f=!t}function y(t,e,n,i){var o=window.ShadyDOM;if(t.shadyDomFastWalk&&o&&o.inUse){if(e.nodeType===Node.ELEMENT_NODE&&n(e),e.querySelectorAll)for(t=o.nativeMethods.querySelectorAll.call(e,"*"),e=0;e<t.length;e++)n(t[e])}else r(e,n,i)}function m(t,e){t.a=!0,t.b.push(e)}function g(t,e){t.a=!0,t.c.push(e)}function b(t,e){t.a&&y(t,e,function(e){return w(t,e)})}function w(t,e){if(t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var n=0;n<t.b.length;n++)t.b[n](e);for(n=0;n<t.c.length;n++)t.c[n](e)}}function _(t,e){var n=[];for(y(t,e,function(t){return n.push(t)}),e=0;e<n.length;e++){var i=n[e];1===i.__CE_state?t.connectedCallback(i):C(t,i)}}function E(t,e){var n=[];for(y(t,e,function(t){return n.push(t)}),e=0;e<n.length;e++){var i=n[e];1===i.__CE_state&&t.disconnectedCallback(i)}}function k(t,e,n){var i=(n=void 0===n?{}:n).s,r=n.upgrade||function(e){return C(t,e)},o=[];for(y(t,e,function(e){if(t.a&&w(t,e),"link"===e.localName&&"import"===e.getAttribute("rel")){var n=e.import;n instanceof Node&&(n.__CE_isImportDocument=!0,n.__CE_registry=document.__CE_registry),n&&"complete"===n.readyState?n.__CE_documentLoadHandled=!0:e.addEventListener("load",function(){var n=e.import;if(!n.__CE_documentLoadHandled){n.__CE_documentLoadHandled=!0;var o=new Set;i&&(i.forEach(function(t){return o.add(t)}),o.delete(n)),k(t,n,{s:o,upgrade:r})}})}else o.push(e)},i),e=0;e<o.length;e++)r(o[e])}function C(t,n){try{var i=n.ownerDocument,r=i.__CE_registry,o=r&&(i.defaultView||i.__CE_isImportDocument)?p(r,n.localName):void 0;if(o&&void 0===n.__CE_state){o.constructionStack.push(n);try{try{if(new o.constructorFunction!==n)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{o.constructionStack.pop()}}catch(t){throw n.__CE_state=2,t}if(n.__CE_state=1,n.__CE_definition=o,o.attributeChangedCallback&&n.hasAttributes()){var a=o.observedAttributes;for(o=0;o<a.length;o++){var s=a[o],u=n.getAttribute(s);null!==u&&t.attributeChangedCallback(n,s,null,u,null)}}e(n)&&t.connectedCallback(n)}}catch(t){x(t)}}function T(t,e,n,i){var r=e.__CE_registry;if(r&&(null===i||"http://www.w3.org/1999/xhtml"===i)&&(r=p(r,n)))try{var o=new r.constructorFunction;if(void 0===o.__CE_state||void 0===o.__CE_definition)throw Error("Failed to construct '"+n+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==o.namespaceURI)throw Error("Failed to construct '"+n+"': The constructed element's namespace must be the HTML namespace.");if(o.hasAttributes())throw Error("Failed to construct '"+n+"': The constructed element must not have any attributes.");if(null!==o.firstChild)throw Error("Failed to construct '"+n+"': The constructed element must not have any children.");if(null!==o.parentNode)throw Error("Failed to construct '"+n+"': The constructed element must not have a parent node.");if(o.ownerDocument!==e)throw Error("Failed to construct '"+n+"': The constructed element's owner document is incorrect.");if(o.localName!==n)throw Error("Failed to construct '"+n+"': The constructed element's local name is incorrect.");return o}catch(r){return x(r),e=null===i?U.call(e,n):N.call(e,i,n),Object.setPrototypeOf(e,HTMLUnknownElement.prototype),e.__CE_state=2,e.__CE_definition=void 0,w(t,e),e}return e=null===i?U.call(e,n):N.call(e,i,n),w(t,e),e}function x(t){var e=t.message,n=t.sourceURL||t.fileName||"",i=t.line||t.lineNumber||0,r=t.column||t.columnNumber||0,o=void 0;void 0===ErrorEvent.prototype.initErrorEvent?o=new ErrorEvent("error",{cancelable:!0,message:e,filename:n,lineno:i,colno:r,error:t}):((o=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,e,n,i),o.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===o.error&&Object.defineProperty(o,"error",{configurable:!0,enumerable:!0,get:function(){return t}}),window.dispatchEvent(o),o.defaultPrevented||console.error(t)}function A(t){window.HTMLElement=function(){function e(){var e=this.constructor,n=document.__CE_registry.l.get(e);if(!n)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var i=n.constructionStack;if(0===i.length)return i=U.call(document,n.localName),Object.setPrototypeOf(i,e.prototype),i.__CE_state=1,i.__CE_definition=n,w(t,i),i;var r=i.length-1,o=i[r];if(o===vt)throw Error("Failed to construct '"+n.localName+"': This element was already constructed.");return i[r]=vt,Object.setPrototypeOf(o,e.prototype),w(t,o),o}return e.prototype=ct.prototype,Object.defineProperty(e.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:e}),e}()}function D(t,n,i){function r(n){return function(i){for(var r=[],o=0;o<arguments.length;++o)r[o]=arguments[o];o=[];for(var a=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(n.apply(this,r),r=0;r<a.length;r++)E(t,a[r]);if(e(this))for(r=0;r<o.length;r++)(a=o[r])instanceof Element&&_(t,a)}}void 0!==i.prepend&&o(n,"prepend",r(i.prepend)),void 0!==i.append&&o(n,"append",r(i.append))}function L(t){o(Document.prototype,"createElement",function(e){return T(t,this,e,null)}),o(Document.prototype,"importNode",function(e,n){return e=O.call(this,e,!!n),this.__CE_registry?k(t,e):b(t,e),e}),o(Document.prototype,"createElementNS",function(e,n){return T(t,this,n,e)}),D(t,Document.prototype,{prepend:F,append:I})}function B(t){function i(n,i){Object.defineProperty(n,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,n);else{var r=void 0;if(this.firstChild){var o=this.childNodes,a=o.length;if(0<a&&e(this)){r=Array(a);for(var s=0;s<a;s++)r[s]=o[s]}}if(i.set.call(this,n),r)for(n=0;n<r.length;n++)E(t,r[n])}}})}o(Node.prototype,"insertBefore",function(i,r){if(i instanceof DocumentFragment){var o=n(i);if(i=H.call(this,i,r),e(this))for(r=0;r<o.length;r++)_(t,o[r]);return i}return o=i instanceof Element&&e(i),r=H.call(this,i,r),o&&E(t,i),e(this)&&_(t,i),r}),o(Node.prototype,"appendChild",function(i){if(i instanceof DocumentFragment){var r=n(i);if(i=W.call(this,i),e(this))for(var o=0;o<r.length;o++)_(t,r[o]);return i}return r=i instanceof Element&&e(i),o=W.call(this,i),r&&E(t,i),e(this)&&_(t,i),o}),o(Node.prototype,"cloneNode",function(e){return e=G.call(this,!!e),this.ownerDocument.__CE_registry?k(t,e):b(t,e),e}),o(Node.prototype,"removeChild",function(n){var i=n instanceof Element&&e(n),r=Y.call(this,n);return i&&E(t,n),r}),o(Node.prototype,"replaceChild",function(i,r){if(i instanceof DocumentFragment){var o=n(i);if(i=V.call(this,i,r),e(this))for(E(t,r),r=0;r<o.length;r++)_(t,o[r]);return i}o=i instanceof Element&&e(i);var a=V.call(this,i,r),s=e(this);return s&&E(t,r),o&&E(t,i),s&&_(t,i),a}),X&&X.get?i(Node.prototype,X):m(t,function(t){i(t,{enumerable:!0,configurable:!0,get:function(){for(var t=[],e=this.firstChild;e;e=e.nextSibling)e.nodeType!==Node.COMMENT_NODE&&t.push(e.textContent);return t.join("")},set:function(t){for(;this.firstChild;)Y.call(this,this.firstChild);null!=t&&""!==t&&W.call(this,document.createTextNode(t))}})})}function S(t){function n(n){return function(i){for(var r=[],o=0;o<arguments.length;++o)r[o]=arguments[o];o=[];for(var a=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(n.apply(this,r),r=0;r<a.length;r++)E(t,a[r]);if(e(this))for(r=0;r<o.length;r++)(a=o[r])instanceof Element&&_(t,a)}}var i=Element.prototype;void 0!==ot&&o(i,"before",n(ot)),void 0!==at&&o(i,"after",n(at)),void 0!==st&&o(i,"replaceWith",function(n){for(var i=[],r=0;r<arguments.length;++r)i[r]=arguments[r];r=[];for(var o=[],a=0;a<i.length;a++){var s=i[a];if(s instanceof Element&&e(s)&&o.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(a=e(this),st.apply(this,i),i=0;i<o.length;i++)E(t,o[i]);if(a)for(E(t,this),i=0;i<r.length;i++)(o=r[i])instanceof Element&&_(t,o)}),void 0!==ut&&o(i,"remove",function(){var n=e(this);ut.call(this),n&&E(t,this)})}function R(t){function n(n,i){Object.defineProperty(n,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){var r=this,o=void 0;if(e(this)&&(o=[],y(t,this,function(t){t!==r&&o.push(t)})),i.set.call(this,n),o)for(var a=0;a<o.length;a++){var s=o[a];1===s.__CE_state&&t.disconnectedCallback(s)}return this.ownerDocument.__CE_registry?k(t,this):b(t,this),n}})}function i(n,i){o(n,"insertAdjacentElement",function(n,r){var o=e(r);return n=i.call(this,n,r),o&&E(t,r),e(n)&&_(t,r),n})}function r(e,n){function i(e,n){for(var i=[];e!==n;e=e.nextSibling)i.push(e);for(n=0;n<i.length;n++)k(t,i[n])}o(e,"insertAdjacentHTML",function(t,e){if("beforebegin"===(t=t.toLowerCase())){var r=this.previousSibling;n.call(this,t,e),i(r||this.parentNode.firstChild,this)}else if("afterbegin"===t)r=this.firstChild,n.call(this,t,e),i(this.firstChild,r);else if("beforeend"===t)r=this.lastChild,n.call(this,t,e),i(r||this.firstChild,null);else{if("afterend"!==t)throw new SyntaxError("The value provided ("+String(t)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,n.call(this,t,e),i(this.nextSibling,r)}})}z&&o(Element.prototype,"attachShadow",function(e){if(e=z.call(this,e),t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var n=0;n<t.b.length;n++)t.b[n](e)}return this.__CE_shadowRoot=e}),K&&K.get?n(Element.prototype,K):lt&&lt.get?n(HTMLElement.prototype,lt):g(t,function(t){n(t,{enumerable:!0,configurable:!0,get:function(){return G.call(this,!0).innerHTML},set:function(t){var e="template"===this.localName,n=e?this.content:this,i=N.call(document,this.namespaceURI,this.localName);for(i.innerHTML=t;0<n.childNodes.length;)Y.call(n,n.childNodes[0]);for(t=e?i.content:i;0<t.childNodes.length;)W.call(n,t.childNodes[0])}})}),o(Element.prototype,"setAttribute",function(e,n){if(1!==this.__CE_state)return Z.call(this,e,n);var i=q.call(this,e);Z.call(this,e,n),n=q.call(this,e),t.attributeChangedCallback(this,e,i,n,null)}),o(Element.prototype,"setAttributeNS",function(e,n,i){if(1!==this.__CE_state)return Q.call(this,e,n,i);var r=J.call(this,e,n);Q.call(this,e,n,i),i=J.call(this,e,n),t.attributeChangedCallback(this,n,r,i,e)}),o(Element.prototype,"removeAttribute",function(e){if(1!==this.__CE_state)return $.call(this,e);var n=q.call(this,e);$.call(this,e),null!==n&&t.attributeChangedCallback(this,e,n,null,null)}),o(Element.prototype,"removeAttributeNS",function(e,n){if(1!==this.__CE_state)return tt.call(this,e,n);var i=J.call(this,e,n);tt.call(this,e,n);var r=J.call(this,e,n);i!==r&&t.attributeChangedCallback(this,n,i,r,e)}),ht?i(HTMLElement.prototype,ht):et&&i(Element.prototype,et),ft?r(HTMLElement.prototype,ft):nt&&r(Element.prototype,nt),D(t,Element.prototype,{prepend:it,append:rt}),S(t)}function P(){var t=new v;A(t),L(t),D(t,DocumentFragment.prototype,{prepend:M,append:j}),B(t),R(t),t=new l(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}var U=window.Document.prototype.createElement,N=window.Document.prototype.createElementNS,O=window.Document.prototype.importNode,F=window.Document.prototype.prepend,I=window.Document.prototype.append,M=window.DocumentFragment.prototype.prepend,j=window.DocumentFragment.prototype.append,G=window.Node.prototype.cloneNode,W=window.Node.prototype.appendChild,H=window.Node.prototype.insertBefore,Y=window.Node.prototype.removeChild,V=window.Node.prototype.replaceChild,X=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),z=window.Element.prototype.attachShadow,K=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),q=window.Element.prototype.getAttribute,Z=window.Element.prototype.setAttribute,$=window.Element.prototype.removeAttribute,J=window.Element.prototype.getAttributeNS,Q=window.Element.prototype.setAttributeNS,tt=window.Element.prototype.removeAttributeNS,et=window.Element.prototype.insertAdjacentElement,nt=window.Element.prototype.insertAdjacentHTML,it=window.Element.prototype.prepend,rt=window.Element.prototype.append,ot=window.Element.prototype.before,at=window.Element.prototype.after,st=window.Element.prototype.replaceWith,ut=window.Element.prototype.remove,ct=window.HTMLElement,lt=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),ht=window.HTMLElement.prototype.insertAdjacentElement,ft=window.HTMLElement.prototype.insertAdjacentHTML,dt=new Set;"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach(function(t){return dt.add(t)});var pt=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);a.prototype.f=function(t){var e=this.a.readyState;for("interactive"!==e&&"complete"!==e||s(this),e=0;e<t.length;e++)for(var n=t[e].addedNodes,i=0;i<n.length;i++)k(this.c,n[i])},l.prototype.o=function(t,e){var n=this;if(!(e instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");h(this,t),this.f.set(t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return d(n)}))},l.prototype.define=function(t,e){var n=this;if(!(e instanceof Function))throw new TypeError("Custom element constructors must be functions.");h(this,t),f(this,t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return d(n)}))},l.prototype.upgrade=function(t){k(this.b,t)},l.prototype.get=function(t){if(t=p(this,t))return t.constructorFunction},l.prototype.whenDefined=function(e){if(!t(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var n=this.j.get(e);if(n)return n.c;n=new u,this.j.set(e,n);var i=this.g.has(e)||this.f.has(e);return e=-1===this.h.indexOf(e),i&&e&&c(n),n.c},l.prototype.polyfillWrapFlushCallback=function(t){this.m&&s(this.m);var e=this.c;this.c=function(n){return t(function(){return e(n)})}},window.CustomElementRegistry=l,l.prototype.define=l.prototype.define,l.prototype.upgrade=l.prototype.upgrade,l.prototype.get=l.prototype.get,l.prototype.whenDefined=l.prototype.whenDefined,l.prototype.polyfillDefineLazy=l.prototype.o,l.prototype.polyfillWrapFlushCallback=l.prototype.polyfillWrapFlushCallback,v.prototype.connectedCallback=function(t){var e=t.__CE_definition;if(e.connectedCallback)try{e.connectedCallback.call(t)}catch(t){x(t)}},v.prototype.disconnectedCallback=function(t){var e=t.__CE_definition;if(e.disconnectedCallback)try{e.disconnectedCallback.call(t)}catch(t){x(t)}},v.prototype.attributeChangedCallback=function(t,e,n,i,r){var o=t.__CE_definition;if(o.attributeChangedCallback&&-1<o.observedAttributes.indexOf(e))try{o.attributeChangedCallback.call(t,e,n,i,r)}catch(t){x(t)}};var vt=new function(){},yt=window.customElements;yt&&!yt.forcePolyfill&&"function"==typeof yt.define&&"function"==typeof yt.get||P(),window.__CE_installPolyfill=P}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var t=HTMLElement,e={HTMLElement:function(){return Reflect.construct(t,[],this.constructor)}};window.HTMLElement=e.HTMLElement,HTMLElement.prototype=t.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,t)}}();var F=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},I=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),M=function(){function t(e){n(this,t),this.options=Object.assign({},e||{},{interval:16}),this.callbacks=[]}return I(t,[{key:"start",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.callbacks=e}},{key:"onTick",value:function(){for(var t=0,e=this.callbacks.length;t<e;t++)(0,this.callbacks[t])()}},{key:"setInterval",value:function(t){return this.options.interval=t,this}}]),t}(),j=function(i){function r(e){n(this,r);var i=t(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return i.prev=null,i.timerId=null,i._subTimerId=null,i._tickFunc=r.getTickFunc(),i.tick=i.tick.bind(i),i}return e(r,i),I(r,[{key:"start",value:function(){for(var t,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=F(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"start",this)).call.apply(t,[this].concat(n)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var t=this._tickFunc;this.timerId=t(this.tick)}},{key:"stop",value:function(){this.timerId&&r.getCancelFunc()(this.timerId)}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==r.getTickFunc()}}]),r}(M),G=function(i){function r(e){n(this,r);var i=t(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return i.timeoutId=null,i}return e(r,i),I(r,[{key:"start",value:function(){for(var t,e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];(t=F(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"nextTick",this)).call.apply(t,[this].concat(i)),this.timeoutId=window.setInterval(function(){e.onTick()},this.options.interval||16)}},{key:"stop",value:function(){this.timeoutId&&window.clearInterval(this.timeoutId)}}]),r}(M),W=function(){return j.isSupported()?j:G},H="undefined"==typeof Symbol?"__target":Symbol(),Y="application/javascript",V=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,X=window.URL||window.webkitURL,z=window.Worker;if(z){var K,q=r("self.onmessage = function () {}"),Z=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");(K=new z(q)).postMessage(Z,[Z.buffer])}catch(t){z=null}finally{X.revokeObjectURL(q),K&&K.terminate()}}var $=new i("./worker.js",function(t,e){function n(){(a=new o(this)).init()}function i(t){a||r.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/ttfe/media/decoder/h264/decoder.js"),addOnPostRun(n.bind(r))}var r=this,o=function(t){this.inited=!1,this.self=t,this.meta=this.self.meta,this.infolist={},t.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),t.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)};o.prototype.toU8Array=function(t,e){return this.self.HEAPU8.subarray(t,t+e)},o.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},o.prototype.broadwayOnPictureDecoded=function(t,e,n,i,r,o){var a=Object.assign({},this.infolist[o]),s=n,u=n/2;444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=n);var c=this.toU8Array(t,i*s+r*u*2);this.infolist[o]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;this.self.postMessage({msg:"DECODED",width:e,height:n,yLinesize:i,uvLinesize:r,info:a,buffer:h},[h])},o.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"DECODER_READY"})},o.prototype.decode=function(t,e){var n=parseInt((new Date).getTime()),i=n-1e9*Math.floor(n/1e9);this.infolist[i]=e,this.streamBuffer.set(t),Module._broadwayPlayStream(t.length,i)},o.prototype.destroy=function(){Module._broadwayExit()};var a;r.addEventListener("message",function(t){var e=t.data;if(e.msg)switch(e.msg){case"init":console.log(e),r.meta=e.meta,i();break;case"decode":a.decode(e.data,e.info);break;case"destory":a.destroy()}else r.postMessage({msg:"ERROR:invalid message"})},!1)}),J=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Q=function(){function t(e){if(o(this,t),!(e instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0}return J(t,[{key:"back",value:function(t){this.position-=t}},{key:"skip",value:function(e){for(var n=Math.floor(e/4),i=e%4,r=0;r<n;r++)t.readByte(this.dataview,4);i>0&&t.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return t.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return t.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return t.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return t.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return t.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return t.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return t.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return t.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(t){this.dataview.position=t},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(t,e,n){var i=void 0;switch(e){case 1:i=n?t.getInt8(t.position):t.getUint8(t.position);break;case 2:i=n?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(n)throw new Error("not supported for readByte 3");i=t.getUint8(t.position)<<16,i|=t.getUint8(t.position+1)<<8,i|=t.getUint8(t.position+2);break;case 4:i=n?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(n)throw new Error("not supported for readBody 8");i=t.getUint32(t.position)<<32,i|=t.getUint32(t.position+4);break;default:i=""}return t.position+=e,i}}]),t}(),tt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),et=function(){function t(e){a(this,t),this.TAG="Golomb",this._buffer=e,this._bufferIndex=0,this._totalBytes=e.byteLength,this._totalBits=8*e.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return tt(t,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),n=new Uint8Array(4);n.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(n.buffer).getUint32(0),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}},{key:"readBits",value:function(t){var e=Math.min(this._currentWordBitsLeft,t),n=this._currentWord>>>32-e;if(t>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=e,this._currentWordBitsLeft>0?this._currentWord<<=e:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),e=t-e,e>0&&this._currentWordBitsLeft?n<<e|this.readBits(e):n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var t=void 0;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}},{key:"readUEG",value:function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}]),t}(),nt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),it=function(){function t(){s(this,t)}return nt(t,null,[{key:"_ebsp2rbsp",value:function(t){for(var e=t,n=e.byteLength,i=new Uint8Array(n),r=0,o=0;o<n;o++)o>=2&&3===e[o]&&0===e[o-1]&&0===e[o-2]||(i[r]=e[o],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(e){var n=t._ebsp2rbsp(e),i=new et(n);i.readByte();var r=i.readByte();i.readByte();var o=i.readByte();i.readUEG();var a=t.getProfileString(r),s=t.getLevelString(o),u=1,c=420,l=[0,420,422,444],h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(c=l[u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==u?8:12,d=0;d<f;d++)i.readBool()&&(d<6?t._skipScalingList(i,16):t._skipScalingList(i,64));i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();for(var v=i.readUEG(),y=0;y<v;y++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),g=i.readUEG(),b=i.readBits(1);0===b&&i.readBits(1),i.readBits(1);var w=0,_=0,E=0,k=0;i.readBool()&&(w=i.readUEG(),_=i.readUEG(),E=i.readUEG(),k=i.readUEG());var C=1,T=1,x=0,A=!0,D=0,L=0;if(i.readBool()){if(i.readBool()){var B=i.readByte(),S=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],R=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];B>0&&B<16?(C=S[B-1],T=R[B-1]):255===B&&(C=i.readByte()<<8|i.readByte(),T=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var P=i.readBits(32),U=i.readBits(32);A=i.readBool(),x=(D=U)/(L=2*P)}}var N=1;1===C&&1===T||(N=C/T);var O=0,F=0;0===u?(O=1,F=2-b):(O=3===u?1:2,F=(1===u?2:1)*(2-b));var I=16*(m+1),M=16*(g+1)*(2-b);I-=(w+_)*O,M-=(E+k)*F;var j=Math.ceil(I*N);return i.destroy(),i=null,{profile_string:a,level_string:s,bit_depth:h,chroma_format:c,chroma_format_string:t.getChromaFormatString(c),frame_rate:{fixed:A,fps:x,fps_den:L,fps_num:D},par_ratio:{width:C,height:T},codec_size:{width:I,height:M},present_size:{width:j,height:M}}}},{key:"_skipScalingList",value:function(t,e){for(var n=8,i=8,r=0;r<e;r++)0!==i&&(i=(n+t.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(t){var e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},e.frameRate=t.frame_rate;var n=e.frameRate.fps_den,i=e.frameRate.fps_num;return e.refSampleDuration=Math.floor(e.timescale*(n/i)),e}}]),t}(),rt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ot=function(){function t(){u(this,t)}return rt(t,null,[{key:"EBSP2RBSP",value:function(t){return t.filter(function(e,n){return n<2||!(0===t[n-2]&&0===t[n-1]&&3===e)})}},{key:"EBSP2SODB",value:function(t){var e=t[t.byteLength-1];return e&&128===e?t.slice(0,t.byteLength-1):t}}]),t}(),at=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),st=function(t){for(var e="",n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return e},ut=function(){function t(){c(this,t)}return at(t,null,[{key:"_resolveNalu",value:function(t){return t.length>=1?ot.EBSP2SODB(ot.EBSP2RBSP(t.slice(1))):null}},{key:"parse",value:function(e){var n=t._resolveNalu(e),i=t.switchPayloadType(n),r=i.payloadType,o=i.offset,a=n.slice(o);switch(r){case 5:return t.user_data_unregistered(a);default:return{code:r,content:a}}}},{key:"switchPayloadType",value:function(t){for(var e=new DataView(t.buffer),n=0,i=0;255===e.getUint8(i);)i++,n+=255;return n+=e.getUint8(i++),{payloadType:n,offset:i}}},{key:"getPayloadLength",value:function(t){for(var e=new DataView(t.buffer),n=0,i=0;255===e.getUint8(i);)i++,n+=255;return n+=e.getUint8(i++),{payloadLength:n,offset:i}}},{key:"user_data_unregistered",value:function(e){var n=t.getPayloadLength(e),i=n.payloadLength,r=n.offset;if(i<16)return{uuid:"",content:null};var o=e.slice(r);return{code:5,uuid:st(o.slice(0,16)),content:st(o.slice(16,i))}}}]),t}(),ct=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),lt=function(){function t(){l(this,t)}return ct(t,null,[{key:"getNalunits",value:function(e){if(e.length-e.position<4)return[];var n=e.dataview,i=e.position;return 1===n.getInt32(i)||0===n.getInt16(i)&&1===n.getInt8(i+2)?t.getAnnexbNals(e):t.getAvccNals(e)}},{key:"getAnnexbNals",value:function(e){for(var n=[],i=t.getHeaderPositionAnnexB(e),r=i.pos,o=r;r<e.length-4;){var a=e.buffer.slice(r,r+i.headerLength);i.pos===e.position&&e.skip(i.headerLength),o=(i=t.getHeaderPositionAnnexB(e)).pos;var s={header:a,body:new Uint8Array(e.buffer.slice(r+a.byteLength,o))};t.analyseNal(s),s.type<=9&&0!==s.type&&n.push(s),e.skip(o-e.position),r=o}return n}},{key:"getAvccNals",value:function(e){for(var n=[];e.position<e.length-4;){var i=e.dataview.getInt32(e.dataview.position);if(!(e.length-e.position>=i))break;var r=e.buffer.slice(e.position,e.position+4);e.skip(4);var o=new Uint8Array(e.buffer.slice(e.position,e.position+i));e.skip(i);var a={header:r,body:o};t.analyseNal(a),a.type<=9&&0!==a.type&&n.push(a)}return n}},{key:"analyseNal",value:function(t){var e=31&t.body[0];switch(t.type=e,e){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:t.sei=ut.parse(t.body);break;case 7:t.sps=it.parseSPS(t.body);break;case 8:t.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(t){for(var e=t.position,n=0,i=t.length;3!==n&&4!==n&&e<i-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?n=4:1===t.dataview.getInt8(e+2)?n=3:e++:e++;return e===i-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(n=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?n=3:e=i)),{pos:e,headerLength:n}}},{key:"getAvcc",value:function(t,e){var n=new Uint8Array(t.byteLength+e.byteLength+11);n[0]=1,n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=255,n[5]=225;var i=6;return n.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),i),i+=2,n.set(t,i),i+=t.byteLength,n[i]=1,i++,n.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),i),i+=2,n.set(e,i),n}}]),t}(),ht=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ft=function(){function t(e){h(this,t),this.configs=Object.assign({},e),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this.chroma=this.meta.chromaFormat,this.height=this.meta.presentHeight,this.width=this.meta.presentWidth,this.canvas.width=this.meta.presentWidth,this.canvas.height=this.meta.presentHeight,this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return ht(t,[{key:"_initContextGL",value:function(){for(var t=this.canvas,e=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!e&&i<n.length;){var r=n[i];try{e=this.contextOptions?t.getContext(r,this.contextOptions):t.getContext(r)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++i}this.contextGL=e}},{key:"_initProgram",value:function(){var t,e,n=this.contextGL;t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),e=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var i=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1],r=n.createShader(n.VERTEX_SHADER);n.shaderSource(r,t),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+n.getShaderInfoLog(r));var o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(o,e),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+n.getShaderInfoLog(o));var a=n.createProgram();n.attachShader(a,r),n.attachShader(a,o),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||console.log("Program failed to compile: "+n.getProgramInfoLog(a)),n.useProgram(a);var s=n.getUniformLocation(a,"YUV2RGB");n.uniformMatrix4fv(s,!1,i),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var t=this.contextGL,e=this.shaderProgram,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var i=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var o=t.getAttribLocation(e,"texturePos");t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.texturePosBuffer=r;var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"uTexturePos");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),this.uTexturePosBuffer=a;var u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var c=t.getAttribLocation(e,"vTexturePos");t.enableVertexAttribArray(c),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var t=this.contextGL,e=this.shaderProgram,n=this._initTexture(),i=t.getUniformLocation(e,"ySampler");t.uniform1i(i,0),this.yTextureRef=n;var r=this._initTexture(),o=t.getUniformLocation(e,"uSampler");t.uniform1i(o,1),this.uTextureRef=r;var a=this._initTexture(),s=t.getUniformLocation(e,"vSampler");t.uniform1i(s,2),this.vTextureRef=a}},{key:"_initTexture",value:function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e}},{key:"_drawPictureGL",value:function(t,e,n,i,r){var o=i*n,a=r*n/2;444!==this.chroma&&422!==this.chroma||(a*=2);var s={yData:(t=new Uint8Array(t)).subarray(0,o),uData:t.subarray(o,o+a),vData:t.subarray(o+a,o+a+a)};this._drawPictureGL420(s,e,n,i,r)}},{key:"_drawPictureGL420",value:function(t,e,n,i,r){var o=this.contextGL,a=this.texturePosBuffer,s=this.uTexturePosBuffer,u=this.vTexturePosBuffer,c=this.yTextureRef,l=this.uTextureRef,h=this.vTextureRef,f=t.yData,d=t.uData,p=t.vData,v=i,y=n,m=e/2,g=n/2;422!==this.chroma&&444!==this.chroma||(g=n);var b=r,w=g,_=this.canvas.width/this.width,E=this.canvas.height/this.height,k=0,C=0,T=this.canvas.width,x=this.canvas.height;_<E?(x=this.height*this.canvas.width/this.width,C=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(T=this.width*this.canvas.height/this.height,k=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),o.viewport(k,C,T,x);var A=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferData(o.ARRAY_BUFFER,A,o.DYNAMIC_DRAW);var D=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,D,o.DYNAMIC_DRAW);var L=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,L,o.DYNAMIC_DRAW),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,c),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,v,y,0,o.LUMINANCE,o.UNSIGNED_BYTE,f),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,l),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,m,g,0,o.LUMINANCE,o.UNSIGNED_BYTE,d),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,h),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,b,w,0,o.LUMINANCE,o.UNSIGNED_BYTE,p),o.drawArrays(o.TRIANGLE_STRIP,0,4)}},{key:"_drawPictureRGB",value:function(t){}},{key:"render",value:function(t,e,n,i,r){this.contextGL?this._drawPictureGL(t,e,n,i,r):this._drawPictureRGB(t)}}]),t}(),dt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),pt=function(){function t(e){f(this,t),this.config=Object.assign({},e),this.type=this.config.type,this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}return dt(t,[{key:"push",value:function(t){if("video"===this.type){if(t.isKeyframe){var e={samples:[],start:t.dts,end:t.dts,nextGop:void 0};this.currentGop&&(this.currentGop.nextGop=e),this.currentGop=e,this.buffer.push(this.currentGop)}this.currentGop&&(this.currentGop.samples.push(t),t.dts<this.currentGop.start&&(this.currentGop.start=t.dts),t.dts>this.currentGop.end&&(this.currentGop.end=t.dts))}}},{key:"get",value:function(t){if("video"===this.type){if(this.buffer.length<1)return;if(void 0===t)return this._getNext()}}},{key:"_getNext",value:function(){if(this._lastGet){var t=this._lastGet.gop,e=t.samples[this._lastGet.index+1];if(e)return this._lastGet.index=this._lastGet.index+1,e;if(!(t=t.nextGop)||t.samples.length<1)return;return e=t.samples[0],this._lastGet={gop:t,index:0},e}var n=this.buffer[0];if(!(n.samples.length<1))return this._lastGet={gop:n,index:0},n.samples[0]}},{key:"remove",value:function(t,e){if(!(this.buffer.length<0))for(var n=0,i=this.buffer[0];i;)i.end<e&&i.start>=t?(this.buffer.splice(n,1),i=this.buffer[n]):(n+=1,i=this.buffer[n])}}]),t}(),vt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),yt=function(){function t(e){d(this,t),this.ranges=e||[]}return vt(t,[{key:"start",value:function(t){return this.ranges[t]?this.ranges[t].start:0}},{key:"end",value:function(t){return this.ranges[t]?this.ranges[t].end:0}},{key:"add",value:function(t){this.ranges.push(t)}},{key:"length",get:function(){return this.ranges.length}}]),t}(),mt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),gt=function(){function t(e){p(this,t),this.config=Object.assign({},e),this.canvas=this.config.canvas?this.config.canvas:document.createElement("canvas"),this.source=new pt({type:"video"}),this.preloadTime=this.config.preloadTime||3,this.oncanplay=void 0,this.onFirstFrame=void 0,this.meta=void 0,this.readyStatus=0,this.paused=!0,this.count=0,this.currentTime=0,this.lastPlayed=0,this._decoderInited=!1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null,this.canvas.style.maxWidth="100%",this.canvas.style.maxHeight="100%",this.canvas.style.top=0,this.canvas.style.bottom=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.margin="auto",this.canvas.style.position="absolute"}return mt(t,[{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){var t=this,e=this;this.wasmworker=new $,this.wasmworker.postMessage({msg:"init",meta:this.meta}),this.wasmworker.addEventListener("message",function(n){switch(n.data.msg){case"DECODER_READY":e._decoderInited=!0;break;case"DECODED":t._onDecoded(n.data)}})}},{key:"setVideoMetaData",value:function(t){if(this.meta=t,!this._decoderInited)return void this.initWasmWorker();this._avccpushed=!0;var e=new Uint8Array(t.sps.byteLength+4);if(e.set([0,0,0,1]),e.set(t.sps,4),this.wasmworker.postMessage({msg:"decode",data:e}),(e=new Uint8Array(t.pps.byteLength+4)).set([0,0,0,1]),e.set(t.pps,4),this.wasmworker.postMessage({msg:"decode",data:e}),!this.yuvCanvas){var n=Object.assign({meta:t,canvas:this.canvas},this.config);this.yuvCanvas=new ft(n)}this.readyStatus=1}},{key:"decodeVideo",value:function(t){if(this._decoderInited){this._avccpushed||this.setVideoMetaData(this.meta);for(var e=t.samples,n=e.shift();n;)this._baseDts||(this._baseDts=n.dts),this.source.push(n),n=e.shift();this._preload()}}},{key:"_preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime){var t=this.source.get();for(t&&(this._lastSampleDts=t.dts,this._analyseNal(t));t&&this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.preloadTime;)(t=this.source.get())&&(this._analyseNal(t),this._lastSampleDts=t.dts)}}},{key:"_analyseNal",value:function(t){for(var e=lt.getAvccNals(new Q(t.data.buffer)),n=0,i=0;i<e.length;i++)n+=e[i].body.byteLength+4;for(var r=0,o=new Uint8Array(n),a=0;a<e.length;a++){var s=e[a];o.set([0,0,0,1],r),r+=4,o.set(new Uint8Array(s.body),r),r+=s.body.byteLength}this.wasmworker.postMessage({msg:"decode",data:o,info:{dts:t.dts,pts:t.pts?t.pts:t.dts+t.cts,key:t.isKeyframe}})}},{key:"_onDecoded",value:function(t){var e=t.info.dts;this._decodedFrames[e]=t,Object.keys(this._decodedFrames).length>10&&(this.playFinish&&this.playFinish(),this.oncanplay&&this.oncanplay())}},{key:"play",value:function(){var t=this;return this.paused=!1,new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null})}},{key:"_onTimer",value:function(t){if(this.paused)return!1;if(this.meta){this.meta.frameRate&&this.meta.frameRate.fixed&&this.meta.frameRate.fps;var e=Object.keys(this._decodedFrames);if(e.length>0){this.currentTime=t;for(var n=-1,i=0;i<e.length&&Number.parseInt(e[i])-this._baseDts<=this.currentTime;i++)n=Number.parseInt(e[i-1]);var r=this._decodedFrames[n];if(r){this.yuvCanvas.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize);for(var o=0;o<e.length;o++)Number.parseInt(e[o])<n&&delete this._decodedFrames[e[o]];return!0}return!1}}this._lastRenderTime=Date.now()}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1)}},{key:"destroy",value:function(){this.wasmworker.postMessage({msg:"destroy"}),this.wasmworker=null,this.canvas=null,this.source=null,this._decoderInited=!1}},{key:"buffered",get:function(){for(var t=[],e={start:null,end:null},n=0;n<this.source.buffer.length;n++){var i=this.source.buffer[n],r=i.start,o=i.end;e.start||(e.start=r),e.end||(e.end=o),r-e.end>1e3?(e.start=e.start/1e3,e.end=e.end/1e3,e={start:r,end:o}):e.end=o}return null!==e.start&&null!==e.end&&(e.start=(e.start-this._baseDts)/1e3,e.end=(e.end-this._baseDts)/1e3,t.push(e)),new yt(t)}},{key:"videoWidth",get:function(){return this.canvas.width}},{key:"videoHeight",get:function(){return this.canvas.height}}]),t}();v.prototype=Object.create(null),y.EventEmitter=y,y.usingDomains=!1,y.prototype.domain=void 0,y.prototype._events=void 0,y.prototype._maxListeners=void 0,y.defaultMaxListeners=10,y.init=function(){this.domain=null,y.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new v,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},y.prototype.getMaxListeners=function(){return m(this)},y.prototype.emit=function(t){var e,n,i,r,o,a,s,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(e=arguments[1],!s){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=s,e.domainThrown=!1,s.emit("error",e),!1}if(!(n=a[t]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:g(n,l,this);break;case 2:b(n,l,this,arguments[1]);break;case 3:w(n,l,this,arguments[1],arguments[2]);break;case 4:_(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];E(n,l,this,r)}return!0},y.prototype.addListener=function(t,e){return k(this,t,e,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(t,e){return k(this,t,e,!0)},y.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,T(this,t,e)),this},y.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,T(this,t,e)),this},y.prototype.removeListener=function(t,e){var n,i,r,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new v:(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){a=n[o].listener,r=o;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new v,this;delete i[t]}else A(n,r);i.removeListener&&this.emit("removeListener",t,a||e)}return this},y.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new v,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new v:delete n[t]),this;if(0===arguments.length){for(var i,r=Object.keys(n),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new v,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},y.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:L(e):[]},y.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):x.call(t,e)},y.prototype.listenerCount=x,y.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var bt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),wt=function(t){function e(t){B(this,e);var n=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.config=Object.assign({},t);var i=window.AudioContext||window.webkitAudioContext;return n.context=new i,n.gainNode=n.context.createGain(),n.gainNode.connect(n.context.destination),n.meta=void 0,n.samples=[],n.preloadTime=n.config.preloadTime||3,n.duration=0,n._currentBuffer=void 0,n._nextBuffer=void 0,n._lastpts=void 0,n._preDecode=[],n._currentTime=0,n._decoding=!1,n._volume=Number.parseInt(n.config.volume)===n.config.volume?n.config.volume:.6,n.gainNode.gain.value=n._volume,n._played=!1,n.paused=!0,n.playFinish=null,n.waitNextID=null,n}return R(e,t),bt(e,[{key:"decodeAudio",value:function(t){var e=t.samples,n=t.meta,i=e;t.samples=[],n&&this.setAudioData(i)}},{key:"setAudioData",value:function(t){for(var e=0;e<t.length;e++)t[e].pts=void 0===t[e].pts?t[e].dts:t[e].pts,this._preDecode.push(t[e]);this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(!this._decoding){this._decoding=!0;for(var t=this._preDecode,n=[],i=this,r=t.shift();r;){var o=e.getAACData(this.meta,r);n.push(o),this._lastpts=r.pts,r=t.shift()}var a=e.combileData(n);try{this.context.decodeAudioData(a.buffer,function(t){var e=i.context.createBufferSource();e.buffer=t,i.samples.push({time:i.duration,duration:t.duration,data:e}),i.duration+=t.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime)),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC(),i.playFinish&&i.playFinish()},function(t){console.error(t)})}catch(t){console.error(t)}}}},{key:"onSourceEnded",value:function(){var t=this;if(!this.paused){if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(function(){t.onSourceEnded()},200));var e=this._nextBuffer.data;e.start(),e.connect(this.gainNode);var n=this;setTimeout(function(){n.onSourceEnded.call(t)},1e3*e.buffer.duration-10),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}}},{key:"play",value:function(){var t=this;if(!this.playFinish){this._played=!0,"suspended"===this.context.state&&this.context.resume();var e=this,n=function(){var n=t._currentBuffer.data;n.start(),n.connect(t.gainNode),t.paused=!1,setTimeout(function(){e.onSourceEnded.call(t)},1e3*n.buffer.duration-20)};return this._currentBuffer?(n(),Promise.resolve()):new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null,n()})}}},{key:"pause",value:function(){var t=this.context;"running"===t.state&&t.suspend(),this.paused=!0}},{key:"getTimeBuffer",value:function(t){for(var e=void 0,n=0;n<this.samples.length;n++){var i=this.samples[n];if(i.time<=t&&i.time+i.duration>t){e=i;break}}return e}},{key:"setAudioMetaData",value:function(t){this.meta=t}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this.paused=!0,this.context.close()}},{key:"mute",value:function(){this.gainNode.gain.value=0}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(t){this.gainNode.gain.value=t?0:this._volume,"suspended"!==this.context.state||this.paused||this.context.resume()}},{key:"volume",get:function(){return"suspended"===this.context.state||this.paused||this.muted?0:this._volume},set:function(t){return t<0?(this._volume=0,void(this.gainNode.gain.value=0)):t>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=t,void(this.gainNode.gain.value=t))}}],[{key:"getAACData",value:function(t,n){var i=new Uint8Array(n.data.byteLength+7),r=e.getAdts(t,n.data);return i.set(r),i.set(n.data,7),i}},{key:"combileData",value:function(t){for(var e=0,n=0,i=t.length;n<i;n++)e+=t[n].byteLength;for(var r=new Uint8Array(e),o=0,a=0,s=t.length;a<s;a++)r.set(t[a],o),o+=t[a].byteLength;return r}},{key:"getAdts",value:function(t,e){var n=new Uint8Array(7);n[0]=255,n[1]=240,n[1]=1|n[1],n[2]=192&t.objectType-1<<6,n[2]=n[2]|60&t.sampleRateIndex<<2,n[2]=n[2]|1&t.channelCount>>2,n[3]=192&t.channelCount<<6;var i=e.byteLength+7;return n[3]=n[3]|3&i>>11,n[4]=255&i>>3,n[5]=224&i<<5,n[5]=31|n[5],n[6]=252,n}}]),e}(y),_t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Et=function(){function t(e){P(this,t),this.aCtx=e.aCtx,this.vCtx=e.vCtx,this.video=e.video,this.timeoutId=null,this.start=null}return _t(t,[{key:"doReconcile",value:function(){var t=this,e=this.vCtx.currentTime||0,n=void 0,i=e-(n=this.video.noAudio?e:this.aCtx.currentTime||0);this.timeoutId||(i>200?(this.video.start+=i,this.vCtx.pause(),this.timeoutId=setTimeout(function(){t.vCtx.play(),t.timeoutId=null},i)):i<-120&&(this.video.start+=i))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null}}]),t}(),kt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ct=function(t){function e(){U(this,e);var t=N(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._canvas=document.createElement("canvas"),t.handleAudioSourceEnd=t.handleAudioSourceEnd.bind(t),t.played=!1,t.pendingPlayTask=null,t._waiting=!1,t._paused=!0,t.videoMetaInited=!1,t.audioMetaInited=!1,t.init(),t}return O(e,t),kt(e,null,[{key:"resolveVideoGOP",value:function(t){var e=t.samples;if(e.length){var n=null,i=null;t.tempSamples&&t.tempSamples.length&&e.unshift.apply(e,t.tempSamples);for(var r=0,o=e.length;r<o;r++)if(e[r].isKeyframe){n=r;break}for(var a=e.length-1;a>0;a++)if(e[a].isKeyframe){i=a;break}0!==n&&e.splice(0,n-1),t.samples=e.slice(0,i);var s=e.slice(i);t.tempSamples?t.tempSamples.push.apply(t.tempSamples,s):t.tempSamples=s}}}]),kt(e,[{key:"init",value:function(){var t=this,e=this.getAttribute("volume"),n=this.muted?0:e;this.vCtx=new gt(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}})),this.noAudio||(this.aCtx=new wt({volume:n})),this.ticker=new(W()),this.reconciler=new Et({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.dispatchEvent(new Event("waiting")),this.vCtx.oncanplay=function(){t.played||t.appendChild(t._canvas),t.dispatchEvent(new Event("canplay"))},this.noAudio||this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"destroy",value:function(){this.videoMetaInited=!1,this.audioMetaInited=!1,this.noAudio||(this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd),this.aCtx.destroy()),this.vCtx.destroy(),this.ticker.stop(),this.start=null,this.reconciler.destroy(),this.aCtx=null,this.vCtx=null,this.ticker=null}},{key:"onDemuxComplete",value:function(t,e){this.noAudio||this.aCtx.decodeAudio(e),this.vCtx.decodeVideo(t)}},{key:"setAudioMeta",value:function(t){this.noAudio||(this.audioMetaInited&&(this.aCtx.destroy(),this.aCtx=new wt({})),this.aCtx.setAudioMetaData(t),this.audioMetaInited=!0)}},{key:"setVideoMeta",value:function(t){this.videoMetaInited&&(this.vCtx.destroy(),this.vCtx=new gt(Object.assign({canvas:this._canvas},{style:{width:this.width,height:this.height}}))),this.vCtx.setVideoMetaData(t),this.videoMetaInited=!0}},{key:"play",value:function(){var t=this;if(!this.pendingPlayTask){this.played&&(this.destroy(),this.init());var e=null;e=this.noAudio?Promise.resolve():this.aCtx.play(),this.pendingPlayTask=Promise.all([this.vCtx.play(),e.then(function(){})]).then(function(){t.ticker.start(function(){t.start||(t.start=Date.now());var e=t._currentTime;t._currentTime=Date.now()-t.start,t.vCtx._onTimer(t._currentTime)?(t._waiting&&(t.dispatchEvent(new Event("playing")),t._waiting=!1),t.dispatchEvent(new Event("timeupdate"))):(t._currentTime=e,t._waiting||(t._waiting=!0,t.dispatchEvent(new Event("waiting")))),t.noAudio&&t.vCtx.cleanBuffer()}),t.pendingPlayTask=null,t.played=!0,t.dispatchEvent(new Event("playing")),t.dispatchEvent(new Event("play")),t._paused=!1})}}},{key:"pause",value:function(){this._paused=!0,this.noAudio||this.aCtx.pause(),this.vCtx.pause(),this.dispatchEvent(new Event("pause"))}},{key:"load",value:function(){}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("width",e),this.style.width=e,this._canvas.width=t}},{key:"height",get:function(){return this.getAttribute("height")},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("height",e),this.style.height=e,this._canvas.height=t}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(t){this.setAttribute("src",t)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(t){this.setAttribute("playbackrate",t),this.noAudio||(this.aCtx.playbackRate=t),this.vCtx.playbackRate=t,this.dispatchEvent(new Event("ratechange"))}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&this.getAttribute("autoplay")},set:function(t){this.setAttribute("autoplay",t)}},{key:"volume",get:function(){return this.noAudio?0:this.aCtx.volume},set:function(t){this.noAudio||(this.setAttribute("volume",t),this.aCtx.volume=t,t>0&&this.muted&&this.aCtx.mute(),this.dispatchEvent(new Event("volumechange")))}},{key:"muted",get:function(){var t="true"===this.getAttribute("muted");return void 0!==t?t:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(t){this.noAudio||(this.setAttribute("muted",t),this.aCtx.muted=!!t,this.dispatchEvent(new Event("volumechange")))}},{key:"error",get:function(){return this.vCtx.error||(this.noAudio?null:this.aCtx.error)}},{key:"buffered",get:function(){return this.vCtx.buffered}},{key:"noAudio",get:function(){return"true"===this.getAttribute("noaudio")}}]),e}(HTMLElement);customElements.define("mobile-video",Ct)});
//# sourceMappingURL=index.min.js.map
