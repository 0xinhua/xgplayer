!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return!(t<20||t>80)}function r(t,e){return function(n){var i=this;if(!e)return new Y(t);if(Y&&!n){var r=o(`${e}`.replace(/^function.+?{/,"").slice(0,-1));return this[W]=new Y(r),H.revokeObjectURL(r),this[W]}var a={postMessage:t=>{i.onmessage&&setTimeout(()=>i.onmessage({data:t,target:a}))}};e.call(a),this.postMessage=(t=>{setTimeout(()=>a.onmessage({data:t,target:i}))}),this.isThisThread=!0}}function o(t){try{return H.createObjectURL(new Blob([t],{type:G}))}catch(n){var e=new V;return e.append(t),H.createObjectURL(e.getBlob(type))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(){}function l(){l.init.call(this)}function h(t){return void 0===t._maxListeners?l.defaultMaxListeners:t._maxListeners}function d(t,e,n){if(e)t.call(n);else for(var i=t.length,r=E(t,i),o=0;o<i;++o)r[o].call(n)}function f(t,e,n,i){if(e)t.call(n,i);else for(var r=t.length,o=E(t,r),a=0;a<r;++a)o[a].call(n,i)}function p(t,e,n,i,r){if(e)t.call(n,i,r);else for(var o=t.length,a=E(t,o),s=0;s<o;++s)a[s].call(n,i,r)}function m(t,e,n,i,r,o){if(e)t.call(n,i,r,o);else for(var a=t.length,s=E(t,a),u=0;u<a;++u)s[u].call(n,i,r,o)}function v(t,e,n,i){if(e)t.apply(n,i);else for(var r=t.length,o=E(t,r),a=0;a<r;++a)o[a].apply(n,i)}function y(t,e,n,i){var r,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(o=t._events,o?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]):(o=t._events=new c,t._eventsCount=0),a){if("function"==typeof a?a=o[e]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(r=h(t))&&r>0&&a.length>r){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,g(s)}}else a=o[e]=n,++t._eventsCount;return t}function g(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function _(t,e,n){function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}var r=!1;return i.listener=n,i}function b(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function w(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}function E(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function k(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function O(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function F(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(function(){function t(t){var e=ft.has(t);return t=/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t),!e&&t}function e(t){var e=t.isConnected;if(void 0!==e)return e;if(pt(t))return!0;for(;t&&!(t.__CE_isImportDocument||t instanceof Document);)t=t.parentNode||(window.ShadowRoot&&t instanceof ShadowRoot?t.host:void 0);return!(!t||!(t.__CE_isImportDocument||t instanceof Document))}function n(t){var e=t.children;if(e)return Array.prototype.slice.call(e);for(e=[],t=t.firstChild;t;t=t.nextSibling)t.nodeType===Node.ELEMENT_NODE&&e.push(t);return e}function i(t,e){for(;e&&e!==t&&!e.nextSibling;)e=e.parentNode;return e&&e!==t?e.nextSibling:null}function r(t,e,n){for(var o=t;o;){if(o.nodeType===Node.ELEMENT_NODE){var a=o;e(a);var s=a.localName;if("link"===s&&"import"===a.getAttribute("rel")){if(o=a.import,void 0===n&&(n=new Set),o instanceof Node&&!n.has(o))for(n.add(o),o=o.firstChild;o;o=o.nextSibling)r(o,e,n);o=i(t,a);continue}if("template"===s){o=i(t,a);continue}if(a=a.__CE_shadowRoot)for(a=a.firstChild;a;a=a.nextSibling)r(a,e,n)}o=o.firstChild?o.firstChild:i(t,o)}}function o(t,e,n){t[e]=n}function a(t){var e=document;this.c=t,this.a=e,this.b=void 0,k(this.c,this.a),"loading"===this.a.readyState&&(this.b=new MutationObserver(this.f.bind(this)),this.b.observe(this.a,{childList:!0,subtree:!0}))}function s(t){t.b&&t.b.disconnect()}function u(){var t=this;this.b=this.a=void 0,this.c=new Promise(function(e){t.b=e,t.a&&e(t.a)})}function c(t){if(t.a)throw Error("Already resolved.");t.a=void 0,t.b&&t.b(void 0)}function l(t){this.f=new Map,this.g=new Map,this.l=new Map,this.i=!1,this.b=t,this.j=new Map,this.c=function(t){return t()},this.a=!1,this.h=[],this.m=t.f?new a(t):void 0}function h(e,n){if(!t(n))throw new SyntaxError("The element name '"+n+"' is not valid.");if(p(e,n))throw Error("A custom element with name '"+n+"' has already been defined.");if(e.i)throw Error("A custom element is already being defined.")}function d(t,e,n){t.i=!0;var i;try{var r=function(t){var e=o[t];if(void 0!==e&&!(e instanceof Function))throw Error("The '"+t+"' callback must be a function.");return e},o=n.prototype;if(!(o instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var a=r("connectedCallback"),s=r("disconnectedCallback"),u=r("adoptedCallback"),c=(i=r("attributeChangedCallback"))&&n.observedAttributes||[]}catch(t){throw t}finally{t.i=!1}return n={localName:e,constructorFunction:n,connectedCallback:a,disconnectedCallback:s,adoptedCallback:u,attributeChangedCallback:i,observedAttributes:c,constructionStack:[]},t.g.set(e,n),t.l.set(n.constructorFunction,n),n}function f(t){if(!1!==t.a){t.a=!1;for(var e=[],n=t.h,i=new Map,r=0;r<n.length;r++)i.set(n[r],[]);for(k(t.b,document,{upgrade:function(n){if(void 0===n.__CE_state){var r=n.localName,o=i.get(r);o?o.push(n):t.g.has(r)&&e.push(n)}}}),r=0;r<e.length;r++)T(t.b,e[r]);for(r=0;r<n.length;r++){for(var o=n[r],a=i.get(o),s=0;s<a.length;s++)T(t.b,a[s]);(o=t.j.get(o))&&c(o)}n.length=0}}function p(t,e){var n=t.g.get(e);if(n)return n;if(n=t.f.get(e)){t.f.delete(e);try{return d(t,e,n())}catch(t){x(t)}}}function m(){var t=vt&&vt.noDocumentConstructionObserver,e=vt&&vt.shadyDomFastWalk;this.b=[],this.c=[],this.a=!1,this.shadyDomFastWalk=e,this.f=!t}function v(t,e,n,i){var o=window.ShadyDOM;if(t.shadyDomFastWalk&&o&&o.inUse){if(e.nodeType===Node.ELEMENT_NODE&&n(e),e.querySelectorAll)for(t=o.nativeMethods.querySelectorAll.call(e,"*"),e=0;e<t.length;e++)n(t[e])}else r(e,n,i)}function y(t,e){t.a=!0,t.b.push(e)}function g(t,e){t.a=!0,t.c.push(e)}function _(t,e){t.a&&v(t,e,function(e){return b(t,e)})}function b(t,e){if(t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var n=0;n<t.b.length;n++)t.b[n](e);for(n=0;n<t.c.length;n++)t.c[n](e)}}function w(t,e){var n=[];for(v(t,e,function(t){return n.push(t)}),e=0;e<n.length;e++){var i=n[e];1===i.__CE_state?t.connectedCallback(i):T(t,i)}}function E(t,e){var n=[];for(v(t,e,function(t){return n.push(t)}),e=0;e<n.length;e++){var i=n[e];1===i.__CE_state&&t.disconnectedCallback(i)}}function k(t,e,n){var i=(n=void 0===n?{}:n).s,r=n.upgrade||function(e){return T(t,e)},o=[];for(v(t,e,function(e){if(t.a&&b(t,e),"link"===e.localName&&"import"===e.getAttribute("rel")){var n=e.import;n instanceof Node&&(n.__CE_isImportDocument=!0,n.__CE_registry=document.__CE_registry),n&&"complete"===n.readyState?n.__CE_documentLoadHandled=!0:e.addEventListener("load",function(){var n=e.import;if(!n.__CE_documentLoadHandled){n.__CE_documentLoadHandled=!0;var o=new Set;i&&(i.forEach(function(t){return o.add(t)}),o.delete(n)),k(t,n,{s:o,upgrade:r})}})}else o.push(e)},i),e=0;e<o.length;e++)r(o[e])}function T(t,n){try{var i=n.ownerDocument,r=i.__CE_registry,o=r&&(i.defaultView||i.__CE_isImportDocument)?p(r,n.localName):void 0;if(o&&void 0===n.__CE_state){o.constructionStack.push(n);try{try{if(new o.constructorFunction!==n)throw Error("The custom element constructor did not produce the element being upgraded.")}finally{o.constructionStack.pop()}}catch(t){throw n.__CE_state=2,t}if(n.__CE_state=1,n.__CE_definition=o,o.attributeChangedCallback&&n.hasAttributes()){var a=o.observedAttributes;for(o=0;o<a.length;o++){var s=a[o],u=n.getAttribute(s);null!==u&&t.attributeChangedCallback(n,s,null,u,null)}}e(n)&&t.connectedCallback(n)}}catch(t){x(t)}}function C(t,e,n,i){var r=e.__CE_registry;if(r&&(null===i||"http://www.w3.org/1999/xhtml"===i)&&(r=p(r,n)))try{var o=new r.constructorFunction;if(void 0===o.__CE_state||void 0===o.__CE_definition)throw Error("Failed to construct '"+n+"': The returned value was not constructed with the HTMLElement constructor.");if("http://www.w3.org/1999/xhtml"!==o.namespaceURI)throw Error("Failed to construct '"+n+"': The constructed element's namespace must be the HTML namespace.");if(o.hasAttributes())throw Error("Failed to construct '"+n+"': The constructed element must not have any attributes.");if(null!==o.firstChild)throw Error("Failed to construct '"+n+"': The constructed element must not have any children.");if(null!==o.parentNode)throw Error("Failed to construct '"+n+"': The constructed element must not have a parent node.");if(o.ownerDocument!==e)throw Error("Failed to construct '"+n+"': The constructed element's owner document is incorrect.");if(o.localName!==n)throw Error("Failed to construct '"+n+"': The constructed element's local name is incorrect.");return o}catch(r){return x(r),e=null===i?N.call(e,n):R.call(e,i,n),Object.setPrototypeOf(e,HTMLUnknownElement.prototype),e.__CE_state=2,e.__CE_definition=void 0,b(t,e),e}return e=null===i?N.call(e,n):R.call(e,i,n),b(t,e),e}function x(t){var e=t.message,n=t.sourceURL||t.fileName||"",i=t.line||t.lineNumber||0,r=t.column||t.columnNumber||0,o=void 0;void 0===ErrorEvent.prototype.initErrorEvent?o=new ErrorEvent("error",{cancelable:!0,message:e,filename:n,lineno:i,colno:r,error:t}):((o=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,e,n,i),o.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===o.error&&Object.defineProperty(o,"error",{configurable:!0,enumerable:!0,get:function(){return t}}),window.dispatchEvent(o),o.defaultPrevented||console.error(t)}function A(t){window.HTMLElement=function(){function e(){var e=this.constructor,n=document.__CE_registry.l.get(e);if(!n)throw Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var i=n.constructionStack;if(0===i.length)return i=N.call(document,n.localName),Object.setPrototypeOf(i,e.prototype),i.__CE_state=1,i.__CE_definition=n,b(t,i),i;var r=i.length-1,o=i[r];if(o===mt)throw Error("Failed to construct '"+n.localName+"': This element was already constructed.");return i[r]=mt,Object.setPrototypeOf(o,e.prototype),b(t,o),o}return e.prototype=ct.prototype,Object.defineProperty(e.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:e}),e}()}function D(t,n,i){function r(n){return function(i){for(var r=[],o=0;o<arguments.length;++o)r[o]=arguments[o];o=[];for(var a=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(n.apply(this,r),r=0;r<a.length;r++)E(t,a[r]);if(e(this))for(r=0;r<o.length;r++)(a=o[r])instanceof Element&&w(t,a)}}void 0!==i.prepend&&o(n,"prepend",r(i.prepend)),void 0!==i.append&&o(n,"append",r(i.append))}function O(t){o(Document.prototype,"createElement",function(e){return C(t,this,e,null)}),o(Document.prototype,"importNode",function(e,n){return e=F.call(this,e,!!n),this.__CE_registry?k(t,e):_(t,e),e}),o(Document.prototype,"createElementNS",function(e,n){return C(t,this,n,e)}),D(t,Document.prototype,{prepend:I,append:B})}function S(t){function i(n,i){Object.defineProperty(n,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){if(this.nodeType===Node.TEXT_NODE)i.set.call(this,n);else{var r=void 0;if(this.firstChild){var o=this.childNodes,a=o.length;if(0<a&&e(this)){r=Array(a);for(var s=0;s<a;s++)r[s]=o[s]}}if(i.set.call(this,n),r)for(n=0;n<r.length;n++)E(t,r[n])}}})}o(Node.prototype,"insertBefore",function(i,r){if(i instanceof DocumentFragment){var o=n(i);if(i=V.call(this,i,r),e(this))for(r=0;r<o.length;r++)w(t,o[r]);return i}return o=i instanceof Element&&e(i),r=V.call(this,i,r),o&&E(t,i),e(this)&&w(t,i),r}),o(Node.prototype,"appendChild",function(i){if(i instanceof DocumentFragment){var r=n(i);if(i=G.call(this,i),e(this))for(var o=0;o<r.length;o++)w(t,r[o]);return i}return r=i instanceof Element&&e(i),o=G.call(this,i),r&&E(t,i),e(this)&&w(t,i),o}),o(Node.prototype,"cloneNode",function(e){return e=W.call(this,!!e),this.ownerDocument.__CE_registry?k(t,e):_(t,e),e}),o(Node.prototype,"removeChild",function(n){var i=n instanceof Element&&e(n),r=H.call(this,n);return i&&E(t,n),r}),o(Node.prototype,"replaceChild",function(i,r){if(i instanceof DocumentFragment){var o=n(i);if(i=Y.call(this,i,r),e(this))for(E(t,r),r=0;r<o.length;r++)w(t,o[r]);return i}o=i instanceof Element&&e(i);var a=Y.call(this,i,r),s=e(this);return s&&E(t,r),o&&E(t,i),s&&w(t,i),a}),X&&X.get?i(Node.prototype,X):y(t,function(t){i(t,{enumerable:!0,configurable:!0,get:function(){for(var t=[],e=this.firstChild;e;e=e.nextSibling)e.nodeType!==Node.COMMENT_NODE&&t.push(e.textContent);return t.join("")},set:function(t){for(;this.firstChild;)H.call(this,this.firstChild);null!=t&&""!==t&&G.call(this,document.createTextNode(t))}})})}function L(t){function n(n){return function(i){for(var r=[],o=0;o<arguments.length;++o)r[o]=arguments[o];o=[];for(var a=[],s=0;s<r.length;s++){var u=r[s];if(u instanceof Element&&e(u)&&a.push(u),u instanceof DocumentFragment)for(u=u.firstChild;u;u=u.nextSibling)o.push(u);else o.push(u)}for(n.apply(this,r),r=0;r<a.length;r++)E(t,a[r]);if(e(this))for(r=0;r<o.length;r++)(a=o[r])instanceof Element&&w(t,a)}}var i=Element.prototype;void 0!==ot&&o(i,"before",n(ot)),void 0!==at&&o(i,"after",n(at)),void 0!==st&&o(i,"replaceWith",function(n){for(var i=[],r=0;r<arguments.length;++r)i[r]=arguments[r];r=[];for(var o=[],a=0;a<i.length;a++){var s=i[a];if(s instanceof Element&&e(s)&&o.push(s),s instanceof DocumentFragment)for(s=s.firstChild;s;s=s.nextSibling)r.push(s);else r.push(s)}for(a=e(this),st.apply(this,i),i=0;i<o.length;i++)E(t,o[i]);if(a)for(E(t,this),i=0;i<r.length;i++)(o=r[i])instanceof Element&&w(t,o)}),void 0!==ut&&o(i,"remove",function(){var n=e(this);ut.call(this),n&&E(t,this)})}function M(t){function n(n,i){Object.defineProperty(n,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){var r=this,o=void 0;if(e(this)&&(o=[],v(t,this,function(t){t!==r&&o.push(t)})),i.set.call(this,n),o)for(var a=0;a<o.length;a++){var s=o[a];1===s.__CE_state&&t.disconnectedCallback(s)}return this.ownerDocument.__CE_registry?k(t,this):_(t,this),n}})}function i(n,i){o(n,"insertAdjacentElement",function(n,r){var o=e(r);return n=i.call(this,n,r),o&&E(t,r),e(n)&&w(t,r),n})}function r(e,n){function i(e,n){for(var i=[];e!==n;e=e.nextSibling)i.push(e);for(n=0;n<i.length;n++)k(t,i[n])}o(e,"insertAdjacentHTML",function(t,e){if("beforebegin"===(t=t.toLowerCase())){var r=this.previousSibling;n.call(this,t,e),i(r||this.parentNode.firstChild,this)}else if("afterbegin"===t)r=this.firstChild,n.call(this,t,e),i(this.firstChild,r);else if("beforeend"===t)r=this.lastChild,n.call(this,t,e),i(r||this.firstChild,null);else{if("afterend"!==t)throw new SyntaxError("The value provided ("+String(t)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");r=this.nextSibling,n.call(this,t,e),i(this.nextSibling,r)}})}z&&o(Element.prototype,"attachShadow",function(e){if(e=z.call(this,e),t.a&&!e.__CE_patched){e.__CE_patched=!0;for(var n=0;n<t.b.length;n++)t.b[n](e)}return this.__CE_shadowRoot=e}),q&&q.get?n(Element.prototype,q):lt&&lt.get?n(HTMLElement.prototype,lt):g(t,function(t){n(t,{enumerable:!0,configurable:!0,get:function(){return W.call(this,!0).innerHTML},set:function(t){var e="template"===this.localName,n=e?this.content:this,i=R.call(document,this.namespaceURI,this.localName);for(i.innerHTML=t;0<n.childNodes.length;)H.call(n,n.childNodes[0]);for(t=e?i.content:i;0<t.childNodes.length;)G.call(n,t.childNodes[0])}})}),o(Element.prototype,"setAttribute",function(e,n){if(1!==this.__CE_state)return $.call(this,e,n);var i=K.call(this,e);$.call(this,e,n),n=K.call(this,e),t.attributeChangedCallback(this,e,i,n,null)}),o(Element.prototype,"setAttributeNS",function(e,n,i){if(1!==this.__CE_state)return Z.call(this,e,n,i);var r=Q.call(this,e,n);Z.call(this,e,n,i),i=Q.call(this,e,n),t.attributeChangedCallback(this,n,r,i,e)}),o(Element.prototype,"removeAttribute",function(e){if(1!==this.__CE_state)return J.call(this,e);var n=K.call(this,e);J.call(this,e),null!==n&&t.attributeChangedCallback(this,e,n,null,null)}),o(Element.prototype,"removeAttributeNS",function(e,n){if(1!==this.__CE_state)return tt.call(this,e,n);var i=Q.call(this,e,n);tt.call(this,e,n);var r=Q.call(this,e,n);i!==r&&t.attributeChangedCallback(this,n,i,r,e)}),ht?i(HTMLElement.prototype,ht):et&&i(Element.prototype,et),dt?r(HTMLElement.prototype,dt):nt&&r(Element.prototype,nt),D(t,Element.prototype,{prepend:it,append:rt}),L(t)}function P(){var t=new m;A(t),O(t),D(t,DocumentFragment.prototype,{prepend:j,append:U}),S(t),M(t),t=new l(t),document.__CE_registry=t,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:t})}var N=window.Document.prototype.createElement,R=window.Document.prototype.createElementNS,F=window.Document.prototype.importNode,I=window.Document.prototype.prepend,B=window.Document.prototype.append,j=window.DocumentFragment.prototype.prepend,U=window.DocumentFragment.prototype.append,W=window.Node.prototype.cloneNode,G=window.Node.prototype.appendChild,V=window.Node.prototype.insertBefore,H=window.Node.prototype.removeChild,Y=window.Node.prototype.replaceChild,X=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),z=window.Element.prototype.attachShadow,q=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),K=window.Element.prototype.getAttribute,$=window.Element.prototype.setAttribute,J=window.Element.prototype.removeAttribute,Q=window.Element.prototype.getAttributeNS,Z=window.Element.prototype.setAttributeNS,tt=window.Element.prototype.removeAttributeNS,et=window.Element.prototype.insertAdjacentElement,nt=window.Element.prototype.insertAdjacentHTML,it=window.Element.prototype.prepend,rt=window.Element.prototype.append,ot=window.Element.prototype.before,at=window.Element.prototype.after,st=window.Element.prototype.replaceWith,ut=window.Element.prototype.remove,ct=window.HTMLElement,lt=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),ht=window.HTMLElement.prototype.insertAdjacentElement,dt=window.HTMLElement.prototype.insertAdjacentHTML,ft=new Set;"annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ").forEach(function(t){return ft.add(t)});var pt=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);a.prototype.f=function(t){var e=this.a.readyState;for("interactive"!==e&&"complete"!==e||s(this),e=0;e<t.length;e++)for(var n=t[e].addedNodes,i=0;i<n.length;i++)k(this.c,n[i])},l.prototype.o=function(t,e){var n=this;if(!(e instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");h(this,t),this.f.set(t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return f(n)}))},l.prototype.define=function(t,e){var n=this;if(!(e instanceof Function))throw new TypeError("Custom element constructors must be functions.");h(this,t),d(this,t,e),this.h.push(t),this.a||(this.a=!0,this.c(function(){return f(n)}))},l.prototype.upgrade=function(t){k(this.b,t)},l.prototype.get=function(t){if(t=p(this,t))return t.constructorFunction},l.prototype.whenDefined=function(e){if(!t(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var n=this.j.get(e);if(n)return n.c;n=new u,this.j.set(e,n);var i=this.g.has(e)||this.f.has(e);return e=-1===this.h.indexOf(e),i&&e&&c(n),n.c},l.prototype.polyfillWrapFlushCallback=function(t){this.m&&s(this.m);var e=this.c;this.c=function(n){return t(function(){return e(n)})}},window.CustomElementRegistry=l,l.prototype.define=l.prototype.define,l.prototype.upgrade=l.prototype.upgrade,l.prototype.get=l.prototype.get,l.prototype.whenDefined=l.prototype.whenDefined,l.prototype.polyfillDefineLazy=l.prototype.o,l.prototype.polyfillWrapFlushCallback=l.prototype.polyfillWrapFlushCallback,m.prototype.connectedCallback=function(t){var e=t.__CE_definition;if(e.connectedCallback)try{e.connectedCallback.call(t)}catch(t){x(t)}},m.prototype.disconnectedCallback=function(t){var e=t.__CE_definition;if(e.disconnectedCallback)try{e.disconnectedCallback.call(t)}catch(t){x(t)}},m.prototype.attributeChangedCallback=function(t,e,n,i,r){var o=t.__CE_definition;if(o.attributeChangedCallback&&-1<o.observedAttributes.indexOf(e))try{o.attributeChangedCallback.call(t,e,n,i,r)}catch(t){x(t)}};var mt=new function(){},vt=window.customElements;vt&&!vt.forcePolyfill&&"function"==typeof vt.define&&"function"==typeof vt.get||P(),window.__CE_installPolyfill=P}).call(self),function(){if(void 0!==window.Reflect&&void 0!==window.customElements&&!window.customElements.polyfillWrapFlushCallback){var t=HTMLElement,e={HTMLElement:function(){return Reflect.construct(t,[],this.constructor)}};window.HTMLElement=e.HTMLElement,HTMLElement.prototype=t.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,t)}}();var I=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},B=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),j=30,U=function(){function t(e){n(this,t),this.options=Object.assign({},e||{}),this.options.interval&&i(1e3/this.options.interval)||(this.options.interval=1e3/30),this.callbacks=[]}return B(t,[{key:"start",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.callbacks=e}},{key:"onTick",value:function(){for(var t=0,e=this.callbacks.length;t<e;t++)(0,this.callbacks[t])()}},{key:"setInterval",value:function(t){return i(1e3/t)||(t=1e3/30),this.options.interval=t,this}}]),t}(),W=(function(i){function r(e){n(this,r);var i=t(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return i.prev=null,i.timerId=null,i._subTimerId=null,i._tickFunc=r.getTickFunc(),i.tick=i.tick.bind(i),i}e(r,i),B(r,[{key:"start",value:function(){for(var t,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=I(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"start",this)).call.apply(t,[this].concat(n)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var t=this._tickFunc;this.timerId=t(this.tick)}},{key:"stop",value:function(){this.timerId&&r.getCancelFunc()(this.timerId)}},{key:"resume",value:function(){this.nextTick()}}],[{key:"getTickFunc",value:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame}},{key:"getCancelFunc",value:function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame}},{key:"isSupported",value:function(){return void 0!==r.getTickFunc()}}])}(U),function(i){function r(e){n(this,r);var i=t(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return i.timeoutId=null,i}e(r,i),B(r,[{key:"start",value:function(){for(var t,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=I(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"start",this)).call.apply(t,[this].concat(n)),this.tick()}},{key:"tick",value:function(){this.nextTick(),this.onTick()}},{key:"nextTick",value:function(){var t=this;this.timeoutId=window.setTimeout(function(){t.stop(),t.tick()},this.options.interval)}},{key:"stop",value:function(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}])}(U),"undefined"==typeof Symbol?"__target":Symbol()),G="application/javascript",V=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,H=window.URL||window.webkitURL,Y=window.Worker;if(Y){var X,z=o("self.onmessage = function () {}"),q=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");(X=new Y(z)).postMessage(q,[q.buffer])}catch(t){Y=null}finally{H.revokeObjectURL(z),X&&X.terminate()}}var K=new r("./worker.js",function(t,e){function n(t){return new Promise(function(e,n){var i;(i=_shimWorkerDocument.createElement("script")).src=t,i.onload=e,i.onerror=n,_shimWorkerDocument.head.appendChild(i)})}function i(){o.postMessage({msg:"LOG",log:"do post run"}),(s=new a(this)).init()}function r(t){var e=this;if(!s)if(o.importScripts){o.postMessage({msg:"LOG",log:"do import script "});try{throw o.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/media-fe/decoder/h264/decoder_worker_1583333072685.js"),new Error("error")}catch(t){o.postMessage({msg:"INIT_FAILED"})}addOnPostRun(i.bind(o)),o.postMessage({msg:"LOG",log:"import script done"+Module.toString()}),setTimeout(function(){s||i.call(e)},5e3)}else n("https://sf1-vcloudcdn.pstatp.com/obj/media-fe/decoder/h264/decoder_1583333072685.js").then(function(){console.log(Module),console.log(addOnPostRun),addOnPostRun(i.bind(o))})}var o=this,a=function(t){this.inited=!1,this.self=t,this.meta=this.self.meta,this.infolist={},t.importScripts?(t.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),t.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)):(_shimWorkerWindow.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),_shimWorkerWindow.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this))};a.prototype.toU8Array=function(t,e){return Module.HEAPU8.subarray(t,t+e)},a.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},a.prototype.broadwayOnPictureDecoded=function(t,e,n,i,r,o){var a=Object.assign({},this.infolist[o]),s=n,u=n/2;!this.meta||444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=n);var c=this.toU8Array(t,i*s+r*u*2);this.infolist[o]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;a&&this.self.postMessage({msg:"LOG",log:"sample "+a.dts+" decoded startAt"+a.decodeTime+" cost: "+(Date.now()-a.decodeTime)}),this.self.postMessage({msg:"DECODED",width:e,height:n,yLinesize:i,uvLinesize:r,info:a,buffer:h},[h])},a.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"LOG",log:"decoder inited"}),this.self.postMessage({msg:"DECODER_READY"})},a.prototype.decode=function(t,e){var n=parseInt((new Date).getTime()),i=n-1e9*Math.floor(n/1e9);this.infolist[i]=e,this.streamBuffer.set(t),Module._broadwayPlayStream(t.length,i)},a.prototype.destroy=function(){Module._broadwayExit()},a.prototype.updateMeta=function(t){this.meta=t};var s;o.onmessage=function(t){var e=t.data;if(e.msg)switch(e.msg){case"init":o.meta=e.meta,o.postMessage({msg:"LOG",log:"worker inited"}),r();break;case"updatemeta":o.meta=e.meta,s.updateMeta(e.meta);break;case"decode":s.decode(e.data,e.info);break;case"destory":s.destroy()}else o.postMessage({msg:"ERROR:invalid message"})}}),$=new r("./backupWorker.js",function(t,e){function n(t){return new Promise(function(e,n){var i;(i=_shimWorkerDocument.createElement("script")).src=t,i.onload=e,i.onerror=n,_shimWorkerDocument.head.appendChild(i)})}function i(){(s=new a(this)).init(),o.postMessage({msg:"LOG",log:"decoder inited"}),s.broadwayOnBroadwayInited()}function r(t){s||(o.importScripts?(o.importScripts("https://sf1-vcloudcdn.pstatp.com/obj/media-fe/decoder/h264/decoder_asm_1589261792455.js"),o.postMessage({msg:"LOG",log:Module.toString()}),i.call(o)):n("https://sf1-vcloudcdn.pstatp.com/obj/media-fe/decoder/h264/decoder_asm_1589261792455.js").then(function(){o.postMessage({msg:"LOG",log:Module}),i.call(o)}))}var o=this,a=function(t){this.inited=!1,this.self=t,this.meta=this.self.meta,this.infolist={},t.importScripts?(t.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),t.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this)):(_shimWorkerWindow.par_broadwayOnBroadwayInited=this.broadwayOnBroadwayInited.bind(this),_shimWorkerWindow.par_broadwayOnPictureDecoded=this.broadwayOnPictureDecoded.bind(this))};a.prototype.toU8Array=function(t,e){return Module.HEAPU8.subarray(t,t+e)},a.prototype.init=function(){Module._broadwayInit(),this.streamBuffer=this.toU8Array(Module._broadwayCreateStream(1048576),1048576)},a.prototype.broadwayOnPictureDecoded=function(t,e,n,i,r,o){var a=Object.assign({},this.infolist[o]),s=n,u=n/2;r||(r=i/2),!this.meta||444!==this.meta.chromaFormat&&422!==this.meta.chromaFormat||(u=n);var c=this.toU8Array(t,i*s+r*u*2);this.infolist[o]=null;var l=new Uint8Array(c.length);l.set(c);var h=l.buffer;a&&this.self.postMessage({msg:"LOG",log:"sample "+a.dts+" decoded startAt"+a.decodeTime+" cost: "+(Date.now()-a.decodeTime)}),this.self.postMessage({msg:"DECODED",width:e,height:n,yLinesize:i,uvLinesize:r,info:a,buffer:h},[h])},a.prototype.broadwayOnBroadwayInited=function(){this.inited=!0,this.self.postMessage({msg:"LOG",log:"decoder inited"}),this.self.postMessage({msg:"DECODER_READY"})},a.prototype.decode=function(t,e){var n=parseInt((new Date).getTime()),i=n-1e9*Math.floor(n/1e9);this.infolist[i]=e,this.streamBuffer.set(t),Module._broadwayPlayStream(t.length,i)},a.prototype.destroy=function(){Module._broadwayExit()},a.prototype.updateMeta=function(t){this.meta=t};var s;o.onmessage=function(t){var e=t.data;if(e.msg)switch(e.msg){case"init":o.meta=e.meta,o.postMessage({msg:"LOG",log:"worker inited"}),r();break;case"updatemeta":o.meta=e.meta,s.updateMeta(e.meta);break;case"decode":s.decode(e.data,e.info);break;case"destory":s.destroy()}else o.postMessage({msg:"ERROR:invalid message"})}}),J=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Q=function(){function t(e){a(this,t),this.configs=Object.assign({},e),this.canvas=this.configs.canvas,this.meta=Object.assign({},this.configs.meta),this._initMeta(),this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return J(t,[{key:"_initMeta",value:function(){this.chroma=this.meta.chromaFormat,this.height=this.meta.presentHeight,this.width=this.meta.presentWidth,this.canvas.width=this.meta.presentWidth,this.canvas.height=this.meta.presentHeight}},{key:"_initContextGL",value:function(){for(var t=this.canvas,e=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!e&&i<n.length;){var r=n[i];try{e=this.contextOptions?t.getContext(r,this.contextOptions):t.getContext(r)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++i}this.contextGL=e}},{key:"_initProgram",value:function(){var t,e,n=this.contextGL;t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),e=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");var i=[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1],r=n.createShader(n.VERTEX_SHADER);n.shaderSource(r,t),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+n.getShaderInfoLog(r));var o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(o,e),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+n.getShaderInfoLog(o));var a=n.createProgram();n.attachShader(a,r),n.attachShader(a,o),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||console.log("Program failed to compile: "+n.getProgramInfoLog(a)),n.useProgram(a);var s=n.getUniformLocation(a,"YUV2RGB");n.uniformMatrix4fv(s,!1,i),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var t=this.contextGL,e=this.shaderProgram,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var i=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var o=t.getAttribLocation(e,"texturePos");t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.texturePosBuffer=r;var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"uTexturePos");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),this.uTexturePosBuffer=a;var u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var c=t.getAttribLocation(e,"vTexturePos");t.enableVertexAttribArray(c),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var t=this.contextGL,e=this.shaderProgram,n=this._initTexture(),i=t.getUniformLocation(e,"ySampler");t.uniform1i(i,0),this.yTextureRef=n;var r=this._initTexture(),o=t.getUniformLocation(e,"uSampler");t.uniform1i(o,1),this.uTextureRef=r;var a=this._initTexture(),s=t.getUniformLocation(e,"vSampler");t.uniform1i(s,2),this.vTextureRef=a}},{key:"_initTexture",value:function(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e}},{key:"_drawPictureGL",value:function(t,e,n,i,r){var o=i*n,a=r*n/2;444!==this.chroma&&422!==this.chroma||(a*=2);var s={yData:(t=new Uint8Array(t)).subarray(0,o),uData:t.subarray(o,o+a),vData:t.subarray(o+a,o+a+a)};this._drawPictureGL420(s,e,n,i,r)}},{key:"_drawPictureGL420",value:function(t,e,n,i,r){var o=this.contextGL,a=this.texturePosBuffer,s=this.uTexturePosBuffer,u=this.vTexturePosBuffer,c=this.yTextureRef,l=this.uTextureRef,h=this.vTextureRef,d=t.yData,f=t.uData,p=t.vData,m=i,v=n,y=r,g=n/2;422!==this.chroma&&444!==this.chroma||(g=n);var _=r,b=g,w=this.canvas.width/this.width,E=this.canvas.height/this.height,k=0,T=0,C=this.canvas.width,x=this.canvas.height;w<E?(x=this.height*this.canvas.width/this.width,T=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(C=this.width*this.canvas.height/this.height,k=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),o.viewport(k,T,C,x);var A=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferData(o.ARRAY_BUFFER,A,o.DYNAMIC_DRAW);var D=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,D,o.DYNAMIC_DRAW);var O=new Float32Array([1,0,0,0,1,1,0,1]);o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,O,o.DYNAMIC_DRAW),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,c),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,m,v,0,o.LUMINANCE,o.UNSIGNED_BYTE,d),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,l),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,y,g,0,o.LUMINANCE,o.UNSIGNED_BYTE,f),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,h),o.texImage2D(o.TEXTURE_2D,0,o.LUMINANCE,_,b,0,o.LUMINANCE,o.UNSIGNED_BYTE,p),o.drawArrays(o.TRIANGLE_STRIP,0,4)}},{key:"_drawPictureRGB",value:function(t){}},{key:"render",value:function(t,e,n,i,r){this.contextGL?this._drawPictureGL(t,e,n,i,r):this._drawPictureRGB(t)}},{key:"resetMeta",value:function(t){this.meta=Object.assign({},t),this._initMeta()}}]),t}(),Z=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),tt=function(){function t(e){s(this,t),this.config=Object.assign({},e),this.type=this.config.type,this.reset()}return Z(t,[{key:"reset",value:function(){this.buffer=[],this.currentGop=void 0,this._lastGet=void 0}},{key:"push",value:function(t){this.buffer.push(t)}},{key:"get",value:function(t){return this.buffer.shift()}},{key:"_getNext",value:function(){if(this._lastGet){var t=this._lastGet.gop,e=t.samples[this._lastGet.index+1];if(e)return this._lastGet.index=this._lastGet.index+1,e;if(!(t=t.nextGop)||t.samples.length<1)return;return e=t.samples[0],this._lastGet={gop:t,index:0},e}var n=this.buffer[0];if(!(n.samples.length<1))return this._lastGet={gop:n,index:0},n.samples[0]}},{key:"remove",value:function(t,e){if(!(this.buffer.length<0))for(var n=0,i=this.buffer[0];i;)i.end<e&&i.start>=t?(this.buffer.splice(n,1),i=this.buffer[n]):(n+=1,i=this.buffer[n])}}]),t}(),et=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),nt=function(){function t(e){u(this,t),this.ranges=e||[]}return et(t,[{key:"start",value:function(t){return this.ranges[t]?this.ranges[t].start:0}},{key:"end",value:function(t){return this.ranges[t]?this.ranges[t].end:0}},{key:"add",value:function(t){this.ranges.push(t)}},{key:"length",get:function(){return this.ranges.length}}]),t}();c.prototype=Object.create(null),l.EventEmitter=l,l.usingDomains=!1,l.prototype.domain=void 0,l.prototype._events=void 0,l.prototype._maxListeners=void 0,l.defaultMaxListeners=10,l.init=function(){this.domain=null,l.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new c,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},l.prototype.getMaxListeners=function(){return h(this)},l.prototype.emit=function(t){var e,n,i,r,o,a,s,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(e=arguments[1],!s){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=s,e.domainThrown=!1,s.emit("error",e),!1}if(!(n=a[t]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:d(n,l,this);break;case 2:f(n,l,this,arguments[1]);break;case 3:p(n,l,this,arguments[1],arguments[2]);break;case 4:m(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];v(n,l,this,r)}return!0},l.prototype.addListener=function(t,e){return y(this,t,e,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(t,e){return y(this,t,e,!0)},l.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_(this,t,e)),this},l.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_(this,t,e)),this},l.prototype.removeListener=function(t,e){var n,i,r,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new c:(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){a=n[o].listener,r=o;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new c,this;delete i[t]}else w(n,r);i.removeListener&&this.emit("removeListener",t,a||e)}return this},l.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new c,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new c:delete n[t]),this;if(0===arguments.length){for(var i,r=Object.keys(n),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new c,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},l.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:k(e):[]},l.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):b.call(t,e)},l.prototype.listenerCount=b,l.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var it=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),rt=function(){try{return function(){"use asm"}(),!0}catch(t){return!1}},ot={VIDEO_EVENTS:"VIDEO_EVENTS"},at=function(t){function e(t){T(this,e);var n=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.config=Object.assign({},t),n.canvas=n.config.canvas?n.config.canvas:document.createElement("canvas"),n.source=new tt({type:"video"}),n.onFirstFrame=void 0,n.oncanplay=void 0,n.initParameters(),n.canvas.style.maxWidth="100%",n.canvas.style.maxHeight="100%",n.canvas.style.top=0,n.canvas.style.bottom=0,n.canvas.style.left=0,n.canvas.style.right=0,n.canvas.style.margin="auto",n.canvas.style.position="absolute",n.handleMessage=n.handleMessage.bind(n),n.useBackupTimer=null,n}return x(e,t),it(e,[{key:"initParameters",value:function(){this.meta=void 0,this.readyStatus=0,this.paused=!0,this.currentTime=0,this._seekState=1,this._avccpushed=!1,this._decodedFrames={},this._lastSampleDts=void 0,this._baseDts=void 0,this._lastRenderTime=null,this.playFinish=null,this._seekState=1}},{key:"reset",value:function(){this.initParameters(),this.source.reset()}},{key:"pause",value:function(){this.paused=!0}},{key:"initWasmWorker",value:function(){window._shimWorkerDocument=document,window._shimWorkerWindow=window,this.initWorker(!1),this.setBackUpWorker()}},{key:"setBackUpWorker",value:function(){var t=this;this.useBackupTimer||(this.useBackupTimer=setTimeout(function(){window.clearTimeout(t.useBackupTimer),t.useBackupTimer=null,!t._decoderInited&&rt()&&t.initWorker(!0)},5e3))}},{key:"initWorker",value:function(t){var e=this,n=t?$:K;this.wasmworker=new n(!1),this.wasmworker.onmessage=function(t){"INIT_FAILED"===t.data.msg?(e.destroyWorker(),e.wasmworker=new n(!0),e.wasmworker.postMessage({msg:"init",meta:e.meta})):e.handleMessage(t)},this.wasmworker.postMessage({msg:"init",meta:this.meta})}},{key:"setVideoMetaData",value:function(t){if(this.meta=t,!this._decoderInited)return void this.initWasmWorker();this.wasmworker.postMessage({msg:"updatemeta",meta:this.meta}),this.pushAvcc(t)}},{key:"pushAvcc",value:function(t){this._avccpushed=!0;var e=new Uint8Array(t.sps.byteLength+4);if(e.set([0,0,0,1]),e.set(t.sps,4),this.wasmworker.postMessage({msg:"decode",data:e}),(e=new Uint8Array(t.pps.byteLength+4)).set([0,0,0,1]),e.set(t.pps,4),this.wasmworker.postMessage({msg:"decode",data:e}),this.yuvCanvas)this.yuvCanvas.resetMeta(t);else{var n=Object.assign({meta:t,canvas:this.canvas},this.config);this.yuvCanvas=new Q(n)}this.readyStatus=1}},{key:"decodeVideo",value:function(t){if(this._decoderInited){this._avccpushed||this.pushAvcc(this.meta);for(var e=t.samples,n=e.shift();n;)this._baseDts||(this._baseDts=n.dts),this.source.push(n),n=e.shift();this.preload()}}},{key:"preload",value:function(){if(!this._lastSampleDts||this._lastSampleDts-this._baseDts<this.currentTime+1e3*this.config.preloadTime){var t=this.source.get();for(t&&(this._lastSampleDts=t.dts,this._analyseNal(t));t&&this._lastSampleDts-this._baseDts<this.currentTime+2e3*this.config.preloadTime;)(t=this.source.get())&&(this._analyseNal(t),this._lastSampleDts=t.dts)}}},{key:"_analyseNal",value:function(t){this.wasmworker.postMessage({msg:"decode",data:t.data,info:{decodeTime:Date.now(),dts:t.dts,pts:t.pts?t.pts:t.dts+t.cts,key:t.isKeyframe}})}},{key:"decodeVideoBuffer",value:function(t){if(!this._decoderInited)return void this.initWasmWorker();this.wasmworker.postMessage({msg:"decode",data:t})}},{key:"_onDecoded",value:function(t){if(t.info){var e=t.info.dts;this._decodedFrames[e]=t;var n=Object.keys(this._decodedFrames).length;1==this.readyStatus&&n>0&&(this.readyStatus=2,this.emit(ot.VIDEO_EVENTS,"loadeddata")),4==this._seekState&&(this.readyStatus=2,this._seekState=1),n>10?(this.playFinish&&this.playFinish(),2==this.readyStatus&&(this.readyStatus=3,this.emit(ot.VIDEO_EVENTS,"canplay")),this.oncanplay&&this.oncanplay(),3==this.readyStatus&&n>2*(this.meta.frameRate.fps||60)&&(this.readyStatus=4,this.emit(ot.VIDEO_EVENTS,"canplaythrough"))):this.readyStatus=2}}},{key:"play",value:function(){var t=this;return this.paused=!1,this.paused?new Promise(function(e){t.playFinish=e}).then(function(){t.playFinish=null}):Promise.resolve()}},{key:"_onTimer",value:function(t){var e=this;if(this.paused)return!1;if(this.meta){var n=Object.keys(this._decodedFrames);if(n.length>0){this.currentTime=t;for(var i=-1,r=0;r<n.length&&Number.parseInt(n[r])-this._baseDts<=this.currentTime;r++)i=Number.parseInt(n[Math.max(r-1,0)]);var o=this._decodedFrames[i];return o?(2==this._seekState&&(this._seekState=4,this.emit(ot.VIDEO_EVENTS,"seeked")),n.forEach(function(t){Number.parseInt(t)<=i&&delete e._decodedFrames[t]}),this.yuvCanvas.render(o.buffer,o.width,o.height,o.yLinesize,o.uvLinesize),!0):!!(n.length&&Number(n[0])>t)}}this._lastRenderTime=Date.now()}},{key:"cleanBuffer",value:function(){this.currentTime>1&&this.source.remove(0,this.currentTime-1);for(var t=Object.keys(this._decodedFrames),e=0;e<t.length;e++)Number.parseInt(t[e])<this.currentTime&&delete this._decodedFrames[t[e]]}},{key:"destroy",value:function(){this.destroyWorker(),this.canvas=null,this._decodedFrames={},this.source=null,this._decoderInited=!1,this._isSeeking=!1}},{key:"destroyWorker",value:function(){this.wasmworker&&(this.wasmworker.removeEventListener("message",this.handleMessage),this.wasmworker.postMessage({msg:"destroy"})),window._shimWorkerDocument=null,window._shimWorkerWindow=null,this.wasmworker=null}},{key:"handleMessage",value:function(t){switch(t.data.msg){case"DECODER_READY":console.log("wasm worker ready"),this._decoderInited=!0,this.pushAvcc(this.meta);break;case"DECODED":this._onDecoded(t.data);break;case"LOG":console.log(t.data.log);case"INIT_FAILED":this.destroyWorker();break;default:console.error("invalid messaeg",t)}}},{key:"setVideoSeeking",value:function(){this._seekState=2,this.emit(ot.VIDEO_EVENTS,"seeking")}},{key:"buffered",get:function(){var t=[],e={start:null,end:null},n=Object.keys(this._decodedFrames);return n.length&&(e.start=Number.parseInt(n[0]),e.end=Number.parseInt(n[n.length-1])),null!==e.start&&null!==e.end&&(e.start=(e.start-this._baseDts)/1e3,e.end=(e.end-this._baseDts)/1e3,t.push(e)),new nt(t)}},{key:"videoWidth",get:function(){return this.canvas.width}},{key:"videoHeight",get:function(){return this.canvas.height}},{key:"seeking",get:function(){return 2==this._seekState}},{key:"readyState",get:function(){return this.readyStatus}}]),e}(l),st=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ut=function(t){function e(t){A(this,e);var n=D(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.config=Object.assign({},t);var i=window.AudioContext||window.webkitAudioContext;return n.context=new i,n.gainNode=n.context.createGain(),n.gainNode.connect(n.context.destination),n.meta=void 0,n.samples=[],n.preloadTime=n.config.preloadTime||3,n.duration=0,n._currentBuffer=void 0,n._nextBuffer=void 0,n._lastpts=void 0,n._preDecode=[],n._currentTime=0,n._decoding=!1,n._volume=Number.parseFloat(n.config.volume)===n.config.volume?n.config.volume:.6,n.gainNode.gain.value=n._volume,n._played=!1,n.paused=!0,n.loadFinish=null,n.waitNextID=null,n.destroyed=!1,n}return O(e,t),st(e,[{key:"decodeAudio",value:function(t){var e=t.samples,n=t.meta,i=e;t.samples=[],n&&this.setAudioData(i)}},{key:"setAudioData",value:function(t){for(var e=0;e<t.length;e++)t[e].pts=void 0===t[e].pts?t[e].dts:t[e].pts,this._preDecode.push(t[e]);this.preload()}},{key:"preload",value:function(){this._preDecode.length>0&&(void 0===this._lastpts&&(this._lastpts=this._preDecode[0].pts),(this._preDecode[this._preDecode.length-1].pts-this._lastpts)/1e3>this.preloadTime&&this.decodeAAC())}},{key:"decodeAAC",value:function(){if(!this._decoding){this._decoding=!0;for(var t=this._preDecode,n=[],i=this,r=t.shift();r;){var o=e.getAACData(this.meta,r);n.push(o),this._lastpts=r.pts,r=t.shift()}var a=e.combileData(n);try{this.context.decodeAudioData(a.buffer,function(t){var e=i.context.createBufferSource();e.buffer=t,i.samples.push({time:i.duration,duration:t.duration,data:e}),i.duration+=t.duration,i._currentBuffer||(i._currentBuffer=i.getTimeBuffer(i.currentTime)),!i._nextBuffer&&i._currentBuffer&&(i._nextBuffer=i.getTimeBuffer(i.currentTime+i._currentBuffer.duration)),i._decoding=!1,(i._preDecode.length>0&&i._preDecode[i._preDecode.length-1].pts-i._lastpts)/1e3>=i.preloadTime&&i.decodeAAC(),i.loadFinish&&i.loadFinish()},function(t){console.error(t)})}catch(t){console.error(t)}}}},{key:"onSourceEnded",value:function(){var t=this;if(!this.destroyed){if(!this._nextBuffer||!this._played)return void(this.waitNextID=setTimeout(function(){t.onSourceEnded()},200));var e=this._nextBuffer.data;e.start(),e.connect(this.gainNode);var n=this;setTimeout(function(){n.onSourceEnded.call(t)},1e3*e.buffer.duration-3),this._currentBuffer=this._nextBuffer,this._currentTime=this._currentBuffer.time,this._nextBuffer=this.getTimeBuffer(this.currentTime),this._currentBuffer&&(this._nextBuffer=this.getTimeBuffer(this.currentTime+this._currentBuffer.duration)),this.emit("AUDIO_SOURCE_END")}}},{key:"play",value:function(){var t=this;if(!this.loadFinish){this._played=!0;var e=this,n=function(){var n=t._currentBuffer.data;try{n.start()}catch(t){}n.connect(t.gainNode),t.paused=!1,"running"!==t.context.state&&t.playFailed?(t.context.resume().then(function(){"running"===t.context.state&&t.playFinish&&t.playFinish()}),setTimeout(function(){t.playFailed(new Error("audio context suspended"))})):t.playFinish&&t.playFinish(),setTimeout(function(){e.onSourceEnded.call(t)},1e3*n.buffer.duration-10)};return this._currentBuffer?new Promise(function(e,i){t.playFinish=e,t.playFailed=i,n()}):new Promise(function(e,i){t.loadFinish=n,t.playFinish=e,t.playFailed=i}).then(function(){t.loadFinish=null,t.playFinish=null,t.playFailed=null,n()})}}},{key:"pause",value:function(){var t=this.context;"running"===t.state&&t.suspend(),this._currentBuffer=void 0,this._nextBuffer=void 0,this._lastpts=void 0,this.samples=[],this.paused=!0}},{key:"getTimeBuffer",value:function(t){for(var e=void 0,n=0;n<this.samples.length;n++){var i=this.samples[n];if(i.time<=t&&i.time+i.duration>t){e=i;break}}return e}},{key:"setAudioMetaData",value:function(t){this.meta=t}},{key:"destroy",value:function(){this.waitNextID&&window.clearTimeout(this.waitNextID),this._preDecode=[],this.paused=!0,this.context.close(),this.destroyed=!0}},{key:"mute",value:function(){this.gainNode.gain.value=0}},{key:"currentTime",get:function(){return this._currentTime}},{key:"muted",set:function(t){this.gainNode.gain.value=t?0:this._volume,"suspended"!==this.context.state||this.paused||this.context.resume()}},{key:"volume",get:function(){return"suspended"===this.context.state||this.muted?0:this._volume},set:function(t){return t<0?(this._volume=0,void(this.gainNode.gain.value=0)):t>1?(this._volume=1,void(this.gainNode.gain.value=1)):(this._volume=t,void(this.gainNode.gain.value=t))}}],[{key:"getAACData",value:function(t,n){var i=new Uint8Array(n.data.byteLength+7),r=e.getAdts(t,n.data);return i.set(r),i.set(n.data,7),i}},{key:"combileData",value:function(t){for(var e=0,n=0,i=t.length;n<i;n++)e+=t[n].byteLength;for(var r=new Uint8Array(e),o=0,a=0,s=t.length;a<s;a++)r.set(t[a],o),o+=t[a].byteLength;return r}},{key:"getAdts",value:function(t,e){var n=new Uint8Array(7);n[0]=255,n[1]=240,n[1]=1|n[1],n[2]=192&t.objectType-1<<6,n[2]=n[2]|60&t.sampleRateIndex<<2,n[2]=n[2]|1&t.channelCount>>2,n[3]=192&t.channelCount<<6;var i=e.byteLength+7;return n[3]=n[3]|3&i>>11,n[4]=255&i>>3,n[5]=224&i<<5,n[5]=31|n[5],n[6]=252,n}}]),e}(l),ct=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),lt=function(){function t(e){S(this,t),this.aCtx=e.aCtx,this.vCtx=e.vCtx,this.video=e.video,this.timeoutId=null,this.start=null}return ct(t,[{key:"doReconcile",value:function(){var t=this,e=this.vCtx.currentTime||0,n=void 0,i=e-(n=this.video.noAudio?e:1e3*this.aCtx.currentTime||0);this.timeoutId||(i>200?(this.video.start+=i,this.vCtx.pause(),this.timeoutId=setTimeout(function(){t.vCtx.play(),t.timeoutId=null},i)):i<-120&&(this.video.start+=i))}},{key:"destroy",value:function(){this.start=null,this.aCtx=null,this.vCtx=null,this.timeoutId&&clearTimeout(this.timeoutId)}}]),t}(),ht=new r("./tickworker.js",function(t,e){var n,i=this;i.addEventListener("message",function(t){switch(t.data.msg){case"start":clearInterval(n),n=setInterval(function(){i.postMessage("tick")},t.data.interval);break;case"stop":clearInterval(n)}},!1)}),dt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ft=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},pt=function(t){function e(t){L(this,e);var n=M(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.timeoutId=null,n.worker=new ht,n.handleMessage=n.handleMessage.bind(n),n.worker.addEventListener("message",n.handleMessage),n}return P(e,t),dt(e,[{key:"handleMessage",value:function(){this.onTick()}},{key:"start",value:function(){for(var t,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];(t=ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this)).call.apply(t,[this].concat(i)),this.onTick(),this.worker.postMessage({msg:"start",interval:this.options.interval})}},{key:"stop",value:function(){this.worker.postMessage({msg:"stop"}),this.worker.removeEventListener("message",this.handleMessage),this.worker=null,this.handleMessage=function(){},this.callbacks=[]}},{key:"setInterval",value:function(t){ft(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setInterval",this).call(this,t),this.onTick(),this.worker.postMessage({msg:"start",interval:this.config.interval})}}]),e}(U),mt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),vt=function(t){function e(){N(this,e);var t=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._canvas=document.createElement("canvas"),t.handleAudioSourceEnd=t.handleAudioSourceEnd.bind(t),t.played=!1,t.pendingPlayTask=null,t._waiting=!1,t._paused=!0,t.videoMetaInited=!1,t.audioMetaInited=!1,t.handleVCtxInnerEvent=t.handleVCtxInnerEvent.bind(t),t._err=null,t._lastTimeupdateStamp=0,t._volumeEventStamp=0,t._hasDispatch=!1,t._fps=j,t}return F(e,t),mt(e,[{key:"init",value:function(){var t=this;this._destroyed=!1,this.vCtx&&this.vCtx.destroy(),this.vCtx=new at(Object.assign({canvas:this._canvas,preloadTime:this.preloadTime},{style:{width:this.width,height:this.height}})),this.vCtx.oncanplay=function(){t.played||t.contains(t._canvas)||t.appendChild(t._canvas)},this.vCtx.on(ot.VIDEO_EVENTS,this.handleVCtxInnerEvent)}},{key:"_initAudio",value:function(){var t=this.getAttribute("volume"),e=this.muted?0:Number.parseFloat(t);this.noAudio||(this.aCtx=new ut({volume:e})),this.ticker=new pt({interval:1e3/this._fps}),this.reconciler=new lt({vCtx:this.vCtx,aCtx:this.aCtx,video:this}),this.noAudio||this.aCtx.on("AUDIO_SOURCE_END",this.handleAudioSourceEnd)}},{key:"handleVCtxInnerEvent",value:function(t){this._innerDispatchEvent(t)}},{key:"handleAudioSourceEnd",value:function(){this.reconciler.doReconcile(),this.vCtx.cleanBuffer(),this.aCtx.preload(),this.vCtx.preload()}},{key:"_cleanBuffer",value:function(){this.vCtx.cleanBuffer()}},{key:"_destroyAudio",value:function(){this.audioMetaInited=!1,!this.noAudio&&this.aCtx&&(this.aCtx.removeListener("AUDIO_SOURCE_END",this.handleAudioSourceEnd),this.aCtx.destroy()),this.start=null,this.aCtx=null,this.ticker.stop(),this.ticker=null,this.pendingPlayTask=null,this.played=!1,this._hasDispatch=!1}},{key:"_destroyVideo",value:function(){this.videoMetaInited=!1,this.vCtx.removeAllListeners(),this.vCtx.destroy(),this.vCtx=null}},{key:"destroy",value:function(){this._destroyed||(this.reconciler.destroy(),this._destroyed=!0,this._destroyVideo(),this._destroyAudio())}},{key:"onDemuxComplete",value:function(t,e){this.noAudio||this.aCtx.decodeAudio(e),this.vCtx.decodeVideo(t)}},{key:"decodeVideoBuffer",value:function(t){this.vCtx.decodeVideoBuffer(t)}},{key:"setAudioMeta",value:function(t){this.noAudio||(this.aCtx.setAudioMetaData(t),this.audioMetaInited=!0)}},{key:"setVideoMeta",value:function(t){this.vCtx.setVideoMetaData(t),this.videoMetaInited=!0}},{key:"handleMediaInfo",value:function(){this._innerDispatchEvent("durationchange"),this._innerDispatchEvent("loadedmetadata"),this._innerDispatchEvent("seeking"),this._innerDispatchEvent("seeked")}},{key:"handleEnded",value:function(){this._innerDispatchEvent("ended")}},{key:"handleErr",value:function(t,e){this._err={},this._err.code=t,this._err.message=e,this._innerDispatchEvent("error")}},{key:"_innerDispatchEvent",value:function(t){this.dispatchEvent(new Event(t))}},{key:"disconnectedCallback",value:function(){this.destroy()}},{key:"connectedCallback",value:function(){this._currentTime=0,this.start=void 0,this.init(),this._initAudio(),this.vCtx.reset()}},{key:"play",value:function(){var t=this;if(!this.pendingPlayTask){this.played&&this.connectedCallback(),this.autoplay||this._hasDispatch||(this._innerDispatchEvent("waiting"),this._hasDispatch=!0,this._waiting=!0),this._paused=!1,this._innerDispatchEvent("play");var e=null;return e=this.noAudio?Promise.resolve():this.aCtx.play(),this.pendingPlayTask=Promise.all([this.vCtx.play(),e.then(function(){t.aCtx&&(t.aCtx.muted=!0)})]).then(function(){t.aCtx&&(t.aCtx.muted=!1),t.ticker.start(function(){t.vCtx.preload(),t.start||(t.start=Date.now(),t._lastTimeupdateStamp=t.start);var e=t._currentTime;if(t._currentTime=Date.now()-t.start,t.vCtx._onTimer(t._currentTime)){t._waiting&&(t._innerDispatchEvent("playing"),t._waiting=!1);var n=Date.now();n-t._lastTimeupdateStamp>=250&&(t._lastTimeupdateStamp=n,t._innerDispatchEvent("timeupdate"))}else t._currentTime=e,t.start+=Date.now()-t.start-e,t._waiting||t.paused||(t._waiting=!0,t._innerDispatchEvent("waiting"))}),t.pendingPlayTask=null,t.played=!0}).catch(function(e){throw t.pendingPlayTask=null,t._paused=!0,console.error(e),e}),this.pendingPlayTask}}},{key:"pause",value:function(){var t=this;this._paused=!0,this.noAudio||(this.aCtx.pause(),this.aCtx.destroy()),this.vCtx.pause(),this.ticker.stop(),Promise.resolve().then(function(){t._innerDispatchEvent("pause")})}},{key:"load",value:function(){}},{key:"onValueChange",value:function(){var t=Date.now();t-this._volumeEventStamp<200||(this._volumeEventStamp=t,this._innerDispatchEvent("volumechange"))}},{key:"width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("width",e),this.style.width=e,this._canvas.width=t}},{key:"height",get:function(){return this.getAttribute("height")},set:function(t){this.style.display="inline-block";var e="number"==typeof t?t+"px":t;this.setAttribute("height",e),this.style.height=e,this._canvas.height=t}},{key:"videoWidth",get:function(){return this.vCtx&&this.vCtx.videoWidth?this.vCtx.videoWidth:0}},{key:"videoHeight",get:function(){return this.vCtx&&this.vCtx.videoHeight?this.vCtx.videoHeight:0}},{key:"src",get:function(){return this.getAttribute("src")},set:function(t){this.setAttribute("src",t)}},{key:"readyState",get:function(){return this.videoMetaInited?this.vCtx.readyState:0}},{key:"seeking",get:function(){return!!this.videoMetaInited&&this.vCtx.seeking}},{key:"currentTime",get:function(){return this.videoMetaInited?this.vCtx.currentTime/1e3:0},set:function(t){var e=Number.parseFloat(t);if(!isNaN(e)&&this.start&&this.currentTime){this.vCtx.setVideoSeeking();var n=this.currentTime-e;this.start+=1e3*n}return e}},{key:"duration",get:function(){return this.audioMetaInited?this.aCtx.duration:0}},{key:"paused",get:function(){return this._paused}},{key:"playbackRate",get:function(){return this.hasAttribute("playbackRate")?this.getAttribute("playbackRate"):1},set:function(t){this.setAttribute("playbackrate",t),this.noAudio||(this.aCtx.playbackRate=t),this.vCtx.playbackRate=t,this._innerDispatchEvent("ratechange")}},{key:"ended",get:function(){return!!this.audioMetaInited&&this.aCtx.ended}},{key:"autoplay",get:function(){return!!this.hasAttribute("autoplay")&&"true"==this.getAttribute("autoplay")},set:function(t){this.setAttribute("autoplay",t)}},{key:"volume",get:function(){return this.noAudio?0:this.aCtx?this.aCtx.volume:0},set:function(t){this.noAudio||(this.setAttribute("volume",t),this.aCtx.volume=t,t>0&&this.muted&&this.aCtx.mute(),this.onValueChange())}},{key:"muted",get:function(){var t="true"===this.getAttribute("muted");return void 0!==t?t:!!this.getAttribute("volume")&&0===Number.parseInt(this.getAttribute("volume"))},set:function(t){this.noAudio||(this.setAttribute("muted",t),this.aCtx.muted=!!t,this.onValueChange())}},{key:"error",get:function(){return this._err||this.vCtx.error||(this.noAudio?null:this.aCtx.error)}},{key:"buffered",get:function(){return this.vCtx.buffered}},{key:"noAudio",get:function(){return"true"===this.getAttribute("noaudio")}},{key:"networkState",get:function(){return 0}},{key:"fps",get:function(){return this._fps},set:function(t){i(t)||(t=j),this._fps=t,this.ticker&&this.ticker.setInterval(1e3/t)}},{key:"preloadTime",get:function(){var t=this.getAttribute("preloadtime");if(t){var e=Number.parseFloat(t);if(e>0&&!Number.isNaN(e))return e}return 1/0},set:function(t){t&&Number(t)>0&&(this.setAttribute("preloadtime",t),this.vCtx.config.preloadTime=this.preloadTime)}}]),e}(HTMLElement);customElements.define("mobile-video",vt)});
//# sourceMappingURL=index.min.js.map
