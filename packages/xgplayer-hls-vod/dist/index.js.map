{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import Player from 'xgplayer'\nimport { Context, EVENTS } from 'xgplayer-utils';\nimport HlsVodController from './hls-vod';\nconst HlsAllowedEvents = EVENTS.HlsAllowedEvents;\nconst REMUX_EVENTS = EVENTS.REMUX_EVENTS;\nconst HLS_EVENTS = EVENTS.HLS_EVENTS;\n\nexport class HlsVodPlayer extends Player {\n  constructor (options) {\n    super(options)\n    this.hlsOps = {};\n    this.util = Player.util;\n    this.util.deepCopy(this.hlsOps, options);\n    this._context = new Context(HlsAllowedEvents);\n  }\n\n  get currentTime () {\n    return super.currentTime;\n  }\n\n  set currentTime (time) {\n    time = parseFloat(time);\n    super.currentTime = parseInt(time);\n    if (this._context) {\n      this.__core__.seek(time);\n    }\n  }\n\n  _initEvents () {\n    this.__core__.once(REMUX_EVENTS.INIT_SEGMENT, () => {\n      const mse = this._context.getInstance('MSE');\n      super.start(mse.url);\n    });\n\n    this.__core__.once(HLS_EVENTS.RETRY_TIME_EXCEEDED, () => {\n      this.emit('error', new Player.Errors('network', this.config.url))\n    })\n\n    this.once('canplay', () => {\n      this.play()\n    });\n  }\n\n  _initSrcChangeHandler () {\n    let _this = this;\n    Object.defineProperty(this, 'src', {\n      get () {\n        return _this.currentSrc\n      },\n      set (url) {\n        _this.config.url = url\n        if (!_this.paused) {\n          _this.pause()\n          _this.once('pause', () => {\n            _this.start(url)\n          })\n          _this.once('canplay', () => {\n            _this.play()\n          })\n        } else {\n          _this.start(url)\n        }\n        _this.once('canplay', () => {\n          _this.currentTime = 0\n        })\n      },\n      configurable: true\n    })\n  }\n\n  start (url = this.config.url) {\n    if (!url) {\n      return;\n    }\n    this.__core__ = this._context.registry('HLS_LIVE_CONTROLLER', HlsVodController)({player:this, container: this.video});\n    this._context.init();\n    this.__core__.load(url);\n    this._initEvents();\n    this._initSrcChangeHandler();\n  }\n\n  destroy () {\n    this._context.destroy();\n    super.destroy();\n  }\n}\nmodule.exports = HlsVodPlayer;\n"],"names":["HlsAllowedEvents","EVENTS","REMUX_EVENTS","HLS_EVENTS","HlsVodPlayer","Player","constructor","options","hlsOps","util","deepCopy","_context","Context","currentTime","time","parseFloat","parseInt","__core__","seek","_initEvents","once","INIT_SEGMENT","mse","getInstance","start","url","RETRY_TIME_EXCEEDED","emit","Errors","config","play","_initSrcChangeHandler","_this","Object","defineProperty","get","currentSrc","set","paused","pause","configurable","registry","HlsVodController","player","container","video","init","load","destroy","module","exports"],"mappings":"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"}