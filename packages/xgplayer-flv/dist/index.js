!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],t):"object"==typeof exports?exports["xgplayer-flv"]=t(require("xgplayer")):e["xgplayer-flv"]=t(e.xgplayer)}(window,(function(e){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(t,i){t.exports=e},function(e,t,i){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){e.exports=i(3)},function(e,t,i){"use strict";var r=a(i(4)),n=a(i(5));function a(e){return e&&e.__esModule?e:{default:e}}e.exports=function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.isLive?new r.default(t):new n.default(t)}},function(e,t,i){"use strict";(function(e){var r,n,a,s,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}window,s=function(e){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":l(e))&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=11)}([function(e,t,i){e.exports={Context:i(13).default,EVENTS:i(6).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,MediaInfo:i(5).default,MediaSample:i(19).default,MediaSegment:i(20).default,MediaSegmentList:i(21).default,AudioTrackMeta:i(7).AudioTrackMeta,VideoTrackMeta:i(7).VideoTrackMeta,AudioTrackSample:i(8).AudioTrackSample,VideoTrackSample:i(8).VideoTrackSample,Mse:i(22).default,Stream:i(23).default,Buffer:i(24).default,Crypto:i(27).default}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){c(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return d(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"distroy",value:function(){this.reset(),this.id=-1}}]),e}();t.default=r,t.AudioTrack=function(e){function t(){var e;return c(this,t),(e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).TAG="AudioTrack",e.type="audio",e}return h(t,e),t}(r),t.VideoTrack=function(e){function t(){var e;return c(this,t),(e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).TAG="VideoTrack",e.type="video",e.dropped=0,e}return h(t,e),d(t,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),t}(r),t.Tracks=function(){function e(){c(this,e),this.audioTrack=null,this.videoTrack=null}return d(e,[{key:"destroy",value:function(){this.audioTrack=null,this.videoTrack=null}}]),e}()},function(e,t,i){e.exports={Nalunit:i(37).default,SpsParser:i(9).default,Compatibility:i(39).default}},function(e,t,i){e.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(10).XgBuffer,RemuxBuffer:i(10).RemuxBuffer,PreSource:i(41).default}},function(t,i){t.exports=e},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0},n=function(){function e(){c(this,e),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return d(e,[{key:"isComplete",value:function(){return e.isBaseInfoReady(this)&&e.isVideoReady(this)&&e.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(e){return r(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||r(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||r(e.video)}}]),e}();t.default=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},n={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},s={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},u=Object.assign({},r,n,a,s,o),d=[],l=[];for(var f in u)u.hasOwnProperty(f)&&d.push(u[f]);for(var h in u)u.hasOwnProperty(h)&&l.push(u[h]);t.default={ALLEVENTS:u,HLS_EVENTS:o,REMUX_EVENTS:a,DEMUX_EVENTS:n,MSE_EVENTS:s,LOADER_EVENTS:r,FlvAllowedEvents:d,HlsAllowedEvents:l,CRYTO_EVENTS:{START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTrackMeta=function(){function e(t){c(this,e);var i={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},i,t):i}return d(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),t.VideoTrackMeta=function(){function e(t){c(this,e);var i={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},i,t):i}return d(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){c(this,e);var i=e.getDefault();return t?Object.assign({},i,t):i}return d(e,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,data:new Uint8Array}}}]),e}();t.AudioTrackSample=r;var n=function(){function e(t){c(this,e);var i=e.getDefault();return t?Object.assign({},i,t):i}return d(e,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}]),e}();t.VideoTrackSample=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(38))&&r.__esModule?r:{default:r},a=function(){function e(){c(this,e)}return d(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),r=new n.default(i);r.readByte();var a=r.readByte();r.readByte();var s=r.readByte();r.readUEG();var o=e.getProfileString(a),u=e.getLevelString(s),d=1,l=420,f=8;if((100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a||138===a||144===a)&&(3===(d=r.readUEG())&&r.readBits(1),d<=3&&(l=[0,420,422,444][d]),f=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var h=3!==d?8:12,c=0;c<h;c++)r.readBool()&&(c<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var p=r.readUEG();if(0===p)r.readUEG();else if(1===p){r.readBits(1),r.readSEG(),r.readSEG();for(var v=r.readUEG(),y=0;y<v;y++)r.readSEG()}r.readUEG(),r.readBits(1);var m=r.readUEG(),g=r.readUEG(),_=r.readBits(1);0===_&&r.readBits(1),r.readBits(1);var k=0,E=0,b=0,S=0;r.readBool()&&(k=r.readUEG(),E=r.readUEG(),b=r.readUEG(),S=r.readUEG());var A=1,T=1,w=0,x=!0,D=0,O=0;if(r.readBool()){if(r.readBool()){var R=r.readByte();R>0&&R<16?(A=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][R-1],T=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][R-1]):255===R&&(A=r.readByte()<<8|r.readByte(),T=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var L=r.readBits(32),M=r.readBits(32);x=r.readBool(),w=(D=M)/(O=2*L)}}var U=1;1===A&&1===T||(U=A/T);var B=0,j=0;0===d?(B=1,j=2-_):(B=3===d?1:2,j=(1===d?2:1)*(2-_));var I=16*(m+1),P=16*(g+1)*(2-_);I-=(k+E)*B,P-=(b+S)*j;var C=Math.ceil(I*U);return r.destroy(),r=null,{profile_string:o,level_string:u,bit_depth:f,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:x,fps:w,fps_den:O,fps_num:D},par_ratio:{width:A,height:T},codec_size:{width:I,height:P},present_size:{width:C,height:P}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var i=t.frameRate.fps_den,r=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(i/r))}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XgBuffer=function(){function e(t){c(this,e),this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}return d(e,[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){var t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){var i=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,i}for(var r=new Uint8Array(e),n=0;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){var a=this.array[0].slice(this.offset,this.offset+e);r.set(a,n),this.offset+=e,this.length-=e,e=0;break}var s=this.array[0].length-this.offset;r.set(this.array[0].slice(this.offset,this.array[0].length),n),this.array.shift(),this.offset=0,n+=s,this.length-=s,e-=s}return r}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){for(var i=0,r=this.offset+e;r<this.offset+t+e;)r<this.array[0].length?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++;return i}}]),e}(),t.RemuxBuffer=function(){function e(){c(this,e),this.video=[],this.audio=[]}return d(e,[{key:"destroy",value:function(){this.video=[],this.audio=[]}}]),e}()},function(e,t,i){e.exports=i(12)},function(e,t,i){var r=s(i(4)),n=i(0),a=s(i(28));function s(e){return e&&e.__esModule?e:{default:e}}var o=n.EVENTS.FlvAllowedEvents;e.exports=function(e){function t(e){var i;return c(this,t),(i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))).context=new n.Context(o),i.initEvents(),i.loaderCompleteTimer=null,i}return h(t,e),d(t,[{key:"start",value:function(){this.initFlv(),this.context.init(),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this,this.flv.mse.url)}},{key:"initFlvEvents",value:function(e){var t=this,i=this;e.once(n.EVENTS.REMUX_EVENTS.INIT_SEGMENT,(function(){if(r.default.util.addClass(i.root,"xgplayer-is-live"),!r.default.util.findDom(t.root,"xg-live")){var e=r.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");i.controls.appendChild(e)}})),e.once(n.EVENTS.LOADER_EVENTS.LOADER_COMPLETE,(function(){i.paused||(t.loaderCompleteTimer=setInterval((function(){var e=i.getBufferedRange()[1];Math.abs(i.currentTime-e)<.5&&(i.emit("ended"),window.clearInterval(t.loaderCompleteTimer))}),200))}))}},{key:"initEvents",value:function(){var e=this;this.on("timeupdate",(function(){e.loadData()})),this.on("seeking",(function(){var t=e.currentTime,i=e.getBufferedRange();(t>i[1]||t<i[0])&&e.flv.seek(e.currentTime)}))}},{key:"initFlv",value:function(){var e=this.context.registry("FLV_CONTROLLER",a.default)(this);this.initFlvEvents(e),this.flv=e}},{key:"play",value:function(){if(this._hasStart){this._destroy(),this.context=new n.Context(o);var e=this.context.registry("FLV_CONTROLLER",a.default)(this);this.initFlvEvents(e),this.flv=e,this.context.init(),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this,e.mse.url),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"play",this).call(this)}else u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"play",this).call(this)}},{key:"pause",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"pause",this).call(this),this.flv&&this.flv.pause()}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTime;this.flv&&this.flv.seek(e)}},{key:"destroy",value:function(){var e=this;this._destroy().then((function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",e).call(e)}))}},{key:"_destroy",value:function(){var e=this;return this.flv.mse.destroy().then((function(){e.context.destroy(),e.flv=null,e.context=null,e.loaderCompleteTimer&&window.clearInterval(e.loaderCompleteTimer)}))}},{key:"src",get:function(){return this.currentSrc},set:function(e){var t=this;this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",(function(){t.start(e)})),this.once("canplay",(function(){t.play()}))),this.once("canplay",(function(){t.currentTime=0}))}}]),t}(r.default)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(5))&&r.__esModule?r:{default:r},a=i(14),s="__TO__";t.default=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];c(this,e),this._emitter=new a.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new n.default,this.allowedEvents=t,this._hooks={}}return d(e,[{key:"getInstance",value:function(e){return this._instanceMap[e]||null}},{key:"initInstance",value:function(e){if(this._clsMap[e]){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var n=new(Function.prototype.bind.apply(this._clsMap[e],[null].concat(i)));return this._instanceMap[e]=n,n.init&&n.init(),n}throw new Error(e+"未在context中注册")}},{key:"init",value:function(e){if(!this._inited){for(var t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(e,t){var i=this,r=this._emitter,n=this._isMessageNameValid.bind(this),a=this;return this._clsMap[e]=function(t){function i(){var t,r;c(this,i);for(var n=arguments.length,s=Array(n),o=0;o<n;o++)s[o]=arguments[o];return(r=f(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(s)))).listeners={},r.onceListeners={},r.TAG=e,r._context=a,r}return h(i,t),d(i,[{key:"on",value:function(t,i){return n(t),this.listeners[t]?this.listeners[t].push(i):this.listeners[t]=[i],r.on(""+t+s+e,i),r.on(t,i)}},{key:"before",value:function(e,t){n(e),a._hooks[e]?a._hooks[e].push(t):a._hooks[e]=[t]}},{key:"once",value:function(t,i){return n(t),this.onceListeners[t]?this.onceListeners[t].push(i):this.onceListeners[t]=[i],r.once(""+t+s+e,i),r.once(t,i)}},{key:"emit",value:function(e){n(e);var t=a._hooks?a._hooks[e]:null;if(t)for(var i=0,s=t.length;i<s;i++)(0,t[i])();for(var o=arguments.length,u=Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];return r.emit.apply(r,[e].concat(u))}},{key:"emitTo",value:function(e,t){for(var i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return n(t),r.emit.apply(r,[""+t+s+e].concat(a))}},{key:"off",value:function(e,t){return n(e),r.off(e,t)}},{key:"removeListeners",value:function(){var t=Object.prototype.hasOwnProperty.bind(this.listeners);for(var i in this.listeners)if(t(i))for(var n=this.listeners[i]||[],a=0;a<n.length;a++){var o=n[a];r.off(i,o),r.off(""+i+s+e,o)}for(var u in this.onceListeners)if(t(u))for(var d=this.onceListeners[u]||[],l=0;l<d.length;l++){var f=d[l];r.off(u,f),r.off(""+u+s+e,f)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete a._instanceMap[e],u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this))return u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(t),function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return i.initInstance.apply(i,[e].concat(r))}}},{key:"destroyInstances",value:function(){var e=this;Object.keys(this._instanceMap).forEach((function(t){e._instanceMap[t].destroy&&e._instanceMap[t].destroy()}))}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}},{key:"_isMessageNameValid",value:function(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error("unregistered message name: "+e)}}]),e}()},function(e,t,i){var r,n="object"==("undefined"==typeof Reflect?"undefined":l(Reflect))?Reflect:null,a=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function f(e,t,i,r){var n,a,s,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===i?"undefined":l(i)));if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=d(e))>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,o=u,console&&console.warn&&console.warn(o)}return e}function h(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}.bind(r);return n.listener=i,r.wrapFn=n,n}function c(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):v(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var d=u.length,l=v(u,d);for(i=0;i<d;++i)a(l[i],this,t)}return!0},o.prototype.addListener=function(e,t){return f(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return f(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":l(t)));return this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":l(t)));return this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,a,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":l(t)));if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,n=a;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,a=Object.keys(i);for(r=0;r<a.length;++r)"removeListener"!==(n=a[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return c(this,e,!0)},o.prototype.rawListeners=function(e){return c(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),n={get device(){var e=n.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(i){return t[i].test(e)})))[0]},get os(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),n=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||n&&/(?:Tablet)/.test(e),s=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:s,isAndroid:r,isPc:!s&&!r&&!i,isSymbian:i,isWindowsPhone:t,isFireFox:n}},get isLe(){return r}};t.default=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}();t.default=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){c(this,e)}return d(e,null,[{key:"decode",value:function(t){for(var i=[],r=t,n=0,a=t.length;n<a;)if(r[n]<128)i.push(String.fromCharCode(r[n])),++n;else{if(r[n]<192);else if(r[n]<224){if(e._checkContinuation(r,n,1)){var s=(31&r[n])<<6|63&r[n+1];if(s>=128){i.push(String.fromCharCode(65535&s)),n+=2;continue}}}else if(r[n]<240){if(e._checkContinuation(r,n,2)){var o=(15&r[n])<<12|(63&r[n+1])<<6|63&r[n+2];if(o>=2048&&55296!=(63488&o)){i.push(String.fromCharCode(65535&o)),n+=3;continue}}}else if(r[n]<248&&e._checkContinuation(r,n,3)){var u=(7&r[n])<<18|(63&r[n+1])<<12|(63&r[n+2])<<6|63&r[n+3];if(u>65536&&u<1114112){u-=65536,i.push(String.fromCharCode(u>>>10|55296)),i.push(String.fromCharCode(1023&u|56320)),n+=4;continue}}i.push(String.fromCharCode(65533)),++n}return i.join("")}},{key:"_checkContinuation",value:function(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}}]),e}();t.default=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){var i=this;c(this,e);var r=e.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return r;var n=Object.assign({},r,t);Object.entries(n).forEach((function(e){var t=o(e,2),r=t[0],n=t[1];i[r]=n}))}return d(e,null,[{key:"getDefaultInf",value:function(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}]),e}();t.default=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(){c(this,e),this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}return d(e,[{key:"addRAP",value:function(e){e.isRAP=!0,this.randomAccessPoints.push(e)}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(t){c(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return d(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,r=0,n=0,a=i,s=0;if(e<t[0].originDts)return-1;for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>t[r].lastSample.originDts&&e<t[r+1].originDts){s=r;break}t[r].originDts<e?n=r+1:a=r-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&e.originStartDts>=t[i].lastSample.originDts&&(i===t.length-1||i<t.length-1&&e.originStartDts<t[i+1].originStartDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(e.originStartDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,e)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!==t?t.lastSample:null}},{key:"getLastRAPBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].randomAccessPoints;0===i.length&&t>0;)t--,i=this._list[t].randomAccessPoints;return i.length>0?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){c(this,e),this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}return d(e,[{key:"init",value:function(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}},{key:"onTimeUpdate",value:function(){this.emit("TIME_UPDATE",this.container)}},{key:"onWaiting",value:function(){this.emit("WAITING",this.container)}},{key:"onSourceOpen",value:function(){this.addSourceBuffers()}},{key:"onUpdateEnd",value:function(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}},{key:"addSourceBuffers",value:function(){if("open"===this.mediaSource.readyState){var e=void 0,t=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");t=t.sources;for(var r=!1,n=0,a=Object.keys(t).length;n<a;n++)if("audio"===(a=Object.keys(t)[n])?e=i.audioTrack:"video"===a&&(e=i.videoTrack),e){var s="audio"===a?21:40;e.meta&&e.meta.refSampleDuration&&(s=e.meta.refSampleDuration),t[a].data.length>=this.preloadTime/s&&(r=!0)}if(r){if(Object.keys(this.sourceBuffers).length>0)return;for(var o=0,u=Object.keys(t).length;o<u;o++){var d=Object.keys(t)[o],l=t[d],f="video"===d?"video/mp4;codecs="+l.mimetype:"audio/mp4;codecs="+l.mimetype,h=this.mediaSource.addSourceBuffer(f);this.sourceBuffers[d]=h,h.addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}}},{key:"doAppend",value:function(){var e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e)for(var t=0;t<Object.keys(this.sourceBuffers).length;t++){var i=Object.keys(this.sourceBuffers)[t],r=this.sourceBuffers[i];if(!r.updating){var n=e.sources[i];if(n&&!n.inited)r.appendBuffer(n.init.buffer.buffer),n.inited=!0;else if(n){var a=n.data.shift();a&&r.appendBuffer(a.buffer.buffer)}}}}},{key:"endOfStream",value:function(){var e=this.mediaSource,t=e.readyState,i=e.activeSourceBuffers;if("open"===t&&0===i.length)try{this.mediaSource.endOfStream()}catch(t){}}},{key:"remove",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;i<Object.keys(this.sourceBuffers).length;i++){var r=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];r.updating||r.remove(t,e)}}},{key:"removeBuffers",value:function(){for(var t=this,i=[],r=function(r){var n=void 0,a=t.sourceBuffers[Object.keys(t.sourceBuffers)[r]];a.removeEventListener("updateend",t.onUpdateEnd),a.updating?n=new Promise((function(t){a.addEventListener("updateend",(function i(){var r=3;setTimeout((function i(){a.updating?r>0?(setTimeout(i,200),r--):t():(e.clearBuffer(a),t())}),200),a.removeEventListener("updateend",i)}))})):(e.clearBuffer(a),n=Promise.resolve()),i.push(n)},n=0;n<Object.keys(this.sourceBuffers).length;n++)r(n);return Promise.all(i)}},{key:"destroy",value:function(){var e=this;return this.removeBuffers().then((function(){for(var t=0;t<Object.keys(e.sourceBuffers).length;t++){var i=e.sourceBuffers[Object.keys(e.sourceBuffers)[t]];e.mediaSource.removeSourceBuffer(i),delete e.sourceBuffers[Object.keys(e.sourceBuffers)[t]]}e.container.removeEventListener("timeupdate",e.onTimeUpdate),e.container.removeEventListener("waiting",e.onWaiting),e.mediaSource.removeEventListener("sourceopen",e.onSourceOpen),e.endOfStream(),window.URL.revokeObjectURL(e.url),e.url=null,e.configs={},e.container=null,e.mediaSource=null,e.sourceBuffers={},e.preloadTime=1}))}}],[{key:"clearBuffer",value:function(e){for(var t=e.buffered,i=.1,r=0,n=t.length;r<n;r++)i=t.end(r);try{e.remove(0,i)}catch(e){}}}]),e}();t.default=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){if(c(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return d(e,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(t){for(var i=Math.floor(t/4),r=t%4,n=0;n<i;n++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,i){var r=void 0;switch(t){case 1:r=i?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=i?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(i)throw new Error("not supported for readByte 3");r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=i?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(i)throw new Error("not supported for readBody 8");r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),e}();t.default=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(25))&&r.__esModule?r:{default:r};t.default=function(){function e(t){c(this,e),this.buffer=t||new Uint8Array(0)}return d(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach((function(t){e.buffer=(0,n.default)(Uint8Array,e.buffer,t)}))}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}},{key:"readAsInt",value:function(e){var t="";return e.forEach((function(e){t+=function(e){return e.toString(16).padStart(2,"0")}(e)})),parseInt(t,16)}}]),e}()},function(e,t,i){var r,n=(r=i(26))&&r.__esModule?r:{default:r};e.exports=n.default},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var a=!0,s=!1,o=void 0;try{for(var u,d=r[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;t+=l.length}}catch(e){s=!0,o=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw o}}var f=new e(t),h=0,c=!0,p=!1,v=void 0;try{for(var y,m=r[Symbol.iterator]();!(c=(y=m.next()).done);c=!0){var g=y.value;f.set(g,h),h+=g.length}}catch(e){p=!0,v=e}finally{try{!c&&m.return&&m.return()}finally{if(p)throw v}}return f}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=((r=i(6))&&r.__esModule?r:{default:r}).default.CRYTO_EVENTS;t.default=function(){function e(t){c(this,e),this.inputBuffer=t.inputbuffer,this.outputBuffer=t.outputbuffer,this.key=t.key,this.iv=t.iv,this.method=t.method,this.crypto=window.crypto||window.msCrypto}return d(e,[{key:"init",value:function(){this.on(n.START_DECRYPT,this.decript.bind(this))}},{key:"decript",value:function(){var e=this;this.aeskey?this.decriptData():this.crypto.subtle.importKey("raw",this.key.buffer,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then((function(t){e.aeskey=t,e.decriptData()}))}},{key:"decriptData",value:function(){var e=this,t=this._context.getInstance(this.inputBuffer),i=this._context.getInstance(this.outputBuffer),r=t.shift();r&&this.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv.buffer},this.aeskey,r).then((function(t){i.push(new Uint8Array(t)),e.emit(n.DECRYPTED),e.decriptData(r)}))}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=f(i(29)),n=i(32),a=i(34),s=i(3),o=i(0),u=i(2),l=f(i(4));function f(e){return e&&e.__esModule?e:{default:e}}var h=o.EVENTS.REMUX_EVENTS,p=o.EVENTS.DEMUX_EVENTS,v=o.EVENTS.LOADER_EVENTS,y=o.EVENTS.MSE_EVENTS,m="FLVController",g=function(){function e(){c(this,e)}return d(e,[{key:"warn",value:function(){}}]),e}();t.default=function(){function e(t){c(this,e),this.TAG=m,this._player=t,this.state={initSegmentArrived:!1}}return d(e,[{key:"init",value:function(){this._context.registry("FETCH_LOADER",n.FetchLoader),this._context.registry("LOADER_BUFFER",s.XgBuffer),this._context.registry("FLV_DEMUXER",a.FlvDemuxer),this._context.registry("TRACKS",s.Tracks),this._context.registry("MP4_REMUXER",r.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",s.PreSource),!1!==this._player.config.compatibility&&this._context.registry("COMPATIBILITY",u.Compatibility),this._context.registry("LOGGER",g),this.mse=this._context.registry("MSE",o.Mse)({container:this._player.video}),this._handleTimeUpdate=this._handleTimeUpdate.bind(this),this.initListeners()}},{key:"initListeners",value:function(){this.on(v.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(v.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(p.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(p.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(p.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(p.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(h.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(h.MEDIA_SEGMENT,this._handleMediaSegment.bind(this)),this.on(y.SOURCE_UPDATE_END,this._handleSourceUpdateEnd.bind(this)),this._player.on("timeupdate",this._handleTimeUpdate)}},{key:"_handleMediaInfo",value:function(){this._context.mediaInfo||this.emit(p.DEMUX_ERROR,new Error("failed to get mediainfo"))}},{key:"_handleLoaderDataLoaded",value:function(){this.emitTo("FLV_DEMUXER",p.DEMUX_START)}},{key:"_handleMetadataParsed",value:function(e){this.emit(h.REMUX_METADATA,e)}},{key:"_handleDemuxComplete",value:function(){this.emit(h.REMUX_MEDIA)}},{key:"_handleAppendInitSegment",value:function(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}},{key:"_handleMediaSegment",value:function(){this.mse.addSourceBuffers(),this.mse.doAppend()}},{key:"_handleSourceUpdateEnd",value:function(){var e=this._player.currentTime,t=this._player.video,i=this._player.config.preloadTime||5,r=t.buffered.length;if(0!==r){var n=t.buffered.end(r-1);n-e>2*i&&(this._player.currentTime=n-i)}}},{key:"_handleTimeUpdate",value:function(){var e=this._player.currentTime;e>2&&this.mse.remove(e-2)}},{key:"_handleNetworkError",value:function(){this._player.emit("error",new l.default.Errors("network",this._player.config.url))}},{key:"_handleDemuxError",value:function(){this._player.emit("error",new l.default.Errors("parse",this._player.config.url))}},{key:"seek",value:function(){this.state.initSegmentArrived||this.loadData()}},{key:"loadData",value:function(){this.emit(v.LADER_START,this._player.config.url)}},{key:"pause",value:function(){var e=this._context.getInstance("FETCH_LOADER");e&&e.cancel()}},{key:"destroy",value:function(){this._player.off("timeupdate",this._handleTimeUpdate),this._player=null,this.mse=null}}]),e}()},function(e,t,i){e.exports={Mp4Remuxer:i(30).default}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(0),a=(r=i(31))&&r.__esModule?r:{default:r},s=n.EVENTS.REMUX_EVENTS,o=function(){function e(){c(this,e),this._dtsBase=0,this._isDtsBaseInited=!1,this._audioNextDts=null,this._videoNextDts=null,this._videoSegmentList=new n.MediaSegmentList("video"),this._audioSegmentList=new n.MediaSegmentList("audio");var t=n.sniffer.browser;this._fillSilenceFrame="ie"===t,this.videoAllDuration=0,this.audioAllDuration=0}return d(e,[{key:"init",value:function(){this.on(s.REMUX_MEDIA,this.remux.bind(this)),this.on(s.REMUX_METADATA,this.onMetaDataReady.bind(this))}},{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null}},{key:"remux",value:function(){var e=this._context.getInstance("TRACKS"),t=e.audioTrack,i=e.videoTrack;!this._isDtsBaseInited&&this.calcDtsBase(t,i),this._remuxVideo(i),this._remuxAudio(t)}},{key:"seek",value:function(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()}},{key:"onMetaDataReady",value:function(e){var t,i=void 0,r=new n.Buffer,o=a.default.ftyp();i="audio"===e?this._context.getInstance("TRACKS").audioTrack:this._context.getInstance("TRACKS").videoTrack,t=a.default.moov({type:e,meta:i.meta}),r.write(o,t);var u=this._context.getInstance("PRE_SOURCE_BUFFER"),d=u.getSource(e);d||(d=u.createSource(e)),d.mimetype=i.meta.codec,d.init=r,this.emit(s.INIT_SEGMENT,e)}},{key:"calcDtsBase",value:function(e,t){if(e.samples.length||t.samples.length){var i=1/0,r=1/0;e.samples&&e.samples.length&&(i=e.samples[0].dts),t.samples&&t.samples.length&&(r=t.samples[0].dts),this._dtsBase=Math.min(i,r),this._isDtsBaseInited=!0}}},{key:"_remuxVideo",value:function(e){var t=e;if(e.samples&&e.samples.length){for(var i=t.samples,r=-1,o=[],u={samples:[]};i.length;){var d=i.shift(),l=d.isKeyframe,f=void 0,h=void 0,c=d.dts-this._dtsBase;-1===r&&(r=c),d.pts&&(f=(h=d.pts-this._dtsBase)-c),d.cts&&(h=d.cts+c,f=d.cts);var p={buffer:[],size:0};u.samples.push(p),p.buffer.push(d.data),p.size+=d.data.byteLength;var v=0;v=i.length>=1?i[0].dts-this._dtsBase-c:o.length>=1?o[o.length-1].duration:this.videoMeta.refSampleDuration,this.videoAllDuration+=v,o.push({dts:c,cts:f,pts:h,data:d.data,size:d.data.byteLength,isKeyframe:l,duration:v,flags:{isLeading:0,dependsOn:l?2:1,isDependedOn:l?1:0,hasRedundancy:0,isNonSync:l?0:1},originDts:c,type:"video"})}var y=new n.Buffer,m=a.default.moof({id:t.meta.id,time:r,samples:o}),g=a.default.mdat(u);y.write(m,g),t.samples=[],t.length=0;var _=this._context.getInstance("PRE_SOURCE_BUFFER"),k=_.getSource("video");k||(k=_.createSource("video")),k.data.push(y),this.emit(s.MEDIA_SEGMENT,"video")}}},{key:"_remuxAudio",value:function(e){var t=e.samples,i=-1,r=[],o={samples:[]};if(t&&t.length){for(var u=!1;t.length;){var d=t.shift(),l=d.data,f=d.dts-this._dtsBase,h=f;u||(i=f,u=!0);var c=0;c=this.audioMeta.refSampleDurationFixed?this.audioMeta.refSampleDurationFixed:t.length>=1?t[0].dts-this._dtsBase-f:r.length>=1?r[r.length-1].duration:this.audioMeta.refSampleDuration,this.audioAllDuration+=c;var p={dts:f,pts:f,cts:0,size:l.byteLength,duration:d.duration?d.duration:c,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:h,type:"audio"},v={buffer:[],size:0};v.buffer.push(l),v.size+=l.byteLength,o.samples.push(v),r.push(p)}var y=new n.Buffer,m=a.default.moof({id:e.meta.id,time:i,samples:r}),g=a.default.mdat(o);y.write(m,g),e.samples=[],e.length=0;var _=this._context.getInstance("PRE_SOURCE_BUFFER"),k=_.getSource("audio");k||(k=_.createSource("audio")),k.data.push(y),this.emit(s.MEDIA_SEGMENT,"audio",y)}}},{key:"initSilentAudio",value:function(t,i){var r=e.getSilentFrame(this._audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:i,unit:r,size:r.byteLength,originDts:t,type:"video"}}},{key:"videoMeta",get:function(){return this._context.getInstance("TRACKS").videoTrack.meta}},{key:"audioMeta",get:function(){return this._context.getInstance("TRACKS").audioTrack.meta}}],[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();t.default=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),n=function(){function e(){c(this,e)}return d(e,null,[{key:"size",value:function(e){return r.Buffer.writeUint32(e)}},{key:"initBox",value:function(t,i){for(var n=new r.Buffer,a=arguments.length,s=Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return n.write.apply(n,[e.size(t),e.type(i)].concat(s)),n.buffer}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){return e.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}},{key:"moov",value:function(t){var i=t.type,r=t.meta,n=void 0,a=8,s=e.mvhd(r.duration,r.timescale);n="video"===i?e.videoTrak(r):e.audioTrak(r);var o=e.mvex(r.duration,r.timescale||1e3,r.id);return[s,n,o].forEach((function(e){a+=e.byteLength})),e.initBox(a,"moov",s,n,o)}},{key:"mvhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.initBox(8+r.length,"mvhd",new Uint8Array(r))}},{key:"videoTrak",value:function(t){var i=8,r=e.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),n=e.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[r,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"trak",r,n)}},{key:"audioTrak",value:function(t){var i=8,r=e.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),n=e.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[r,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"trak",r,n)}},{key:"tkhd",value:function(t){var i=t.id,r=t.duration,n=t.width,a=t.height,s=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,a>>>8&255,255&a,0,0]);return e.initBox(8+s.byteLength,"tkhd",s)}},{key:"edts",value:function(t){var i=new r.Buffer,n=t.duration,a=t.mediaTime;return i.write(e.size(36),e.type("edts")),i.write(e.size(28),e.type("elst")),i.write(new Uint8Array([0,0,0,1,n>>24&255,n>>16&255,n>>8&255,255&n,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,1])),i.buffer}},{key:"mdia",value:function(t){var i=8,r=e.mdhd(t.timescale,t.duration),n=e.hdlr(t.type),a=e.minf(t);return[r,n,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"mdia",r,n,a)}},{key:"mdhd",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments[1],r=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]);return e.initBox(12+r.byteLength,"mdhd",e.extension(0,0),r)}},{key:"hdlr",value:function(t){var i=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(i.splice(8,4,115,111,117,110),i.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),e.initBox(8+i.length,"hdlr",new Uint8Array(i))}},{key:"minf",value:function(t){var i=8,r="video"===t.type?e.vmhd():e.smhd(),n=e.dinf(),a=e.stbl(t);return[r,n,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"minf",r,n,a)}},{key:"vmhd",value:function(){return e.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}},{key:"smhd",value:function(){return e.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}},{key:"dinf",value:function(){var t=new r.Buffer;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){var i=8,r=e.stsd(t),n=e.stts(),a=e.stsc(),s=e.stsz(),o=e.stco();return[r,n,a,s,o].forEach((function(e){i+=e.byteLength})),e.initBox(i,"stbl",r,n,a,s,o)}},{key:"stsd",value:function(t){var i;return i="audio"===t.type?e.mp4a(t):e.avc1(t),e.initBox(16+i.byteLength,"stsd",e.extension(0,0),new Uint8Array([0,0,0,1]),i)}},{key:"mp4a",value:function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),r=e.esds(t.config);return e.initBox(8+i.byteLength+r.byteLength,"mp4a",i,r)}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],i=t.length,n=new r.Buffer,a=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t).concat([6,1,2]));return n.write(e.size(8+a.byteLength),e.type("esds"),a),n.buffer}},{key:"avc1",value:function(t){var i=new r.Buffer,n=t.width,a=t.height,s=t.parRatio.height,o=t.parRatio.width,u=t.avcc,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),f=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o]);return i.write(e.size(40+d.byteLength+u.byteLength+l.byteLength),e.type("avc1"),d,e.size(8+u.byteLength),e.type("avcC"),u,e.size(20),e.type("btrt"),l,e.size(16),e.type("pasp"),f),i.buffer}},{key:"stts",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stts",t)}},{key:"stsc",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stsc",t)}},{key:"stco",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stco",t)}},{key:"stsz",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return e.initBox(20,"stsz",t)}},{key:"mvex",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i=arguments[2],n=new r.Buffer,a=r.Buffer.writeUint32(t);return n.write(e.size(56),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),a,e.trex(i)),n.buffer}},{key:"trex",value:function(t){var i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.initBox(8+i.byteLength,"trex",i)}},{key:"moof",value:function(t){var i=8,r=e.mfhd(),n=e.traf(t);return[r,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"moof",r,n)}},{key:"mfhd",value:function(){var t=r.Buffer.writeUint32(e.sequence);return e.sequence+=1,e.initBox(16,"mfhd",e.extension(0,0),t)}},{key:"traf",value:function(t){var i=8,r=e.tfhd(t.id),n=e.tfdt(t.time),a=e.sdtp(t),s=e.trun(t,a.byteLength);return[r,n,s,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"traf",r,n,s,a)}},{key:"tfhd",value:function(t){var i=r.Buffer.writeUint32(t);return e.initBox(16,"tfhd",e.extension(0,0),i)}},{key:"tfdt",value:function(t){return e.initBox(16,"tfdt",e.extension(0,0),r.Buffer.writeUint32(t))}},{key:"trun",value:function(t,i){var n=new r.Buffer,a=r.Buffer.writeUint32(t.samples.length),s=r.Buffer.writeUint32(92+16*t.samples.length+i);return n.write(e.size(20+16*t.samples.length),e.type("trun"),new Uint8Array([0,0,15,1]),a,s),t.samples.forEach((function(e){var t=e.flags;n.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))})),n.buffer}},{key:"sdtp",value:function(t){var i=new r.Buffer;return i.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach((function(e){var t=e.flags,r=t.isLeading<<6|t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;i.write(new Uint8Array([r]))})),i.buffer}},{key:"mdat",value:function(t){var i=new r.Buffer,n=8;t.samples.forEach((function(e){n+=e.size})),i.write(e.size(n),e.type("mdat"));var a=new Uint8Array(n),s=0;return a.set(i.buffer,s),s+=8,t.samples.forEach((function(e){e.buffer.forEach((function(e){a.set(e,s),s+=e.byteLength}))})),a}}]),e}();n.type=function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])},n.sequence=1,t.default=n},function(e,t,i){e.exports={FetchLoader:i(33).default}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).EVENTS.LOADER_EVENTS;t.default=function(){function e(t){c(this,e),this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}return d(e,[{key:"init",value:function(){this.on(r.LADER_START,this.load.bind(this))}},{key:"load",value:function(e,t){var i=this;this.url=e,this._canceled=!1;var n=this.getParams(t);return i.loading=!0,fetch(this.url,n).then((function(e){if(e.ok)return i.status=e.status,i._onFetchResponse(e);i.loading=!1,i.emit(r.LOADER_ERROR,i,e)})).catch((function(e){throw i.loading=!1,i.emit(r.LOADER_ERROR,i,e),new Error(e.message)}))}},{key:"_onFetchResponse",value:function(e){var t=this,i=this._context.getInstance(this.buffer);this._loaderTaskNo++;var n=this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case 2:e.json().then((function(e){t.loading=!1,t._canceled||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))}));break;case 1:e.text().then((function(e){t.loading=!1,t._canceled||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))}));break;case 3:e.arrayBuffer().then((function(e){t.loading=!1,t._canceled||(i?(i.push(new Uint8Array(e)),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))}));break;case 0:default:return this._onReader(e.body.getReader(),n)}}},{key:"_onReader",value:function(e,t){var i=this._context.getInstance(this.buffer);if(i||this._reader.cancel(),this._reader=e,!1!==this.loading){var n=this;this._reader&&this._reader.read().then((function(a){return a.done?(n.loading=!1,n.status=0,void n.emit(r.LOADER_COMPLETE,i)):n._canceled?void n._reader.cancel():(i.push(a.value),n.emit(r.LOADER_DATALOADED,i),n._onReader(e,t))})).catch((function(e){n.loading=!1,n.emit(r.LOADER_ERROR,n,e)}))}}},{key:"getParams",value:function(e){var t=Object.assign({},e),i=new Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==l(this.configs.headers)){var n=this.configs.headers;for(var a in n)n.hasOwnProperty(a)&&i.append(a,n[a])}if("object"==l(t.headers)){var s=t.headers;for(var o in s)s.hasOwnProperty(o)&&i.append(o,s[o])}return!1===t.cors&&(r.mode="same-origin"),t.withCredentials&&(r.credentials="include"),r}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(e){}this._reader=null,this.loading=!1,this._canceled=!0}}},{key:"destroy",value:function(){this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),e}()},function(e,t,i){e.exports={M3U8Parser:i(35).default,TsDemuxer:i(36).default,Playlist:i(42).default,FlvDemuxer:i(43).default}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){c(this,e)}return d(e,null,[{key:"parse",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r={duration:0};if(t&&t.split){var n=t.split(/\r|\n/),a=(n=n.filter((function(e){return e}))).shift();if(!a.match("#EXTM3U"))return null;for(a=n.shift();a;){var s=a.match(/#(.[A-Z|-]*):(.*)/);if(s&&s.length>2)switch(s[1]){case"EXT-X-VERSION":r.version=parseInt(s[2]);break;case"EXT-X-MEDIA-SEQUENCE":r.sequence=parseInt(s[2]);break;case"EXT-X-TARGETDURATION":r.targetduration=parseFloat(s[2]);break;case"EXTINF":e.parseFrag(s,n,r,i);break;case"EXT-X-KEY":e.parseDecrypt(s[2],r)}a=n.shift()}return r}}},{key:"parseFrag",value:function(e,t,i,r){i.frags||(i.frags=[]);var n={start:i.duration,duration:1e3*parseFloat(e[2])};i.duration+=n.duration;var a=t.shift();a.match(/#(.*):(.*)/)&&(a=t.shift()),a.length>0&&"/"===a.charAt(0)&&r.match(/.*\/\/.*\.\w+/g)&&(r=r.match(/.*\/\/.*\.\w+/g)[0]),a.match(/.*:\/\/.*/)?n.url=a:n.url=r+a,i.frags.push(n)}},{key:"parseURL",value:function(e){var t="",i=e.match(/(.*\/).*\.m3u8/);if(i&&i.length>0)for(var r=0;r<i.length;r++)i[r].match(/.*\/$/g)&&i[r].length>t.length&&(t=i[r]);return t}},{key:"parseDecrypt",value:function(e,t){t.encrypt={};var i=e.split(",");for(var r in i){var n=i[r];if(n.match(/METHOD=(.*)/)&&(t.encrypt.method=n.match(/METHOD=(.*)/)[1]),n.match(/URI="(.*)"/)&&(t.encrypt.uri=n.match(/URI="(.*)"/)[1]),n.match(/IV=0x(.*)/)){var a=n.match(/IV=0x(.*)/)[1],s=Math.ceil(a.length/2);t.encrypt.ivb=new Uint8Array(s);for(var o=s-1;o>=0;o--){var u=parseInt(a.substr(2*o,2),16);t.encrypt.ivb[o]=u}t.encrypt.iv=a}}}}]),e}();t.default=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),n=i(3),a=i(0),s=a.EVENTS.DEMUX_EVENTS,o={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]},u=function(){function e(t){c(this,e),this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}return d(e,[{key:"init",value:function(){this.on(s.DEMUX_START,this.demux.bind(this))}},{key:"demux",value:function(){if(!this.demuxing){for(var t=this.inputBuffer,i={pat:[],pmt:[]},r={};t.length>=188;){for(;t.length>=1&&71!==t.array[0][t.offset];)t.shift(1);var n=t.shift(188),o=new a.Stream(n.buffer),u={};e.read(o,u,i),u.pes?(r[u.header.pid]||(r[u.header.pid]=[]),r[u.header.pid].push(u.pes),u.pes.ES.buffer=[u.pes.ES.buffer]):r[u.header.pid]&&r[u.header.pid][r[u.header.pid].length-1].ES.buffer.push(u.payload.stream)}for(var d=0;d<Object.keys(r).length;d++)for(var l=r[Object.keys(r)[d]],f=0;f<l.length;f++)l[f].id=Object.keys(r)[d],l[f].ES.buffer=e.Merge(l[f].ES.buffer),"audio"===l[f].type?this.pushAudioSample(l[f]):"video"===l[f].type&&this.pushVideoSample(l[f]);this._hasAudioMeta&&this.emit(s.DEMUX_COMPLETE,"audio"),this._hasVideoMeta&&this.emit(s.DEMUX_COMPLETE,"video")}}},{key:"pushAudioSample",value:function(e){var t=void 0;this._tracks.audioTrack?t=this._tracks.audioTrack:(this._tracks.audioTrack=new n.AudioTrack,(t=this._tracks.audioTrack).meta=new a.AudioTrackMeta({audioSampleRate:e.ES.frequence,sampleRate:e.ES.frequence,channelCount:e.ES.channel,codec:"mp4a.40."+e.ES.audioObjectType,config:e.ES.audioConfig,id:2,sampleRateIndex:e.ES.frequencyIndex}),t.meta.refSampleDuration=Math.floor(1024/t.meta.audioSampleRate*t.meta.timescale),this._hasAudioMeta||(this._hasAudioMeta=!0,this.emit(s.METADATA_PARSED,"audio")));var i=new Uint8Array(e.ES.buffer.buffer.slice(e.ES.buffer.position,e.ES.buffer.length)),r=parseInt(e.pts/90),o=parseInt(e.pts/90),u=new a.AudioTrackSample({dts:r,pts:o,data:i});t.samples.push(u)}},{key:"pushVideoSample",value:function(t){var i=void 0,o=r.Nalunit.getNalunits(t.ES.buffer);this._tracks.videoTrack?i=this._tracks.videoTrack:(this._tracks.videoTrack=new n.VideoTrack,(i=this._tracks.videoTrack).meta=new a.VideoTrackMeta);for(var u=0,d=!1,l=!1,f=0;f<o.length;f++){var h=o[f];if(h.sps){if(i.sps&&e.compaireUint8(h.body,i.sps))continue;d=h,i.sps=h.body,i.meta.chromaFormat=d.sps.chroma_format,i.meta.codec="avc1.";for(var c=1;c<4;c++){var p=d.body[c].toString(16);p.length<2&&(p="0"+p),i.meta.codec+=p}i.meta.codecHeight=d.sps.codec_size.height,i.meta.codecWidth=d.sps.codec_size.width,i.meta.frameRate=d.sps.frame_rate,i.meta.id=1,i.meta.level=d.sps.level_string,i.meta.presentHeight=d.sps.present_size.height,i.meta.presentWidth=d.sps.present_size.width,i.meta.profile=d.sps.profile_string,i.meta.refSampleDuration=Math.floor(i.meta.timescale*(d.sps.frame_rate.fps_den/d.sps.frame_rate.fps_num)),i.meta.sarRatio=d.sps.sar_ratio?d.sps.sar_ratio:d.sps.par_ratio}else h.pps?(i.pps=h.body,l=h):u+=4+h.body.byteLength}d&&l&&(i.meta.avcc=r.Nalunit.getAvcc(d.body,l.body),this._hasVideoMeta||(this._hasVideoMeta=!0,this.emit(s.METADATA_PARSED,"video")));for(var v=new Uint8Array(u),y=0,m=!1,g=0;g<o.length;g++){var _=o[g],k=_.body.byteLength;_.idr&&(m=!0),_.pps||_.sps||(v.set(new Uint8Array([k>>>24&255,k>>>16&255,k>>>8&255,255&k]),y),y+=4,v.set(_.body,y),y+=k)}var E=new a.VideoTrackSample({dts:parseInt(t.dts/90),pts:parseInt(t.pts/90),cts:(t.pts-t.dts)/90,originDts:t.dts,isKeyframe:m,data:v});i.samples.push(E)}},{key:"destory",value:function(){this.off(s.DEMUX_START,this.demux),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}},{key:"inputBuffer",get:function(){return this._context.getInstance(this.configs.inputbuffer)}},{key:"_tracks",get:function(){return this._context.getInstance("TRACKS")}}],[{key:"compaireUint8",value:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var i=!0,r=0;r<e.byteLength;r++)e[r]!==t[r]&&(i=!1);return i}},{key:"Merge",value:function(e){for(var t=void 0,i=0,r=0,n=0;n<e.length;n++)i+=e[n].length-e[n].position;t=new Uint8Array(i);for(var s=0;s<e.length;s++){var o=e[s];t.set(new Uint8Array(o.buffer,o.position),r),r+=o.length-o.position}return new a.Stream(t.buffer)}},{key:"read",value:function(t,i,r){e.readHeader(t,i),e.readPayload(t,i,r),"MEDIA"!==i.header.packet||1!==i.header.payload||i.unknownPIDs||(i.pes=e.PES(i))}},{key:"readPayload",value:function(t,i,r){var n=i.header.pid;switch(n){case 0:e.PAT(t,i,r);break;case 1:e.CAT(t,i,r);break;case 2:e.TSDT(t,i,r);break;case 8191:break;default:if(r.pat.some((function(e){return e.pid===n})))e.PMT(t,i,r);else{var a=r.pmt?r.pmt.filter((function(e){return e.pid===n})):[];a.length>0?e.Media(t,i,o[a[0].streamType][0]):i.unknownPIDs=!0}}}},{key:"readHeader",value:function(e,t){var i={};i.sync=e.readUint8();var r=e.readUint16();i.error=r>>>15,i.payload=r>>>14&1,i.priority=r>>>13&1,i.pid=8191&r,r=e.readUint8(),i.scrambling=r>>6&3,i.adaptation=r>>4&3,i.continuity=15&r,i.packet=0===i.pid?"PAT":"MEDIA",t.header=i}},{key:"PAT",value:function(e,t,i){var r={},n=e.readUint8();e.skip(n),n=e.readUint8(),r.tabelID=n,n=e.readUint16(),r.error=n>>>7,r.zero=n>>>6&1,r.sectionLength=4095&n,r.streamID=e.readUint16(),r.current=1&e.readUint8(),r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();for(var a=(r.sectionLength-9)/4,s=[],o=0;o<a;o++){var u=e.readUint16(),d=8191&e.readUint16();s.push({program:u,pid:d,type:0===u?"network":"mapPID"})}s.length>0&&(i.pat=i.pat.concat(s)),r.list=s,r.program=e.readUint16(),r.pid=8191&e.readUint16(),t.payload=r}},{key:"PMT",value:function(e,t,i){var r={};t.header.packet="PMT";var n=e.readUint8();e.skip(n),n=e.readUint8(),r.tableID=n,n=e.readUint16(),r.sectionLength=4095&n,r.program=e.readUint16(),r.current=1&e.readUint8(),r.order=e.readUint8(),r.lastOrder=e.readUint8(),r.PCR_PID=8191&e.readUint16(),r.programLength=4095&e.readUint16();for(var a=(r.sectionLength-13)/5,s=[],o=0;o<a;o++)s.push({streamType:e.readUint8(),pid:8191&e.readUint16(),es:4095&e.readUint16()});r.list=s,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(s.map((function(e){return{pid:e.pid,es:e.es,streamType:e.streamType,program:r.program}}))),t.payload=r}},{key:"Media",value:function(e,t,i){var r=t.header,n={};if(r.type=i,3===r.adaptation&&(n.adaptationLength=e.readUint8(),n.adaptationLength>0)){var s=e.readUint8();n.discontinue=s>>>7,n.access=s>>>6&1,n.priority=s>>>5&1,n.PCR=s>>>4&1,n.OPCR=s>>>3&1,n.splicePoint=s>>>2&1,n.transportPrivate=s>>>1&1,n.adaptationField=1&s;var o=e.position;if(1===n.PCR&&(n.programClockBase=e.readUint32()<<1,s=e.readUint16(),n.programClockBase|=s>>>15,n.programClockExtension=511&s),1===n.OPCR&&(n.originProgramClockBase=e.readUint32()<<1,s=e.readUint16(),n.originProgramClockBase+=s>>>15,n.originProgramClockExtension=511&s),1===n.splicePoint&&(n.spliceCountdown=e.readUint8()),1===n.transportPrivate)for(var u=e.readUint8(),d=[],l=0;l<u;l++)d.push(e.readUint8());if(1===n.adaptationField){var f=e.readUint8(),h=e.readUint8(),c=e.position,p=h>>>6&1,v=h>>>5&1;1==h>>>7&&(h=e.readUint16(),n.ltwValid=h>>>15,n.ltwOffset=61439&h),1===p&&(h=e.readUint24(),n.piecewiseRate=4194303&h),1===v&&(h=e.readInt8(),n.spliceType=h>>>4,n.dtsNextAU1=h>>>1&7,n.marker1=1&h,h=e.readUint16(),n.dtsNextAU2=h>>>1,n.marker2=1&h,h=e.readUint16(),n.dtsNextAU3=h),e.skip(f-1-(e.position-c))}var y=n.adaptationLength-1-(e.position-o);e.skip(y)}n.stream=new a.Stream(e.buffer.slice(e.position)),t.payload=n}},{key:"PES",value:function(t){var i={},r=t.payload.stream;if(1!==r.readUint24())i.ES={},i.ES.buffer=r;else{var n=r.readUint8();n>=224&&n<=239&&(i.type="video"),n>=192&&n<=223&&(i.type="audio");var a=r.readUint16();if(i.packetLength=a,"video"!==i.type&&"audio"!==i.type)throw new Error("format is not supported");var s=r.readUint8();if(2!=s>>>6)throw new Error("error when parse pes header");s=r.readUint8(),i.ptsDTSFlag=s>>>6,i.escrFlag=s>>>5&1,i.esRateFlag=s>>>4&1,i.dsmFlag=s>>>3&1,i.additionalFlag=s>>>2&1,i.crcFlag=s>>>1&1,i.extensionFlag=1&s,i.pesHeaderLength=r.readUint8();var o=i.pesHeaderLength;if(2===i.ptsDTSFlag){var u=[];s=r.readUint8(),u.push(s>>>1&7),s=r.readUint16(),u.push(s>>>1),s=r.readUint16(),u.push(s>>>1),i.pts=u[0]<<30|u[1]<<15|u[2],o-=5,"video"===i.type&&(i.dts=i.pts)}if(3===i.ptsDTSFlag){var d=[];s=r.readUint8(),d.push(s>>>1&7),s=r.readUint16(),d.push(s>>>1),s=r.readUint16(),d.push(s>>>1),i.pts=d[0]<<30|d[1]<<15|d[2];var l=[];s=r.readUint8(),l.push(s>>>1&7),s=r.readUint16(),l.push(s>>>1),s=r.readUint16(),l.push(s>>>1),i.dts=l[0]<<30|l[1]<<15|l[2],o-=10}if(1===i.escrFlag){var f=[],h=[];s=r.readUint8(),f.push(s>>>3&7),f.push(3&s),s=r.readUint16(),f.push(s>>>13),f.push(3&s),s=r.readUint16(),f.push(s>>>13),h.push(3&s),s=r.readUint8(),h.push(s>>>1),i.escr=300*(f[0]<<30|f[1]<<28|f[2]<<15|f[3]<<13|f[4])+(h[0]<<7|h[1]),o-=6}if(1===i.esRateFlag&&(s=r.readUint24(),i.esRate=s>>>1&4194303,o-=3),1===i.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===i.additionalFlag&&(s=r.readUint8(),i.additionalCopyInfo=127&s,o-=1),1===i.crcFlag&&(i.pesCRC=r.readUint16(),o-=2),1===i.extensionFlag)throw new Error("not support extension");o>0&&r.skip(o),i.ES=e.ES(r,i.type)}return i}},{key:"ES",value:function(t,i){var r=void 0,n={};if("video"===i){if(1!==(r=t.readUint32())&&(t.back(4),1!==(r=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),n.buffer=t}else{if("audio"!==i)throw new Error("ES "+i+" is not supported");if((r=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");n.id=0==(r>>>3&1)?"MPEG-4":"MPEG-2",n.layer=r>>>1&3,n.absent=1&r,r=t.readUint16(),n.audioObjectType=1+(r>>>14&3),n.profile=n.audioObjectType-1,n.frequencyIndex=r>>>10&15,n.frequence=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][n.frequencyIndex],n.channel=r>>>6&7,n.frameLength=(3&r)<<11|t.readUint16()>>>5,n.audioConfig=e.getAudioConfig(n.audioObjectType,n.channel,n.frequencyIndex),t.skip(1),n.buffer=t}return n}},{key:"TSDT",value:function(e,t,i){t.payload={}}},{key:"CAT",value:function(e,t,i){var r={};r.tableID=e.readUint8();var n=e.readUint16();r.sectionIndicator=n>>>7,r.sectionLength=4095&n,e.skip(2),n=e.readUint8(),r.version=n>>>3,r.currentNextIndicator=1&n,r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();for(var a=(this.sectionLength-9)/4,s=[],o=0;o<a;o++)s.push({});r.crc32=e.readUint32(),t.payload=r}},{key:"getAudioConfig",value:function(e,t,i){var r=void 0,n=void 0,a=navigator.userAgent.toLowerCase();return/firefox/i.test(a)?i>=6?(e=5,r=new Array(4),n=i-3):(e=2,r=new Array(2),n=i):-1!==a.indexOf("android")?(e=2,r=new Array(2),n=i):(e=5,r=new Array(4),i>=6?n=i-3:(1===t&&(e=2,r=new Array(2)),n=i)),r[0]=e<<3,r[0]|=(14&i)>>1,r[1]=(1&i)<<7,r[1]|=t<<3,5===e&&(r[1]|=(14&n)>>1,r[2]=(1&n)<<7,r[2]|=8,r[3]=0),r}}]),e}();t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(9))&&r.__esModule?r:{default:r},a=function(){function e(){c(this,e)}return d(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var i=t.dataview,r=t.position;return 1===i.getInt32(r)||0===i.getInt16(r)&&1===i.getInt8(r+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var i=[],r=e.getHeaderPositionAnnexB(t),n=r.pos,a=n;n<t.length-4;){var s=t.buffer.slice(n,n+r.headerLength);r.pos===t.position&&t.skip(r.headerLength),a=(r=e.getHeaderPositionAnnexB(t)).pos;var o={header:s,body:new Uint8Array(t.buffer.slice(n+s.byteLength,a))};e.analyseNal(o),i.push(o),t.skip(a-t.position),n=a}return i}},{key:"getAvccNals",value:function(t){for(var i=[];t.position<t.length-4;){var r=t.dataview.getInt32();if(!(t.length-t.position>=r))break;var n=t.buffer.slice(t.position,t.position+4);t.skip(4);var a=t.buffer.slice(t.position,t.position+r);t.skip(r);var s={header:n,body:a};e.analyseNal(s),i.push(s)}return i}},{key:"analyseNal",value:function(e){switch(31&e.body[0]){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:break;case 7:e.sps=n.default.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,i=0;3!==i&&4!==i&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(i=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=e.length)),{pos:t,headerLength:i}}},{key:"getAvcc",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength+11);i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225;var r=6;return i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),r),r+=2,i.set(e,r),i[r+=e.byteLength]=1,r++,i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),r),r+=2,i.set(t,r),i}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(t){c(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return d(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0,!1),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){if(e<=this._currentWordBitsLeft){var t=this._currentWord>>>32-e;return this._currentWord<<=e,this._currentWordBitsLeft-=e,t}var i=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;var r=e-this._currentWordBitsLeft;this._fillCurrentWord();var n=Math.min(r,this._currentWordBitsLeft),a=this._currentWord>>>32-n;return this._currentWord<<=n,this._currentWordBitsLeft-=n,i<<n|a}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(0),a=(r=i(40))&&r.__esModule?r:{default:r},s=n.EVENTS.REMUX_EVENTS,o=function(){function e(){c(this,e),this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.videoFixedTimes=0,this.audioFixedTimes=0,this.videoGapAvg=0,this.audioGapAvg=0}return d(e,[{key:"init",value:function(){this.before(s.REMUX_MEDIA,this.doFix.bind(this))}},{key:"reset",value:function(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}},{key:"doFix",value:function(){var e=this.getFirstSample(),t=e.isFirstAudioSamples,i=e.isFirstVideoSamples;this.removeInvalidSamples(),this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples),this.doFixVideo(i),this.doFixAudio(t)}},{key:"doFixVideo",value:function(e){var t=this.videoTrack,i=t.samples,r=t.meta;if((!r.frameRate||!1!==r.frameRate.fixed)&&i&&i.length&&this._firstVideoSample){var n=i[0],a=n.dts,s=i.length;if(e&&this._firstAudioSample){var o=this._firstVideoSample.dts,u=o-this._firstAudioSample.dts;if(u>2*r.refSampleDuration)for(var d=Math.floor(u/r.refSampleDuration),l=0;l<d;l++){var f=Object.assign({},n);f.dts=o-(l+1)*r.refSampleDuration,f.pts=f.dts+f.cts,i.unshift(f),this.filledVideoSamples.push({dts:f.dts,size:f.data.byteLength})}}var h=void 0;if(this.nextVideoDts){h=a-this.nextVideoDts;var c=Math.abs(h);if(h>=2*r.refSampleDuration)for(var p=Math.floor(h/r.refSampleDuration),v=0;v<p;v++){var y=Object.assign({},i[0]),m=a-(v+1)*r.refSampleDuration;y.dts=m>this.nextVideoDts?m:this.nextVideoDts,y.pts=y.dts+y.cts,this.videoTrack.samples.unshift(y),this.filledVideoSamples.push({dts:y.dts,size:y.data.byteLength})}else c<=r.refSampleDuration&&c>0&&(this.recordGapFixTime("video",h),console.log("重定位视频帧dts",i[0].dts,this.nextVideoDts,"pts: "+(this.nextVideoDts+i[0].cts)),i[0].dts=this.nextVideoDts,i[0].originDts=i[0].dts,i[0].cts=i[0].cts||i[0].pts-i[0].dts,i[0].pts=i[0].dts+i[0].cts)}var g=i[i.length-1].dts,_=i.length>=2?g-i[i.length-2].dts:r.refSampleDurationFixed||r.refSampleDuration;this.lastVideoSamplesLen=s,this.nextVideoDts=g+_,this.lastVideoDts=g;for(var k=0,E=i.length;k<E;k++){var b=i[k],S=i[k+1];if(!S)break;var A=S.dts-b.dts;if(A>2*r.refSampleDuration)for(var T=Math.floor(A/r.refSampleDuration),w=0;w<T;){var x=Object.assign({},S);x.dts=b.dts+(w+1)*r.refSampleDuration,x.pts=x.dts+x.cts,x<S.dts&&(i.splice(k,0,x),this.filledVideoSamples.push({dts:x.dts,size:x.data.byteLength})),w++,k++}}this.videoTrack.samples.forEach((function(e){console.log(e.dts)})),this.videoTrack.samples=i}}},{key:"doFixAudio",value:function(t){var i=this.audioTrack,r=i.samples,n=i.meta;if(r&&r.length){var s=r.length,o=a.default.getSilentFrame(n.codec,n.channelCount),u=this._firstAudioSample;if(this._firstVideoSample&&t){var d=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(u.dts-d>n.refSampleDuration)for(var l=Math.floor((u.dts-d)/n.refSampleDuration),f=0;f<l;f++){var h={data:o,datasize:o.byteLength,dts:u.dts-(f+1)*n.refSampleDuration,filtered:0};r.unshift(h),this.filledAudioSamples.push({dts:h.dts,size:h.data.byteLength})}}var c=void 0,p=r[0].dts;if(this.nextAudioDts){c=p-this.nextAudioDts;var v=Math.abs(c);if(c>2*n.refSampleDuration)for(var y=Math.floor(c/n.refSampleDuration),m=0;m<y;m++){var g=p-(m+1)*n.refSampleDuration,_=Object.assign({},r[0],{dts:g>this.nextAudioDts?g:this.nextAudioDts});this.filledAudioSamples.push({dts:_.dts,size:_.data.byteLength}),this.audioTrack.samples.unshift(_)}else v<=n.refSampleDuration&&v>0&&(this.recordGapFixTime("video",c),r[0].dts=this.nextAudioDts,r[0].pts=this.nextAudioDts)}var k=r[r.length-1].dts,E=r.length>=2?k-r[r.length-2].dts:n.refSampleDuration;this.lastAudioSamplesLen=s,this.nextAudioDts=n.refSampleDurationFixed?k+n.refSampleDurationFixed:k+E,this.lastAudioDts=k;for(var b=0,S=r.length;b<S;b++){var A=r[b],T=r[b+1];if(!T)break;var w=T.dts-A.dts;r[b].duration=w}this.audioTrack.samples=e.sortAudioSamples(r)}}},{key:"getFirstSample",value:function(){var t=this.videoTrack.samples,i=this.audioTrack.samples,r=!1,n=!1;return!this._firstVideoSample&&t.length&&(this._firstVideoSample=e.findFirstVideoSample(t),r=!0),!this._firstAudioSample&&i.length&&(this._firstAudioSample=e.findFirstAudioSample(i),n=!0),{isFirstVideoSamples:r,isFirstAudioSamples:n}}},{key:"fixRefSampleDuration",value:function(e,t){var i="video"===e.type,r=i?this.allVideoSamplesCount:this.allAudioSamplesCount,n=i?this._firstVideoSample.dts:this._firstAudioSample.dts,a=i?this.filledVideoSamples.length:this.filledAudioSamples.length,s=i?this.videoFixedTimes:this.filledAudioSamples.length,o=i?this.videoGapAvg:this.audioGapAvg;if(!e.refSampleDuration||e.refSampleDuration<=0||Number.isNaN(e.refSampleDuration)){if(t.length>=1){var u=t[t.length-1].dts;e.refSampleDuration=Math.floor((u-n)/(r+a-1))}}else if(e.refSampleDuration&&t.length>=3){var d=(t[t.length-1].dts-t[0].dts)/(t.length-1);e.refSampleDuration=Math.abs(e.refSampleDuration-d)<=e.refSampleDuration?e.refSampleDuration:d}s>=10&&o>10&&!e.refSampleDurationFixed&&(e.refSampleDurationFixed=e.refSampleDuration-o)}},{key:"recordGapFixTime",value:function(e,t){"video"===e?(this.videoGapAvg=0===this.videoFixedTimes?t:Math.floor(this.videoGapAvg*this.videoFixedTimes/this.videoFixedTimes+1)+Math.floor(t/this.videoFixedTimes+1),this.videoFixedTimes+=1):(this.audioGapAvg=0===this.audioFixedTimes?t:Math.floor(this.audioGapAvg*this.audioFixedTimes/this.audioFixedTimes+1)+Math.floor(t/this.audioFixedTimes+1),this.audioFixedTimes+=1)}},{key:"recordSamplesCount",value:function(){var e=this.audioTrack,t=this.videoTrack;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){var e=this,t=this._firstVideoSample,i=this._firstAudioSample;this.audioTrack.samples=this.audioTrack.samples.filter((function(t){return t.dts>=i.dts&&(void 0===e.lastAudioDts||t.dts>e.lastAudioDts)})),this.videoTrack.samples=this.videoTrack.samples.filter((function(i){return i.dts>=t.dts&&(void 0===e.lastVideoDts||i.dts>e.lastVideoDts)}))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks?this.tracks.audioTrack:null}},{key:"videoTrack",get:function(){return this.tracks?this.tracks.videoTrack:null}}],[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:e.sort((function(e,t){return e.dts-t.dts}))}},{key:"findFirstAudioSample",value:function(t){return t&&0!==t.length?e.sortAudioSamples(t)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;for(var t=e.sort((function(e,t){return e.dts-t.dts})),i=0,r=t.length;i<r;i++)if(t[i].isKeyframe)return t[i]}}]),e}();t.default=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(){c(this,e)}return d(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function e(){c(this,e),this.mimetype="",this.init=null,this.data=[]};t.default=function(){function e(){c(this,e),this.sources={}}return d(e,[{key:"getSource",value:function(e){return this.sources[e]}},{key:"createSource",value:function(e){return this.sources[e]=new r,this.sources[e]}},{key:"clear",value:function(){this.sources={}}},{key:"destroy",value:function(){this.sources={}}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(t){c(this,e),this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=t.autoclear||!1}return d(e,[{key:"push",value:function(e,t){this._ts[e]||(this._ts[e]={duration:t,downloaded:!1,downloading:!1,start:this.duration},this._list[this.duration]=e,this.duration+=t,this.fragLength+=1)}},{key:"deleteFrag",value:function(e){this._ts[e]&&(this._ts[e].start>this._lastget.time&&(this._lastget={duration:this._ts[e].duration,time:this._ts[e].start,downloaded:!1,downloading:!1,url:e}),delete this._list[this._ts[e].start],delete this._ts[e],this.fragLength-=1)}},{key:"pushM3U8",value:function(e,t){if(e&&(this.version=e.version,this.targetduration=e.targetduration,e.encrypt&&!this.encrypt&&(this.encrypt=e.encrypt),e.sequence>this.sequence)){this.sequence=e.sequence;for(var i=[],r=0;r<e.frags.length;r++){var n=e.frags[r];this._ts[n.url]||(i.push(n.url),this.push(n.url,n.duration))}if(t)for(var a=this.getTsList(),s=0;s<a.length;s++)i.indexOf(a[s])<0&&this.deleteFrag(a[s])}}},{key:"getTsList",value:function(){return Object.keys(this._ts)}},{key:"downloaded",value:function(e,t){var i=this._ts[e];i&&(i.downloaded=t)}},{key:"downloading",value:function(e,t){var i=this._ts[e];i&&(i.downloading=t)}},{key:"getTsByName",value:function(e){return this._ts[e]}},{key:"getTs",value:function(e){var t=void 0,i=Object.keys(this._list);if(void 0===e&&(e=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||e>=this.duration)){i.sort((function(e,t){return parseFloat(e)-parseFloat(t)}));for(var r=0;r<i.length&&e>=parseInt(i[r]);r++){var n=this._list[i[r]];t={url:n,downloaded:this._ts[n].downloaded,downloading:this._ts[n].downloading,time:parseInt(i[r]),duration:parseInt(this._ts[n].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=t}return t}}},{key:"clear",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}},{key:"clearDownloaded",value:function(){for(var e=0,t=Object.keys(this._ts).length;e<t;e++){var i=this._ts[Object.keys(this._ts)[e]];i.downloaded=!1,i.downloading=!1}}},{key:"destroy",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=!1}},{key:"list",get:function(){return this._list}},{key:"baseURL",set:function(e){this.baseURL!==e&&(this.clear(),this._baseURL=e)},get:function(){return this._baseURL}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(0),a=i(2),s=i(3),o=(r=i(44))&&r.__esModule?r:{default:r},u=n.EVENTS.DEMUX_EVENTS,l=function(){function e(){c(this,e),this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}return d(e,[{key:"init",value:function(){this.on(u.DEMUX_START,this.doParseFlv.bind(this))}},{key:"doParseFlv",value:function(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;var e=void 0,t=1e5;do{e=this._parseFlvTag()}while(e&&t-- >0);this.emit(u.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;var i=this.loaderBuffer.shift(13);this.parseFlvHeader(i),this.doParseFlv()}}},{key:"parseFlvHeader",value:function(t){if(e.isFlvFile(t)){this._firstFragmentLoaded=!0;var i=e.getPlayType(t[4]);i.hasVideo&&this.initVideoTrack(),i.hasAudio&&this.initAudioTrack()}else this.emit(u.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}},{key:"initVideoTrack",value:function(){this._trackNum++;var e=new s.VideoTrack;e.meta=new n.VideoTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;var e=new s.AudioTrack;e.meta=new n.AudioTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"_parseFlvTag",value:function(){if(this.loaderBuffer.length<11)return null;var e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}},{key:"_parseFlvTagHeader",value:function(){var e=0,t={},i=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&i)>>>5,t.tagType=31&i,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.logger.warn(this.TAG,"tagType "+t.tagType),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);var r=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);var n=this.loaderBuffer.shift(1)[0];return n>0&&(r+=16777216*n),t.dts=r,this.loaderBuffer.shift(3),t}},{key:"_processChunk",value:function(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}},{key:"_parseScriptData",value:function(e){var t=this.tracks.audioTrack,i=this.tracks.videoTrack,r=this.loaderBuffer.shift(e.datasize),n=(new o.default).resolve(r,r.length),a=this._context.onMetaData=n?n.onMetaData:void 0;if(this._context.mediaInfo.duration=a.duration,this._context.mediaInfo.hasVideo=a.hasVideo,this._context.mediaInfo.hsaAudio=a.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(u.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){var s=t.meta;switch(a.audiosamplerate&&(s.sampleRate=a.audiosamplerate),a.audiochannels&&(s.channelCount=a.audiochannels),a.audiosamplerate){case 44100:s.sampleRateIndex=4;break;case 22050:s.sampleRateIndex=7;break;case 11025:s.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){var d=i.meta;if("number"==typeof a.framerate){var l=Math.floor(1e3*a.framerate);if(l>0){var f=l/1e3;d.frameRate||(d.frameRate={}),d.frameRate.fixed=!0,d.frameRate.fps=f,d.frameRate.fps_num=l,d.frameRate.fps_den=1e3}}}}},{key:"_aacSequenceHeaderParser",value:function(e){var t={hasSpecificConfig:!0};t.objectType=e[1]>>>3,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2],t.codec="mp4a.40."+t.objectType;var i=void 0,r=void 0,n=window.navigator.userAgent.toLowerCase(),a=t.sampleRateIndex;return-1!==n.indexOf("firefox")?t.sampleRateIndex>=6?(t.objectType=5,r=new Array(4),i=a-3):(t.objectType=2,r=new Array(2),i=a):-1!==n.indexOf("android")?(t.objectType=2,r=new Array(2),i=a):(t.objectType=5,i=t.sampleRateIndex,r=new Array(4),t.sampleRateIndex>=6?i=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,r=new Array(2),i=t.sampleRateIndex)),r[0]=t.objectType<<3,r[0]|=(15&t.sampleRateIndex)>>>1,r[1]=(15&t.sampleRateIndex)<<7,r[1]|=(15&t.channelCount)<<3,5===t.objectType&&(r[1]|=(15&i)>>>1,r[2]=(1&i)<<7,r[2]|=8,r[3]=0),t.config=r,t}},{key:"_parseAACData",value:function(e){var t=this.tracks.audioTrack;if(t){var i=t.meta;i||(i=new n.AudioTrackMeta);var r=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);var a=(240&r)>>>4;t.format=a,10!==a&&this.emit(u.DEMUX_ERROR,new Error("invalid audio format: "+a)),10!==a||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(r),i.sampleRateIndex=(12&r)>>>2,i.frameLenth=(2&r)>>>1,i.channelCount=1&r,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));var s=i.audioSampleRate,o=i.sampleRateIndex,d=i.refSampleDuration;delete e.tagType;var l=this._datasizeValidator(e.datasize);if(0===e.data[0]){var f=this._aacSequenceHeaderParser(e.data);s=f.audiosamplerate||i.audioSampleRate,o=f.sampleRateIndex||i.sampleRateIndex,d=Math.floor(1024/s*i.timescale),i.channelCount=f.channelCount,i.sampleRate=s,i.sampleRateIndex=o,i.refSampleDuration=d,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=f.config;var h=this._context.mediaInfo.audio;h.codec=f.codec,h.channelCount=f.channelCount,h.sampleRate=s,h.sampleRateIndex=f.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(u.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&this.emit(u.AUDIO_METADATA_CHANGE),this._hasAudioSequence=!0}else e.data=e.data.slice(1,e.data.length),t.samples.push(e);if(!l){var c=new Error("TAG length error at "+e.datasize);this.emit(u.DEMUX_ERROR,c.message),this.logger.warn(this.TAG,c.message)}}}},{key:"_parseHevcData",value:function(e){var t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;var i=15&t;if(this.tracks.videoTrack.codecID=i,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){var r=this.loaderBuffer.shift(e.datasize-5);if(e.data=r,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize);var n={},a=0;for(n.cts=e.cts,n.dts=e.dts;e.data.length>a;){var s=e.data.slice(Number.parseInt(a),4+a);n.size=s[3],n.size+=256*s[2],n.size+=256*s[1]*256,n.size+=256*s[0]*256*256,a+=4,n.data=e.data.slice(Number.parseInt(a),n.size+a),a+=n.size,this.tracks.videoTrack.samples.push(n),this.emit(u.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(u.METADATA_PARSED,"video"):this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize))}else if(7===i){var o=this.loaderBuffer.shift(e.datasize-5);if(0===o[4]&&0===o[5]&&0===o[6]&&1===o[7]){for(var d=0,l=0;l<4;l++)d=256*d+o[l];d-=4,(o=o.slice(4,o.length))[3]=d%256,d=(d-o[3])/256,o[2]=d%256,d=(d-o[2])/256,o[1]=d%256,o[0]=(d-o[1])/256}if(e.data=o,0===e.avcPacketType)this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(u.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&this.emit(u.VIDEO_METADATA_CHANGE),this._hasVideoSequence=!0);else{if(!this._datasizeValidator(e.datasize))return void this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize);this.tracks.videoTrack.samples.push(e)}}else this.logger.warn(this.TAG,"video codeid is "+i),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize),this.tracks.videoTrack.samples.push(e),this.emit(u.DEMUX_COMPLETE);delete e.tagType}},{key:"_avcSequenceHeaderParser",value:function(e){var t=this.tracks.videoTrack;if(t){var i=0;t.meta||(t.meta=new n.VideoTrackMeta);var r=t.meta;r.configurationVersion=e[0],r.avcProfileIndication=e[1],r.profileCompatibility=e[2],r.avcLevelIndication=e[3]/10,r.nalUnitLength=1+(3&e[4]);var s=31&e[5];i=6;for(var o={},u=0;u<s;u++){var d=255*e[i]+e[i+1];i+=2;for(var l=new Uint8Array(d),f=0;f<d;f++)l[f]=e[i+f];for(var h="avc1.",c=1;c<4;c++){var p=l[c].toString(16);p.length<2&&(p="0"+p),h+=p}r.codec=h,i+=d,this.tracks.videoTrack.meta.sps=l,o=a.SpsParser.parseSPS(l)}var v=e[i];i++;for(var y=0;y<v;y++){var m=255*e[i]+e[i+1];i+=2;for(var g=new Uint8Array(m),_=0;_<m;_++)g[_]=e[i+_];i+=m,this.tracks.videoTrack.meta.pps=g}Object.assign(r,a.SpsParser.toVideoMeta(o));var k=this._context.mediaInfo.video;k.codec=r.codec,k.profile=r.profile,k.level=r.level,k.chromaFormat=r.chromaFormat,k.frameRate=r.frameRate,k.parRatio=r.parRatio,k.width=k.width===r.presentWidth?k.width:r.presentWidth,k.height=k.height===r.presentHeight?k.width:r.presentHeight,r.duration=this._context.mediaInfo.duration*r.timescale,r.avcc=new Uint8Array(e.length),r.avcc.set(e),t.meta=r}}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e){var t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}},{key:"loaderBuffer",get:function(){var e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(u.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}}],[{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),e}();t.default=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),n=0,a=1,s=2,o=3,u=8,l=9,f=10,h=11,p=12;t.default=function(){function e(){c(this,e),this.offset=0,this.readOffset=this.offset}return d(e,[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");var i={},r=this.parseValue(e),n=this.parseValue(e,t-r.bodySize);return i[r.data]=n.data,this.resetStatus(),i}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t,i=new DataView(e,this.readOffset).getUint16(0,!r.isLe);t=i>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,i)):"";var n=i+2;return this.readOffset+=n,{data:t,bodySize:i+2}}},{key:"parseDate",value:function(e,t){var i=new DataView(e,this.readOffset,t),n=i.getFloat64(0,!r.isLe);return n+=60*i.getInt16(8,!r.isLe)*1e3,this.readOffset+=10,{data:new Date(n),bodySize:10}}},{key:"parseObject",value:function(e,t){var i=this.parseString(e,t),r=this.parseValue(e,t-i.bodySize);return{data:{name:i.data,value:r.data},bodySize:i.bodySize+r.bodySize,isObjEnd:r.isObjEnd}}},{key:"parseLongString",value:function(e){var t,i=new DataView(e,this.readOffset).getUint32(0,!r.isLe);return t=i>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,i)):"",this.readOffset+=i+4,{data:t,bodySize:i+4}}},{key:"parseValue",value:function(e,t){var i=new ArrayBuffer;i=e instanceof ArrayBuffer?e:e.buffer;var d=n,c=a,v=s,y=o,m=u,g=l,_=f,k=h,E=p,b=new DataView(i,this.readOffset,t),S=!1,A=b.getUint8(0),T=1;this.readOffset+=1;var w=null;switch(A){case d:w=b.getFloat64(1,!r.isLe),this.readOffset+=8,T+=8;break;case c:w=!!b.getUint8(1),this.readOffset+=1,T+=1;break;case v:var x=this.parseString(i);w=x.data,T+=x.bodySize;break;case y:w={};var D=0;for(16777215&b.getUint32(t-4,!r.isLe)&&(D=3);T<t-4;){var O=this.parseObject(i,t-T-D);if(O.isObjectEnd)break;w[O.data.name]=O.data.value,T+=O.bodySize}T<=t-3&&9==(16777215&b.getUint32(T-1,!r.isLe))&&(this.readOffset+=3,T+=3);break;case m:w={},T+=4,this.readOffset+=4;var R=0;for(9==(16777215&b.getUint32(t-4,!r.isLe))&&(R=3);T<t-8;){var L=this.parseObject(i,t-T-R);if(L.isObjectEnd)break;w[L.data.name]=L.data.value,T+=L.bodySize}T<=t-3&&9==(16777215&b.getUint32(T-1,!r.isLe))&&(T+=3,this.readOffset+=3);break;case g:w=null,S=!0;break;case _:w=[];var M=b.getUint32(1,!r.isLe);T+=4,this.readOffset+=4;for(var U=0;U<M;U++){var B=this.parseValue(i,t-T);w.push(B.data),T+=B.bodySize}break;case k:var j=this.parseDate(i,t-1);w=j.data,T+=j.bodySize;break;case E:var I=this.parseLongString(i,t-1);w=I.data,T+=I.bodySize;break;default:T=t}return{data:w,bodySize:T,isObjEnd:S}}}]),e}()}])},"object"==l(t)&&"object"==l(e)?e.exports=s(i(0)):(n=[i(0)],void 0===(a="function"==typeof(r=s)?r.apply(t,n):r)||(e.exports=a))}).call(this,i(1)(e))},function(e,t,i){"use strict";(function(e){var r,n,a,s,o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}window,s=function(e){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":l(e))&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"../../node_modules/events/events.js":
/*!*****************************************************************************************!*\
      !*** /Users/leonardo/Documents/front-end/player/xgplayer/node_modules/events/events.js ***!
      \*****************************************************************************************/
/*! no static exports found */function(e,t,i){var r,n="object"==("undefined"==typeof Reflect?"undefined":l(Reflect))?Reflect:null,a=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function f(e,t,i,r){var n,a,s,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===i?"undefined":l(i)));if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=d(e))>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,o=u,console&&console.warn&&console.warn(o)}return e}function h(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function c(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=h.bind(r);return n.listener=i,r.wrapFn=n,n}function p(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):y(n,n.length)}function v(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function y(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)a(u,this,t);else{var d=u.length,l=y(u,d);for(i=0;i<d;++i)a(l[i],this,t)}return!0},o.prototype.addListener=function(e,t){return f(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return f(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":l(t)));return this.on(e,c(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":l(t)));return this.prependListener(e,c(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,a,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===t?"undefined":l(t)));if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,n=a;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,a=Object.keys(i);for(r=0;r<a.length;++r)"removeListener"!==(n=a[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},o.prototype.listenerCount=v,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},"../xgplayer-buffer/index.js":
/*!***********************************!*\
      !*** ../xgplayer-buffer/index.js ***!
      \***********************************/
/*! no static exports found */function(e,t,i){e.exports={Track:i(/*! ./src/track */"../xgplayer-buffer/src/track.js").default,Tracks:i(/*! ./src/track */"../xgplayer-buffer/src/track.js").Tracks,AudioTrack:i(/*! ./src/track */"../xgplayer-buffer/src/track.js").AudioTrack,VideoTrack:i(/*! ./src/track */"../xgplayer-buffer/src/track.js").VideoTrack,XgBuffer:i(/*! ./src/buffer */"../xgplayer-buffer/src/buffer.js").XgBuffer,RemuxBuffer:i(/*! ./src/buffer */"../xgplayer-buffer/src/buffer.js").RemuxBuffer,PreSource:i(/*! ./src/presouce */"../xgplayer-buffer/src/presouce.js").default}},"../xgplayer-buffer/src/buffer.js":
/*!****************************************!*\
      !*** ../xgplayer-buffer/src/buffer.js ***!
      \****************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XgBuffer=function(){function e(t){c(this,e),this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}return d(e,[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){var t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){var i=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,i}for(var r=new Uint8Array(e),n=0;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){var a=this.array[0].slice(this.offset,this.offset+e);r.set(a,n),this.offset+=e,this.length-=e,e=0;break}var s=this.array[0].length-this.offset;r.set(this.array[0].slice(this.offset,this.array[0].length),n),this.array.shift(),this.offset=0,n+=s,this.length-=s,e-=s}return r}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){for(var i=0,r=this.offset+e;r<this.offset+t+e;)r<this.array[0].length?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++;return i}}]),e}(),t.RemuxBuffer=function(){function e(){c(this,e),this.video=[],this.audio=[]}return d(e,[{key:"destroy",value:function(){this.video=[],this.audio=[]}}]),e}()},"../xgplayer-buffer/src/presouce.js":
/*!******************************************!*\
      !*** ../xgplayer-buffer/src/presouce.js ***!
      \******************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function e(){c(this,e),this.mimetype="",this.init=null,this.data=[]};t.default=function(){function e(){c(this,e),this.sources={}}return d(e,[{key:"getSource",value:function(e){return this.sources[e]}},{key:"createSource",value:function(e){return this.sources[e]=new r,this.sources[e]}},{key:"clear",value:function(){this.sources={}}},{key:"destroy",value:function(){this.sources={}}}]),e}()},"../xgplayer-buffer/src/track.js":
/*!***************************************!*\
      !*** ../xgplayer-buffer/src/track.js ***!
      \***************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){c(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return d(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"distroy",value:function(){this.reset(),this.id=-1}}]),e}();t.default=r,t.AudioTrack=function(e){function t(){var e;return c(this,t),(e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).TAG="AudioTrack",e.type="audio",e}return h(t,e),t}(r),t.VideoTrack=function(e){function t(){var e;return c(this,t),(e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).TAG="VideoTrack",e.type="video",e.dropped=0,e}return h(t,e),d(t,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),t}(r),t.Tracks=function(){function e(){c(this,e),this.audioTrack=null,this.videoTrack=null}return d(e,[{key:"destroy",value:function(){this.audioTrack=null,this.videoTrack=null}}]),e}()},"../xgplayer-codec/index.js":
/*!**********************************!*\
      !*** ../xgplayer-codec/index.js ***!
      \**********************************/
/*! no static exports found */function(e,t,i){e.exports={Nalunit:i(/*! ./src/h264/nalunit */"../xgplayer-codec/src/h264/nalunit/index.js").default,SpsParser:i(/*! ./src/h264/nalunit/sps */"../xgplayer-codec/src/h264/nalunit/sps.js").default,Compatibility:i(/*! ./src/compatibility */"../xgplayer-codec/src/compatibility.js").default}},"../xgplayer-codec/src/aac/aac-helper.js":
/*!***********************************************!*\
      !*** ../xgplayer-codec/src/aac/aac-helper.js ***!
      \***********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(){c(this,e)}return d(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}()},"../xgplayer-codec/src/compatibility.js":
/*!**********************************************!*\
      !*** ../xgplayer-codec/src/compatibility.js ***!
      \**********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),a=(r=i(/*! ./aac/aac-helper */"../xgplayer-codec/src/aac/aac-helper.js"))&&r.__esModule?r:{default:r},s=n.EVENTS.REMUX_EVENTS,o=function(){function e(){c(this,e),this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}return d(e,[{key:"init",value:function(){this.before(s.REMUX_MEDIA,this.doFix.bind(this))}},{key:"reset",value:function(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}},{key:"doFix",value:function(){var e=this.getFirstSample(),t=e.isFirstAudioSamples,i=e.isFirstVideoSamples;this.removeInvalidSamples(),this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples),this.doFixVideo(i),this.doFixAudio(t)}},{key:"doFixVideo",value:function(e){var t=this.videoTrack,i=t.samples,r=t.meta;if((!r.frameRate||!1!==r.frameRate.fixed)&&i&&i.length&&this._firstVideoSample){var n=i[0],a=n.dts,s=i.length;if(e&&this._firstAudioSample){var o=this._firstVideoSample.dts,u=o-this._firstAudioSample.dts;if(u>2*r.refSampleDuration)for(var d=Math.floor(u/r.refSampleDuration),l=0;l<d;l++){var f=Object.assign({},n);f.dts=o-(l+1)*r.refSampleDuration,f.pts=f.dts+f.cts,i.unshift(f),this.filledVideoSamples.push({dts:f.dts,size:f.data.byteLength})}}var h=void 0;if(this.nextVideoDts){h=a-this.nextVideoDts;var c=Math.abs(h);if(h>2*r.refSampleDuration)for(var p=Math.floor(h/r.refSampleDuration),v=0;v<p;v++){var y=Object.assign({},i[0]),m=a-(v+1)*r.refSampleDuration;y.dts=m>this.nextVideoDts?m:this.nextVideoDts,y.pts=y.dts+y.cts,this.videoTrack.samples.unshift(y),this.filledVideoSamples.push({dts:y.dts,size:y.data.byteLength})}else c<=10&&c>0&&(i[0].dts=this.nextVideoDts,i[0].originDts=i[0].dts,i[0].cts=i[0].cts||i[0].pts-i[0].dts,i[0].pts=i[0].dts+i[0].cts)}var g=i[i.length-1].dts,_=i.length>=2?g-i[i.length-2].dts:r.refSampleDuration;this.lastVideoSamplesLen=s,this.nextVideoDts=g+_,this.lastVideoDts=g;for(var k=0,E=i.length;k<E;k++){var b=i[k],S=i[k+1];if(!S)break;var A=S.dts-b.dts;if(A>2*r.refSampleDuration)for(var T=Math.floor(A/r.refSampleDuration),w=0;w<T;){var x=Object.assign({},S);x.dts=b.dts+(w+1)*r.refSampleDuration,x.pts=x.dts+x.cts,x<S.dts&&(i.splice(k,0,x),this.filledVideoSamples.push({dts:x.dts,size:x.data.byteLength})),w++,k++}}this.videoTrack.samples=i}}},{key:"doFixAudio",value:function(t){var i=this.audioTrack,r=i.samples,n=i.meta;if(r&&r.length){var s=r.length,o=a.default.getSilentFrame(n.codec,n.channelCount),u=this._firstAudioSample;if(this._firstVideoSample&&t){var d=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(u.dts-d>n.refSampleDuration)for(var l=Math.floor((u.dts-d)/n.refSampleDuration),f=0;f<l;f++){var h={data:o,datasize:o.byteLength,dts:u.dts-(f+1)*n.refSampleDuration,filtered:0};r.unshift(h),this.filledAudioSamples.push({dts:h.dts,size:h.data.byteLength})}}var c=void 0,p=r[0].dts;if(this.nextAudioDts){c=p-this.nextAudioDts;var v=Math.abs(c);if(v>n.refSampleDuration&&1===s&&1===this.lastAudioSamplesLen&&(n.refSampleDurationFixed=void 0),c>2*n.refSampleDuration)if(1===s&&1===this.lastAudioSamplesLen)n.refSampleDurationFixed=void 0!==n.refSampleDurationFixed?n.refSampleDurationFixed+c:n.refSampleDuration+c;else for(var y=Math.floor(c/n.refSampleDuration),m=0;m<y;m++){var g=p-(m+1)*n.refSampleDuration,_=Object.assign({},r[0],{dts:g>this.nextAudioDts?g:this.nextAudioDts});this.filledAudioSamples.push({dts:_.dts,size:_.data.byteLength}),this.audioTrack.samples.unshift(_)}else v<=10&&v>0&&(r[0].dts=this.nextAudioDts,r[0].pts=this.nextAudioDts)}var k=r[r.length-1].dts,E=r.length>=2?k-r[r.length-2].dts:n.refSampleDuration;this.lastAudioSamplesLen=s,this.nextAudioDts=n.refSampleDurationFixed?k+n.refSampleDurationFixed:k+E,this.lastAudioDts=k;for(var b=0,S=r.length;b<S;b++){var A=r[b],T=r[b+1];if(!T)break;var w=T.dts-A.dts;r[b].duration=w}this.audioTrack.samples=e.sortAudioSamples(r)}}},{key:"getFirstSample",value:function(){var t=this.videoTrack.samples,i=this.audioTrack.samples,r=!1,n=!1;return!this._firstVideoSample&&t.length&&(this._firstVideoSample=e.findFirstVideoSample(t),r=!0),!this._firstAudioSample&&i.length&&(this._firstAudioSample=e.findFirstAudioSample(i),n=!0),{isFirstVideoSamples:r,isFirstAudioSamples:n}}},{key:"fixRefSampleDuration",value:function(e,t){var i="video"===e.type,r=i?this.allVideoSamplesCount:this.allAudioSamplesCount,n=i?this._firstVideoSample.dts:this._firstAudioSample.dts,a=i?this.filledVideoSamples.length:this.filledAudioSamples.length;if(!e.refSampleDuration||e.refSampleDuration<=0||Number.isNaN(e.refSampleDuration)){if(t.length>=1){var s=t[t.length-1].dts;e.refSampleDuration=Math.floor((s-n)/(r+a-1))}}else if(e.refSampleDuration&&t.length>=3){var o=(t[t.length-1].dts-t[0].dts)/(t.length-1);e.refSampleDuration=Math.abs(e.refSampleDuration-o)<=e.refSampleDuration?e.refSampleDuration:o}}},{key:"recordSamplesCount",value:function(){var e=this.audioTrack,t=this.videoTrack;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){var e=this,t=this._firstVideoSample,i=this._firstAudioSample;this.audioTrack.samples=this.audioTrack.samples.filter((function(t){return t.dts>=i.dts&&(void 0===e.lastAudioDts||t.dts>e.lastAudioDts)})),this.videoTrack.samples=this.videoTrack.samples.filter((function(i){return i.dts>=t.dts&&(void 0===e.lastVideoDts||i.dts>e.lastVideoDts)}))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks?this.tracks.audioTrack:null}},{key:"videoTrack",get:function(){return this.tracks?this.tracks.videoTrack:null}}],[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:e.sort((function(e,t){return e.dts-t.dts}))}},{key:"findFirstAudioSample",value:function(t){return t&&0!==t.length?e.sortAudioSamples(t)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;for(var t=e.sort((function(e,t){return e.dts-t.dts})),i=0,r=t.length;i<r;i++)if(t[i].isKeyframe)return t[i]}}]),e}();t.default=o},"../xgplayer-codec/src/h264/nalunit/golomb.js":
/*!****************************************************!*\
      !*** ../xgplayer-codec/src/h264/nalunit/golomb.js ***!
      \****************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(t){c(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return d(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0,!1),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){if(e<=this._currentWordBitsLeft){var t=this._currentWord>>>32-e;return this._currentWord<<=e,this._currentWordBitsLeft-=e,t}var i=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;var r=e-this._currentWordBitsLeft;this._fillCurrentWord();var n=Math.min(r,this._currentWordBitsLeft),a=this._currentWord>>>32-n;return this._currentWord<<=n,this._currentWordBitsLeft-=n,i<<n|a}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}()},"../xgplayer-codec/src/h264/nalunit/index.js":
/*!***************************************************!*\
      !*** ../xgplayer-codec/src/h264/nalunit/index.js ***!
      \***************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(/*! ./sps */"../xgplayer-codec/src/h264/nalunit/sps.js"))&&r.__esModule?r:{default:r},a=function(){function e(){c(this,e)}return d(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var i=t.dataview,r=t.position;return 1===i.getInt32(r)||0===i.getInt16(r)&&1===i.getInt8(r+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var i=[],r=e.getHeaderPositionAnnexB(t),n=r.pos,a=n;n<t.length-4;){var s=t.buffer.slice(n,n+r.headerLength);r.pos===t.position&&t.skip(r.headerLength),a=(r=e.getHeaderPositionAnnexB(t)).pos;var o={header:s,body:new Uint8Array(t.buffer.slice(n+s.byteLength,a))};e.analyseNal(o),i.push(o),t.skip(a-t.position),n=a}return i}},{key:"getAvccNals",value:function(t){for(var i=[];t.position<t.length-4;){var r=t.dataview.getInt32();if(!(t.length-t.position>=r))break;var n=t.buffer.slice(t.position,t.position+4);t.skip(4);var a=t.buffer.slice(t.position,t.position+r);t.skip(r);var s={header:n,body:a};e.analyseNal(s),i.push(s)}return i}},{key:"analyseNal",value:function(e){switch(31&e.body[0]){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:break;case 7:e.sps=n.default.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,i=0;3!==i&&4!==i&&t<e.length-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===e.length-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)&&(i=4):(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=e.length)),{pos:t,headerLength:i}}},{key:"getAvcc",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength+11);i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225;var r=6;return i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),r),r+=2,i.set(e,r),i[r+=e.byteLength]=1,r++,i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),r),r+=2,i.set(t,r),i}}]),e}();t.default=a},"../xgplayer-codec/src/h264/nalunit/sps.js":
/*!*************************************************!*\
      !*** ../xgplayer-codec/src/h264/nalunit/sps.js ***!
      \*************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(/*! ./golomb */"../xgplayer-codec/src/h264/nalunit/golomb.js"))&&r.__esModule?r:{default:r},a=function(){function e(){c(this,e)}return d(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),r=new n.default(i);r.readByte();var a=r.readByte();r.readByte();var s=r.readByte();r.readUEG();var o=e.getProfileString(a),u=e.getLevelString(s),d=1,l=420,f=8;if((100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a||138===a||144===a)&&(3===(d=r.readUEG())&&r.readBits(1),d<=3&&(l=[0,420,422,444][d]),f=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var h=3!==d?8:12,c=0;c<h;c++)r.readBool()&&(c<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var p=r.readUEG();if(0===p)r.readUEG();else if(1===p){r.readBits(1),r.readSEG(),r.readSEG();for(var v=r.readUEG(),y=0;y<v;y++)r.readSEG()}r.readUEG(),r.readBits(1);var m=r.readUEG(),g=r.readUEG(),_=r.readBits(1);0===_&&r.readBits(1),r.readBits(1);var k=0,E=0,b=0,S=0;r.readBool()&&(k=r.readUEG(),E=r.readUEG(),b=r.readUEG(),S=r.readUEG());var A=1,T=1,w=0,x=!0,D=0,O=0;if(r.readBool()){if(r.readBool()){var R=r.readByte();R>0&&R<16?(A=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][R-1],T=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][R-1]):255===R&&(A=r.readByte()<<8|r.readByte(),T=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var L=r.readBits(32),M=r.readBits(32);x=r.readBool(),w=(D=M)/(O=2*L)}}var U=1;1===A&&1===T||(U=A/T);var B=0,j=0;0===d?(B=1,j=2-_):(B=3===d?1:2,j=(1===d?2:1)*(2-_));var I=16*(m+1),P=16*(g+1)*(2-_);I-=(k+E)*B,P-=(b+S)*j;var C=Math.ceil(I*U);return r.destroy(),r=null,{profile_string:o,level_string:u,bit_depth:f,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:x,fps:w,fps_den:O,fps_num:D},par_ratio:{width:A,height:T},codec_size:{width:I,height:P},present_size:{width:C,height:P}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var i=t.frameRate.fps_den,r=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(i/r))}}]),e}();t.default=a},"../xgplayer-demux/src/flv/amf-parser.js":
/*!***********************************************!*\
      !*** ../xgplayer-demux/src/flv/amf-parser.js ***!
      \***********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),n=0,a=1,s=2,o=3,u=8,l=9,f=10,h=11,p=12;t.default=function(){function e(){c(this,e),this.offset=0,this.readOffset=this.offset}return d(e,[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");var i={},r=this.parseValue(e),n=this.parseValue(e,t-r.bodySize);return i[r.data]=n.data,this.resetStatus(),i}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t,i=new DataView(e,this.readOffset).getUint16(0,!r.isLe);t=i>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,i)):"";var n=i+2;return this.readOffset+=n,{data:t,bodySize:i+2}}},{key:"parseDate",value:function(e,t){var i=new DataView(e,this.readOffset,t),n=i.getFloat64(0,!r.isLe);return n+=60*i.getInt16(8,!r.isLe)*1e3,this.readOffset+=10,{data:new Date(n),bodySize:10}}},{key:"parseObject",value:function(e,t){var i=this.parseString(e,t),r=this.parseValue(e,t-i.bodySize);return{data:{name:i.data,value:r.data},bodySize:i.bodySize+r.bodySize,isObjEnd:r.isObjEnd}}},{key:"parseLongString",value:function(e){var t,i=new DataView(e,this.readOffset).getUint32(0,!r.isLe);return t=i>0?r.UTF8.decode(new Uint8Array(e,this.readOffset+2,i)):"",this.readOffset+=i+4,{data:t,bodySize:i+4}}},{key:"parseValue",value:function(e,t){var i=new ArrayBuffer;i=e instanceof ArrayBuffer?e:e.buffer;var d=n,c=a,v=s,y=o,m=u,g=l,_=f,k=h,E=p,b=new DataView(i,this.readOffset,t),S=!1,A=b.getUint8(0),T=1;this.readOffset+=1;var w=null;switch(A){case d:w=b.getFloat64(1,!r.isLe),this.readOffset+=8,T+=8;break;case c:w=!!b.getUint8(1),this.readOffset+=1,T+=1;break;case v:var x=this.parseString(i);w=x.data,T+=x.bodySize;break;case y:w={};var D=0;for(16777215&b.getUint32(t-4,!r.isLe)&&(D=3);T<t-4;){var O=this.parseObject(i,t-T-D);if(O.isObjectEnd)break;w[O.data.name]=O.data.value,T+=O.bodySize}T<=t-3&&9==(16777215&b.getUint32(T-1,!r.isLe))&&(this.readOffset+=3,T+=3);break;case m:w={},T+=4,this.readOffset+=4;var R=0;for(9==(16777215&b.getUint32(t-4,!r.isLe))&&(R=3);T<t-8;){var L=this.parseObject(i,t-T-R);if(L.isObjectEnd)break;w[L.data.name]=L.data.value,T+=L.bodySize}T<=t-3&&9==(16777215&b.getUint32(T-1,!r.isLe))&&(T+=3,this.readOffset+=3);break;case g:w=null,S=!0;break;case _:w=[];var M=b.getUint32(1,!r.isLe);T+=4,this.readOffset+=4;for(var U=0;U<M;U++){var B=this.parseValue(i,t-T);w.push(B.data),T+=B.bodySize}break;case k:var j=this.parseDate(i,t-1);w=j.data,T+=j.bodySize;break;case E:var I=this.parseLongString(i,t-1);w=I.data,T+=I.bodySize;break;default:T=t}return{data:w,bodySize:T,isObjEnd:S}}}]),e}()},"../xgplayer-demux/src/flv/index.js":
/*!******************************************!*\
      !*** ../xgplayer-demux/src/flv/index.js ***!
      \******************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),a=i(/*! xgplayer-codec */"../xgplayer-codec/index.js"),s=i(/*! xgplayer-buffer */"../xgplayer-buffer/index.js"),o=(r=i(/*! ./amf-parser */"../xgplayer-demux/src/flv/amf-parser.js"))&&r.__esModule?r:{default:r},u=n.EVENTS.DEMUX_EVENTS,l=function(){function e(){c(this,e),this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}return d(e,[{key:"init",value:function(){this.on(u.DEMUX_START,this.doParseFlv.bind(this))}},{key:"doParseFlv",value:function(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;var e=void 0,t=1e5;do{e=this._parseFlvTag()}while(e&&t-- >0);this.emit(u.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;var i=this.loaderBuffer.shift(13);this.parseFlvHeader(i),this.doParseFlv()}}},{key:"parseFlvHeader",value:function(t){if(e.isFlvFile(t)){this._firstFragmentLoaded=!0;var i=e.getPlayType(t[4]);i.hasVideo&&this.initVideoTrack(),i.hasAudio&&this.initAudioTrack()}else this.emit(u.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}},{key:"initVideoTrack",value:function(){this._trackNum++;var e=new s.VideoTrack;e.meta=new n.VideoTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;var e=new s.AudioTrack;e.meta=new n.AudioTrackMeta,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"_parseFlvTag",value:function(){if(this.loaderBuffer.length<11)return null;var e=this._parseFlvTagHeader();return e&&this._processChunk(e),e}},{key:"_parseFlvTagHeader",value:function(){var e=0,t={},i=this.loaderBuffer.toInt(e,1);if(e+=1,t.filtered=(32&i)>>>5,t.tagType=31&i,t.datasize=this.loaderBuffer.toInt(e,3),e+=3,8!==t.tagType&&9!==t.tagType&&11!==t.tagType&&18!==t.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.logger.warn(this.TAG,"tagType "+t.tagType),null;if(this.loaderBuffer.length<t.datasize+15)return null;this.loaderBuffer.shift(4);var r=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);var n=this.loaderBuffer.shift(1)[0];return n>0&&(r+=16777216*n),t.dts=r,this.loaderBuffer.shift(3),t}},{key:"_processChunk",value:function(e){switch(e.tagType){case 18:this._parseScriptData(e);break;case 8:this._parseAACData(e);break;case 9:this._parseHevcData(e);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}},{key:"_parseScriptData",value:function(e){var t=this.tracks.audioTrack,i=this.tracks.videoTrack,r=this.loaderBuffer.shift(e.datasize),n=(new o.default).resolve(r,r.length),a=this._context.onMetaData=n?n.onMetaData:void 0;if(this._context.mediaInfo.duration=a.duration,this._context.mediaInfo.hasVideo=a.hasVideo,this._context.mediaInfo.hsaAudio=a.hasAudio,this._datasizeValidator(e.datasize)&&(this.emit(u.MEDIA_INFO),this._hasScript=!0),t&&!t.hasSpecificConfig){var s=t.meta;switch(a.audiosamplerate&&(s.sampleRate=a.audiosamplerate),a.audiochannels&&(s.channelCount=a.audiochannels),a.audiosamplerate){case 44100:s.sampleRateIndex=4;break;case 22050:s.sampleRateIndex=7;break;case 11025:s.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){var d=i.meta;if("number"==typeof a.framerate){var l=Math.floor(1e3*a.framerate);if(l>0){var f=l/1e3;d.frameRate||(d.frameRate={}),d.frameRate.fixed=!0,d.frameRate.fps=f,d.frameRate.fps_num=l,d.frameRate.fps_den=1e3}}}}},{key:"_aacSequenceHeaderParser",value:function(e){var t={hasSpecificConfig:!0};t.objectType=e[1]>>>3,t.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,t.audiosamplerate=this._switchAudioSampleRate(t.sampleRateIndex),t.channelCount=(120&e[2])>>>3,t.frameLength=(4&e[2])>>>2,t.dependsOnCoreCoder=(2&e[2])>>>1,t.extensionFlagIndex=1&e[2],t.codec="mp4a.40."+t.objectType;var i=void 0,r=void 0,n=window.navigator.userAgent.toLowerCase(),a=t.sampleRateIndex;return-1!==n.indexOf("firefox")?t.sampleRateIndex>=6?(t.objectType=5,r=new Array(4),i=a-3):(t.objectType=2,r=new Array(2),i=a):-1!==n.indexOf("android")?(t.objectType=2,r=new Array(2),i=a):(t.objectType=5,i=t.sampleRateIndex,r=new Array(4),t.sampleRateIndex>=6?i=t.sampleRateIndex-3:1===t.channelCount&&(t.objectType=2,r=new Array(2),i=t.sampleRateIndex)),r[0]=t.objectType<<3,r[0]|=(15&t.sampleRateIndex)>>>1,r[1]=(15&t.sampleRateIndex)<<7,r[1]|=(15&t.channelCount)<<3,5===t.objectType&&(r[1]|=(15&i)>>>1,r[2]=(1&i)<<7,r[2]|=8,r[3]=0),t.config=r,t}},{key:"_parseAACData",value:function(e){var t=this.tracks.audioTrack;if(t){var i=t.meta;i||(i=new n.AudioTrackMeta);var r=this.loaderBuffer.shift(1)[0];e.data=this.loaderBuffer.shift(e.datasize-1);var a=(240&r)>>>4;t.format=a,10!==a&&this.emit(u.DEMUX_ERROR,new Error("invalid audio format: "+a)),10!==a||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(r),i.sampleRateIndex=(12&r)>>>2,i.frameLenth=(2&r)>>>1,i.channelCount=1&r,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));var s=i.audioSampleRate,o=i.sampleRateIndex,d=i.refSampleDuration;delete e.tagType;var l=this._datasizeValidator(e.datasize);if(0===e.data[0]){var f=this._aacSequenceHeaderParser(e.data);s=f.audiosamplerate||i.audioSampleRate,o=f.sampleRateIndex||i.sampleRateIndex,d=Math.floor(1024/s*i.timescale),i.channelCount=f.channelCount,i.sampleRate=s,i.sampleRateIndex=o,i.refSampleDuration=d,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=f.config;var h=this._context.mediaInfo.audio;h.codec=f.codec,h.channelCount=f.channelCount,h.sampleRate=s,h.sampleRateIndex=f.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(u.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&this.emit(u.AUDIO_METADATA_CHANGE),this._hasAudioSequence=!0}else e.data=e.data.slice(1,e.data.length),t.samples.push(e);if(!l){var c=new Error("TAG length error at "+e.datasize);this.emit(u.DEMUX_ERROR,c.message),this.logger.warn(this.TAG,c.message)}}}},{key:"_parseHevcData",value:function(e){var t=this.loaderBuffer.shift(1)[0];e.frameType=(240&t)>>>4,e.isKeyframe=1===e.frameType;var i=15&t;if(this.tracks.videoTrack.codecID=i,e.avcPacketType=this.loaderBuffer.shift(1)[0],e.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){var r=this.loaderBuffer.shift(e.datasize-5);if(e.data=r,0!==Number.parseInt(e.avcPacketType)){this._datasizeValidator(e.datasize)||this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize);var n={},a=0;for(n.cts=e.cts,n.dts=e.dts;e.data.length>a;){var s=e.data.slice(Number.parseInt(a),4+a);n.size=s[3],n.size+=256*s[2],n.size+=256*s[1]*256,n.size+=256*s[0]*256*256,a+=4,n.data=e.data.slice(Number.parseInt(a),n.size+a),a+=n.size,this.tracks.videoTrack.samples.push(n),this.emit(u.METADATA_PARSED,"video")}}else 0===Number.parseInt(e.avcPacketType)&&(this._datasizeValidator(e.datasize)?this.emit(u.METADATA_PARSED,"video"):this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize))}else if(7===i){var o=this.loaderBuffer.shift(e.datasize-5);if(0===o[4]&&0===o[5]&&0===o[6]&&1===o[7]){for(var d=0,l=0;l<4;l++)d=256*d+o[l];d-=4,(o=o.slice(4,o.length))[3]=d%256,d=(d-o[3])/256,o[2]=d%256,d=(d-o[2])/256,o[1]=d%256,o[0]=(d-o[1])/256}if(e.data=o,0===e.avcPacketType)this._avcSequenceHeaderParser(e.data),this._datasizeValidator(e.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(u.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&this.emit(u.VIDEO_METADATA_CHANGE),this._hasVideoSequence=!0);else{if(!this._datasizeValidator(e.datasize))return void this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize);this.tracks.videoTrack.samples.push(e)}}else this.logger.warn(this.TAG,"video codeid is "+i),e.data=this.loaderBuffer.shift(e.datasize-1),this._datasizeValidator(e.datasize)||this.logger.warn(this.TAG,"invalid video tag datasize: "+e.datasize),this.tracks.videoTrack.samples.push(e),this.emit(u.DEMUX_COMPLETE);delete e.tagType}},{key:"_avcSequenceHeaderParser",value:function(e){var t=this.tracks.videoTrack;if(t){var i=0;t.meta||(t.meta=new n.VideoTrackMeta);var r=t.meta;r.configurationVersion=e[0],r.avcProfileIndication=e[1],r.profileCompatibility=e[2],r.avcLevelIndication=e[3]/10,r.nalUnitLength=1+(3&e[4]);var s=31&e[5];i=6;for(var o={},u=0;u<s;u++){var d=255*e[i]+e[i+1];i+=2;for(var l=new Uint8Array(d),f=0;f<d;f++)l[f]=e[i+f];for(var h="avc1.",c=1;c<4;c++){var p=l[c].toString(16);p.length<2&&(p="0"+p),h+=p}r.codec=h,i+=d,this.tracks.videoTrack.meta.sps=l,o=a.SpsParser.parseSPS(l)}var v=e[i];i++;for(var y=0;y<v;y++){var m=255*e[i]+e[i+1];i+=2;for(var g=new Uint8Array(m),_=0;_<m;_++)g[_]=e[i+_];i+=m,this.tracks.videoTrack.meta.pps=g}Object.assign(r,a.SpsParser.toVideoMeta(o));var k=this._context.mediaInfo.video;k.codec=r.codec,k.profile=r.profile,k.level=r.level,k.chromaFormat=r.chromaFormat,k.frameRate=r.frameRate,k.parRatio=r.parRatio,k.width=k.width===r.presentWidth?k.width:r.presentWidth,k.height=k.height===r.presentHeight?k.width:r.presentHeight,r.duration=this._context.mediaInfo.duration*r.timescale,r.avcc=new Uint8Array(e.length),r.avcc.set(e),t.meta=r}}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e){var t=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),t===e+11}},{key:"loaderBuffer",get:function(){var e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(u.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}}],[{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),e}();t.default=l},"../xgplayer-loader/index.js":
/*!***********************************!*\
      !*** ../xgplayer-loader/index.js ***!
      \***********************************/
/*! no static exports found */function(e,t,i){e.exports={FetchLoader:i(/*! ./src/fetch-loader */"../xgplayer-loader/src/fetch-loader.js").default}},"../xgplayer-loader/src/fetch-loader.js":
/*!**********************************************!*\
      !*** ../xgplayer-loader/src/fetch-loader.js ***!
      \**********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(/*! xgplayer-utils */"../xgplayer-utils/index.js").EVENTS.LOADER_EVENTS;t.default=function(){function e(t){c(this,e),this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}return d(e,[{key:"init",value:function(){this.on(r.LADER_START,this.load.bind(this))}},{key:"load",value:function(e,t){var i=this;this.url=e,this._canceled=!1;var n=this.getParams(t);return i.loading=!0,fetch(this.url,n).then((function(e){if(e.ok)return i.status=e.status,i._onFetchResponse(e);i.emit(r.LOADER_ERROR,i,e),i.loading=!1})).catch((function(e){throw i.emit(r.LOADER_ERROR,i,e),i.loading=!1,new Error(e.message)}))}},{key:"_onFetchResponse",value:function(e){var t=this,i=this._context.getInstance(this.buffer);this._loaderTaskNo++;var n=this._loaderTaskNo;if(!0===e.ok)switch(this.readtype){case 2:e.json().then((function(e){t.loading=!1,t._canceled||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))}));break;case 1:e.text().then((function(e){t.loading=!1,t._canceled||(i?(i.push(e),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))}));break;case 3:e.arrayBuffer().then((function(e){t.loading=!1,t._canceled||(i?(i.push(new Uint8Array(e)),t.emit(r.LOADER_COMPLETE,i)):t.emit(r.LOADER_COMPLETE,e))}));break;case 0:default:return this._onReader(e.body.getReader(),n)}}},{key:"_onReader",value:function(e,t){var i=this._context.getInstance(this.buffer);if(i||this._reader.cancel(),this._reader=e,!1!==this.loading){var n=this;this._reader&&this._reader.read().then((function(a){return a.done?(n.loading=!1,n.status=0,void n.emit(r.LOADER_COMPLETE,i)):n._canceled?void n._reader.cancel():(i.push(a.value),n.emit(r.LOADER_DATALOADED,i),n._onReader(e,t))})).catch((function(e){n.emit(r.LOADER_ERROR,n,e),n.loading=!1}))}}},{key:"getParams",value:function(e){var t=Object.assign({},e),i=new Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==l(this.configs.headers)){var n=this.configs.headers;for(var a in n)n.hasOwnProperty(a)&&i.append(a,n[a])}if("object"==l(t.headers)){var s=t.headers;for(var o in s)s.hasOwnProperty(o)&&i.append(o,s[o])}return!1===t.cors&&(r.mode="same-origin"),t.withCredentials&&(r.credentials="include"),r}},{key:"cancel",value:function(){if(this._reader){try{this._reader.cancel()}catch(e){}this._reader=null,this.loading=!1,this._canceled=!0}}},{key:"destroy",value:function(){this.cancel()}}],[{key:"type",get:function(){return"loader"}}]),e}()},"../xgplayer-remux/index.js":
/*!**********************************!*\
      !*** ../xgplayer-remux/index.js ***!
      \**********************************/
/*! no static exports found */function(e,t,i){e.exports={Mp4Remuxer:i(/*! ./src/mp4 */"../xgplayer-remux/src/mp4/index.js").default}},"../xgplayer-remux/src/mp4/fmp4.js":
/*!*****************************************!*\
      !*** ../xgplayer-remux/src/mp4/fmp4.js ***!
      \*****************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),n=function(){function e(){c(this,e)}return d(e,null,[{key:"size",value:function(e){return r.Buffer.writeUint32(e)}},{key:"initBox",value:function(t,i){for(var n=new r.Buffer,a=arguments.length,s=Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return n.write.apply(n,[e.size(t),e.type(i)].concat(s)),n.buffer}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){return e.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}},{key:"moov",value:function(t){var i=t.type,r=t.meta,n=void 0,a=8,s=e.mvhd(r.duration,r.timescale);n="video"===i?e.videoTrak(r):e.audioTrak(r);var o=e.mvex(r.duration,r.timescale||1e3,r.id);return[s,n,o].forEach((function(e){a+=e.byteLength})),e.initBox(a,"moov",s,n,o)}},{key:"mvhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.initBox(8+r.length,"mvhd",new Uint8Array(r))}},{key:"videoTrak",value:function(t){var i=8,r=e.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),n=e.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[r,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"trak",r,n)}},{key:"audioTrak",value:function(t){var i=8,r=e.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),n=e.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[r,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"trak",r,n)}},{key:"tkhd",value:function(t){var i=t.id,r=t.duration,n=t.width,a=t.height,s=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,a>>>8&255,255&a,0,0]);return e.initBox(8+s.byteLength,"tkhd",s)}},{key:"edts",value:function(t){var i=new r.Buffer,n=t.duration,a=t.mediaTime;return i.write(e.size(36),e.type("edts")),i.write(e.size(28),e.type("elst")),i.write(new Uint8Array([0,0,0,1,n>>24&255,n>>16&255,n>>8&255,255&n,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,1])),i.buffer}},{key:"mdia",value:function(t){var i=8,r=e.mdhd(t.timescale,t.duration),n=e.hdlr(t.type),a=e.minf(t);return[r,n,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"mdia",r,n,a)}},{key:"mdhd",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments[1],r=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]);return e.initBox(12+r.byteLength,"mdhd",e.extension(0,0),r)}},{key:"hdlr",value:function(t){var i=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(i.splice(8,4,115,111,117,110),i.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),e.initBox(8+i.length,"hdlr",new Uint8Array(i))}},{key:"minf",value:function(t){var i=8,r="video"===t.type?e.vmhd():e.smhd(),n=e.dinf(),a=e.stbl(t);return[r,n,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"minf",r,n,a)}},{key:"vmhd",value:function(){return e.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}},{key:"smhd",value:function(){return e.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}},{key:"dinf",value:function(){var t=new r.Buffer;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){var i=8,r=e.stsd(t),n=e.stts(),a=e.stsc(),s=e.stsz(),o=e.stco();return[r,n,a,s,o].forEach((function(e){i+=e.byteLength})),e.initBox(i,"stbl",r,n,a,s,o)}},{key:"stsd",value:function(t){var i;return i="audio"===t.type?e.mp4a(t):e.avc1(t),e.initBox(16+i.byteLength,"stsd",e.extension(0,0),new Uint8Array([0,0,0,1]),i)}},{key:"mp4a",value:function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),r=e.esds(t.config);return e.initBox(8+i.byteLength+r.byteLength,"mp4a",i,r)}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],i=t.length,n=new r.Buffer,a=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t).concat([6,1,2]));return n.write(e.size(8+a.byteLength),e.type("esds"),a),n.buffer}},{key:"avc1",value:function(t){var i=new r.Buffer,n=t.width,a=t.height,s=t.parRatio.height,o=t.parRatio.width,u=t.avcc,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),f=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o]);return i.write(e.size(40+d.byteLength+u.byteLength+l.byteLength),e.type("avc1"),d,e.size(8+u.byteLength),e.type("avcC"),u,e.size(20),e.type("btrt"),l,e.size(16),e.type("pasp"),f),i.buffer}},{key:"stts",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stts",t)}},{key:"stsc",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stsc",t)}},{key:"stco",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stco",t)}},{key:"stsz",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return e.initBox(20,"stsz",t)}},{key:"mvex",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i=arguments[2],n=new r.Buffer,a=r.Buffer.writeUint32(t);return n.write(e.size(56),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),a,e.trex(i)),n.buffer}},{key:"trex",value:function(t){var i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.initBox(8+i.byteLength,"trex",i)}},{key:"moof",value:function(t){var i=8,r=e.mfhd(),n=e.traf(t);return[r,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"moof",r,n)}},{key:"mfhd",value:function(){var t=r.Buffer.writeUint32(e.sequence);return e.sequence+=1,e.initBox(16,"mfhd",e.extension(0,0),t)}},{key:"traf",value:function(t){var i=8,r=e.tfhd(t.id),n=e.tfdt(t.time),a=e.sdtp(t),s=e.trun(t,a.byteLength);return[r,n,s,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"traf",r,n,s,a)}},{key:"tfhd",value:function(t){var i=r.Buffer.writeUint32(t);return e.initBox(16,"tfhd",e.extension(0,0),i)}},{key:"tfdt",value:function(t){return e.initBox(16,"tfdt",e.extension(0,0),r.Buffer.writeUint32(t))}},{key:"trun",value:function(t,i){var n=new r.Buffer,a=r.Buffer.writeUint32(t.samples.length),s=r.Buffer.writeUint32(92+16*t.samples.length+i);return n.write(e.size(20+16*t.samples.length),e.type("trun"),new Uint8Array([0,0,15,1]),a,s),t.samples.forEach((function(e){var t=e.flags;n.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))})),n.buffer}},{key:"sdtp",value:function(t){var i=new r.Buffer;return i.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach((function(e){var t=e.flags,r=t.isLeading<<6|t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;i.write(new Uint8Array([r]))})),i.buffer}},{key:"mdat",value:function(t){var i=new r.Buffer,n=8;t.samples.forEach((function(e){n+=e.size})),i.write(e.size(n),e.type("mdat"));var a=new Uint8Array(n),s=0;return a.set(i.buffer,s),s+=8,t.samples.forEach((function(e){e.buffer.forEach((function(e){a.set(e,s),s+=e.byteLength}))})),a}}]),e}();n.type=function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])},n.sequence=1,t.default=n},"../xgplayer-remux/src/mp4/index.js":
/*!******************************************!*\
      !*** ../xgplayer-remux/src/mp4/index.js ***!
      \******************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),a=(r=i(/*! ./fmp4 */"../xgplayer-remux/src/mp4/fmp4.js"))&&r.__esModule?r:{default:r},s=n.EVENTS.REMUX_EVENTS,o=function(){function e(){c(this,e),this._dtsBase=0,this._isDtsBaseInited=!1,this._audioNextDts=null,this._videoNextDts=null,this._videoSegmentList=new n.MediaSegmentList("video"),this._audioSegmentList=new n.MediaSegmentList("audio");var t=n.sniffer.browser;this._fillSilenceFrame="ie"===t,this.videoAllDuration=0,this.audioAllDuration=0}return d(e,[{key:"init",value:function(){this.on(s.REMUX_MEDIA,this.remux.bind(this)),this.on(s.REMUX_METADATA,this.onMetaDataReady.bind(this))}},{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null}},{key:"remux",value:function(){var e=this._context.getInstance("TRACKS"),t=e.audioTrack,i=e.videoTrack;!this._isDtsBaseInited&&this.calcDtsBase(t,i),this._remuxVideo(i),this._remuxAudio(t)}},{key:"seek",value:function(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()}},{key:"onMetaDataReady",value:function(e){var t,i=void 0,r=new n.Buffer,o=a.default.ftyp();i="audio"===e?this._context.getInstance("TRACKS").audioTrack:this._context.getInstance("TRACKS").videoTrack,t=a.default.moov({type:e,meta:i.meta}),r.write(o,t);var u=this._context.getInstance("PRE_SOURCE_BUFFER"),d=u.getSource(e);d||(d=u.createSource(e)),d.mimetype=i.meta.codec,d.init=r,this.emit(s.INIT_SEGMENT,e)}},{key:"calcDtsBase",value:function(e,t){if(e.samples.length||t.samples.length){var i=1/0,r=1/0;e.samples&&e.samples.length&&(i=e.samples[0].dts),t.samples&&t.samples.length&&(r=t.samples[0].dts),this._dtsBase=Math.min(i,r),this._isDtsBaseInited=!0}}},{key:"_remuxVideo",value:function(e){var t=e;if(e.samples&&e.samples.length){for(var i=t.samples,r=-1,o=[],u={samples:[]};i.length;){var d=i.shift(),l=d.isKeyframe,f=void 0,h=void 0,c=d.dts-this._dtsBase;-1===r&&(r=c),d.pts&&(f=(h=d.pts-this._dtsBase)-c),d.cts&&(h=d.cts+c,f=d.cts);var p={buffer:[],size:0};u.samples.push(p),p.buffer.push(d.data),p.size+=d.data.byteLength;var v=0;v=i.length>=1?i[0].dts-this._dtsBase-c:o.length>=1?o[o.length-1].duration:this.videoMeta.refSampleDuration,this.videoAllDuration+=v,o.push({dts:c,cts:f,pts:h,data:d.data,size:d.data.byteLength,isKeyframe:l,duration:v,flags:{isLeading:0,dependsOn:l?2:1,isDependedOn:l?1:0,hasRedundancy:0,isNonSync:l?0:1},originDts:c,type:"video"})}var y=new n.Buffer,m=a.default.moof({id:t.meta.id,time:r,samples:o}),g=a.default.mdat(u);y.write(m,g),t.samples=[],t.length=0;var _=this._context.getInstance("PRE_SOURCE_BUFFER"),k=_.getSource("video");k||(k=_.createSource("video")),k.data.push(y),this.emit(s.MEDIA_SEGMENT,"video")}}},{key:"_remuxAudio",value:function(e){var t=e.samples,i=-1,r=[],o={samples:[]};if(t&&t.length){for(var u=!1;t.length;){var d=t.shift(),l=d.data,f=d.dts-this._dtsBase,h=f;u||(i=f,u=!0);var c=0;c=this.audioMeta.refSampleDurationFixed?this.audioMeta.refSampleDurationFixed:t.length>=1?t[0].dts-this._dtsBase-f:r.length>=1?r[r.length-1].duration:this.audioMeta.refSampleDuration,this.audioAllDuration+=c;var p={dts:f,pts:f,cts:0,size:l.byteLength,duration:d.duration?d.duration:c,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:h,type:"audio"},v={buffer:[],size:0};v.buffer.push(l),v.size+=l.byteLength,o.samples.push(v),r.push(p)}var y=new n.Buffer,m=a.default.moof({id:e.meta.id,time:i,samples:r}),g=a.default.mdat(o);y.write(m,g),e.samples=[],e.length=0;var _=this._context.getInstance("PRE_SOURCE_BUFFER"),k=_.getSource("audio");k||(k=_.createSource("audio")),k.data.push(y),this.emit(s.MEDIA_SEGMENT,"audio",y)}}},{key:"initSilentAudio",value:function(t,i){var r=e.getSilentFrame(this.audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:i,unit:r,size:r.byteLength,originDts:t,type:"video"}}},{key:"videoMeta",get:function(){return this._context.getInstance("TRACKS").videoTrack.meta}},{key:"audioMeta",get:function(){return this._context.getInstance("TRACKS").audioTrack.meta}}],[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();t.default=o},"../xgplayer-utils/index.js":
/*!**********************************!*\
      !*** ../xgplayer-utils/index.js ***!
      \**********************************/
/*! no static exports found */function(e,t,i){e.exports={Context:i(/*! ./src/context */"../xgplayer-utils/src/context.js").default,EVENTS:i(/*! ./src/constants/events */"../xgplayer-utils/src/constants/events.js").default,WORKER_COMMANDS:i(/*! ./src/constants/worker-commands */"../xgplayer-utils/src/constants/worker-commands.js").default,sniffer:i(/*! ./src/env/sniffer */"../xgplayer-utils/src/env/sniffer.js").default,isLe:i(/*! ./src/env/isle */"../xgplayer-utils/src/env/isle.js").default,UTF8:i(/*! ./src/env/utf8 */"../xgplayer-utils/src/env/utf8.js").default,MediaInfo:i(/*! ./src/models/media-info */"../xgplayer-utils/src/models/media-info.js").default,MediaSample:i(/*! ./src/models/media-sample */"../xgplayer-utils/src/models/media-sample.js").default,MediaSegment:i(/*! ./src/models/media-segment */"../xgplayer-utils/src/models/media-segment.js").default,MediaSegmentList:i(/*! ./src/models/media-segment-list */"../xgplayer-utils/src/models/media-segment-list.js").default,AudioTrackMeta:i(/*! ./src/models/track-meta */"../xgplayer-utils/src/models/track-meta.js").AudioTrackMeta,VideoTrackMeta:i(/*! ./src/models/track-meta */"../xgplayer-utils/src/models/track-meta.js").VideoTrackMeta,AudioTrackSample:i(/*! ./src/models/track-sample */"../xgplayer-utils/src/models/track-sample.js").AudioTrackSample,VideoTrackSample:i(/*! ./src/models/track-sample */"../xgplayer-utils/src/models/track-sample.js").VideoTrackSample,Mse:i(/*! ./src/mse/index */"../xgplayer-utils/src/mse/index.js").default,Stream:i(/*! ./src/write/stream */"../xgplayer-utils/src/write/stream.js").default,Buffer:i(/*! ./src/write/buffer */"../xgplayer-utils/src/write/buffer.js").default}},"../xgplayer-utils/node_modules/concat-typed-array/lib/concat.js":
/*!***********************************************************************!*\
      !*** ../xgplayer-utils/node_modules/concat-typed-array/lib/concat.js ***!
      \***********************************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];var a=!0,s=!1,o=void 0;try{for(var u,d=r[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;t+=l.length}}catch(e){s=!0,o=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw o}}var f=new e(t),h=0,c=!0,p=!1,v=void 0;try{for(var y,m=r[Symbol.iterator]();!(c=(y=m.next()).done);c=!0){var g=y.value;f.set(g,h),h+=g.length}}catch(e){p=!0,v=e}finally{try{!c&&m.return&&m.return()}finally{if(p)throw v}}return f}},"../xgplayer-utils/node_modules/concat-typed-array/lib/index.js":
/*!**********************************************************************!*\
      !*** ../xgplayer-utils/node_modules/concat-typed-array/lib/index.js ***!
      \**********************************************************************/
/*! no static exports found */function(e,t,i){var r,n=(r=i(/*! ./concat */"../xgplayer-utils/node_modules/concat-typed-array/lib/concat.js"))&&r.__esModule?r:{default:r};e.exports=n.default},"../xgplayer-utils/src/constants/events.js":
/*!*************************************************!*\
      !*** ../xgplayer-utils/src/constants/events.js ***!
      \*************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},n={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},s={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},u=Object.assign({},r,n,a,s,o),d=[],l=[];for(var f in u)u.hasOwnProperty(f)&&d.push(u[f]);for(var h in u)u.hasOwnProperty(h)&&l.push(u[h]);t.default={ALLEVENTS:u,HLS_EVENTS:o,REMUX_EVENTS:a,DEMUX_EVENTS:n,MSE_EVENTS:s,LOADER_EVENTS:r,FlvAllowedEvents:d,HlsAllowedEvents:l}},"../xgplayer-utils/src/constants/worker-commands.js":
/*!**********************************************************!*\
      !*** ../xgplayer-utils/src/constants/worker-commands.js ***!
      \**********************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},"../xgplayer-utils/src/context.js":
/*!****************************************!*\
      !*** ../xgplayer-utils/src/context.js ***!
      \****************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(/*! ./models/media-info */"../xgplayer-utils/src/models/media-info.js"))&&r.__esModule?r:{default:r},a=i(/*! events */"../../node_modules/events/events.js"),s="__TO__";t.default=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];c(this,e),this._emitter=new a.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new n.default,this.allowedEvents=t,this._hooks={}}return d(e,[{key:"getInstance",value:function(e){return this._instanceMap[e]||null}},{key:"initInstance",value:function(e){if(this._clsMap[e]){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var n=new(Function.prototype.bind.apply(this._clsMap[e],[null].concat(i)));return this._instanceMap[e]=n,n.init&&n.init(),n}throw new Error(e+"未在context中注册")}},{key:"init",value:function(e){if(!this._inited){for(var t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(e,t){var i=this,r=this._emitter,n=this._isMessageNameValid.bind(this),a=this;return this._clsMap[e]=function(t){function i(){var t,r;c(this,i);for(var n=arguments.length,s=Array(n),o=0;o<n;o++)s[o]=arguments[o];return(r=f(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(s)))).listeners={},r.onceListeners={},r.TAG=e,r._context=a,r}return h(i,t),d(i,[{key:"on",value:function(t,i){return n(t),this.listeners[t]?this.listeners[t].push(i):this.listeners[t]=[i],r.on(""+t+s+e,i),r.on(t,i)}},{key:"before",value:function(e,t){n(e),a._hooks[e]?a._hooks[e].push(t):a._hooks[e]=[t]}},{key:"once",value:function(t,i){return n(t),this.onceListeners[t]?this.onceListeners[t].push(i):this.onceListeners[t]=[i],r.once(""+t+s+e,i),r.once(t,i)}},{key:"emit",value:function(e){n(e);var t=a._hooks?a._hooks[e]:null;if(t)for(var i=0,s=t.length;i<s;i++)(0,t[i])();for(var o=arguments.length,u=Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];return r.emit.apply(r,[e].concat(u))}},{key:"emitTo",value:function(e,t){for(var i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return n(t),r.emit.apply(r,[""+t+s+e].concat(a))}},{key:"off",value:function(e,t){return n(e),r.off(e,t)}},{key:"removeListeners",value:function(){var t=Object.prototype.hasOwnProperty.bind(this.listeners);for(var i in this.listeners)if(t(i))for(var n=this.listeners[i]||[],a=0;a<n.length;a++){var o=n[a];r.off(i,o),r.off(""+i+s+e,o)}for(var u in this.onceListeners)if(t(u))for(var d=this.onceListeners[u]||[],l=0;l<d.length;l++){var f=d[l];r.off(u,f),r.off(""+u+s+e,f)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete a._instanceMap[e],u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this))return u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(t),function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return i.initInstance.apply(i,[e].concat(r))}}},{key:"destroyInstances",value:function(){var e=this;Object.keys(this._instanceMap).forEach((function(t){e._instanceMap[t].destroy&&e._instanceMap[t].destroy()}))}},{key:"destroy",value:function(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}},{key:"_isMessageNameValid",value:function(e){if(!this.allowedEvents.indexOf(e)<0)throw new Error("unregistered message name: "+e)}}]),e}()},"../xgplayer-utils/src/env/isle.js":
/*!*****************************************!*\
      !*** ../xgplayer-utils/src/env/isle.js ***!
      \*****************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}();t.default=r},"../xgplayer-utils/src/env/sniffer.js":
/*!********************************************!*\
      !*** ../xgplayer-utils/src/env/sniffer.js ***!
      \********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),n={get device(){var e=n.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(i){return t[i].test(e)})))[0]},get os(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),n=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||n&&/(?:Tablet)/.test(e),s=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:s,isAndroid:r,isPc:!s&&!r&&!i,isSymbian:i,isWindowsPhone:t,isFireFox:n}},get isLe(){return r}};t.default=n},"../xgplayer-utils/src/env/utf8.js":
/*!*****************************************!*\
      !*** ../xgplayer-utils/src/env/utf8.js ***!
      \*****************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){c(this,e)}return d(e,null,[{key:"decode",value:function(t){for(var i=[],r=t,n=0,a=t.length;n<a;)if(r[n]<128)i.push(String.fromCharCode(r[n])),++n;else{if(r[n]<192);else if(r[n]<224){if(e._checkContinuation(r,n,1)){var s=(31&r[n])<<6|63&r[n+1];if(s>=128){i.push(String.fromCharCode(65535&s)),n+=2;continue}}}else if(r[n]<240){if(e._checkContinuation(r,n,2)){var o=(15&r[n])<<12|(63&r[n+1])<<6|63&r[n+2];if(o>=2048&&55296!=(63488&o)){i.push(String.fromCharCode(65535&o)),n+=3;continue}}}else if(r[n]<248&&e._checkContinuation(r,n,3)){var u=(7&r[n])<<18|(63&r[n+1])<<12|(63&r[n+2])<<6|63&r[n+3];if(u>65536&&u<1114112){u-=65536,i.push(String.fromCharCode(u>>>10|55296)),i.push(String.fromCharCode(1023&u|56320)),n+=4;continue}}i.push(String.fromCharCode(65533)),++n}return i.join("")}},{key:"_checkContinuation",value:function(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}}]),e}();t.default=r},"../xgplayer-utils/src/models/media-info.js":
/*!**************************************************!*\
      !*** ../xgplayer-utils/src/models/media-info.js ***!
      \**************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0},n=function(){function e(){c(this,e),this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return d(e,[{key:"isComplete",value:function(){return e.isBaseInfoReady(this)&&e.isVideoReady(this)&&e.isAudioReady(this)}}],[{key:"isBaseInfoReady",value:function(e){return r(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||r(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||r(e.video)}}]),e}();t.default=n},"../xgplayer-utils/src/models/media-sample.js":
/*!****************************************************!*\
      !*** ../xgplayer-utils/src/models/media-sample.js ***!
      \****************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){var i=this;c(this,e);var r=e.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return r;var n=Object.assign({},r,t);Object.entries(n).forEach((function(e){var t=o(e,2),r=t[0],n=t[1];i[r]=n}))}return d(e,null,[{key:"getDefaultInf",value:function(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}]),e}();t.default=r},"../xgplayer-utils/src/models/media-segment-list.js":
/*!**********************************************************!*\
      !*** ../xgplayer-utils/src/models/media-segment-list.js ***!
      \**********************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(t){c(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return d(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,r=0,n=0,a=i,s=0;if(e<t[0].originDts)return-1;for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>t[r].lastSample.originDts&&e<t[r+1].originDts){s=r;break}t[r].originDts<e?n=r+1:a=r-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&e.originStartDts>=t[i].lastSample.originDts&&(i===t.length-1||i<t.length-1&&e.originStartDts<t[i+1].originStartDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(e.originStartDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,e)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!==t?t.lastSample:null}},{key:"getLastRAPBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].randomAccessPoints;0===i.length&&t>0;)t--,i=this._list[t].randomAccessPoints;return i.length>0?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()},"../xgplayer-utils/src/models/media-segment.js":
/*!*****************************************************!*\
      !*** ../xgplayer-utils/src/models/media-segment.js ***!
      \*****************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(){c(this,e),this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}return d(e,[{key:"addRAP",value:function(e){e.isRAP=!0,this.randomAccessPoints.push(e)}}]),e}()},"../xgplayer-utils/src/models/track-meta.js":
/*!**************************************************!*\
      !*** ../xgplayer-utils/src/models/track-meta.js ***!
      \**************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTrackMeta=function(){function e(t){c(this,e);var i={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},i,t):i}return d(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),t.VideoTrackMeta=function(){function e(t){c(this,e);var i={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},i,t):i}return d(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}()},"../xgplayer-utils/src/models/track-sample.js":
/*!****************************************************!*\
      !*** ../xgplayer-utils/src/models/track-sample.js ***!
      \****************************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){c(this,e);var i=e.getDefault();return t?Object.assign({},i,t):i}return d(e,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,data:new Uint8Array}}}]),e}();t.AudioTrackSample=r;var n=function(){function e(t){c(this,e);var i=e.getDefault();return t?Object.assign({},i,t):i}return d(e,null,[{key:"getDefault",value:function(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}]),e}();t.VideoTrackSample=n},"../xgplayer-utils/src/mse/index.js":
/*!******************************************!*\
      !*** ../xgplayer-utils/src/mse/index.js ***!
      \******************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){c(this,e),this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}return d(e,[{key:"init",value:function(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}},{key:"onTimeUpdate",value:function(){this.emit("TIME_UPDATE",this.container)}},{key:"onWaiting",value:function(){this.emit("WAITING",this.container)}},{key:"onSourceOpen",value:function(){this.addSourceBuffers()}},{key:"onUpdateEnd",value:function(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}},{key:"addSourceBuffers",value:function(){if("open"===this.mediaSource.readyState){var e=void 0,t=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");t=t.sources;for(var r=!1,n=0,a=Object.keys(t).length;n<a;n++)if("audio"===(a=Object.keys(t)[n])?e=i.audioTrack:"video"===a&&(e=i.videoTrack),e){var s="audio"===a?21:40;e.meta&&e.meta.refSampleDuration&&(s=e.meta.refSampleDuration),t[a].data.length>=this.preloadTime/s&&(r=!0)}if(r){if(Object.keys(this.sourceBuffers).length>0)return;for(var o=0,u=Object.keys(t).length;o<u;o++){var d=Object.keys(t)[o],l=t[d],f="video"===d?"video/mp4;codecs="+l.mimetype:"audio/mp4;codecs="+l.mimetype,h=this.mediaSource.addSourceBuffer(f);this.sourceBuffers[d]=h,h.addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}}},{key:"doAppend",value:function(){var e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e)for(var t=0;t<Object.keys(this.sourceBuffers).length;t++){var i=Object.keys(this.sourceBuffers)[t],r=this.sourceBuffers[i];if(!r.updating){var n=e.sources[i];if(n&&!n.inited)r.appendBuffer(n.init.buffer.buffer),n.inited=!0;else if(n){var a=n.data.shift();a&&r.appendBuffer(a.buffer.buffer)}}}}},{key:"endOfStream",value:function(){var e=this.mediaSource,t=e.readyState,i=e.activeSourceBuffers;if("open"===t&&0===i.length)try{this.mediaSource.endOfStream()}catch(t){}}},{key:"remove",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;i<Object.keys(this.sourceBuffers).length;i++){var r=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];r.updating||r.remove(t,e)}}},{key:"removeBuffers",value:function(){for(var t=this,i=[],r=function(r){var n=void 0,a=t.sourceBuffers[Object.keys(t.sourceBuffers)[r]];a.removeEventListener("updateend",t.onUpdateEnd),a.updating?n=new Promise((function(t){a.addEventListener("updateend",(function i(){var r=3;setTimeout((function i(){a.updating?r>0?(setTimeout(i,200),r--):t():(e.clearBuffer(a),t())}),200),a.removeEventListener("updateend",i)}))})):(e.clearBuffer(a),n=Promise.resolve()),i.push(n)},n=0;n<Object.keys(this.sourceBuffers).length;n++)r(n);return Promise.all(i)}},{key:"destroy",value:function(){var e=this;return this.removeBuffers().then((function(){for(var t=0;t<Object.keys(e.sourceBuffers).length;t++){var i=e.sourceBuffers[Object.keys(e.sourceBuffers)[t]];e.mediaSource.removeSourceBuffer(i),delete e.sourceBuffers[Object.keys(e.sourceBuffers)[t]]}e.container.removeEventListener("timeupdate",e.onTimeUpdate),e.container.removeEventListener("waiting",e.onWaiting),e.mediaSource.removeEventListener("sourceopen",e.onSourceOpen),e.endOfStream(),window.URL.revokeObjectURL(e.url),e.url=null,e.configs={},e.container=null,e.mediaSource=null,e.sourceBuffers={},e.preloadTime=1}))}}],[{key:"clearBuffer",value:function(e){for(var t=e.buffered,i=.1,r=0,n=t.length;r<n;r++)i=t.end(r);try{e.remove(0,i)}catch(e){}}}]),e}();t.default=r},"../xgplayer-utils/src/write/buffer.js":
/*!*********************************************!*\
      !*** ../xgplayer-utils/src/write/buffer.js ***!
      \*********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=i(/*! concat-typed-array */"../xgplayer-utils/node_modules/concat-typed-array/lib/index.js"))&&r.__esModule?r:{default:r};t.default=function(){function e(t){c(this,e),this.buffer=t||new Uint8Array(0)}return d(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach((function(t){e.buffer=(0,n.default)(Uint8Array,e.buffer,t)}))}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}},{key:"readAsInt",value:function(e){var t="";return e.forEach((function(e){t+=function(e){return e.toString(16).padStart(2,"0")}(e)})),parseInt(t,16)}}]),e}()},"../xgplayer-utils/src/write/stream.js":
/*!*********************************************!*\
      !*** ../xgplayer-utils/src/write/stream.js ***!
      \*********************************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){if(c(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return d(e,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(t){for(var i=Math.floor(t/4),r=t%4,n=0;n<i;n++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,i){var r=void 0;switch(t){case 1:r=i?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=i?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(i)throw new Error("not supported for readByte 3");r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=i?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(i)throw new Error("not supported for readBody 8");r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),e}();t.default=r},"./src/flv-vod.js":
/*!************************!*\
      !*** ./src/flv-vod.js ***!
      \************************/
/*! no static exports found */function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=f(i(/*! ../../xgplayer-demux/src/flv */"../xgplayer-demux/src/flv/index.js")),n=f(i(/*! xgplayer-remux */"../xgplayer-remux/index.js")),a=i(/*! xgplayer-loader */"../xgplayer-loader/index.js"),s=i(/*! xgplayer-buffer */"../xgplayer-buffer/index.js"),o=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),u=i(/*! xgplayer-codec */"../xgplayer-codec/index.js"),l=f(i(/*! xgplayer */"xgplayer"));function f(e){return e&&e.__esModule?e:{default:e}}var h=o.EVENTS.REMUX_EVENTS,p=o.EVENTS.DEMUX_EVENTS,v=o.EVENTS.LOADER_EVENTS,y="FLVController",m=function(){function e(){c(this,e)}return d(e,[{key:"warn",value:function(){}}]),e}(),g=function(){function e(t){c(this,e),this.TAG=y,this._player=t,this.state={initSegmentArrived:!1,range:{start:0,end:""},rangeSupport:!0}}return d(e,[{key:"init",value:function(){var e=this;this._context.registry("FETCH_LOADER",a.FetchLoader),this._context.registry("LOADER_BUFFER",s.XgBuffer),this._context.registry("FLV_DEMUXER",r.default),this._context.registry("TRACKS",s.Tracks),this._context.registry("MP4_REMUXER",n.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",s.PreSource),this._context.registry("COMPATIBILITY",u.Compatibility),this._context.registry("LOGGER",m),this.mse=this._context.registry("MSE",o.Mse)({container:this._player.video}),this.initListeners(),setTimeout((function(){e.loadMeta()}),0)}},{key:"initListeners",value:function(){this.on(v.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(p.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(p.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(p.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(p.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(h.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(h.MEDIA_SEGMENT,this._handleMediaSegment.bind(this))}},{key:"_handleMediaInfo",value:function(){var e=this;this._context.onMetaData||this.emit(p.DEMUX_ERROR,new Error("failed to get mediainfo"));var t=this._context.getInstance("LOADER_BUFFER"),i=this._context.getInstance("FETCH_LOADER");this.isSeekable&&(i.cancel(),this.state.range={start:0,end:t.historyLen-1},setTimeout((function(){e.loadNext(0)})))}},{key:"_handleLoaderDataLoaded",value:function(){this.emitTo("FLV_DEMUXER",p.DEMUX_START)}},{key:"_handleMetadataParsed",value:function(e){this.emit(h.REMUX_METADATA,e)}},{key:"_handleDemuxComplete",value:function(){this.emit(h.REMUX_MEDIA)}},{key:"_handleAppendInitSegment",value:function(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}},{key:"_handleMediaSegment",value:function(){this.mse.addSourceBuffers(),this.mse.doAppend()}},{key:"_handleDemuxError",value:function(){this._player.emit("error",new l.default.Errors("parse",this._player.config.url))}},{key:"seek",value:function(e){if(this._context.onMetaData){if(this.isSeekable){this._context.getInstance("LOADER_BUFFER").clear();var t=this._player.config.preloadTime,i=void 0===t?15:t,r=this.getSeekRange(e,i);this.state.range=r,this.loadData()}}else this.loadMeta()}},{key:"loadNext",value:function(e){this._context.onMetaData&&(this.loader.loading||this.getNextRange(e)&&this.loadData())}},{key:"loadData",value:function(){var e=this.state.range,t=e.start,i=e.end;this.emit(v.LADER_START,this._player.config.url,{headers:{method:"get",Range:"bytes="+t+"-"+i}})}},{key:"loadMeta",value:function(){var e=this;this.loader.load(this._player.config.url,{headers:{Range:"bytes=0-"}}).catch((function(){e.state.rangeSupport=!1,e.loadFallback()}))}},{key:"loadFallback",value:function(){var e=this;this.loader.load(this._player.config.url).catch((function(){e._player.emit("error",new l.default.Errors("network",e._player.config.url))}))}},{key:"getSeekRange",value:function(t,i){var r=this._context.onMetaData.keyframes,n=this._context.mediaInfo.duration,a=t,s=t+i,o=e.findFilePosition(a,r);return s>=n||a>=n?{start:o,end:""}:{start:o,end:e.findFilePosition(s,r)}}},{key:"getNextRange",value:function(e){if(""!==this.state.range.end){var t=this.getSeekRange(e,this.config.preloadTime||15).end;return t<=this.state.range.end&&""!==t?void 0:(this.state.range={start:this.state.range.end+1,end:t},!0)}}},{key:"destroy",value:function(){this._player=null,this.mse=null,this.state={initSegmentArrived:!1,range:{start:0,end:""},rangeSupport:!0}}},{key:"isSeekable",get:function(){return!!this.state.rangeSupport&&(!this._context||!this._context.mediaInfo.isComplete()||null!==this._context.mediaInfo.keyframes&&void 0!==this._context.mediaInfo.keyframes)}},{key:"config",get:function(){return this._player.config}},{key:"loader",get:function(){return this._context.getInstance("FETCH_LOADER")}}],[{key:"findFilePosition",value:function(e,t){for(var i=0,r=t.times.length;i<r;i++){var n=t.times[i],a=i+1<r?t.times[i+1]:Number.MAX_SAFE_INTEGER;if(n<=e&&e<=a)return t.filepositions[i]}return""}}]),e}();t.default=g},"./src/index.js":
/*!**********************!*\
      !*** ./src/index.js ***!
      \**********************/
/*! no static exports found */function(e,t,i){var r=s(i(/*! xgplayer */"xgplayer")),n=i(/*! xgplayer-utils */"../xgplayer-utils/index.js"),a=s(i(/*! ./flv-vod */"./src/flv-vod.js"));function s(e){return e&&e.__esModule?e:{default:e}}var o=n.EVENTS.FlvAllowedEvents;e.exports=function(e){function t(e){var i;return c(this,t),(i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))).context=new n.Context(o),i.initEvents(),i}return h(t,e),d(t,[{key:"start",value:function(){var e=this.context.registry("FLV_CONTROLLER",a.default)(this);this.flv=e,this.context.init(),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this,e.mse.url)}},{key:"initEvents",value:function(){this.on("timeupdate",this.handleTimeUpdate.bind(this)),this.on("seeking",this.handleSeek.bind(this)),this.once("destroy",this._destroy.bind(this))}},{key:"handleTimeUpdate",value:function(){this.loadData(),function(e,t){if(!e.config.isLive&&e.duration-e.currentTime<2){var i=e.getBufferedRange();e.currentTime-i[1]<.1&&(e.emit("ended"),t.mse.endOfStream())}}(this,this.flv)}},{key:"handleSeek",value:function(){var e=this.currentTime,t=this.getBufferedRange();(e>t[1]||e<t[0])&&this.flv.seek(this.currentTime)}},{key:"_destroy",value:function(){this.context.destroy(),this.context=null,this.flv=null}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTime,t=this.getBufferedRange();t[1]-e<(this.config.preloadTime||15)-5&&this.flv.loadNext(t[1]+1)}},{key:"src",get:function(){return this.currentSrc},set:function(e){var t=this;this.player.config.url=e,this.paused?this.start(e):(this.pause(),this.once("pause",(function(){t.start(e)})),this.once("canplay",(function(){t.play()}))),this.once("canplay",(function(){t.currentTime=0}))}}]),t}(r.default)},0:
/*!****************************!*\
      !*** multi ./src/index.js ***!
      \****************************/
/*! no static exports found */function(e,t,i){e.exports=i(/*! ./src/index.js */"./src/index.js")},xgplayer:
/*!***************************!*\
      !*** external "xgplayer" ***!
      \***************************/
/*! no static exports found */function(t,i){t.exports=e}})},"object"==l(t)&&"object"==l(e)?e.exports=s(i(0)):(n=[i(0)],void 0===(a="function"==typeof(r=s)?r.apply(t,n):r)||(e.exports=a))}).call(this,i(1)(e))}])}));